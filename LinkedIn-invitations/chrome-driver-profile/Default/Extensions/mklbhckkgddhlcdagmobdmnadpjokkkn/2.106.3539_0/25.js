"use strict";(self.webpackChunkguru_ui=self.webpackChunkguru_ui||[]).push([[25],{71780:function(e,t,i){i.r(t),i.d(t,{default:function(){return Y}});i(33948);var r=i(67294),a=i(94184),s=i.n(a),n=i(41609),c=i.n(n),o=i(45697),l=i.n(o),d=i(73935),p=i(19904),h=i(31439),v=i(11609),m=i(27361),u=i.n(m),f=i(51644),g=i(42584),E=i.n(g),w=i(22386),N=i(95587),y=i(27008),Z=i(4879),q=i(7350);class C extends r.Component{render(){const{showTooltip:e,hideTooltip:t,children:i}=this.props;return r.createElement("div",{className:"ghq-listdisplaycard-metadata",onMouseEnter:e,onMouseLeave:t},i)}}const T=(0,w.Z)(C);class S extends r.Component{composeVerifierName(){const{card:e}=this.props;return e.lastVerifiedBy?y.Z.getNameFromModel(e.lastVerifiedBy):null}composeVerifierDate(){const{card:e}=this.props;return e.lastVerified?r.createElement(q.Z,{date:e.lastVerified}):null}render(){const{NEEDS_VERIFICATION:e,TRUSTED:t,SYNCED_NO_VERIFICATION:i}=E(),a=N.Z.hasKnowledgeSyncVerifiers(),{card:n}=this.props,c=this.composeVerifierName(),o=this.composeVerifierDate(),l=u()(n,"collection.collectionType")===f.Z.EXTERNAL,d=n.verificationState===i,p=(a||!l)&&n.verificationState===t,h=(a||!l)&&n.verificationState===e;let v,m="Verified";l?m="Synced Card":h&&(m="Unverified");const g=s()("ghq-listdisplaycard-verification-text",{"ghq-verification-synced":l,"ghq-needs-verification":h,"ghq-has-knowledge-sync-verifiers":a});return v=c&&o?r.createElement("div",{className:"ghq-listdisplaycard-verification-tool-tip"},r.createElement("p",{className:g},m),r.createElement("p",{className:"ghq-listdisplaycard-verification-message"},"Last verified by",r.createElement("span",{className:"ghq-listdisplaycard-verification-message-name"}," ",c)),r.createElement("p",{className:"ghq-listdisplaycard-verification-message"},"on ",o,".")):r.createElement("div",{className:"ghq-listdisplaycard-verification-tool-tip"},r.createElement("p",{className:g},m),r.createElement("p",{className:"ghq-listdisplaycard-verification-message"},"This card has never been verified before")),r.createElement(T,{tooltipped:{message:v}},r.createElement(Z.Z,{isSynced:a?d:l,isTrusted:p}))}}var P=i(65185),I=i(21112),_=i.n(I),D=i(4439),V=i(56893),F=i(64925),b=i(60500),k=i(44371),M=i(6759),R=i(12713),L=i(90315),A=i(49768),H=i(43387),B=i(25108);const O=(e,t)=>{if(e===A.Z.getName()){const e=H.Z.getBySearchId(u()(t,"fact.id",null)),i=u()(e,"data",[]).filter((e=>"user-group"===e.type));if(i.length)return i[0].id}else B.error("filter not set")};class U extends r.Component{constructor(){super(...arguments),this.verifyFact=()=>{const{fact:e}=this.props;h.Z.verifyFact(e.id,{callback:()=>{k.Z.getNoCache(R.GLOBAL,{pathVars:[L.Z.getEmail()]})}})},this.loadGroupMembers=()=>{const{verifiers:e}=this.props;e.status===E().LOADED&&"user-group"===u()(e,"data[0]",{}).type&&b.Z.get(O(A.Z.getName(),this.props),{pathVars:[e.data[0].id]})},this.renderBackButton=()=>{const{handleBack:e}=this.props;return e?r.createElement("div",{className:"ghq-verification-status__back",onClick:e},r.createElement(v.Z,{icon:"chevron-left",size:28})):null},this.getTitle=()=>{const{fact:e}=this.props,t=u()(e,"data.verificationState");return u()(e,"data.collection.collectionType")===f.Z.EXTERNAL?"Synced card":t===E().TRUSTED?"Trusted":"Untrusted"}}componentDidUpdate(e){const t=u()(e.verifiers,"data[0]",{}),i=u()(this.props.verifiers,"data[0]",{});t.id!==i.id&&this.loadGroupMembers()}render(){const{fact:e,isVerifier:t}=this.props,i=u()(e,"data.verificationState"),a=u()(e,"data.collection.collectionType")===f.Z.EXTERNAL,n=s()("ghq-verification-status",{"ghq-fact-synced":a,"ghq-fact-trusted":!a&&i===E().TRUSTED,"ghq-fact-needs-verification":!a&&i===E().NEEDS_VERIFICATION});let c=this.getTitle();const o=!a&&i===E().NEEDS_VERIFICATION&&t?r.createElement(M.Z,{branded:!0,value:"Verify",icon:"verification",onClick:this.verifyFact}):null,l=this.renderBackButton();return r.createElement("div",{className:n},r.createElement("span",{className:"ghq-verification-status-title"},c),o,l)}}var x=(0,D.Z)(((e,t)=>{const{fact:i}=t,r=L.Z.getState(),a=H.Z.getBySearchId(i.id),s=O(A.Z.getName(),t),n=s?A.Z.getFilter(s):null;return{isVerifier:a.data.some((e=>{if("user"===e.type)return e.user.email===r.data.email}))||n&&n.items.data.some((e=>e.user.email===r.data.email))}}),O)([H.Z,A.Z,L.Z],U),X=i(52341),z=i(43714),G=i(47482),W=i(23525);class K extends r.Component{constructor(){super(...arguments),this.updatePreviewHeight=()=>{const e=this.refs.previewHeader;if(e&&200===this.state.previewHeight){const t=d.findDOMNode(e).getBoundingClientRect();this.setState({previewHeight:200+t.height})}},this.trackPreview=()=>{const{preview:e,searchId:t,searchSessionId:i,searchPosition:r,activity:a,activityId:s}=this.props;p.Z.postActivity({searchId:t,searchSessionId:i,searchPosition:r,type:W.default.CARD_PREVIEWED,properties:{factId:e.id,activityId:s,activitySubType:a},biOnly:!0})},this.renderCardMeta=()=>{const{preview:e}=this.props,{PUBLIC:t}=_().visibility,i=e.shareStatus===t?r.createElement(v.Z,{className:"ghq-NewListDisplayCard__public-icon",icon:"file-sharing",size:12}):null,a=e.favorited?r.createElement(v.Z,{className:"ghq-NewListDisplayCard__icon-heart",icon:"favorite-filled",size:12}):null;return r.createElement("div",{className:"ghq-factcard-container-meta"},i,a)},this.renderTitleInfo=()=>{const{preview:e}=this.props,{preferredPhrase:t}=e;return r.createElement("div",{className:"ghq-NewPreviewFact__title"},r.createElement(S,{card:e}),r.createElement("div",null,t))},this.renderCardContent=()=>{const{preview:e}=this.props,{id:t}=e;return r.createElement("div",{className:"ghq-NewPreviewFact__body","data-testid":"Card preview"},r.createElement(V.Z,{readOnly:!0,id:t,fact:e}))},this.handleMouseLeave=()=>{const{closePopover:e}=this.props;e()},this.handleMouseEnter=()=>{const{openPopover:e}=this.props;e()},this.handleClick=()=>{const{preview:e,closePopover:t}=this.props;h.Z.openFact(e.id,{}),t()}}UNSAFE_componentWillMount(){this.setState({previewHeight:200,winHeight:window.innerHeight})}componentDidMount(){this.updatePreviewHeight(),this.timeout=window.setTimeout((()=>{this.trackPreview()}),2e3)}componentDidUpdate(){this.updatePreviewHeight()}componentWillUnmount(){this.timeout&&window.clearTimeout(this.timeout)}renderCollectionInfo(){const{preview:e,openPopover:t,closePopover:i}=this.props,{collection:a,id:s}=e,n=a?r.createElement(F.Z,{clickable:!0,id:s,cardClosePopover:i,cardOpenPopover:t,collectionColor:a.color,collectionName:a.name}):null;return r.createElement("div",{className:"ghq-factcard-container-collection-info"},n)}render(){const{previewPointerDirection:e,preview:t,previewMessage:i}=this.props;if(c()(t.content))return null;let a=t.top;this.state.winHeight-(a+this.state.previewHeight)<0&&(a=this.state.winHeight-this.state.previewHeight);let n="ghq-NewPreviewFact";const o=s()("ghq-NewFactViewContainer"),l=s()("ghq-NewPreviewFact__pointer",{"ghq-NewPreviewFact__pointer-right":e===P.pX,"ghq-NewPreviewFact__pointer-left":e===P.RL}),d=this.renderCollectionInfo(),p=this.renderCardContent();let h,v="",m=null,u=t.verificationState;if(t.searchTerm){v="ghq-preview-header-search";let e=null;i&&(e=r.createElement("div",{className:"ghq-preview-search-text"},i)),h=r.createElement("div",{ref:"previewFooter",className:v},e,r.createElement("div",{className:"ghq-preview-search-label"},"Search:"),r.createElement("div",{className:"ghq-preview-search-text"},t.searchTerm))}else t.isVerbose?(u===E().TRUSTED?(v="ghq-preview-header-trusted",m="Trusted"):u===E().NEEDS_VERIFICATION&&(v="ghq-preview-header-needs-verification",m="Untrusted"),h=r.createElement("div",{ref:"previewFooter",className:v},r.createElement(x,{fact:t,status:null,title:m}),r.createElement(X.Z,{fact:t}),r.createElement(z.Z,{fact:t,verifierName:"you"}))):i&&(h=r.createElement("div",{ref:"previewFooter",className:"ghq-preview-footer-container"},r.createElement("div",{className:"ghq-preview-header-label"},i)));return h&&(n+=" preview-with-footer"),r.createElement("div",{className:n,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,onClick:this.handleClick},r.createElement("div",{className:o},d,p),h,r.createElement("div",{className:l}))}}K.propTypes={previewPointerDirection:l().string},K.defaultProps={previewPointerDirection:P.pX};var Y=(0,D.Z)((()=>({preview:G.ZP.getPreviewState()})))([G.ZP,N.Z],K)}}]);