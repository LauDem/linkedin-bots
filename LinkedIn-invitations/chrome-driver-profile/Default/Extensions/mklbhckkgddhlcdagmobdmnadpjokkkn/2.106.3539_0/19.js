(self.webpackChunkguru_ui=self.webpackChunkguru_ui||[]).push([[19],{68897:function(e,t,a){"use strict";var n=a(2514),r=a(57922),s=a(47421),i=a(29857),o=a(74173),l=a(25108);const c=i.Z.getFlux().dispatcher,d=new n.Z({name:o.Z.getName(),boundActions:{loadMoreFavoriteListItems(e,t){r.ZP.callApi(c,s.LOAD_MORE_FAVORITE_LIST_ITEMS,"/cards/bulk",{type:"POST",contentType:"application/json",data:JSON.stringify({ids:t})},{filterId:e,ids:t})}}}),m=i.Z.getFlux().actions[d.name];m||l.error("Error creating actions"),t.Z=m},76462:function(e,t,a){"use strict";var n=a(2514),r=a(29857),s=a(55173),i=a(25108);const o=new n.Z({name:s.Z.getName()}),l=r.Z.getFlux().actions[o.name];l||i.error("Error creating actions"),t.Z=l},70724:function(e,t,a){"use strict";var n=a(2514),r=a(29857),s=a(17233),i=a(25108);const o=new n.Z({name:s.Z.getName()}),l=r.Z.getFlux().actions[o.name];l||i.error("error creating actions"),t.Z=l},81594:function(e,t,a){"use strict";a.d(t,{Z:function(){return i}});a(33948);var n=a(73424),r=a(27949),s=a(5257);function i(){const[e,t]=(0,r.Z)({store:s.Z,actions:n.Z});return[e,t]}},74983:function(e,t,a){"use strict";a.d(t,{Z:function(){return d}});a(33948);var n=a(76462),r=a(3486),s=a(12713),i=a.n(s),o=a(13011),l=a(47111),c=a(55173);function d(){const[e]=(0,o.Z)(r.Z.FAVORITE_LISTS_ALLOWED);return(0,l.Z)({filterId:i().GLOBAL,store:c.Z,actions:n.Z,onMustLoad:t=>{e&&t.get()}})}},77843:function(e,t,a){"use strict";a(33948),a(99244);var n=a(85945),r=a(98596),s=a(36492),i=a(64469),o=a(27998),l=a(31954);const c=new o.Z,d=async(e,t)=>await c.getPaginated({path:"/users/".concat(e,"/following"),queryParams:t?{token:t}:void 0}).catch((e=>{if(new RegExp(/404/).test(e.message))return{data:[],token:void 0}})),m=async(e,t)=>await c.getPaginated({path:"/users/".concat(e,"/followers"),queryParams:t?{token:t}:void 0}).catch((e=>{if(new RegExp(/404/).test(e.message))return{data:[],token:void 0}})),u=async e=>c.get({path:"/users/".concat(e,"/follows")}),h=async e=>{let{id:t,isFollowing:a,variables:n={}}=e;const r={path:"/users/".concat(t,"/follow"),activityHeaders:n.activityHeaders};return a?c.delete(r):c.put(r)},p=(e,t)=>["PersonFollows",e,t];t.Z=function(e){var t,a;let o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const c=(0,n.NL)(),[{data:{id:g}}]=(0,l.Z)(),{data:f,isLoading:E,refetch:v,fetchNextPage:C}=(0,r.N)(p(e,"following"),(t=>d(e,t.pageParam)),{getNextPageParam:e=>null==e?void 0:e.token,enabled:o}),{data:y,isLoading:b,refetch:S,fetchNextPage:Z}=(0,r.N)(p(e,"followers"),(t=>m(e,t.pageParam)),{getNextPageParam:e=>null==e?void 0:e.token,enabled:o}),{data:N,isLoading:I,refetch:T}=(0,s.a)(p(e,"data"),(()=>u(e)),{enabled:o}),A=(0,i.D)((function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return h({id:e,isFollowing:t.isFollowedByCurrentUser||(null==N?void 0:N.isFollowedByCurrentUser),variables:t})}),{onSuccess:(e,t)=>{null!=t&&t.callback?t.callback():(c.invalidateQueries(p(g,"following")),c.invalidateQueries(p(g,"followers")),c.invalidateQueries(p(g,"data")),S(),v(),T())}});return{isLoading:E||I||b,following:null!==(t=null==f?void 0:f.pages.flatMap((e=>e.data)))&&void 0!==t?t:[],followers:null!==(a=null==y?void 0:y.pages.flatMap((e=>e.data)))&&void 0!==a?a:[],followData:null!=N?N:{},fetchNextPageOfFollowers:Z,fetchNextPageOfFollowing:C,followPerson:A.mutate,refetchFollowData:T}}},67176:function(e,t,a){"use strict";a.d(t,{D:function(){return m}});a(33948);var n=a(67294),r=a(85945),s=a(36492),i=a(64469),o=a(27998),l=a(36508);const c=new o.Z,d="REACTJIS";let m;!function(e){e.CardComment="card-comment",e.CardCommentReply="card-comment-reply"}(m||(m={}));const u=e=>c.delete({path:"/reactions/".concat(e)}),h=e=>{let{type:t,typeId:a,reaction:n}=e;return c.post({path:"/reactions",body:{type:t,typeId:a,reaction:n}})};t.Z=e=>{var t;let{reactions:a,typeId:o,type:m}=e;const p=(0,r.NL)(),g=[d,m,o],[f,E]=(0,n.useState)(""),v=(0,s.a)(g,(()=>a.map((e=>(0,l.r)(e))))),C=[m,o,f].every((e=>e)),y=(0,s.a)([d,m,o,f],(()=>(e=>{let{type:t,typeId:a,reaction:n}=e;return c.get({path:"/reactions/".concat(t,"/").concat(a,"?reaction=").concat(encodeURIComponent(n))})})({type:m,typeId:o,reaction:f})),{enabled:C,onSuccess:e=>{e&&p.setQueryData(g,(t=>{if(t)return((e,t,a)=>{let{reactions:n}=a;const{foundReaction:r,cleanedShortcode:s}=(0,l.X)(e,t);return r&&(r.reactors=n[s].userNames,r.hasOthers=n[s].hasOthers),e})(t,f,e)}))}}),b=(0,i.D)(u,{onSuccess:(e,t)=>{p.setQueryData(g,(e=>{if(e)return((e,t)=>{const a=e.findIndex((e=>e.currentUserReactionId===t));return a>-1&&(e[a].count--,e[a].currentUserReactionId=void 0,e[a].youReacted=!1,0===e[a].count&&e.splice(a,1)),e})(e,t)}))}}),S=(0,i.D)(h,{onSuccess:(e,t)=>{let{reaction:a}=t;p.setQueryData(g,(t=>{if(t&&null!=e&&e.reactionId)return((e,t,a)=>{const{cleanedShortcode:n,foundReaction:r}=(0,l.X)(e,a);return r?r.youReacted||(r.currentUserReactionId=t,r.youReacted=!0,r.count++):e.push({count:1,youReacted:!0,currentUserReactionId:t,shortcodes:n,reactors:[]}),e})(t,e.reactionId,a)}))}});return{isLoaded:v.isFetched,reactjis:null!==(t=v.data)&&void 0!==t?t:[],unreactToItem:b.mutate,reactToItem:S.mutate,getWhoReacted:E,whoReacted:y.data}}},36508:function(e,t,a){"use strict";a.d(t,{X:function(){return r},r:function(){return n}});a(15306);const n=e=>{let{count:t,shortcode:a,currentUserReactionId:n}=e;return{count:t,shortcodes:a,youReacted:Boolean(n),currentUserReactionId:n,reactors:[]}},r=(e,t)=>{const a=e=>e.split("::")[0].replace(/:/g,""),n=a(t),r=e.find((e=>a(e.shortcodes)===n));return{cleanedShortcode:n,foundReaction:r}}},79136:function(e,t,a){"use strict";var n=a(67294),r=a(19887),s=a(80007),i=a(66674),o=a(2803),l=a(32195),c=a(50811),d=a(24594),m=a(76030),u=a(40510);t.Z=e=>{let{handleClickOutside:t,handleCreateList:a,handleInputChange:h,onClickClose:p,newListName:g="",title:f=(0,s.Z)("modals.newList.defaultHeading")}=e;const E=g.length<1,v=g.length>25,C=(0,i.Z)(t,[]),{t:y}=(0,r.$G)(),b=()=>n.createElement(l.ZP,{aria:y("common.close"),icon:m.Z.Close,style:l.Dd.Standard,onClick:p});return n.createElement("div",{className:"NewListModal",ref:C},n.createElement(u.ZP,null,n.createElement(u.MM,{appendage:n.createElement(b,null)},f),n.createElement(u.R3,null,n.createElement(d.Z,{autofocus:!0,label:y("modals.newList.inputLabel"),value:g,name:"newList",placeholder:y("modals.newList.placeholder"),maxCharacterCount:25,onChange:h})),n.createElement(u.v3,null,n.createElement(c.Z,{alignment:c.A.Right},n.createElement(o.ZP,{label:y("common.cancel"),style:o.ZJ.Text,theme:o.bn.Gray,onClick:p}),n.createElement(o.ZP,{disabled:E||v,label:y("modals.newList.saveListButtonLabel"),theme:o.bn.Primary,onClick:a})))))}},18512:function(e,t,a){"use strict";a.d(t,{L:function(){return u}});a(33948);var n=a(67294),r=a(11609),s=a(3486),i=a(54159),o=a(42584),l=a.n(o),c=a(13011),d=a(74983),m=a(21650);const u={NO_SEARCH_RESULTS:"NO_SEARCH_RESULTS"};t.Z=e=>{let{view:t="",searchState:a,searchedMessage:o="No cards were found.",savedSearchId:h=""}=e;const[{items:{editData:p=[]},status:g}]=(0,d.Z)(),[f,E]=n.useState(!1),[v]=(0,c.Z)(s.Z.FAVORITE_LISTS_ALLOWED);n.useEffect((()=>{const e=p.reduce(((e,t)=>e+t.numberOfFacts),0);E(e>0)}),[p,g]);const C=(()=>{switch(a){case l().SEARCHING:return"Searching...";case l().SEARCHED:case l().LOADED:return h===i.Z.MY_FAVORITES?v&&f?n.createElement("div",null,n.createElement("p",null,"You haven't added any Cards to this list. Click the",n.createElement("span",{className:"ghq-SearchHint__icon-chevron"},n.createElement(r.Z,{size:20,icon:"chevron-right"})),"next to the",n.createElement("span",{className:"ghq-SearchHint__icon"},n.createElement(r.Z,{size:20,icon:"favorite-empty",title:"Favorites"})),"icon on any Card to add it here.")):n.createElement("div",null,n.createElement("p",null,"You haven't Favorited any Cards yet."),n.createElement("p",null,"Click the",n.createElement("span",{className:"ghq-SearchHint__icon"},n.createElement(r.Z,{size:20,icon:"favorite-empty",title:"Favorites"})),"icon on a Card to add it here.")):h||t!==u.NO_SEARCH_RESULTS?o:n.createElement(m.ZP,null,"No cards were found. Try editing your search, or removing any filters you may have applied.");case l().EMPTY_SEARCH:return"You forgot to enter something to search!";default:return"What are you looking for?"}})();return n.createElement("div",{"aria-live":"polite",className:"ghq-SearchHint"},C)}},51330:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return Nv}});a(33948);var n=a(67294),r=a(94184),s=a.n(r),i=a(27361),o=a.n(i),l=a(23493),c=a.n(l),d=a(31439),m=a(81510),u=a(77110),h=a(4439),p=a(2514),g=a(29857),f=a(84801),E=a(12713),v=a.n(E),C=a(27171);f.Z.register(E.PublicCardTemplate,{GET:{path:"/cards/:cardId/public"}});const y=new C.Z({name:E.PublicCardTemplate,dataType:v().OBJECT});y.createStore();var b=g.Z.addStore(y.store),S=a(25108);const Z=new p.Z({name:b.getName()}),N=g.Z.getFlux().actions[Z.name];N||S.error("error creating actions");var I=N,T=a(47111);a(15306);var A=a(23279),_=a.n(A),w=a(45697),D=a.n(w),P=a(73935),k=a(45918),L=a.n(k),M=a(19904),O=a(73424);f.Z.register(E.TeamsAttributes,{GET:{path:"/teams/:teamId/attributes"}});const F=new C.Z({name:E.TeamsAttributes,syncFilters:!1});F.createStore();var R=g.Z.addStore(F.store),x=a(25108);const q=new p.Z({name:R.getName()}),B=g.Z.getFlux().actions[q.name];B||x.error("error creating actions");var V=B,U=a(2348),H=a(25108);const W=new p.Z({name:U.Z.getName()}),G=g.Z.getFlux().actions[W.name];G||H.error("error creating actions");var z=G,Y=a(88205),K=a(4252),j=a(25108);const J=new p.Z({name:K.Z.getName()}),Q=g.Z.getFlux().actions[J.name];Q||j.error("error creating actions");var X=Q,$=a(59806),ee=a(51575),te=a(457),ae=a(45429),ne=a(11113),re=a(80100),se=a(47301),ie=a.n(se),oe=a(42584),le=a.n(oe),ce=a(80028),de=a(35015);const me=e=>{d.Z.discardFact(e,{doNotConfirm:!0}),$.Z.createToast({content:"Draft saved!",id:m.ZP.isExtension()?"".concat(E.GLOBAL,"-extension"):void 0,options:{url:ie().DRAFTS}})},ue={save:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{isSaveAsDraft:void 0};const{content:a,jsonContent:n,preferredPhrase:r,id:s}=ae.C.getEditorInfoFromFact({fact:e}),{isSaveAsDraft:i}=t,o=(0,ne.M)(),l=i&&{[re.Kg]:JSON.stringify([o])},c={content:a,jsonContent:n,title:r,saveType:de.V.UserSaved,cardId:-1===s.indexOf("new")?s:void 0,contentSchemaVersion:ce.Z},m={headers:l,data:JSON.stringify(c),pathVars:void 0,success:()=>{me(s)},error:()=>{d.Z.setFactMessage({factId:s,messageKey:le().DRAFT_ERROR})}},u=ae.C.drafts({editorSession:e.editorSession}),h=te.Z.userSaved({drafts:u}),p=te.Z.autoSaved({drafts:u});h?X.put(s,{...m,pathVars:[ee.n.id({draft:h})]}):p?X.put(s,{...m,pathVars:[ee.n.id({draft:p})]}):X.post(s,m)},onDraftSave:me};var he=ue,pe=a(33200),ge=a(46745),fe=a(21112),Ee=a.n(fe),ve=a(22663),Ce=a(53056),ye=a(13921),be=a(85256),Se=a(92381),Ze=a.n(Se),Ne=a(3486),Ie=a(30381),Te=a.n(Ie),Ae=a(24895),_e=a(31954),we=a(11200),De=a(27949),Pe=a(90315);var ke=a(21071),Le=a(82754),Me=a(20830),Oe=a(13228);function Fe(){return Fe=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},Fe.apply(this,arguments)}function Re(e){var t,a;const{Component:r,render:s,...i}=e,{location:l}=i,[c]=(0,_e.Z)(),[d]=function(){const[e,t]=(0,De.Z)({store:Pe.Z,actions:we.Z,onGetState:e=>e.getNewUserState()});return[e,t]}(),{token:m}=c.data,{hasQuery:u,value:h}=(0,ke.Z)("template_id");if(![oe.LOADED,oe.ERROR].includes(c.status))return null;if(!Ae.Z.isLoggedIn(c)){let e=Me.Z.Root;return n.createElement(be.l_,{to:{pathname:e,state:{referrer:l},search:l.search}})}const p=/^(\/developer)?\/signin\/teams/.test(l.pathname),g=l.pathname.includes("/signin/new-user-profile");if(Oe.Z.isOnExpiredTrial(c)&&!p&&"/trial-expired"!==l.pathname)return n.createElement(be.l_,{to:"/trial-expired"});if((null===(t=c.data.team)||void 0===t?void 0:t.status)===Le.vf.LockedPay&&!p&&"/payment-locked"!==l.pathname)return n.createElement(be.l_,{to:"/payment-locked"});if(!Oe.Z.isOnExpiredTrial(c)&&!m&&!p&&!g)return n.createElement(be.l_,{to:{pathname:o()(d,"data.developer",!1)?"/developer/signin/teams":Me.Z.Teams,state:{referrer:l},search:l.search}});const f=Te()("2019-10-18"),E=Te().unix(c.data.dateCreated).isAfter(f)||c.data.email.includes("test@getguru.com"),v=!Boolean(c.data.role)&&!Boolean(null===(a=c.data.userProfile)||void 0===a?void 0:a.role),C=!c.data.email.endsWith("@e.rainforestqa.com");return v&&E&&C&&!p&&!g&&!pe.ZP.HIDE_ROLE_COLLECTION&&!Oe.Z.isOnExpiredTrial(c)?n.createElement(be.l_,{to:{pathname:"/signin/new-user-profile",state:{referrer:l,newTeam:o()(l.state,"newTeam",!1)},search:l.search}}):!u||c.data.author||p?s?s(i):n.createElement(r,i):(window.location.href="/card/".concat(h,"?templateRedirect=true"),null)}function xe(e){const{component:t,render:a,path:r,...s}=e;return n.createElement(be.AW,Fe({},s,{path:r,render:e=>n.createElement(Re,Fe({},e,{Component:t,render:a}))}))}var qe=a(40048),Be=a(31223);function Ve(e){const[t,a]=(0,De.Z)({store:Be.Z,actions:qe.Z,onGetState:t=>t.getByFactId(e)});return n.useEffect((()=>{t.status===le().NOT_LOADED&&a.loadPermissions(e)}),[t.status]),[t,Be.U,a]}var Ue=a(13011);function He(e){const[t]=(0,Ue.Z)(Ne.Z.CARD_ATTRIBUTES_ALLOWED),[a,n]=(0,T.Z)({filterId:e,store:R,actions:V,onMustLoad:a=>t&&e&&a.get({pathVars:[e]})});return[a,n]}var We=a(6759),Ge=a(16648);var ze=()=>{const[e]=(0,_e.Z)(),t=e.data.admin,a=n.useContext(ye.ZP),{card:r,canEdit:s}=a;return n.createElement("div",{className:"ghq-CardArchivedPrompt"},n.createElement("span",null,"This Card has been archived."),n.createElement("div",{className:"ghq-CardArchivedPrompt__buttons"}),s&&n.createElement(n.Fragment,null,n.createElement("div",{className:"ghq-CardArchivedPrompt__button"},n.createElement(We.Z,{secondary:!0,small:!0,value:"Restore",onClick:()=>{return e=r.data.id,void d.Z.bulkOperation({action:{type:Ge.nj},items:{type:"id",cardIds:[e]}});var e}})),t&&n.createElement("div",{className:"ghq-CardArchivedPrompt__button"},n.createElement(We.Z,{destructive:!0,small:!0,value:"Delete Card",onClick:()=>{return e=r.data.id,d.Z.bulkOperation({action:{type:Ge.cV},fromCardArchivedPrompt:!0,items:{type:"id",cardIds:[e]}}),d.Z.discardFact(r.data.id),void $.Z.createToast({content:"Card deleted"});var e}}))))},Ye=a(1708);f.Z.register(E.TeamsBulkOp,{POST:{path:"/teams/:teamId/bulkop"}});const Ke=new C.Z({name:E.TeamsBulkOp});Ke.createStore();var je=g.Z.addStore(Ke.store);const Je=new p.Z({name:je.getName()});var Qe=g.Z.getFlux().actions[Je.name],Xe=a(11609),$e=a(93390),et=a(27672),tt=a(54793),at=a(32195),nt=a(76030),rt=a(71268),st=a(54442),it=a(40510);var ot=e=>{let{title:t,children:a,onClose:r,triggerRef:s}=e;(0,rt.Z)(!0);const{containerRef:i}=(0,st.Z)({shouldTrapFocus:!0,onEscape:()=>{var e;r(),null==s||null===(e=s.current)||void 0===e||e.focus()}}),o=()=>n.createElement(at.ZP,{aria:"close modal",icon:nt.Z.Close,style:at.Dd.Standard,onClick:r});return n.createElement("div",{className:"ghq-CardAnalyticsFollowersModal ghq-is-not-draggable","data-testid":"followers-modal",ref:i},n.createElement(it.ZP,{scrollable:!0,modifier:it.QV.Bordered},n.createElement(it.MM,{appendage:n.createElement(o,null)},t),n.createElement(it.R3,null,a)))};f.Z.register(E.CardsFollowers,{GET:{path:"/cards/:cardId/followers"}});const lt=new C.Z({name:E.CardsFollowers,syncFilters:!1});lt.createStore();var ct=g.Z.addStore(lt.store),dt=a(25108);const mt=new p.Z({name:ct.getName()}),ut=g.Z.getFlux().actions[mt.name];ut||dt.error("error creating actions");var ht=ut;var pt=e=>{const[t,a]=(0,T.Z)({filterId:e,store:ct,actions:ht});return[t,a]},gt=a(27008),ft=a(2803),Et=a(79521);function vt(){return vt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},vt.apply(this,arguments)}let Ct,yt;!function(e){e.Dark="dark",e.Light="light"}(Ct||(Ct={})),function(e){e.Button="button"}(yt||(yt={}));var bt=e=>{let{style:t=Ct.Dark,data:a,columns:r,maxHeight:i,children:o,rowProps:l=(()=>{})}=e;const{getTableProps:c,getTableBodyProps:d,headerGroups:m,rows:u,prepareRow:h}=Et.useTable({columns:r,data:a}),p={maxHeight:i||null};return n.createElement("div",{className:"Table-sage",style:p},n.createElement("table",vt({className:s()("Table-sage__table","Table-sage--style-".concat(t))},c()),n.createElement("thead",{className:"Table-sage__header"},m.map((e=>n.createElement("tr",vt({className:"Table-sage__header-row"},e.getHeaderGroupProps()),e.headers.map((e=>n.createElement("th",vt({scope:"col"},e.getHeaderProps([{className:e.className}])),e.render("Header")))))))),n.createElement("tbody",vt({className:"Table-sage__body"},d()),u.map((e=>{h(e);const{rowKind:t,onClick:a,content:s}=e.getRowProps(l(e));return t===yt.Button?n.createElement("tr",vt({},e.getRowProps(l(e)),{className:"Table-sage__body-row"}),n.createElement("td",{rowSpan:1,colSpan:r.length,className:"Table-sage__body-row-button-container"},n.createElement("button",{className:"Table-sage__body-row-button",onClick:e=>{e.stopPropagation(),a()}},n.createElement("span",null,s)))):n.createElement("tr",vt({className:"Table-sage__body-row"},e.getRowProps()),e.cells.map((e=>n.createElement("td",e.getCellProps(),e.render("Cell")))))})))),o)},St=a(21650),Zt=a(85695),Nt=a(39429),It=a(7350);var Tt,At=e=>{var t,a;let{cardId:r}=e;const[s,i]=pt(r),o=s.items.data,l=[u.S.Loaded,u.S.Updating].includes(s.status);(0,n.useEffect)((()=>{i.get({pathVars:[r]})}),[]);const c=null===(t=s.linkHeaders)||void 0===t?void 0:t["next-page"],d=null!==(a=null==c?void 0:c.token)&&void 0!==a?a:"",m=s.items.editData,h=(0,n.useMemo)((()=>[{Header:"Name",accessor:"user",Cell:e=>{let{row:{original:t}}=e;return n.createElement(Zt.Z,{initials:gt.Z.getUsersInitials(t.user),src:t.user.profilePicUrl,alt:"".concat(gt.Z.getNameFromModel(t.user),"'s profile picture")},n.createElement("span",{className:""},gt.Z.getNameFromModel(t.user)))}},{Header:"Following Since",accessor:"dateFollowed",Cell:e=>{let{row:{original:t}}=e;return n.createElement(It.Z,{date:t.dateFollowed})}}]),[m]);return s.status===u.S.Error?n.createElement(St.ZP,null,"Something went wrong."):n.createElement(n.Fragment,null,l?n.createElement("div",{className:"CardAnalyticsFollowersTable"},n.createElement(bt,{data:o,columns:h,style:Ct.Light}),d?n.createElement(ft.ZP,{label:"Show more followers",style:ft.ZJ.Text,theme:ft.bn.Primary,icon:nt.Z.ChevronDown,onClick:()=>i.get({pathVars:[r],linkHeader:c})}):null):n.createElement(Nt.ZP,{dataTestId:"loading-card-followers"}))},_t=a(15286),wt=a(9248),Dt=a(77917),Pt=a(23525),kt=a(57481);!function(e){e.DATE_CREATED="dateCreated",e.LAST_MODIFIED="lastModified",e.LAST_VERIFIED="lastVerified"}(Tt||(Tt={}));var Lt=()=>{var e,t,a,r,s,i;const{isSynced:o,isPublicLinkAllowed:l,id:c,dateCreated:d,lastModified:u,lastVerified:h,card:p}=(0,ye.RC)(),[g]=(0,_e.Z)(),[f]=(0,tt.Z)(c),[E,C]=(0,n.useState)(Tt.DATE_CREATED),[y,b]=(0,n.useState)(!1),S=(0,n.useRef)(null),Z=[le().NOT_LOADED,le().LOADING].includes(f.status),N=f.status===le().UPDATING;(0,n.useEffect)((()=>{Ye.Z.post(c,{pathVars:[p.data.id]})}),[]);const I=()=>{switch(E){case Tt.DATE_CREATED:return d;case Tt.LAST_VERIFIED:return h;case Tt.LAST_MODIFIED:return u}},T=[{type:"menu-item",label:"All time",value:Tt.DATE_CREATED},{type:"menu-item",label:"Since last edited",value:Tt.LAST_MODIFIED},{type:"menu-item",label:"Since last verified",value:Tt.LAST_VERIFIED}],A=f.data.analytics,_=null!==(e=null==A?void 0:A.followers)&&void 0!==e?e:0,w=null!==(t=null==A?void 0:A.copies)&&void 0!==t?t:0,D=null!==(a=null==A?void 0:A.favorites)&&void 0!==a?a:0,P=null!==(r=null==A?void 0:A.views)&&void 0!==r?r:0,k=null!==(s=f.data.membersWithCardView)&&void 0!==s?s:0,L=null!==(i=f.data.membersWithoutCardView)&&void 0!==i?i:0,M="".concat(P," ").concat((0,_t.B$)("View",P)),O="".concat(w," ").concat(1!==w?"Copies":"Copy"),F="".concat(D," ").concat((0,_t.B$)("Favorite",D)),R="".concat(_," ").concat((0,_t.B$)("Follower",_));return Z?null:n.createElement("div",{className:"ghq-CardAnalytics ghq-has-8-columns"},n.createElement("div",{className:"ghq-CardAnalytics__date-range"},Te()(I()).format("MMM D, YYYY")," -"," ",Te()(Date.now()).format("MMM D, YYYY")),n.createElement(et.Z,{disabled:o,refKey:"".concat(c,"-analytics-filter"),className:"ghq-CardAnalytics__filter",selectedValue:E,items:T,handleItemClick:e=>{let{value:t}=e;C(t),Ye.Z.post(c,{pathVars:[p.data.id],queryParams:{sortField:t}})}}),n.createElement("div",{className:"ghq-CardAnalytics__reloading"},n.createElement($e.Z,{className:"ghq-CardAnalaytics__reloader",isReloading:N})),n.createElement("div",{className:"ghq-CardAnalytics__views ghq-CardAnalytics__analytics-info"},n.createElement(Xe.Z,{icon:nt.Z.Views,size:36,className:"ghq-CardAnalytics__analytics-info-icon"}),n.createElement("div",null,l?n.createElement(Dt.ZP,{icon:nt.Z.Globe,iconPosition:Dt.yT.Right,iconTooltip:{aria:"withPublicCardViews",message:"Includes Public Card Views"},iconColor:wt.ZP.Twilight},M):n.createElement(n.Fragment,null,M))),n.createElement("div",{className:"ghq-CardAnalytics__copies ghq-CardAnalytics__analytics-info"},n.createElement(Xe.Z,{icon:nt.Z.Copies,size:30,className:"ghq-CardAnalytics__analytics-info-icon"}),n.createElement("div",null,O)),n.createElement("div",{className:"ghq-CardAnalytics__favorites ghq-CardAnalytics__analytics-info"},n.createElement(Xe.Z,{icon:nt.Z.Likes,size:30,className:"ghq-CardAnalytics__analytics-info-icon"}),n.createElement("div",null,F)),n.createElement("div",{className:"ghq-CardAnalytics__followers ghq-CardAnalytics__analytics-info"},n.createElement(Xe.Z,{icon:nt.Z.BellCheckmark,size:25,className:"ghq-CardAnalytics__analytics-info-icon"}),n.createElement("div",null,_>0?n.createElement(ft.ZP,{style:ft.ZJ.Anchor,label:R,trackEvent:{name:Pt.default.FOLLOWERS_MODAL_CLICKED,activitySource:kt.ni.UI,application:m.ZP.isExtension()?kt.Nu.ChromeExt:kt.Nu.WebApp,eventType:Pt.default.FOLLOWERS_MODAL_CLICKED,userId:g.data.email,activityId:c},onClick:()=>{b(!0)}}):R)),y?n.createElement(ot,{title:"".concat(_," ").concat((0,_t.B$)("Follower",_)),triggerRef:S,onClose:()=>b(!1)},n.createElement(At,{cardId:c})):null,n.createElement("div",{className:"ghq-CardAnalytics__view-breakdown"},n.createElement("span",{className:"ghq-CardAnalytics__view-member-access"},k+L),n.createElement("span",null," team members have access to this Card in Guru. "),n.createElement("br",null),n.createElement("span",{className:"ghq-CardAnalytics__view-breakdown-seen"},k," "),n.createElement("span",null," ",1===k?"has":"have"," read it, "),n.createElement("span",{className:"ghq-CardAnalytics__view-breakdown-not-seen"},L),n.createElement("span",null," ",1===L?"has":"have"," not."),n.createElement(Xe.Z,{className:"ghq-CardAnalytics__view-breakdown-export",icon:nt.Z.Export,size:16,tooltipped:{message:"Export .csv via email"},onClick:()=>(e=>{var t;const a={action:{type:"export-fact-view-stats",cardId:c,dateFrom:e}};Qe.post(v().GLOBAL,{data:JSON.stringify(a),pathVars:[null===(t=g.data.team)||void 0===t?void 0:t.id],success:()=>{$.Z.createToast({content:"Export successful! You should get an email shortly.",id:"fact-card-".concat(c)})}})})(I())})))},Mt=a(37044),Ot=a(61697),Ft=a(14195),Rt=a(73970);var xt=a(82280);const qt=e=>{let{queryType:t}=e;const a=t===Mt.e7.Resolved?Mt.e7.Resolved:Mt.e7.Open,r={[Mt.e7.Resolved]:{message:"To hide an open comment, mark it as resolved.",tip:"We'll notify anyone who replied to the comment."},[Mt.e7.Open]:{message:"To ask a question or share feedback with a teammate, post a comment ",exampleText:'(e.g. "@jamie is this current?").',tip:"We'll notify this Card's Verifier and anyone you mention."}}[a];return n.createElement("div",{className:"CardCommentsEmpty"},n.createElement("img",{className:"CardCommentsEmpty__img",src:xt.Z.getURL("common/images/comments-empty-state.svg"),role:"presentation"}),n.createElement("section",{className:"CardCommentsEmpty__info"},n.createElement(St.ZP,{style:St.Jo.Bold},r.message,"exampleText"in r&&n.createElement("span",{className:"CardCommentsEmpty__info-example"},r.exampleText)),n.createElement(St.ZP,null,r.tip)))};var Bt=a(67411),Vt=a(52643),Ut=a(85945),Ht=a(44778),Wt=a(47421);const Gt={showMentionMenu:function(e,t,a,n){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this.dispatch(Wt.default.SHOW_MENTIONS,{targetNode:r,factId:e,searchText:t,addMember:a,offset:n})},hideMentionMenu:function(){this.dispatch(Wt.default.HIDE_MENTIONS)},selectUp:function(){this.dispatch(Wt.default.SELECT_MENTION_UP)},selectDown:function(){this.dispatch(Wt.default.SELECT_MENTION_DOWN)},selectIndex:function(e){this.dispatch(Wt.default.SELECT_MENTION,{index:e})}};var zt=g.Z.addActions({factmentions:Gt}),Yt=a(51615),Kt=a(85911),jt=a(25108);const Jt=new Kt.Z({name:E.AddComments}),Qt=g.Z.getFlux().actions[Jt.name];Qt||jt.error("error creating actions");var Xt=Qt,$t=a(25108);const ea=new p.Z({name:E.CardMembersMention}),ta=g.Z.getFlux().actions[ea.name];ta||$t.error("error creating actions");var aa=ta,na=a(59426),ra=a(37707);const sa=new ra.Z({dataType:E.OBJECT,name:E.AddComments,syncFilters:!1,boundActions:[Wt.default.DISCARD_FACT,function(e){var t;const a=e.factId,n=this._getFilter(a);null!==(t=n.syncCapable.data)&&void 0!==t&&t.text&&(n.syncCapable.data.text="")},Wt.default.DISCARD_ALL_FACTS,function(){this._clear()}]});sa.createStore();var ia=g.Z.addStore(sa.store),oa=a(4199),la=a.n(oa),ca=a(89734),da=a.n(ca);const ma=new C.Z({name:E.CardMembersMention,syncFilters:!1});ma.createStore();var ua=g.Z.addStore(ma.store),ha=a(78184),pa=a(47482),ga=a(25512);const fa=la().createStore({getName:function(){return"FactMentionStore"},initialize:function(){this._mentions=ga.Z.create().setData({}),this._matchingMembers=[],this.bindActions(Wt.default.SHOW_MENTIONS,this.onShowMentions,Wt.default.HIDE_MENTIONS,this.onHideMentions,Wt.default.SELECT_MENTION_UP,this.onSelectMentionUp,Wt.default.SELECT_MENTION_DOWN,this.onSelectMentionDown,Wt.default.SELECT_MENTION,this.onSelectMention,Wt.default.LOGOUT,this.clear)},getState:function(){return this._mentions.clone()},_getMembersByFactId:function(e,t){const a=t?t.toLowerCase():"";let n=[];const r={};let s;const i=pa.ZP.getById(e);if(!i)return n;const o="PRIVATE"===i.data.shareStatus,l=ua.getFilter(this._mentions.factId);l.items.data.forEach((e=>{if("user-group"===e.type){const t=e.userGroup.groupIdentifier;r[t]={username:t,name:e.userGroup.name,type:"user-group",userGroup:e.userGroup}}else if("user"===e.type){const t=e.user,a=t.email.split("@")[0].toLowerCase();r[a]={username:a,name:gt.Z.getNameFromModel(t),picUrl:t.profilePicUrl,type:"user",user:t}}})),l.linkHeaders&&l.linkHeaders["next-page"]&&(r.waypoint={isWaypoint:!0});const c=Object.getOwnPropertyNames(r);for(s=0;s<c.length;s++)n.push(r[c[s]]);return n=da()(n,["username","name"]),ha.Z.getBySearchId(e).data.length>0&&(!a||0==="shared".indexOf(a))&&n.push({username:"shared",name:"All shared users on this Card"}),o||!l.items.data.find((e=>{e.type}))||a&&0!=="team".indexOf(a)||n.push({username:"team",name:"All members of your Team"}),n},getMatching:function(){return this._getMembersByFactId(this._mentions.factId,this._mentions.searchNameText)},getSelectedMember:function(){return this.getMatching()[this._mentions.selectedIndex]},onShowMentions:function(e){const t=pa.ZP.getById(e.factId);this._mentions.factId=t.data.id||t.id,this._mentions.show=!0,this._mentions.selectedIndex=0,this._mentions.searchNameText=e.searchText,this._mentions.addMember=e.addMember,this._mentions.offset=e.offset,this._mentions.targetNode=e.targetNode,this.onChange()},isShowing:function(){return this._mentions.show},onHideMentions:function(){this._mentions.show=!1,this.onChange()},onSelectMentionUp:function(){this._mentions.selectedIndex>0&&(this._mentions.selectedIndex--,this._mentions.scrollDir="up",this.onChange())},onSelectMentionDown:function(){this._mentions.selectedIndex<this.getMatching().length-1&&(this._mentions.selectedIndex++,this._mentions.scrollDir="down",this.onChange())},onSelectMention:function(e){this._mentions.selectedIndex=e.index,this._mentions.scrollDir=null,this.onChange()},clear:function(){this._mentions=ga.Z.create().setData({}),this.onChange()},onChange:function(){this.emit("change")}});var Ea=g.Z.addStore(new fa);const va=e=>{let{addMentionName:t,event:a,factId:n,input:r,showNameMenu:s,text:i}=e;s?(aa.mergeFilterMeta(n,{search:i}),zt.showMentionMenu(n,i,t,(e=>{const t=e.getBoundingClientRect();return{top:t.top+window.scrollY,left:t.left+window.scrollX}})(null==a?void 0:a.target),r)):zt.hideMentionMenu()};var Ca=e=>{var t,a;let{elementId:r,factId:s,commentId:i}=e;const[o,l]=(0,n.useState)(!1),[c,d]=(0,n.useState)(null),[m,u]=(0,n.useState)(null!==(t=null===(a=ia.getFilter(i).data)||void 0===a?void 0:a.text)&&void 0!==t?t:""),h=document.getElementById(r);let p,g="";const f=()=>{const{value:e,selectionStart:t}=h,a=e.lastIndexOf("@",t),n=(e=>{let{value:t,atIndex:a}=e;return t.substring(0,a+1)+Ea.getSelectedMember().username+" "})({value:e,atIndex:a}),r=(e=>{let{value:t,selectionStart:a}=e;return t.substring(a)})({value:e,selectionStart:t});u(n+r),d(n.length),Xt.replaceData({text:n+r},i),zt.hideMentionMenu(),l(!1)};return{checkForName:e=>{let t=!0;if(o)switch(null==e?void 0:e.keyCode){case na.ZP.Tab:case na.ZP.Enter:f(),t=!1;break;case na.ZP.ArrowUp:zt.selectUp(),t=!1;break;case na.ZP.ArrowDown:zt.selectDown(),t=!1}t||(e.stopPropagation(),e.preventDefault())},setMentionState:e=>{var t,a,n;d(null);let r=null==e||null===(t=e.target)||void 0===t?void 0:t.value;u(r);const i=null==e||null===(a=e.target)||void 0===a?void 0:a.selectionStart,o=null===(n=r)||void 0===n?void 0:n.lastIndexOf("@",i);return l(!1),p=!1,g="",o>=0&&(r=r.substring(o+1,i),(e=>null===e.match(/\s+/))(r)&&(l(!0),p=!0,g=r)),va({addMentionName:f,event:e,factId:s,input:h,showNameMenu:p,text:r}),{showNameMenu:p,searchNameText:g}},commentText:m,caretPosition:c}},ya=a(67176),ba=a(42404);const Sa=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{hour:0,daysToAdd:0},t=arguments.length>1?arguments[1]:void 0;const a=new Date,n=a.getDate()+e.daysToAdd;a.setDate(n),a.setHours(e.hour),a.setMinutes(0),a.setSeconds(0),t(a.toISOString())},Za=e=>{let{creatorEmail:t,viewerEmail:a}=e;return t===a};var Na=a(16926);f.Z.register(E.AnnouncementStatsSummary,{GET:{path:"/announcements/:announcementId/stats/summary"}});const Ia=new C.Z({name:E.AnnouncementStatsSummary,syncFilters:!1,boundActions:[Wt.default.CLEAR_CARD_ALERT,function(e){const{alertId:t}=e,a=this._filters[t];if(!Boolean(a))return;a.items.editData[0].currentUserReadDate=new Date(Date.now()),this._onChange()}]});Ia.createStore();var Ta=g.Z.addStore(Ia.store),Aa=a(25108);const _a=new p.Z({name:Ta.getName()}),wa=g.Z.getFlux().actions[_a.name];wa||Aa.error("error creating actions");var Da=wa;function Pa(e){const[t,a]=(0,T.Z)({filterId:e,store:Ta,actions:Da,onMustLoad:t=>t.get({pathVars:[e]})});return[t,a]}f.Z.register(E.AnnouncementStatsFull,{GET:{path:"/announcements/:announcementId/stats/full"}});const ka=new C.Z({name:E.AnnouncementStatsFull,syncFilters:!1});ka.createStore();var La=g.Z.addStore(ka.store),Ma=a(25108);const Oa=new p.Z({name:La.getName()}),Fa=g.Z.getFlux().actions[Oa.name];Fa||Ma.error("error creating actions");var Ra=Fa;function xa(e){const[t,a]=(0,T.Z)({filterId:e,store:La,actions:Ra,onMustLoad:t=>t.get({pathVars:[e]})});return[t,a]}var qa=a(68475),Ba=a(25108);const Va=new p.Z({name:qa.Z.getName()}),Ua=g.Z.getFlux().actions[Va.name];Ua||Ba.error("error creating actions");var Ha=Ua,Wa=a(50811),Ga=a(7230);const za=e=>{let{announcementIsOlderThanThreeDays:t,isSender:a,lastAutomatedReminderDate:n,lastManualReminderDate:r}=e;return r||n?"Recipients were last reminded ".concat(Te()(r&&n?r<n?n:r:null!=r?r:n).locale("en").fromNow()):t?"No reminders have been sent.":a?"If needed, you can send an additional reminder now.":null},Ya=e=>{let{announcementItem:t}=e;const{announcement:{creator:a,dateCreated:r,lastAutomatedReminderDate:s,lastManualReminderDate:i,id:o},unreadCount:l}=t,c=Ae.Z.isMe(a.id),d=Te()().diff(r,"days")>3,m="".concat(l," ").concat((0,_t.B$)("recipient",l)),u=n.createElement(ft.ZP,{theme:ft.bn.Gray,label:"Send reminder",size:ft.qE.Small,style:ft.ZJ.Outline}),h=za({announcementIsOlderThanThreeDays:d,isSender:c,lastAutomatedReminderDate:s,lastManualReminderDate:i}),p=!s&&!d;return n.createElement(n.Fragment,null,p?n.createElement("p",{className:"ghq-AnnouncementReminder-send-reminder-description"},"Automated reminders will be sent to recipients who haven't read this announcement after 3 days."):null,n.createElement("div",{className:"ghq-AnnouncementReminder-send-reminder"},n.createElement("p",null,h),c?n.createElement(Ga.Z,{trigger:u,"data-testid":"AnnouncementReminderPopover"},n.createElement(St.ZP,null,"The ",m," who"," ",1===l?"hasn't":"haven't"," yet read this announcement will receive a reminder notification."),n.createElement(Wa.Z,{alignment:Wa.A.Right},n.createElement(ft.ZP,{label:"Cancel",style:ft.ZJ.Text,theme:ft.bn.Gray}),n.createElement(ft.ZP,{label:"Send reminder",theme:ft.bn.Primary,onClick:()=>{return e=o,void Ha.post(v().GLOBAL,{pathVars:[e]});var e}}))):null))};var Ka=e=>{let{announcementItem:t}=e;const{announcement:{dateCreated:a},readCount:r,unreadCount:s}=t,i=s+r,o=Te()(a).locale("en").fromNow(),l="".concat(i," ").concat((0,_t.B$)("recipient",i));return n.createElement("div",{className:"ghq-AnnouncementReminder"},n.createElement("p",{className:"ghq-AnnouncementReminder-sent-information"},"Sent ",o," to ",l),s>0&&n.createElement(Ya,{announcementItem:t}))},ja=a(99386);var Ja=e=>{let{announcementItem:t}=e;const[a]=(0,Ue.Z)(Ne.Z.ANNOUNCEMENT_REMINDERS_ALLOWED),r=t.unreadCount+t.readCount,s=Math.round(100*t.openedCount/r),i=Math.round(100*t.readCount/r),o=Te()(t.announcement.dateCreated).locale("en").fromNow(),l="".concat(r," ").concat((0,_t.B$)("recipient",r));return n.createElement("div",{className:"ghq-AnnouncementOpenReadStats"},a?null:n.createElement("p",{className:"ghq-AnnouncementOpenReadStats-sent-information"},"Sent ",o," to ",l),n.createElement("div",{className:"ghq-AnnouncementOpenReadStats-stats"},n.createElement("div",{className:"ghq-AnnouncementOpenReadStats-open-stats"},n.createElement(ja.ZP,{level:ja.Yx.H3,style:ja.VH.Medium},"Open rate"),n.createElement("p",{className:"ghq-AnnouncementOpenReadStats-stat-percentage"},s,"%"),n.createElement(St.ZP,null,t.openedCount," / ",r," opened")),n.createElement("div",{className:"ghq-AnnouncementOpenReadStats-read-stats"},n.createElement(ja.ZP,{level:ja.Yx.H3,style:ja.VH.Medium},"Read rate"),n.createElement("p",{className:"ghq-AnnouncementOpenReadStats-stat-percentage"},i,"%"),n.createElement(St.ZP,null,t.readCount," / ",r," read"))),a?n.createElement(Ka,{announcementItem:t}):null)},Qa=a(82581),Xa=a(25108);const $a=new p.Z({name:Qa.Z.getName()}),en=g.Z.getFlux().actions[$a.name];en||Xa.error("error creating actions");var tn=en;f.Z.register(E.AnnouncementStatsUsers,{GET:{path:"/announcements/:announcementId/stats/users"}});const an=new C.Z({name:E.AnnouncementStatsUsers});an.createStore();var nn=g.Z.addStore(an.store),rn=a(25108);const sn=new p.Z({name:nn.getName()}),on=g.Z.getFlux().actions[sn.name];on||rn.error("error creating actions");var ln=on;var cn=a(54975),dn=a(20369);var mn=e=>{var t,a,r;let{announcementId:s}=e;const[i,o]=function(e){const[t,a]=(0,T.Z)({filterId:e,store:nn,actions:ln,onMustLoad:t=>t.get({pathVars:[e]})});return[t,a]}(s),[l]=(0,Ue.Z)(Ne.Z.EXTENSION_PROFILES_ALLOWED),[,c]=xa(s),[,d]=function(){const[e,t]=(0,T.Z)({filterId:v().GLOBAL,store:Qa.Z,actions:tn});return[e,t]}(),{getTrackEventData:m}=(0,dn.Z)(),h=null===(t=i.linkHeaders)||void 0===t?void 0:t["next-page"],p=null!==(a=null==h?void 0:h.token)&&void 0!==a?a:"",g=null==i||null===(r=i.items)||void 0===r?void 0:r.editData;(0,n.useEffect)((()=>()=>{c.clearStore(),o.clearStore()}),[]);const f=(0,n.useMemo)((()=>[{Header:"Name",accessor:"name",Cell:e=>{let{row:{original:t}}=e;const{onClick:a,to:r}=(0,cn.k)(t.id,l);return n.createElement(Zt.Z,{initials:gt.Z.getUsersInitials(t),src:t.profilePicUrl,linkSrc:r,alt:"".concat(gt.Z.getNameFromModel(t),"'s profile picture"),trackEvent:m({activitySubtype:dn.Y.AnnouncementUserStats,userId:t.email}),onClick:a},n.createElement("span",{className:"AnnouncementUserStats-list-name"},gt.Z.getNameFromModel(t)))}},{Header:"Last Opened",accessor:"announcementViewedAt",Cell:e=>{let{row:{original:t}}=e;return t.announcementViewedAt?n.createElement(It.Z,{hideCurrentYear:!0,date:t.announcementViewedAt}):"Unopened"}},{Header:"Read",accessor:"announcementReadAt",Cell:e=>{let{row:{original:t}}=e;return t.announcementReadAt?n.createElement(Dt.ZP,{icon:nt.Z.Check},n.createElement(It.Z,{hideCurrentYear:!0,date:t.announcementReadAt})):"Unread"}}]),[g]),E=[u.S.Loaded,u.S.Updating].includes(i.status);return n.createElement("div",{className:"AnnouncementUserStats"},E?n.createElement(n.Fragment,null,n.createElement(ja.ZP,{level:ja.Yx.H3,style:ja.VH.Medium},"Recipients"),n.createElement(bt,{data:g,columns:f,style:Ct.Light}),p?n.createElement(ft.ZP,{label:"Show more recipients",style:ft.ZJ.Text,theme:ft.bn.Primary,icon:nt.Z.ChevronDown,onClick:()=>o.get({pathVars:[s],linkHeader:h})}):null,n.createElement("div",{className:"AnnouncementUserStats-export-data"},n.createElement("p",{className:"AnnouncementUserStats-export-data-description"},"To dive deeper, download engagement data. The list will be emailed to you once it's generated."),n.createElement(ft.ZP,{style:ft.ZJ.Outline,theme:ft.bn.Gray,label:"Export data",onClick:()=>d.post({pathVars:[s]})}))):n.createElement(Nt.ZP,{dataTestId:"loading-user-stats"}))};var un=e=>{let{title:t,footer:a,triggerRef:r,children:s,onClose:i}=e;(0,rt.Z)(!0);const{containerRef:o}=(0,st.Z)({shouldTrapFocus:!0,onEscape:()=>{var e;i(),null==r||null===(e=r.current)||void 0===e||e.focus()}}),l=()=>n.createElement(at.ZP,{aria:"close modal",icon:nt.Z.Close,style:at.Dd.Standard,onClick:i});return n.createElement("div",{className:"ghq-AnnouncementSubModal",ref:o},n.createElement(it.ZP,{scrollable:!0,modifier:it.QV.Bordered},n.createElement(it.MM,{appendage:n.createElement(l,null)},t),n.createElement(it.R3,null,s),a?n.createElement(it.v3,null,a):null))};var hn=e=>{var t;let{announcementId:a,onClose:r,triggerRef:s}=e;(0,rt.Z)(!0);const[i]=xa(a),o=null==i||null===(t=i.items)||void 0===t?void 0:t.editData[0];return n.createElement(un,{title:"Announcement Insights",triggerRef:s,onClose:r},i.status===u.S.Loaded?n.createElement(Ja,{announcementItem:o}):null,n.createElement(mn,{announcementId:a}))},pn=a(57682),gn=a(1164),fn=a(65680);const En=e=>{let{announcementId:t,readDate:a}=e;const[r]=(0,_e.Z)(),s=(0,be.TH)(),i=(0,Ut.NL)(),{value:o}=(0,ke.Z)("source"),l=(0,n.useContext)(ye.ZP),[,c]=Pa(t),{id:d,knowledgeAlerts:u,onClickReadConfirmation:h}=l,p=()=>h(s,u,d,(()=>{i.invalidateQueries(["announcements"]),c.clearStore()}));return Boolean(a)?n.createElement(gn.ZP,{type:gn.a8.Default},n.createElement(St.ZP,null,"You confirmed you read this Card on ",n.createElement(It.Z,{date:a})),n.createElement("span",{className:"ghq-AnnouncementCommentCTA__thumb",role:"img","aria-label":"announcement read thumbs up emoji"},"\u{1f44d}")):n.createElement(gn.ZP,{type:gn.a8.Action},n.createElement(St.ZP,null,"Once you've read this Card, please confirm here"),n.createElement(ft.ZP,{label:"\u{1f44d} I read it",style:ft.ZJ.Outline,trackEvent:{name:Pt.default.ANNOUNCEMENT_READ,activityId:t,activityMetaData:[{featureName:Na.Z.ANNOUNCEMENTS,data:{cardId:d}}],activitySource:(null==s||null===(g=s.state)||void 0===g||null===(f=g.eventTrack)||void 0===f?void 0:f.activitySource)||o,application:m.ZP.isExtension()?kt.Nu.ChromeExt:kt.Nu.WebApp,eventType:Pt.default.ANNOUNCEMENT_READ,userId:r.data.email},theme:ft.bn.Gray,onClick:p}));var g,f},vn=e=>{let{users:t}=e,a=t.map((e=>{const{email:t,profilePicUrl:a}=e;return{alt:gt.Z.getNameFromModel(e),id:t,initials:gt.Z.getUsersInitials(e),src:a}})).splice(0,3);return n.createElement("span",{className:"ghq-AnnouncementReadStack"},a.map((e=>n.createElement(pn.Z,{alt:e.alt,initials:e.initials,key:e.id,size:20,src:e.src}))),0===a.length?n.createElement(fn.Z,{dataTestId:"UnreadAnnouncement",icon:nt.Z.AccountMultiple,size:20}):null)};var Cn=e=>{var t,a;let{announcementId:r}=e;const[s,i]=(0,n.useState)(!1),o=(0,n.useRef)(null),[l]=Pa(r),[c]=(0,_e.Z)();if(l.status!==u.S.Loaded)return null;const{announcement:d,currentUserReadDate:m,readCount:h,readUsers:p,unreadCount:g}=null!==(t=null==l||null===(a=l.items)||void 0===a?void 0:a.editData[0])&&void 0!==t?t:{};if(d.scheduledSendDate)return null;const f=Math.round(h/(h+g)*100),E=Za({creatorEmail:null==d?void 0:d.creator.email,viewerEmail:c.data.email});return n.createElement("div",{className:"ghq-AnnouncementCommentCTA"},E?null:n.createElement(En,{announcementId:r,readDate:m}),n.createElement("div",{className:"ghq-AnnouncementCommentCTA__stats"},n.createElement(vn,{users:p}),n.createElement("button",{className:"ghq-AnnouncementCommentCTA__stats-modal-trigger",onClick:()=>i(!0)},f,"% read it"),s?n.createElement(hn,{announcementId:r,triggerRef:o,onClose:()=>i(!1)}):null))},yn=a(22386);const bn=e=>e.length<=1?e[0]:"".concat(e.slice(0,-1).join(", ")).concat(2===e.length?" ":", ","and ").concat(e[e.length-1]);var Sn=a(32838),Zn=a(81371),Nn=a(18633);function In(){return In=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},In.apply(this,arguments)}var Tn=e=>{var t,a,r;let{announcementId:s}=e;const[i]=Pa(s),{getTrackEventData:o}=(0,dn.Z)(),[l]=(0,Ue.Z)(Ne.Z.EXTENSION_PROFILES_ALLOWED);let c="";if(i.status!==u.S.Loaded)return null;const{announcement:d,currentUserReadDate:m,currentUserAnnouncementUser:h}=null!==(t=null==i||null===(a=i.items)||void 0===a?void 0:a.editData[0])&&void 0!==t?t:{},p=h&&!Boolean(m),g=gt.Z.getNameFromModel(d.creator),f=null!==(r=null==d?void 0:d.groups.map((e=>e.name)))&&void 0!==r?r:[];c=bn(f);const E=(0,yn.Z)((e=>{let{showTooltip:t,hideTooltip:a,children:r}=e;return n.createElement("button",{className:"ghq-AnnouncementDetails__recipients",onMouseEnter:t,onMouseLeave:a},r)}));return n.createElement("div",{className:"ghq-AnnouncementDetails","data-testid":"AnnouncementDetails"},n.createElement(ja.ZP,{level:ja.Yx.H3,style:ja.VH.Small},n.createElement(Sn.Z,In({type:Sn.q.MediumPriority,trackEvent:o({activitySubtype:dn.Y.AnnouncementDetails,userId:d.creator.email})},(0,cn.k)(d.creator.id,l)),g),p?n.createElement(Zn.ZP,{bold:!0,size:Zn.n8.Small,type:Zn.Rt.Yolk},"Unread"):null),n.createElement(Nn.Z,{style:Nn.W.Dim},n.createElement(It.Z,{hideCurrentYear:!0,date:d.dateCreated}),"\u2022",n.createElement(fn.Z,{icon:nt.Z.MustReadFilled,size:14,color:wt.ZP.Twilight}),n.createElement(E,{tooltipped:{message:"To ".concat(c),preferredYPosition:"top"}},"To ",c)))};var An=e=>{let{announcementId:t,setIsScheduledAnnouncement:a}=e;const[r]=Pa(t),[s]=(0,_e.Z)();if(r.status===u.S.Loaded){var i,o;const{announcement:e}=null!==(i=null==r||null===(o=r.items)||void 0===o?void 0:o.editData[0])&&void 0!==i?i:{},t=Za({creatorEmail:null==e?void 0:e.creator.email,viewerEmail:s.data.email});return e.scheduledSendDate&&t?(a(!0),n.createElement("div",{className:"ghq-AnnouncementScheduledNotice"},n.createElement(gn.ZP,{type:gn.a8.Default},n.createElement(Dt.ZP,{icon:nt.Z.Clock},"Scheduled to be sent to your recipients"," ",Te()(e.scheduledSendDate).format("MMM D [at] h:mm A"),".")))):null}return null};var _n=e=>{let{onClose:t,onDelete:a}=e;const r=()=>{a(),t()},s=()=>n.createElement(Wa.Z,{alignment:Wa.A.Right},n.createElement(ft.ZP,{label:"Cancel",theme:ft.bn.Gray,onClick:t}),n.createElement(ft.ZP,{label:"Delete",theme:ft.bn.Destructive,onClick:r}));return n.createElement(un,{title:"Delete announcement",footer:n.createElement(s,null),onClose:t},n.createElement("p",{className:"ghq-AnnouncementDeleteModal-delete-confirmation"},"Are you sure you want to delete this announcement?"))},wn=a(37540);const{Delete:Dn,Edit:Pn,Reopen:kn,UseAsAnswer:Ln,SendReminder:Mn,DeleteAnnouncement:On}=Mt.R7,Fn=e=>{let{canAnswer:t,canManageBasedonCollPerms:a,comment:r,fact:i,isOwner:o,isSavingNewComment:l,deleteComment:c,editComment:d,unresolveComment:m,useAsAnswer:u}=e;const[h,p]=(0,n.useState)(!1),[g]=(0,Ue.Z)(Ne.Z.ANNOUNCEMENT_REMINDERS_ALLOWED);if(l)return null;const f=(e,t,a)=>({icon:e,label:t,handleClick:a}),E={delete:f("delete",Dn,c),edit:f("pencil",Pn,d),unresolve:f("redo",kn,m),useAsAnswer:f("circle-question",Ln,u),sendReminder:f("notifications",Mn,(()=>{var e;Ha.post(v().GLOBAL,{pathVars:[null===(e=r.extraDetailsModel)||void 0===e?void 0:e.announcementId]})})),deleteAnnouncement:f("delete",On,(()=>p(!0)))},C=i.data.cardType,y=()=>a||o,b=()=>(0,Ft.xg)(r),S=(()=>{let e=[];return b()?g&&o?e.push(E.deleteAnnouncement):o&&(e.push(E.sendReminder),e.push(E.deleteAnnouncement)):(t&&(0,Ft.KX)(C)&&e.push(E.useAsAnswer),(0,Ft.F_)(C)&&(0,Ft.Wg)(r)&&y()&&e.push(E.unresolve),(0,Ft.J5)({isOwner:o,comment:r})&&e.push(E.edit),y()&&!b()&&e.push(E.delete)),e})().map((e=>n.createElement(wn.sN,{key:e.label,icon:e.icon,onClick:e.handleClick},e.label)));const Z=s()("ghq-CommentMenu",{"ghq-is-announcement":b()});return n.createElement(n.Fragment,null,S.length>0?n.createElement("div",{className:Z},n.createElement(Ga.Z,{"data-testid":"comment-menu-toggle"},n.createElement(wn.ZP,{ariaLabel:"More Options",dataTestId:"comment-menu"},S)),h&&n.createElement(_n,{onClose:()=>p(!1),onDelete:()=>c()})):null)},Rn=e=>{var t;let{comment:a,fact:r,canResolve:s,onResolve:i,onDelete:o,onEdit:l,onUnresolve:c,onUseAsAnswer:d}=e;const[m]=(0,_e.Z)(),[u]=(0,Yt.Z)(ba.v.CanDeleteAnyComments,null===(t=r.data.collection)||void 0===t?void 0:t.id);return n.createElement("div",{className:"CommentActionButtons","data-testid":"CommentActionButtons"},s&&n.createElement(at.ZP,{tooltipPosition:at.DU.Left,dataTestId:"resolve-comment-button",style:at.Dd.Standard,aria:"Resolve",icon:nt.Z.Check,tooltipLabel:"Resolve",onClick:i}),n.createElement(Fn,{canAnswer:!1,canManageBasedonCollPerms:u,comment:a,fact:r,isOwner:(0,Ft.k3)({comment:a,authEmail:m.data.email}),deleteComment:o,editComment:l,unresolveComment:c,useAsAnswer:d}))};var xn=a(88278),qn=a(86429);const Bn=e=>{let{owner:t}=e;const{getTrackEventData:a}=(0,dn.Z)(),[r]=(0,Ue.Z)(Ne.Z.EXTENSION_PROFILES_ALLOWED),{onClick:s,to:i}=(0,cn.k)(t.id,r);return n.createElement("div",{className:"CommentAvatar","data-testid":"CommentAvatar"},n.createElement(qn.Z,{firstName:t.firstName,lastName:t.lastName,email:t.email,profilePictureSrc:xn.ZP.getProfileUrl(t.profilePicUrl),url:i,trackEvent:a({activitySubtype:dn.Y.CommentDetails,userId:t.email}),onClick:s}))},Vn=e=>{let{status:t,onRetry:a}=e;if(!t)return null;const r=t===Mt.JI.Error?"".concat(t,"."):"".concat(t,"..."),s=t===Mt.JI.Error;return n.createElement("div",{className:"CommentSendingStatus"},n.createElement("span",{className:"CommentSendingStatus__status"},r),s&&n.createElement(ft.ZP,{size:ft.qE.Small,style:ft.ZJ.Anchor,label:"Retry?",onClick:a}))};function Un(){return Un=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},Un.apply(this,arguments)}const Hn=e=>{let{comment:t,commentSendingStatus:a,isCommentOwner:r,isHero:i,onRetry:o,isEditing:l,profileId:c}=e;const d=gt.Z.getNameFromModel(t.owner),{getTrackEventData:m}=(0,dn.Z)(),[u]=(0,Ue.Z)(Ne.Z.EXTENSION_PROFILES_ALLOWED),h=Boolean(a),p=Te()(t.lastModified,"YYYY-MM-DD[T]HH:mm:ss.SSSZZ"),g=Te()(),f=Te().min(p,g),E=Te()().diff(t.lastModified,"days"),v=()=>E>3?f.format("MMM D, YYYY"):f.fromNow();let C="";h||(C=((e,t)=>{const a=((e,t)=>E>3?"":e!==t?"Edited - ":"")(e,t);return a+v()})(t.dateCreated,t.lastModified));const y="Resolved - "+v();return n.createElement("div",{className:s()("CommentDetails",{"CommentDetails--editing":l}),"data-testid":"CommentDetails"},n.createElement(Sn.Z,Un({type:Sn.q.MediumPriority,trackEvent:m({activitySubtype:dn.Y.CommentDetails,userId:t.owner.email})},(0,cn.k)(c,u)),n.createElement(ja.ZP,{level:ja.Yx.H3,style:ja.VH.Small},d)),n.createElement("div",{className:"CommentDetails__date"},(0,Ft.qN)({comment:t,isHero:i,hasSendingStatus:h,isEditing:l})?n.createElement(Nn.Z,{style:Nn.W.Dim},Te()(C).isValid()?n.createElement(It.Z,{hideCurrentYear:!0,date:C}):C):null,r&&h&&n.createElement(Vn,{status:a,onRetry:o}),(0,Ft.Oh)({comment:t,isHero:i})?n.createElement(Nn.Z,{style:Nn.W.Dim},y):null))};var Wn=a(95394);const Gn="commentContent",zn=e=>{let{content:t,isNew:a,onBlur:r,onCancel:s,onChange:i,onKeyDown:o,onSave:l}=e;return n.createElement("div",{className:"CommentEditor","data-testid":"CommentEditor"},n.createElement(Wn.Z,{autofocus:!0,useVisuallyHiddenLabel:!0,required:!0,label:"Add a Comment",name:Gn,placeholder:"Add a comment...",value:t,onChangeWithEvent:i,onKeyDown:o,onBlur:r,onFocus:e=>{const t=e.target.value;e.target.value="",e.target.value=t}}),n.createElement(Wa.Z,{alignment:Wa.A.Right},n.createElement(ft.ZP,{size:ft.qE.Small,theme:ft.bn.Gray,style:ft.ZJ.Text,label:"Cancel",onClick:s}),n.createElement(ft.ZP,{disabled:!(null!=t&&t.length),size:ft.qE.Small,theme:ft.bn.Primary,label:a?"Send":"Save",onClick:l})))};var Yn=a(71041);var Kn=e=>{let{reactions:t,type:r,typeId:s,userId:i,isOpenComment:o}=e;if((0,m.p1)())return null;const l=n.lazy((()=>a.e(23).then(a.bind(a,46028))));return n.createElement(Yn.Z,{id:Yn.J.commentReactions,render:()=>null},n.createElement(n.Suspense,{fallback:n.createElement(Nt.ZP,{size:Nt.wx.Small})},n.createElement(l,{reactions:t,type:r,typeId:s,userId:i,isOpenComment:o})))};const jn=(0,n.createContext)({}),Jn=()=>{const e=(0,n.useContext)(jn);if(!e)throw new Error("useCommentThreadContext must be used within a CommentThreadProvider");return e};var Qn=e=>{var t,a;let{comment:r,queryType:s,children:i}=e;const[o,l]=(0,n.useState)(!1),c=!(0,Ft.$X)({isHero:!1,queryType:s});return n.createElement(jn.Provider,{value:{announcementId:null===(t=r.extraDetailsModel)||void 0===t?void 0:t.announcementId,hasReplies:null!==(a=r.totalReplies>0)&&void 0!==a&&a,isAnnouncementComment:(0,Ft.xg)(r),isScheduledAnnouncement:o,showReplyButton:!o&&c,showReactionButton:!o,setIsScheduledAnnouncement:l}},n.createElement("div",{className:"CommentThread","data-testid":"CommentThread"},i))},Xn=a(98512),$n=a(69723),er=a(72555),tr=a.n(er),ar=a(14892),nr=a(25108);class rr extends n.Component{constructor(){super(...arguments),this.selectIndex=()=>{zt.selectIndex(this.props.index)},this.selectMember=()=>{Ea.getState().addMember()}}componentDidUpdate(e){this.props.selected&&!e.selected&&("up"===this.props.scrollDir?P.findDOMNode(this).scrollIntoView(!0):"down"===this.props.scrollDir&&P.findDOMNode(this).scrollIntoView(!1))}render(){const{foundMember:e}=this.props;if(e.isWaypoint)return n.createElement(Bt.h,{key:"waypoint",onEnter:this.props.onEnterWaypoint});let t=null;if("user-group"===e.type)t=n.createElement(Xe.Z,{className:"ghq-comment-user-group-pic",icon:"account-multiple",size:20});else{const a=e.picUrl?xn.ZP.getProfileUrl(e.picUrl):null;t=n.createElement(pn.Z,{className:"ghq-comment-profile-pic",initials:gt.Z.getUsersInitials(e.user),alt:gt.Z.getNameFromModel(e.user),size:pn.Z.sizes.XSMALL,src:a})}return n.createElement("li",{className:"ghq-comment-contact"+this.props.selected,onMouseOver:this.selectIndex,onMouseDown:this.selectMember},t,n.createElement("span",{className:"ghq-comment-contact-username"},e.username),n.createElement("span",{className:"ghq-comment-hyphen"},"-"),n.createElement("span",{className:"ghq-comment-contact-email"},e.name))}}const sr=tr()({displayName:"MentionList",mixins:[(0,ar.Z)(ua,Ea)],getStoreFilterName(e){if(e===E.CardMembersMention)return this.props.factId;nr.error("filter not set")},getStateFromFlux(){return{cardMembersMention:ua.getFilter(this.getStoreFilterName(E.CardMembersMention)),factMention:Ea.getState()}},componentDidMount(){const{cardMembersMention:e,factMention:t}=this.state;e.status===le().NOT_LOADED&&t.show&&this.getCardMembersMention()},UNSAFE_componentWillUpdate(e,t){const{cardMembersMention:a}=this.state,{cardMembersMention:n,factMention:r}=t;a.meta.search!==n.meta.search&&r.show&&this.getCardMembersMention({search:n.meta.search})},getCardMembersMention(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{factId:t}=this.props,{cardMembersMention:a}=this.state,n=e.search||a.meta.search;aa.get(this.getStoreFilterName(E.CardMembersMention),{pathVars:[t],queryParams:{search:n},...e})},selectUp(){zt.selectUp()},selectDown(){zt.selectDown()},onEnterWaypoint(e){const{cardMembersMention:t}=this.state;if(e!==this.state.waypointId){this.setState({waypointId:e});const a=t.linkHeaders["next-page"];this.getCardMembersMention({linkHeader:a})}},render(){const{cardMembersMention:e,factMention:t}=this.state,{factId:a,targetNode:r}=this.props,s=Ea.getMatching();if(!(t.show&&t.factId===a&&t.targetNode===r)||0===s.length)return null;let i=null;const o=s.map((function(e,a){const r=a===t.selectedIndex?" ghq-comment-contact-selected":"";return n.createElement(rr,{foundMember:e,selected:r,scrollDir:t.scrollDir,key:a,index:a,onEnterWaypoint:this.onEnterWaypoint})}),this);return i=this.state.factMention.searchNameText?o.length>0?n.createElement("div",{className:"ghq-comment-namelist-header"},"Users or Groups matching",n.createElement("span",{className:"ghq-bold"}," @"+this.state.factMention.searchNameText)):n.createElement("div",{className:"ghq-comment-namelist-header"},"no matches for",n.createElement("span",{className:"ghq-bold"}," @"+this.state.factMention.searchNameText)):n.createElement("div",{className:"ghq-comment-namelist-header"},"Users or Groups"),e.status===le().LOADING?n.createElement(Nt.ZP,null):n.createElement("div",{className:"ghq-comment-namelist-container"},i,n.createElement("ul",{className:"ghq-comment-namelist"},o))}});var ir=sr;const or=e=>{var t,a;let{cardType:r=Vt.eT.Card,comment:i,commentsStoreFilterId:o,fact:l,isHero:c=!1,heroCommentId:d,isNew:m=!1,queryType:u,onCancelReply:h=(()=>{})}=e;const[p]=(0,_e.Z)(),g=(0,Ut.NL)(),{activeAnnouncement:f,setActiveAnnouncement:E}=(0,n.useContext)(ye.ZP),{isAnnouncementComment:v,showReactionButton:C,announcementId:y,setIsScheduledAnnouncement:b}=Jn(),S=m?p.data.id:i.owner.id,[Z]=(0,Yt.Z)(ba.v.CanDeleteAnyComments,null===(t=l.data.collection)||void 0===t?void 0:t.id),[N,I]=(0,n.useState)(i.content),[T,A]=(0,n.useState)(m),[_,w]=(0,n.useState)(!1),[D,P]=(0,n.useState)();let k;const L=v&&f===y,M=v&&y&&c;(0,n.useEffect)((()=>{if((T||L)&&setTimeout((()=>{var e,t;null===(e=(t=k).scrollIntoView)||void 0===e||e.call(t,{behavior:"smooth",block:"start"})}),500),L){(()=>(w(!0),setTimeout((()=>{w(!1)}),2e3)))(),E()}}),[L,T]);const{checkForName:O,setMentionState:F,commentText:R,caretPosition:x}=Ca({elementId:Gn,factId:l.data.id,commentId:i.id}),q=()=>{A(!1),P(void 0),m&&h()},B=()=>{P(Mt.JI.Error),(0,Ft.rv)(l.data.id)},V=()=>m?void(0,Ft.gq)({comment:i,content:N,fact:l,onError:B,onSuccess:q,status:D,updateStatus:e=>P(e)}):void(c?(0,Ft.oM)({comment:i,content:N,fact:l,status:D,storeFilterId:o,updateStatus:e=>P(e),onSuccess:q,onError:B}):(0,Ft.uf)({comment:i,content:N,fact:l,heroCommentId:d,onError:B,onSuccess:q,status:D,updateStatus:e=>P(e)})),U=document.getElementById(Gn);(0,n.useEffect)((()=>{R&&U&&x&&(U.selectionStart=x,U.selectionEnd=x,U.focus(),I(R))}),[T,U,R,x]);const H=s()("ghq-Comment",{"is-highlighted":_,"is-editing":T});return n.createElement("div",{className:H,"data-testid":c?"Comment":"CommentReply",ref:e=>{e&&(k=e)}},n.createElement("div",{className:"Comment__metadata"},n.createElement(Bn,{owner:i.owner}),M?n.createElement(Tn,{announcementId:y}):n.createElement(Hn,{comment:i,commentSendingStatus:D,isCommentOwner:(0,Ft.k3)({comment:i,authEmail:p.data.email}),isHero:c,isEditing:T,profileId:S,onRetry:V}),(0,Ft.zG)({canAnswerQuestion:!1,canManageBasedonCollPerms:Z,isEditing:T,isOwner:(0,Ft.k3)({comment:i,authEmail:p.data.email}),isReplyOnResolvedComment:(0,Ft.$X)({isHero:c,queryType:u})})&&n.createElement(Rn,{comment:i,fact:l,canResolve:(0,Ft.ej)({isHero:c,isCard:(0,Ft.F_)(r),isAnnouncement:v,isOpen:(0,Ft.Sn)(i),hasPermission:Z||(0,Ft.k3)({comment:i,authEmail:p.data.email})}),onResolve:()=>{(0,Ft.qB)({commentId:i.id,factId:l.data.id,filterId:null!=o?o:"",message:"Your comment has been resolved"})},onDelete:()=>{c?(0,Ft.kn)({comment:i,fact:l,storeFilterId:null!=o?o:"",onDeleteSuccess:()=>g.refetchQueries(["announcements"])}):(0,Ft.gj)({comment:i,fact:l,heroCommentId:d})},onEdit:()=>{A(!0)},onUnresolve:()=>{(0,Ft.kX)({commentId:i.id,factId:l.data.id,filterId:null!=o?o:""})},onUseAsAnswer:()=>{}})),T?n.createElement(n.Fragment,null,n.createElement(zn,{content:N,isNew:m,onChange:e=>{I(e.target.value),F(e)},onCancel:()=>{A(!1),I(i.content),m&&h()},onSave:V,onKeyDown:e=>O(e),onBlur:()=>{zt.hideMentionMenu()}}),U?n.createElement(Xn.Z,{poll:!0,target:U}," ",n.createElement(ir,{factId:l.data.id,targetNode:U})," "):null):n.createElement(n.Fragment,null,n.createElement("div",{className:"Comment__content"},M?n.createElement(An,{setIsScheduledAnnouncement:b,announcementId:y}):null,n.createElement($n.Z,null,n.createElement(Ht.ZP,{properties:{target:"_blank",rel:"noopener noreferrer"}},i.content))),M?n.createElement(Cn,{announcementId:y}):null,C?n.createElement(Kn,{reactions:null!==(a=i.reactions)&&void 0!==a?a:[],type:c?ya.D.CardComment:ya.D.CardCommentReply,typeId:i.id,userId:p.data.email,isOpenComment:u===Mt.e7.Open}):null))};var lr=a(15670),cr=a(21100);const dr=e=>{let{onClick:t,disabled:a=!1}=e;return n.createElement("div",{className:"CommentThreadExpander","data-testid":"CommentThreadExpander"},n.createElement(ft.ZP,{disabled:a,icon:nt.Z.ToggleMenu,label:"Show more replies",size:ft.qE.Small,style:ft.ZJ.Text,theme:ft.bn.Primary,onClick:t}))};var mr=a(29703);const ur=e=>{var t,a,r,s,i;let{comment:o,fact:l,queryType:c}=e;const[d,m]=n.useState(1),[h,p]=function(e){let{hasReplies:t,commentId:a,factId:r}=e;const[s,i]=(0,T.Z)({filterId:a,store:cr.Z,actions:lr.Z});return n.useEffect((()=>{t&&i.get({pathVars:[r,a]})}),[t,r,a]),[s,i]}({hasReplies:(null!==(t=o.totalReplies)&&void 0!==t?t:0)>0,factId:null!==(a=l.data.id)&&void 0!==a?a:"",commentId:o.id}),{items:g,linkHeaders:f,status:E}=h,v=null!==(r=g.editData)&&void 0!==r?r:[],C=(y="id",[...new Map(v.map((e=>[e[y],e]))).values()]);var y;const b=C.length,S=function(e){const t=n.useRef(0);return n.useEffect((()=>{t.current=e})),t.current}(b),Z=null!==(s=null==f||null===(i=f["next-page"])||void 0===i?void 0:i.token)&&void 0!==s?s:"",N=Boolean(b>d||Z),I=E===u.S.Loading,A=E===u.S.Updating,_=function(){let e,{loadNextPage:t=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t&&(e=f["next-page"]),p.get({pathVars:[l.data.id,o.id],linkHeader:e})},w=()=>{if(N)if(b!==d)m(b);else{if(!Z)return;_({loadNextPage:!0})}};n.useEffect((()=>{1!==d&&(w(),Z&&(N||S===b||_()))}),[b]);const D=(P=C.slice(0,d),[...P].reverse());var P;return n.createElement("div",{className:"CommentReplies","data-testid":"CommentReplies"},N&&n.createElement(dr,{disabled:A,onClick:w}),I?n.createElement("div",{className:"CommentThread__replies-loader"},n.createElement(Nt.ZP,{size:Nt.wx.Medium})):D.map(((e,t)=>n.createElement(n.Fragment,{key:"".concat(e.id,"-comment")},(e=>{let{index:t,hasHiddenReplies:a}=e;return!a||0!==t})({index:t,hasHiddenReplies:N})&&n.createElement(mr.Z,null),n.createElement(or,{cardType:Vt.eT.Card,comment:e,fact:l,heroCommentId:o.id,isHero:!1,queryType:c})))))},hr=e=>{let{comment:t,fact:a}=e;const[r]=(0,_e.Z)(),[s,i]=n.useState(!1),o=(0,Ft.uZ)({auth:r,heroCommentId:t.id}),[l,c]=n.useState(o);return n.createElement("div",{className:"CommentReplyButton","data-testid":"CommentReplyButton"},s?n.createElement(or,{isNew:s,key:"".concat(l.id,"-comment-reply"),queryType:Mt.e7.Open,comment:l,fact:a,onCancelReply:()=>i(!1)}):n.createElement("div",{className:"CommentReplyButton__button"},n.createElement(Wa.Z,{alignment:Wa.A.Right},n.createElement(ft.ZP,{size:ft.qE.Small,theme:ft.bn.Gray,style:ft.ZJ.Outline,label:"Reply",icon:nt.Z.Comment,onClick:()=>{i(!0),c(o)}}))))},pr=e=>{let{comment:t,commentsStoreFilterId:a,fact:r,queryType:s}=e;const{hasReplies:i,showReplyButton:o}=Jn();return n.createElement(it.ZP,{modifier:it.QV.Blank},n.createElement(it.R3,null,n.createElement(or,{isHero:!0,queryType:s,cardType:Vt.eT.Card,key:"".concat(t.id,"-comment"),fact:r,comment:t,commentsStoreFilterId:a}),i&&n.createElement(ur,{fact:r,comment:t,queryType:s})),o&&n.createElement(it.v3,null,n.createElement(hr,{comment:t,fact:r})))};var gr=e=>n.createElement(Qn,{comment:e.comment,queryType:e.queryType},n.createElement(pr,e)),fr=a(25686);const Er=e=>{const{comments:t,commentsStatus:a,fact:r,hasWaypoint:s,meta:i,onEnterWaypoint:o,queryType:l=Mt.e7.Open}=e,c=(0,Ft.q6)({factId:r.data.id,queryType:l});return n.createElement(n.Fragment,null,n.createElement($e.Z,{isReloading:a===u.S.Updating}),s&&n.createElement(Bt.h,{key:"card-comments-waypoint",onEnter:o}),(d=t,[...d].reverse()).map((e=>n.createElement(gr,{key:e.id,fact:r,comment:e,meta:i,commentsStoreFilterId:c,queryType:l}))),n.createElement(fr.FN,{filter:"comments-fact-".concat(r.id)}));var d};var vr=a(66678),Cr=a.n(vr),yr=a(28899);var br={Mixin:e=>({componentDidUpdate(){this.state.textCaret&&(P.findDOMNode(this.refs[e]).selectionStart=this.state.textCaret,P.findDOMNode(this.refs[e]).selectionEnd=this.state.textCaret,yr.Z.setTimeout(function(){P.findDOMNode(this.refs[e]).focus(),this.updateTextCaret({textCaret:null})}.bind(this),0))},componentWillUnmount(){const{factId:e,fact:t}=this.props,a=e||o()(t,"id",o()(t,"data.id"));aa.replaceFilterMeta(a,{}),aa.replaceData([],a)},updateTextCaret(e){this.setState(e)},hideNameMenu(){zt.hideMentionMenu()},getMentionState(t){const{factId:a,fact:n}=this.props,r=a||o()(n,"id",o()(n,"data.id")),s={};let i=t.target.value;const l=i.lastIndexOf("@",t.target.selectionStart);if(s.showNameMenu=!1,s.searchNameText="",l>=0){const e=/\s+/;i=i.substring(l+1,t.target.selectionStart),null===i.match(e)&&(s.showNameMenu=!0,s.searchNameText=i)}return s.showNameMenu?(aa.mergeFilterMeta(r,{search:i}),zt.showMentionMenu(r,i,this.addMemberName,(e=>{const t=e.getBoundingClientRect();return{top:t.top+window.scrollY,left:t.left+window.scrollX}})(t.target),this.refs[e])):zt.hideMentionMenu(),s},checkForName(e){let t=!0;if(this.state.showNameMenu)switch(e.keyCode){case na.ZP.Tab:case na.ZP.Enter:this.addMemberName(),t=!1;break;case na.ZP.ArrowUp:zt.selectUp(),t=!1;break;case na.ZP.ArrowDown:zt.selectDown(),t=!1;break;case na.ZP.Escape:zt.hideMentionMenu(),t=!1}t||(e.stopPropagation(),e.preventDefault())},addMemberName(){const{factId:t,fact:a}=this.props,n=t||o()(a,"id",o()(a,"data.id")),r=P.findDOMNode(this.refs[e]),s=r.value,i=s.lastIndexOf("@",r.selectionStart),l=s.substring(0,i+1)+Ea.getSelectedMember().username+" ",c=s.substring(r.selectionStart);this.setState({commentText:l+c,showNameMenu:!1,textCaret:l.length}),Xt.replaceData({text:l+c},n),zt.hideMentionMenu()}})},Sr=a(95587),Zr=a(34928),Nr=a(25108);var Ir=tr()({displayName:"AddComment",propTypes:{fact:D().object.isRequired,maxHeight:D().number,focusOnMount:D().bool,onEscape:D().func,onCommentAdded:D().func.isRequired},mixins:[br.Mixin("commentBody"),(0,ar.Z)(Rt.Z,Pe.Z,ia,Sr.Z)],getDefaultProps:()=>({maxHeight:200,focusOnMount:!1,onEscape:null,onCommentAdded:()=>{}}),getStoreFilterName(e){const{fact:t,queryType:a}=this.props,n=t.data.cardType===le().QUESTION?t.id:(0,Ft.q6)({factId:t.data.id,queryType:a});if(e===E.Comments)return n;Nr.error("filter not set")},getStateFromFlux(){var e,t;return{auth:Pe.Z.getState(),comments:Rt.Z.getFilter(this.getStoreFilterName(E.Comments)),commentText:null!==(e=null===(t=ia.getFilter(this.props.fact.data.id).data)||void 0===t?void 0:t.text)&&void 0!==e?e:""}},componentDidMount(){const{focusOnMount:e}=this.props,{commentBody:t}=this.refs;e&&this.refs.commentBody&&t.focus(),this.refs.commentBody.selectionStart=this.refs.commentBody.selectionEnd=this.state.commentText.length},clearComment(){this.setState({commentText:"",height:null}),Xt.resetFilter(this.props.fact.data.id)},postComment(){const{commentText:e,auth:t}=this.state,{fact:a}=this.props,n=Zr.Z.getId("new"),r={data:{id:n,content:e,owner:{email:t.data.email,firstName:t.data.firstName,lastName:t.data.lastName,profilePicUrl:t.data.profilePicUrl}},meta:{isSending:!0}};if(!e||0===e.trim().length)return;const s={pathVars:[a.data.id],data:JSON.stringify({content:e}),success:this.onCommentCreationSuccess,error:this.onCommentCreationError,meta:{tempId:n,comment:r.data}};Ot.Z.post(this.getStoreFilterName(E.Comments),s),Ot.Z.unshiftEditDataItem(this.getStoreFilterName(E.Comments),r.data),Ot.Z.replaceFilterItemMeta(this.getStoreFilterName(E.Comments),n,{tempId:n,comment:r}),this.clearComment()},onCommentCreationSuccess(e,t){const a=Rt.Z.getFilter(this.getStoreFilterName(E.Comments)),n=Cr()(a.items.editData).filter((e=>t.tempId!==e.id));Ot.Z.replaceEditData(this.getStoreFilterName(E.Comments),n),this.props.onCommentAdded()},onCommentCreationError(e,t){Ot.Z.replaceFilterItemMeta(this.getStoreFilterName(E.Comments),t.tempId,{isSending:!1,isError:!0})},checkForSave(e){e.keyCode!==na.ZP.Enter||e.shiftKey||(e.stopPropagation(),e.preventDefault(),this.postComment(),this.props.onAddComment&&this.props.onAddComment())},changeCommentText(e){const{commentBody:t}=this.refs,a=e.target.value,n=this.getMentionState(e);Xt.replaceData({text:a},this.props.fact.data.id);const r=P.findDOMNode(t);a.length>0?this.setState({...n,height:Math.min(r.scrollHeight,200)}):this.setState({...n,height:null})},renderMentionList(){const{fact:e}=this.props,{commentBody:t}=this.refs;return t?n.createElement(Xn.Z,{poll:!0,target:t},n.createElement(ir,{factId:e.data.id,targetNode:t})):null},render(){const{commentText:e}=this.state,t=this.renderMentionList(),a=s()("ghq-cmt-commentinput ghq-input",{"ghq-is-extension":m.ZP.isExtension()});return n.createElement("div",{className:"ghq-add-comment","data-testid":"Add Comment"},n.createElement("div",{className:"ghq-addcomment",onKeyDown:this.checkForSave},n.createElement("textarea",{autoFocus:!0,className:a,"data-testid":"Add Comment Input",ref:"commentBody",placeholder:"Add a comment...",value:e,key:"comment",style:{height:this.state.height},onKeyDown:this.checkForName,onBlur:this.hideNameMenu,onChange:this.changeCommentText,onMouseDown:e=>e.stopPropagation()}),t))}});const Tr=e=>{let{auth:t,comments:a,commentsStatus:r,fact:s,hasDoneInitialScroll:i,linkHeaders:o,meta:l,onEnterWaypoint:c,queryType:d}=e;const m=Boolean(i&&(null==o?void 0:o["next-page"]));return[oe.NOT_LOADED,oe.LOADING].includes(r)?n.createElement("div",{className:"ghq-CardComments__loader"},n.createElement(Nt.ZP,{dataTestId:"card-comments-loader"})):a.length?n.createElement(Er,{auth:t,comments:a,commentsStatus:r,fact:s,meta:l,queryType:d,hasWaypoint:m,onEnterWaypoint:c}):n.createElement(qt,{queryType:d})};class Ar extends n.Component{constructor(){var e;super(...arguments),e=this,this.state={waypointId:null,hasDoneInitialScroll:!1,oldScrollBottom:null},this.scrollContainerRef=void 0,this.scrollToBottom=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const{hasDoneInitialScroll:a}=e.state,{activeAnnouncement:n}=e.props;e.scrollContainerRef&&(setTimeout((()=>{var t;n||(null===(t=e.scrollContainerRef)||void 0===t||t.scrollIntoView({block:"end",behavior:"smooth"}))}),t),e.scrollContainerRef.scrollTop+=24,a||e.setState({hasDoneInitialScroll:!0}))},this.setNewScrollTop=(e,t)=>{const a=e.clientHeight,n=e.scrollHeight-t-a;e.scrollTop=n,this.setState({oldScrollBottom:null})},this.calculateScrollBottomRestore=()=>{const e=this.scrollContainerRef,t=e.clientHeight;return e.scrollHeight-e.scrollTop-t},this.onEnterWaypoint=()=>{const{loadWaypoint:e,linkHeaders:t,queryType:a}=this.props,{waypointId:n}=this.state,r=t["next-page"].token;if(n===r)return;const s=this.calculateScrollBottomRestore();this.setState({waypointId:r,oldScrollBottom:s});e({linkHeader:t["next-page"],queryParams:a?{status:a}:null})}}componentDidMount(){const{commentsStatus:e}=this.props;e===oe.LOADED&&this.scrollToBottom()}componentDidUpdate(e){const{commentsStatus:t}=e,{commentsStatus:a}=this.props,{hasDoneInitialScroll:n,oldScrollBottom:r}=this.state;a===oe.LOADED&&t===oe.UPDATING&&null!==r&&this.scrollContainerRef&&this.setNewScrollTop(this.scrollContainerRef,r),n||a!==oe.LOADED||this.scrollToBottom(500)}render(){const{auth:e,comments:t,commentsStatus:a,fact:r,linkHeaders:s,meta:i,queryType:o,showAddComment:l}=this.props,{hasDoneInitialScroll:c}=this.state;return n.createElement("div",{className:"ghq-CardComments"},n.createElement("div",{className:"ghq-CardComments__comments"},n.createElement("div",{className:"ghq-CardComments__comments-constrained-width",ref:e=>{this.scrollContainerRef=e}},n.createElement(Tr,{auth:e,comments:t,commentsStatus:a,fact:r,hasDoneInitialScroll:c,linkHeaders:s,meta:i,queryType:o,onEnterWaypoint:this.onEnterWaypoint}))),l?n.createElement("div",{className:"ghq-CardComments__add-comment"},n.createElement(Ir,{queryType:o,fact:r,factId:r.data.id,onCommentAdded:this.scrollToBottom})):null)}}function _r(e){let{queryType:t=Mt.e7.Open,fact:a}=e;const[r]=(0,_e.Z)(),[s,i]=function(e){let{factId:t,pathVars:a,queryType:r=Mt.e7.Open}=e;const s=(0,Ft.q6)({factId:t,queryType:r}),[i,o]=(0,T.Z)({filterId:s,store:Rt.Z,actions:Ot.Z});return n.useEffect((()=>o.get({pathVars:[a],queryParams:{status:r}})),[r]),[i,o]}({factId:a.data.id,pathVars:[a.data.id],queryType:t}),{activeAnnouncement:o}=(0,n.useContext)(ye.ZP),l=t===Mt.e7.Resolved;return n.createElement(Ar,{fact:a,comments:s.items.editData,meta:s.items.meta,linkHeaders:s.linkHeaders,commentsStatus:s.status,auth:r,showAddComment:!l,queryType:t,loadWaypoint:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i.get({pathVars:[a.data.id],...e})},activeAnnouncement:o})}var wr=a(69280);function Dr(){return Dr=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},Dr.apply(this,arguments)}const Pr=()=>{const e=n.useContext(ye.ZP),t=(0,ke.Z)("comments"),a=null==t?void 0:t.value,[r,s]=n.useState(a&&a===Mt.e7.Resolved?Mt.e7.Resolved:Mt.e7.Open),i=[{label:Mt.LV.Open,id:Mt.e7.Open},{label:Mt.LV.Resolved,id:Mt.e7.Resolved}];return n.createElement("div",{className:"CardCommentsTabPanelGroup","data-testid":"CardCommentsTabPanelGroup"},n.createElement(it.ZP,{modifier:it.QV.Underlined},n.createElement(wr.ZP,{activeTab:r,setActiveTab:e=>(e=>{s(e)})(e)},n.createElement(wr.v0,null,i.map((e=>n.createElement(wr.OK,{key:e.id,tabId:e.id},e.label)))),n.createElement("div",{className:"CardCommentsTabPanelGroup__content"},i.map((t=>n.createElement(wr.x4,{key:t.id,tabId:t.id},r===t.id?n.createElement(_r,Dr({fact:e.__compatProps.card},e.__compatProps,{queryType:t.id})):null)))))))};var kr=e=>{let{title:t,children:a}=e;const{setShowCommentsTray:r}=(0,n.useContext)(ye.ZP);return n.createElement("div",{className:"ghq-CardCommentsTray","data-testid":"card-comments-tray"},n.createElement("div",{className:"ghq-CardCommentsTray__upper"},t&&n.createElement("h2",{className:"ghq-CardCommentsTray__upper-title"},t),n.createElement(at.ZP,{style:at.Dd.Standard,aria:"close-tray",icon:nt.Z.CloseArrowRight,tooltipLabel:"Collapse",tooltipPosition:at.DU.Left,onClick:()=>r(!1)})),n.createElement("div",{className:"ghq-CardCommentsTray__content"},a))},Lr=a(71643),Mr=a(35034);class Or extends n.Component{render(){const{renderLabel:e}=this.props;return n.createElement("div",{className:"ghq-CardDetailsSection"},n.createElement("div",{className:"ghq-CardDetailsSection__label"},e()),this.props.children)}}Or.propTypes={renderLabel:D().func},Or.defaultProps={renderLabel:()=>{}};var Fr=a(35874),Rr=a(11514);let xr;!function(e){e.Current="CURRENT",e.Default="DEFAULT"}(xr||(xr={}));var qr=a(87159),Br=a(4879);var Vr=function(e){var t;let{item:a,lastVerifiedItem:r,type:i,isTrusted:l,isUntrusted:c,onCompareToLatest:d,onCompareToLastVerified:u,onViewChanges:h}=e;const{getTrackEventData:p}=(0,dn.Z)(),[g]=(0,Ue.Z)(Ne.Z.EXTENSION_PROFILES_ALLOWED),{onClick:f,to:E}=(0,cn.k)(null===(t=a.lastModifiedBy)||void 0===t?void 0:t.id,g);return n.createElement("div",{className:s()("ghq-CardHistoryItem",{"ghq-is-current":i===Ee().history.CURRENT})},n.createElement("div",{className:"ghq-CardHistoryItem__avatar-and-icon"},(()=>{const e=xn.ZP.getProfileUrl(o()(a,"lastModifiedBy.profilePicUrl",""),68),t=i===xr.Current,s=a.version===r.data.version&&c,d=t||s?n.createElement("div",{className:"ghq-CardHistoryItem__trust-stamp"},n.createElement(Br.Z,{isTrusted:t?l:s})):n.createElement("div",{className:"ghq-CardHistoryItem__icon"},n.createElement(fn.Z,{color:wt.ZP.Dusk,size:12,icon:nt.Z.Pencil}));return n.createElement(n.Fragment,null,n.createElement(qn.Z,{size:pn.Z.sizes.LARGE,profilePictureSrc:e,firstName:a.lastModifiedBy.firstName,lastName:a.lastModifiedBy.lastName,email:a.lastModifiedBy.email,url:E,trackEvent:p({activitySubtype:dn.Y.CardHistory,userId:a.lastModifiedBy.email}),onClick:()=>{g&&f()}}),d)})()),n.createElement("div",{className:"ghq-CardHistoryItem__details"},(()=>{const e=Te()(a.lastModified,"YYYY-MM-DD[T]HH:mm:ss.SSSZZ").format("MMM D, YYYY");return n.createElement("div",{className:"ghq-CardHistoryItem__last-modified"},e)})(),(()=>{const e=1===a.version,t=s()("ghq-CardHistoryItem__current-version",{"ghq-is-trusted":l,"ghq-is-untrusted":c});return i===Ee().history.CURRENT?n.createElement("div",{className:t,"data-testid":"current-card-history"},n.createElement("span",{className:"ghq-CardHistoryItem__current"},"Current:"),a.version-1==0?" Original":" Revision #".concat(a.version-1)):r.data.version===a.version&&c?n.createElement("div",{className:t},n.createElement("span",{className:"ghq-CardHistoryItem__last-trusted"},"Last Trusted:"),a.version-1==0?" Original":" Revision #".concat(a.version-1)):e?n.createElement("div",{className:"ghq-CardHistoryItem__revision"},"Original"):n.createElement("div",{className:"ghq-CardHistoryItem__revision"},"Revision #",a.version-1)})(),(()=>{const e=gt.Z.getPersonalName(a.lastModifiedBy);return g&&(0,m.p1)()?n.createElement(ft.ZP,{size:ft.qE.Small,style:ft.ZJ.Anchor,theme:ft.bn.Dark,label:e,onClick:f}):n.createElement(Sn.Z,{to:E,type:Sn.q.MediumPriority,trackEvent:p({activitySubtype:dn.Y.CardHistory,userId:a.lastModifiedBy.email}),onClick:f},n.createElement("span",{className:"ghq-CardHistoryItem__modified-by-name"},e))})(),(()=>{const e=i!==Ee().history.DEFAULT?null:n.createElement(ft.ZP,{label:"Current Version",size:ft.qE.Small,style:ft.ZJ.Anchor,onClick:()=>{d(a.version)}}),t=(()=>{const e=1===a.version,t=a.version-1==1;return e?null:n.createElement(ft.ZP,{label:t?"Original":"Revision #".concat(a.version-2),size:ft.qE.Small,style:ft.ZJ.Anchor,onClick:()=>{h(a.version)}})})(),s=(()=>{const{version:e,lastVerified:t,lastVerifiedBy:s}=r.data,o=i!==Ee().history.CURRENT,l=e===a.version;return t&&s&&!o&&!l&&c?n.createElement(ft.ZP,{label:"Last Trusted",size:ft.qE.Small,style:ft.ZJ.Anchor,onClick:()=>u(a.version)}):null})();return e||t?n.createElement(Wa.Z,{alignment:Wa.A.Left},n.createElement("div",{className:"ghq-CardHistoryItem__compare-to"},"Compare to: "),e,t,s):null})()))},Ur=a(95879),Hr=a(61038);var Wr=(0,h.Z)(((e,t)=>{let{fact:a}=t;return{cardHistory:Hr.Z.getById(a.id)}}))([Hr.Z],(function(e){let{fact:t,cardHistory:a}=e;const[r,s]=(0,n.useState)(!1),i=(0,n.useRef)(null);(0,n.useEffect)((()=>{Rr.Z.loadCardHistory(t.id)}),[t]);const o=e=>{e.key===qr.R.Escape&&(s(!1),e.stopPropagation())},l=()=>{i.current&&i.current.addEventListener("keydown",o),s(!0)},c=()=>{const e=a.id,t=a.data.lastVerified.data.version,n=a.data.cardVersions[0].version;Fr.Z.addCardDiff(e,t,n),l()},d=e=>{var t,n;const r=null===(t=a.data.cardVersions)||void 0===t||null===(n=t[0])||void 0===n?void 0:n.version;if(!r)return;const{cardVersions:s}=a.data,i=s[r-e+1].version,o=s[r-e].version;Fr.Z.addCardDiff(a.id,i,o),l()},m=e=>{var t,n;const r=null===(t=a.data.cardVersions)||void 0===t||null===(n=t[0])||void 0===n?void 0:n.version;if(!r)return;const{cardVersions:s}=a.data,i=s[r-e].version,o=s[0].version;Fr.Z.addCardDiff(a.id,i,o),l()};return a&&a.status===le().LOADED&&a.data.lastVerified&&a.data.lastVerified.status===le().LOADED?n.createElement("div",{className:"ghq-CardHistory",ref:i},a.data.cardVersions.map(((e,r)=>n.createElement(Vr,{key:0===r?"0current":"".concat(r,"default"),type:0===r?xr.Current:xr.Default,item:e,isTrusted:t.data.verificationState===le().TRUSTED,isUntrusted:t.data.verificationState===le().NEEDS_VERIFICATION,lastVerifiedItem:a.data.lastVerified,onCompareToLatest:m,onCompareToLastVerified:c,onViewChanges:d}))),r&&n.createElement(Ur.Z,{onClose:()=>{i.current&&i.current.removeEventListener("keydown",o,!0),s(!1)}})):n.createElement("div",{className:"ghq-CardHistory"})})),Gr=a(39531);f.Z.register(E.CardsLinks,{GET:{path:"/cards/:cardId/links"}});const zr=new C.Z({dataType:E.ARRAY,name:E.CardsLinks,syncFilters:!1});zr.createStore();var Yr=g.Z.addStore(zr.store),Kr=a(25108);const jr=new p.Z({name:Yr.getName()}),Jr=g.Z.getFlux().actions[jr.name];Jr||Kr.error("Error creating actions");var Qr=Jr;var Xr=a(11975),$r=a(95302),es=a(12022),ts=a(1918);const as=e=>{let{cardSlug:t,cardId:a,cardTitle:r,verificationState:s}=e;const i=m.ZP.isExtension()?"".concat(pe.ZP.APP_URL,"/card/").concat(t):"/card/".concat(t);return n.createElement("div",{className:"LinkedCard"},a?n.createElement(n.Fragment,null,n.createElement("span",{className:"LinkedCard__icon"},n.createElement(Br.Z,{isTrusted:s===le().TRUSTED})),n.createElement(Sn.Z,{normal:!0,to:i,onClick:()=>ts.Z.transitionTo(i)},r)):n.createElement(n.Fragment,null,n.createElement("span",{className:"LinkedCard__icon"},n.createElement(fn.Z,{icon:nt.Z.Lock,color:wt.ZP.Vacuum})),n.createElement(St.ZP,{modifier:St.s4.Italicized},"You do not have access to this Card")))},ns=e=>{var t;let{linkedCards:a}=e;const r=null!==(t=[...a].sort((e=>{let{cardId:t=!1}=e;return t?-1:1})))&&void 0!==t?t:[];return r.length>0?n.createElement("div",{className:"LinkedCards"},n.createElement(ja.ZP,{level:ja.Yx.H4,style:ja.VH.Small},n.createElement("span",{className:"LinkedCards__header"},"The following Cards contain a link to this Card:")),n.createElement(es.Z,{spacing:es.Z.spaces.RELAXED},r.map((e=>n.createElement(es.H,{key:e.cardId},n.createElement(as,e)))))):n.createElement("div",{className:"LinkedCards__empty-state"},n.createElement($r.Z,{imageUrl:"common/images/empty-card-links.svg",heading:"No links",bodyCopy:"No other Guru Cards contain links to this Card.",cta:n.createElement(Sn.Z,{ariaLabel:"Learn more about card to card linking.",to:Xr.Z.CARD_TO_CARD_LINKING,type:Sn.q.HighPriority,target:"_blank"},"Learn more at our Help Center")}))},rs=e=>{var t,a,r;let{cardId:s,fact:i,hasHistory:o}=e;const[l,c]=n.useState(o?"revision-history":"linked-cards"),[d]=function(e){const[t]=(0,Ue.Z)(Ne.Z.CARD_TO_CARD_LINKING_ALLOWED);return(0,T.Z)({filterId:e,store:Yr,actions:Qr,onMustLoad:a=>e&&t&&a.get({pathVars:[e]})})}(s),m=null!==(t=null==d||null===(a=d.items)||void 0===a||null===(r=a.data)||void 0===r?void 0:r.length)&&void 0!==t?t:0;return n.createElement(it.ZP,{modifier:it.QV.Underlined},n.createElement(wr.ZP,{activeTab:l,setActiveTab:c},n.createElement(wr.v0,null,o&&n.createElement(wr.OK,{tabId:"revision-history"},"Revision History"),n.createElement(wr.OK,{tabId:"linked-cards"},"Cards that link to this Card",n.createElement("div",{className:"LinkedCard__tag"},m))),o&&n.createElement(wr.x4,{tabId:"revision-history"},n.createElement(Wr,{fact:i})),n.createElement(wr.x4,{tabId:"linked-cards"},n.createElement(ns,{linkedCards:d.items.data}))))},ss=e=>{let{image:t,name:a,firstName:r,lastName:s,date:i,id:o,email:l}=e;const{getTrackEventData:c}=(0,dn.Z)(),d=o?(0,Gr.pv)(o):void 0,[u]=(0,Ue.Z)(Ne.Z.EXTENSION_PROFILES_ALLOWED),h=u&&(0,m.p1)(),{onClick:p,to:g}=(0,cn.k)(o,u);return n.createElement("div",{className:"ghq-CardDetails__timestamp"},Boolean(t)&&n.createElement(qn.Z,{profilePictureSrc:t,firstName:r,lastName:s,email:l,size:pn.Z.sizes.LARGE,url:g,trackEvent:c({activitySubtype:dn.Y.CardDetails,userId:l}),onClick:p}),n.createElement("div",{className:"ghq-CardDetails__timestamp-info"},Boolean(a)&&(d?h?n.createElement(ft.ZP,{size:ft.qE.Small,style:ft.ZJ.Anchor,theme:ft.bn.Dark,label:a,onClick:p}):n.createElement(Sn.Z,{to:g,type:Sn.q.MediumPriority,trackEvent:c({activitySubtype:dn.Y.CardDetails,userId:l}),onClick:p},n.createElement("p",{className:"ghq-CardDetails__timestamp-text"},a)):n.createElement("p",{className:"ghq-CardDetails__timestamp-text"},a)),n.createElement("p",null,n.createElement(It.Z,{date:i}))))};var is=()=>{var e,t,a;const{__compatProps:r,card:i,dateCreated:o,lastSyncDate:l,isSynced:c,isSyncedNoVerification:d,hasAnalytics:m,hasHistory:u,lastVerified:h,lastVerifiedBy:p,originalOwner:g}=(0,ye.RC)(),[f]=(0,Ue.Z)(Ne.Z.CARD_TO_CARD_LINKING_ALLOWED),[E]=(0,Ue.Z)(Ne.Z.KNOWLEDGE_SYNC_VERIFIERS),[v]=(0,Ue.Z)(Ne.Z.NEW_CARD_ANALYTICS_ALLOWED),{syncInfo:C,id:y}=i.data,b=null==C?void 0:C.contentSyncType,S=!E&&!c||E&&!d,Z=c&&l&&!E,N=l?new Date(l).toISOString():void 0,{firstName:I,lastName:T,id:A,email:_}=p||{},w=p?xn.ZP.getProfileUrl(p.profilePicUrl,pn.Z.sizes.LARGE):void 0,D=p&&gt.Z.getPersonalName(p),P=p?null===(e=new Date(h))||void 0===e?void 0:e.toISOString():void 0,k=w||D||P,{firstName:L,lastName:M,id:O,email:F}=g||{},R=gt.Z.getPersonalName(g),x=xn.ZP.getProfileUrl(null==g?void 0:g.profilePicUrl,pn.Z.sizes.LARGE),q=new Date(o).toISOString();return n.createElement("div",{className:"ghq-CardDetails"},n.createElement("div",{className:s()("ghq-CardDetails__creation-details",{"ghq-no-verification-status":d&&E})},n.createElement(Or,{renderLabel:()=>c?"Sync Created":"Card Created"},n.createElement("div",{className:"ghq-CardDetails__created-by","data-testid":"CreatedBy"},o?n.createElement(ss,{image:x,name:R,firstName:L,lastName:M,date:q,email:F,id:O}):null)),Z&&N&&n.createElement(Or,{renderLabel:()=>"Last Synced"},n.createElement("p",{className:"ghq-CardDetails__last-verified"},n.createElement(It.Z,{withTime:!0,date:N}))),S&&n.createElement(Or,{renderLabel:()=>"Last Verified"},n.createElement("div",{className:"ghq-CardDetails__last-verified","data-testid":"LastVerification"},k?n.createElement(ss,{image:w,name:D,firstName:I,lastName:T,email:_,date:P,id:A}):n.createElement("p",{className:"ghq-CardDetails__never-verified"},"This card has never been verified")))),c&&l&&n.createElement("div",{className:"ghq-CardDetails__last-synced"},n.createElement("div",{className:"ghq-CardDetails__last-synced-img-wrapper"},n.createElement(fn.Z,{icon:null!==(t=Lr.TW[b])&&void 0!==t?t:Lr.TW[Lr.ZP.MANUAL],size:20})),n.createElement("div",{className:"ghq-CardDetails__last-synced-text-wrapper"},n.createElement("p",null,n.createElement("span",{className:"ghq-CardDetails__last-synced-origin"},"Last synced from"," ",null!==(a=Lr.jV[b])&&void 0!==a?a:Lr.jV.UNKNOWN," ","on"),n.createElement("span",{className:"ghq-CardDetails__timestamp-text"},n.createElement(It.Z,{withTime:!0,date:N}))),n.createElement("p",null,"Learn more in the"," ",n.createElement(Sn.Z,{normal:!0,to:Mr.r.KnowledgeSyncOverview,type:Sn.q.MediumPriority},"Help Center"),"."))),m&&!v?n.createElement(Or,{renderLabel:()=>"Analytics"},n.createElement(Lt,null)):null,f?n.createElement(rs,{fact:i,hasHistory:u,cardId:y}):null,u&&!f?n.createElement(Or,{renderLabel:()=>"Revision History"},n.createElement(Wr,r)):null)},os=a(74001),ls=a(81594),cs=a(14092),ds=a(3368),ms=a(95946),us=a(43814);var hs=e=>{let{isFollowing:t,id:a,serverAssignedId:r}=e;const{isArchivedOrInaccessible:i}=(0,ye.RC)(),[,o]=(0,ds.Z)(),l=(0,us.tq)()||(0,us.xR)(),c=s()("CardFollowButton",{"hide-label":l}),d=t?"Following":"Follow",m=t?nt.Z.NotificationsFilled:nt.Z.Notifications;return n.createElement("div",{className:c,"data-testid":"CardFollowButton"},n.createElement(ft.ZP,{icon:m,theme:ft.bn.Gray,disabled:i,style:ft.ZJ.Outline,label:l?"":d,onClick:()=>{const e="fact-card-".concat(a),n={pathVars:[r],success:()=>{$.Z.createToast({content:t?"Card update notifications turned off.":"Card update notifications turned on.",type:ms.p.Success,id:e})},error:()=>{$.Z.createToast({content:"Unable to ".concat(t?"un":"","follow. Try again."),type:ms.p.Error,id:e})}};t?o.delete(n):o.put(n)}}))},ps=a(68897),gs=a(96751),fs=a(25108);const Es=new p.Z({name:gs.Z.getName()}),vs=g.Z.getFlux().actions[Es.name];vs||fs.error("Error creating actions");var Cs=vs;function ys(e){return(0,T.Z)({filterId:e,store:gs.Z,actions:Cs,onMustLoad:t=>e&&t.get({pathVars:[e]})})}var bs=a(74983);f.Z.register(E.FavoriteListsListEntries,{PUT:{path:"/favoritelists/:listid/entries"}});const Ss=new C.Z({name:E.FavoriteListsListEntries,syncFilters:!1});Ss.createStore();var Zs=g.Z.addStore(Ss.store),Ns=a(25108);const Is=new p.Z({name:Zs.getName()}),Ts=g.Z.getFlux().actions[Is.name];Ts||Ns.error("Error creating actions");var As=Ts;var _s=(0,n.forwardRef)(((e,t)=>{let{aria:a,buttonSelected:r,disableWhenArchived:s=!0,icon:i,onClick:o,tooltipLabel:l}=e;const{isArchivedOrInaccessible:c}=(0,ye.RC)();return n.createElement(at.ZP,{icon:i,iconSize:16,buttonSelected:r,style:at.Dd.Standard,disabled:s&&c,aria:a,tooltipLabel:l,tooltipPosition:at.DU.Bottom,ref:t,onClick:o})})),ws=a(85731),Ds=a(66674),Ps=a(47640),ks=a(55978),Ls=a(96127),Ms=a(81899),Os=a(40979),Fs=a(24594),Rs=a(27434);const{vacuum:xs}=Rs.Z,qs=(e,t)=>{const a=e.filter(Boolean);let n;if(a.length>1){const e=a.reduce(((e,t)=>e+t.listIds.length),0);n="".concat(e," lists updated")}else if(1===a.length){const e=a[0];n="Card ".concat("add-card-to-favoritelist"===e.type?"added to":"removed from"),e.listIds.length>1?n+=" ".concat(e.listIds.length," lists"):n+=' "'.concat(t.find((t=>e.listIds[0]===t.id)).title,'"')}return n},Bs=(e,t)=>e.filter((e=>e.title.split(" ").join("").toLowerCase().includes(t.split(" ").join("").toLowerCase()))).sort(((e,t)=>e.defaultList?-1:t.defaultList||e.title.toLowerCase()>t.title.toLowerCase()?1:-1));function Vs(e){let{card:t,closeMenu:a,handleCreateNewList:r,handleConfirmClose:s,checkboxes:i,listsAreUnchanged:o,handleCheckboxToggle:l,favoritelists:c,cardsFavoritelists:m}=e;const[u,h]=n.useState(!1),[p,g]=n.useState(""),[f,E]=n.useState(Bs(i,p)),v=_()((e=>E(Bs(i,e))),400);n.useEffect((()=>{E(Bs(i,p))}),[i]);const C=()=>{o?(h(!1),a()):h(!0)},y=(0,Ds.Z)(C);return n.createElement("div",{className:"CardHomeSidebarListsMenu ghq-is-not-draggable",ref:y},u?n.createElement("div",{className:"CardHomeSidebarListsMenu__unsaved-changes"},n.createElement("p",{className:"CardHomeSidebarListsMenu__unsaved-changes-text"},"We see you\u2019ve made some unsaved changes to your lists. Are you sure you want to close out before saving?"),n.createElement(ks.Z,{alignment:ks.Z.alignments.center},n.createElement(Ms.Z,{kind:Ms.Z.kinds.GRAY,size:Ms.Z.sizes.MEDIUM,onClick:()=>{h(!1)}},"Cancel"),n.createElement(Ps.Z,{kind:Ps.Z.kinds.PRIMARY,size:Ps.Z.sizes.MEDIUM,onClick:()=>s()},"Discard Changes"))):n.createElement(n.Fragment,null,n.createElement("div",{className:"CardHomeSidebarListsMenu__top-bar"},n.createElement("h1",{className:"CardHomeSidebarListsMenu__top-bar-title"},"Add to list"),n.createElement(Xe.Z,{color:xs,icon:"close",size:12,onClick:()=>C()})),c.length>1&&n.createElement("div",{className:"CardHomeSidebarListsMenu__search-input"},n.createElement(Fs.Z,{placeholder:"Search for a list",value:p,onChange:e=>{return g(t=e),void v(t);var t}})),n.createElement("div",{className:"CardHomeSidebarListsMenu__items"},f.length>0?f.map((e=>n.createElement("div",{key:e.id},n.createElement(Os.Z,{name:e.title,isChecked:Boolean(e.selected),label:e.title,onChange:()=>l(e.id)}),c.length<2&&n.createElement("div",{className:"CardHomeSidebarListsMenu__empty-lists"},n.createElement(Dt.ZP,{icon:nt.Z.Likes,iconSize:32},n.createElement("p",{className:"CardHomeSidebarListsMenu__empty-lists-text"},"Create a new list below to start organizing your Favorite Cards!")))))):n.createElement("p",{className:"CardHomeSidebarListsMenu__search--no-results"},"No lists found")),n.createElement("div",{className:"CardHomeSidebarListsMenu__controls"},n.createElement(Ls.Z,{kind:Ls.Z.kinds.GRAY,size:Ls.Z.sizes.SMALL,icon:"circle-plus",onClick:()=>r()},"New List"),n.createElement(Ps.Z,{disabled:o,kind:Ps.Z.kinds.PRIMARY,size:Ps.Z.sizes.SMALL,onClick:()=>(()=>{const e=[{ids:i.filter((e=>e.selected&&!m.some((t=>t.id===e.id)))).map((e=>e.id)),actionType:"add-card-to-favoritelist"},{ids:i.filter((e=>!e.selected&&m.some((t=>t.id===e.id)))).map((e=>e.id)),actionType:"remove-card-from-favoritelist"}].map((e=>new Promise((a=>{e.ids.length>0?d.Z.bulkOperation({action:{type:e.actionType,listIds:e.ids},items:{type:"id",cardIds:[t.data.id]}},(()=>a({listIds:e.ids,type:e.actionType}))):a()}))));Promise.all(e).then((e=>{a(),$.Z.createToast({content:qs(e,c)})}))})()},"Apply"))))}Vs.propTypes={card:D().object,closeMenu:D().func,handleConfirmClose:D().func,handleCreateNewList:D().func,checkboxes:D().array,listsAreUnchanged:D().bool,handleCheckboxToggle:D().func,favoritelists:D().array,cardsFavoritelists:D().array},Vs.defaultProps={card:{},closeMenu:()=>{},handleConfirmClose:()=>{},handleCreateNewList:()=>{},checkboxes:[],listsAreUnchanged:!0,handleCheckboxToggle:()=>{},favoritelists:[],cardFavoritelists:[]};var Us,Hs=a(79136),Ws=a(20456);!function(e){e.CloseMenus="CLOSE_MENUS",e.CloseNewList="CLOSE_NEW_LIST",e.CheckboxHasBeenClicked="CHECKBOX_HAS_BEEN_CLICKED",e.CreateNewList="CREATE_NEW_LIST",e.ListNameChanged="LIST_NAME_CHANGED",e.ResetCheckboxesFromStote="RESET_CHECKBOXES_FROM_STORE",e.ShowListsMenu="SHOW_LISTS_MENU",e.StartListCreation="START_LIST_CREATION"}(Us||(Us={}));const Gs=(e,t)=>e.every((e=>e.selected?null==t?void 0:t.some((t=>t.id===e.id)):!(null!=t&&t.some((t=>t.id===e.id))))),zs=(e,t)=>{let{type:a,payload:n}=t;switch(a){case Us.CloseMenus:return{...e,shouldShowNewListModal:!1,shouldShowFavoritesMenu:!1,newListName:""};case Us.CloseNewList:return{...e,shouldShowNewListModal:!1,shouldShowFavoritesMenu:!0,newListName:""};case Us.StartListCreation:return{...e,shouldShowNewListModal:!0,shouldShowFavoritesMenu:!1};case Us.CreateNewList:return{...e,shouldShowNewListModal:!1,shouldShowFavoritesMenu:!0,newListName:""};case Us.ListNameChanged:const{updatedName:t}=n;return{...e,newListName:t};case Us.ShowListsMenu:return{...e,shouldShowFavoritesMenu:!0};case Us.ResetCheckboxesFromStote:const a=n.favoritelists.map((e=>{var t;return{...e,selected:null==n||null===(t=n.cardsFavoritelists)||void 0===t?void 0:t.some((t=>t.id===e.id))}}));return{...e,checkboxes:a,listsAreUnchanged:Gs(a,null==n?void 0:n.cardsFavoritelists)};case Us.CheckboxHasBeenClicked:const r=e.checkboxes.findIndex((e=>e.id===(null==n?void 0:n.checkboxID))),s=-1!==r?[...e.checkboxes.slice(0,r),{...e.checkboxes[r],selected:!e.checkboxes[r].selected},...e.checkboxes.slice(r+1,e.checkboxes.length)]:[...e.checkboxes,{...null==n?void 0:n.newCheckboxToAutoSelect,selected:!0}];return{...e,checkboxes:s,listsAreUnchanged:Gs(s,null==n?void 0:n.cardsFavoritelists)};default:throw new Error("Unrecognized action in CardFavorite")}};var Ys=e=>{var t,a;let{cardId:r,card:s,isFavorited:i=!1}=e;const[{items:{editData:o},status:l},c]=ys(r),[m]=(0,Ue.Z)(Ne.Z.FAVORITE_LISTS_ALLOWED),{popoverRef:u,triggerRef:h}=(0,Ws.Z)({containerClass:".ghq-CardFavoriteModalContainer"});(0,ws.Z)({anchor:u,target:h});const[{items:{editData:p},status:g},f]=(0,bs.Z)(),E=null!==(t=null===(a=p.find((e=>e.defaultList)))||void 0===a?void 0:a.id)&&void 0!==t?t:"",[,v]=(C=E,(0,T.Z)({filterId:C,store:Zs,actions:As}));var C;const y=n.useRef(null),[{checkboxes:b,listsAreUnchanged:S,shouldShowFavoritesMenu:Z,shouldShowNewListModal:N,newListName:I},A]=n.useReducer(zs,{checkboxes:[],listsAreUnchanged:!1,shouldShowFavoritesMenu:!1,shouldShowNewListModal:!1,newListName:""}),[_,w]=n.useState(!0);n.useEffect((()=>{g===oe.LOADED&&l===oe.LOADED&&_&&(A({type:Us.ResetCheckboxesFromStote,payload:{favoritelists:p,cardsFavoritelists:o}}),w(!1))}),[g,l,_]);const[D,P]=n.useState(null);n.useEffect((()=>{g===oe.LOADED&&l===oe.LOADED&&D&&(A({type:Us.CheckboxHasBeenClicked,payload:{checkboxID:D.id,newCheckboxToAutoSelect:D,cardsFavoritelists:o}}),P(null))}),[g,l,D]);const k=()=>{const e=o;c.get({pathVars:[r],success:t=>{let{data:a}=t,n=new Set(a.map((e=>e.id)));e.forEach((e=>{n.has(e.id)?n.delete(e.id):n.add(e.id)})),n.forEach((e=>{p.some((t=>t.id===e))&&ps.Z.get(e,{pathVars:[e]})})),w(!0)}})};return n.createElement("div",{className:"ghq-CardFavorite",ref:y},n.createElement(_s,{aria:"Favorite",icon:i?nt.Z.FavoriteFilled:nt.Z.FavoriteEmpty,tooltipLabel:i?"Remove from Favorites":"Add to Favorites",ref:h,onClick:()=>{m?(A({type:Us.ShowListsMenu}),k()):i?m&&o.length>1?d.Z.startCustomConfirmKey(r,"removeFromFavorites"):d.Z.hateFact(r,{callback:()=>{k()}}):m?v.put({pathVars:[E],data:JSON.stringify({prevSiblingItem:"last",actionType:"add",boardEntries:[{cardId:r,entryType:"card"}]}),success:()=>{k()}}):d.Z.favoriteFact(r)}}),n.createElement("div",{className:"ghq-CardFavoriteModalContainer",ref:u},Z&&n.createElement(Vs,{card:s,closeMenu:()=>{A({type:Us.CloseMenus}),k()},handleConfirmClose:()=>{A({type:Us.CloseMenus}),k()},handleCreateNewList:()=>A({type:Us.StartListCreation}),checkboxes:b,listsAreUnchanged:S,handleCheckboxToggle:e=>A({type:Us.CheckboxHasBeenClicked,payload:{checkboxID:e,cardsFavoritelists:o}}),favoritelists:p,cardsFavoritelists:o}),N&&n.createElement("div",{className:"NewListModal-container"},n.createElement(Hs.Z,{title:"Create New List",newListName:I,handleClickOutside:()=>A({type:Us.CloseMenus}),handleCreateList:()=>{A({type:Us.CreateNewList}),f.post({data:JSON.stringify({title:I}),meta:{unshiftFlag:!1},success:e=>{P(e.data)}})},handleInputChange:e=>A({type:Us.ListNameChanged,payload:{updatedName:e}}),onClickClose:()=>A({type:Us.CloseNewList})}))))},Ks=a(19887),js=a(72506),Js=a(18809);const Qs={folders:[{scope:"folders"}],items:[{scope:"items"}],paths:[{scope:"paths"}],bulk:[{scope:"bulk"}],bulkFolderOperation:e=>[{...Qs.bulk[0],jobId:e}],homeFolderBySlugId:e=>[{...Qs.folders[0],folderId:"home",collectionSlugId:(0,Js.v)(e)}],folderBySlugId:(e,t)=>[{...Qs.folders[0],folderSlugId:(0,Js.v)(e),detail:t}],infiniteFolderItems:e=>[{...Qs.items[0],folderSlugId:(0,Js.v)(e)}],folderPathsBySlugId:e=>[{...Qs.paths[0],folderSlugId:(0,Js.v)(e)}]};var Xs=Qs;class $s extends n.Component{constructor(){super(...arguments),this.handleClickOutside=e=>{this.props.onClickOutside(e)}}render(){const{renderTitle:e,renderButtons:t,renderContent:a,renderFooter:r,onClickClose:s}=this.props;return n.createElement("div",{className:"ghq-CardMenu"},e&&n.createElement("div",{className:"ghq-CardMenu__top-bar"},n.createElement("h2",{className:"ghq-CardMenu__title"},e()),t?n.createElement("div",{className:"ghq-CardMenu__buttons"},t()):n.createElement(at.ZP,{aria:"close modal",style:at.Dd.Standard,icon:nt.Z.Close,onClick:s})),n.createElement("div",{className:"ghq-CardMenu__content"},a()),r&&n.createElement("div",{className:"ghq-CardMenu__bottom-bar"},r()))}}var ei=(0,ve.Z)($s,null,[".ghq-CardHeaderVerificationButton"]);$s.propTypes={renderTitle:D().func,renderButtons:D().func,renderContent:D().func,renderFooter:D().func,onClickClose:D().func,onClickOutside:D().func},$s.defaultProps={renderContent:()=>{},onClickClose:()=>{},onClickOutside:()=>{}};var ti=a(18661),ai=a(74337);var ni=e=>{let{collectionId:t,query:a,onCreateNewBoard:r=(()=>{}),fact:s}=e;const i=(0,Yt.Z)(ai.Z.CAN_CREATE_BOARD,t)?"Create new folder named ".concat(a,"?"):"Contact an admin to create this folder.";return n.createElement("div",{className:"FoldersDropdownEmptyState"},n.createElement("div",{className:"FoldersDropdownEmptyState__not-found"},n.createElement("p",null,"Folder not found")),a&&n.createElement(ft.ZP,{theme:ft.bn.Primary,style:ft.ZJ.Text,size:ft.qE.Small,label:i,onClick:()=>{var e,t,n,i;d.Z.startCreateBoard({title:a,factId:null==s||null===(e=s.editFact)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.id,collection:null==s||null===(n=s.editFact)||void 0===n||null===(i=n.data)||void 0===i?void 0:i.collection,createNewBoardCallback:r})}}))},ri=(a(99244),a(98596));const si={FiveSeconds:5e3};var ii=a(27998);const oi=new ii.Z,li="/folders",ci={all:[{entity:"folder"}],list:e=>[{...ci.all[0],...e}]},di=async e=>{let{queryKey:t,pageParam:a}=e;const{collection:n,search:r}=t[0];return oi.getPaginated({path:"".concat(li),queryParams:{...a&&{token:a},...n&&{collection:n},...r&&{search:r}}})};var mi=function(){var e,t;let{queryParams:a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const n=(0,ri.N)(ci.list(a),di,{keepPreviousData:!0,staleTime:si.FiveSeconds,getNextPageParam:e=>null==e?void 0:e.token});return{...n,data:null!==(e=null===(t=n.data)||void 0===t?void 0:t.pages.flatMap((e=>e.data)))&&void 0!==e?e:[]}};let ui;!function(e){e.Required="Required",e.Optional="Optional"}(ui||(ui={}));var hi=a(97061);function pi(){return pi=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},pi.apply(this,arguments)}var gi=e=>{var t,a,r;let{collectionId:s,requiresValue:i,required:o,collectionSlug:l,fact:c,isDisabled:d,isTemplate:m,onCreateNewBoard:u,save:h}=e;const p=null==c||null===(t=c.editFact)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.id,[g,f]=(0,js.Z)(p),E=(0,Ut.NL)(),v=(0,ti.Z)(s),C=null!==(r=(e=>{let{factBoards:t}=e;return t.editData.map((e=>e.slug?(0,Js.v)(e.slug):e.id))})({factBoards:g}))&&void 0!==r?r:[],{fetchNextPage:y,hasNextPage:b,isFetching:S,isFetchingNextPage:Z,data:N,refetch:I}=mi({queryParams:{...s&&{collection:s}}});n.useEffect((()=>{b&&!Z&&y()}),[b,Z]);const[T,A]=n.useState("");n.useEffect((()=>{c.board&&f.addEditDataItem(c.id,{id:(0,Js.v)(c.board.data.slug)})}),[]),n.useEffect((()=>{v&&s!==v&&g.editData.forEach((e=>f.removeEditDataItem(c.id,e.id)))}),[s]);return n.createElement("div",{className:"FoldersDropdown"},n.createElement(hi.ZP,{multiSelect:!0,searchable:!0,requiresValue:i,required:o,maxPopoverHeight:hi.sI.Small,disabled:d||S,emptyState:ni({collectionId:s,query:T,onCreateNewBoard:e=>{f.addEditDataItem(c.id,e.data),null==u||u(e),I()},fact:c}),helperText:"Cards must live in at least 1 location.",key:null==N?void 0:N.length,name:"folders-dropdown",label:m?"Default folders":"Folders",requirementLabel:o?ui.Required:void 0,placeholder:"Search for folders",value:C,onChange:async e=>{let t="";try{e.length>=C.length?(t=e.filter((e=>!C.includes(e)))[0].toString(),h?f.addFactBoards(c.data.id,{id:t}):f.addEditDataItem(c.id,{id:t})):(t=C.filter((t=>!e.includes(t)))[0].toString(),h?f.deleteFactBoard(c.data.id,t,s):f.removeEditDataItem(c.id,t))}finally{h&&(l&&await E.invalidateQueries(Xs.homeFolderBySlugId(l)),E.invalidateQueries(Xs.infiniteFolderItems(t)),await(null==N?void 0:N.forEach((e=>{const a=e.id===t||e.slug.includes(t);e.slug&&a&&(E.invalidateQueries(Xs.infiniteFolderItems(e.slug)),E.invalidateQueries(Xs.folderBySlugId(e.slug,"BASIC")))}))))}},onInputChange:A},null==N?void 0:N.map((e=>{const t="home"in e?"".concat(e.title," (home)"):e.title;return n.createElement(hi.Jq,pi({},function(e){var t,a;return e?"home"in e?{icon:nt.Z.CollectionFilled,iconColor:wt.ZP.Custom,customColor:null===(a=e.collection)||void 0===a?void 0:a.color}:{icon:null!==(t=e.groupsSharedWith)&&void 0!==t&&t.length?nt.Z.FolderShared:nt.Z.Folder}:{}}(e),{key:(0,Js.v)(e.slug),value:(0,Js.v)(e.slug)}),null!=t?t:"")}))))},fi=a(90208);var Ei=e=>{let{collectionId:t,fact:a,save:r}=e;const s=a.editFact.data.id,[i,o]=(0,js.Z)(s),[l]=(0,Yt.Z)(ai.Z.CAN_EDIT_FACT,t),c=e=>{r?o.deleteFactBoard(s,e,t):o.removeEditDataItem(s,e)},d=(()=>{const e=(!r||a.board&&!a.data.id?i.editData:i.data).filter((e=>{var t;return e.id!==(null==a||null===(t=a.board)||void 0===t?void 0:t.id)})).map((e=>{let{id:t,title:a,label:r}=e;return n.createElement(fi.Z,{className:"ghq-board-chip",id:t,key:t,label:a||r,removeChip:l?c:null})}));return a.board&&!Boolean(a.meta.isTemplate)?[n.createElement(fi.Z,{className:"ghq-board-chip",key:a.board.id,id:a.board.id,label:a.board.data.title}),...e]:e})();return d.length?n.createElement("div",{className:"ghq-facts-factsboards-current-boards"},d):null},vi=a(63582),Ci=a(70735),yi=a.n(Ci),bi=a(43063),Si=a.n(bi),Zi=a(53148),Ni=a(1747);const Ii=new C.Z({name:E.BoardsList,syncFilters:!1});Ii.createStore();var Ti=g.Z.addStore(Ii.store),Ai=a(25518),_i=a(82455),wi=a(25108),Di=tr()({displayName:"BoardsChipInput",propTypes:{refKey:D().string.isRequired,collectionId:D().string.isRequired,disabled:D().bool,className:D().string,factId:D().string},mixins:[(0,ar.Z)(Ti,Ai.Z)],getStoreFilterName(e){if(e===E.BoardsList)return this.props.refKey;wi.error("filter not set")},getStateFromFlux(){const{factId:e}=this.props;return{boardsList:Ti.getFilter(this.getStoreFilterName(E.BoardsList)),factBoards:e?Ai.Z.getByFactId(e):null}},getDefaultProps:()=>({disabled:!1}),UNSAFE_componentWillMount(){this.getBoardsList()},componentDidUpdate(e,t){const{boardsList:a}=t,{boardsList:n}=this.state,{collectionId:r}=e,{collectionId:s}=this.props;r===s?a.meta.search&&!n.meta.search&&this.getBoardsList():this.getBoardsList()},getBoardsList(){const{collectionId:e}=this.props,{boardsList:t}=this.state;vi.Z.get(this.getStoreFilterName(E.BoardsList),{queryParams:{collection:e,search:t.meta.search}})},handleAction(){this.getBoardsList()},setBoardListSearchTerms(e){vi.Z.mergeFilterMeta(this.getStoreFilterName(E.BoardsList),{search:e})},handleInputChange(e){this.setBoardListSearchTerms(e)},handleMenuItemSelect(e){const{handleBoardSelected:t}=this.props;"notexactmatch"===e.key?(this.setBoardListSearchTerms(null),this.handleNotExactMatchInput()):(this.setBoardListSearchTerms(null),t?t(e):Zi.Z.addEditDataItem(this.props.factId,{id:e.value,title:e.label,removeChip:e.meta.removeChip}))},removeChip(e){Zi.Z.removeEditDataItem(this.props.factId,e)},composeMenuItems(){const{boardsList:e,factBoards:t}=this.state,{chips:a}=this.props,n=Si()(e.items.data,(e=>{let n=!1;return t?(t.data.forEach((t=>{t.id===e.id&&(n=!0)})),t.editData.forEach((t=>{t.id===e.id&&(n=!0)})),n):(a&&a.forEach((t=>{t.id===e.id&&(n=!0)})),n)})).map((e=>({label:e.title,type:"menu-item",value:e.id,meta:{removeChip:this.removeChip},rightIcon:e.groupsSharedWith?nt.Z.SharedBoard:null})));return e.linkHeaders&&e.linkHeaders["next-page"]&&n.push({onEnter:this.onEnterWaypoint,type:"waypoint",value:"boardsList-waypoint"}),n},composeChips(){const{chips:e}=this.props,{factBoards:t}=this.state;return t?yi()(t.editData,t.data,"id").map((e=>({label:e.title,id:e.id,removeChip:e.removeChip}))):e||[]},handleNotExactMatchInput(){const{boardsList:e}=this.state,{collectionId:t,createBoard:a}=this.props;_i.Z.hasPermission(ai.Z.CAN_CREATE_BOARD,t)&&a(e.meta.search,this.removeChip)},renderNotExactMatch(){const{boardsList:e}=this.state,{collectionId:t,createBoard:a}=this.props,r=_i.Z.hasPermission(ai.Z.CAN_CREATE_BOARD,t);if(!a)return null;let s="Create new Board named ".concat(e.meta.search,"?");r||(s="Contact an admin to create this board.");return{rawContent:n.createElement("div",null,n.createElement("div",null,"Board not found"),n.createElement("div",{className:"ghq-chip-input-not-found-message"},s)),type:"menu-item",key:"notexactmatch"}},filterMenuItems(e){const{boardsList:t}=this.state,{boardBeingAddedID:a}=this.props;return 1===e.menuItems.length&&"waypoint"===e.menuItems[0].type?t.meta.search&&""!==t.meta.search.trim()?[this.renderNotExactMatch()]:[]:a?e.menuItems.filter((e=>e.value!==a)):e.menuItems},render(){const{className:e,refKey:t,disabled:a,tooltipped:r,handleMenuItemSelect:s,allowMultiple:i}=this.props,{boardsList:o}=this.state,l=this.renderNotExactMatch();return n.createElement(Ni.Z,{chips:i?this.composeChips():[],className:e,handleAction:this.handleAction,handleInputChange:this.handleInputChange,handleMenuItemSelect:s||this.handleMenuItemSelect,hasInput:!0,inputValue:o.meta.search||"",menuIsReloading:o.status===oe.UPDATING,refKey:t,menuItems:this.composeMenuItems(),isDisabled:a,inputPlaceHolderText:"Add existing Boards, or create a new one",inputPlaceHolderIcon:"search",tooltipped:r,notExactMatchItem:l,filterMenuItems:this.filterMenuItems})}});var Pi=e=>{var t,a,r,s;let{allowMultiple:i,fact:o,collectionId:l,onCreateNewBoard:c,save:m,isDisabled:u}=e;const h=o.editFact.data.id,[p,g]=(0,js.Z)(h),[f,E]=(0,n.useState)(l);(0,n.useEffect)((()=>{l!==f&&(p.editData.forEach((e=>{g.removeEditDataItem(h,e.id)})),E(l))}),[l]);const v=(null===(t=o.editFact)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.shareStatus)!==Ee().visibility.PRIVATE;return n.createElement(n.Fragment,null,v?n.createElement(Di,{disabled:u,className:"ghq-facts-factsboards-input",chips:[],boardBeingAddedID:null!==(r=null===(s=o.board)||void 0===s?void 0:s.id)&&void 0!==r?r:null,createBoard:(e,t)=>{const a={title:e,factId:h,collection:o.editFact.data.collection,removeChip:t};d.Z.startCreateBoard(a),c&&c()},handleBoardSelected:i?null:e=>(vi.Z.mergeFilterMeta("".concat(o.id,"-FactsBoards"),{search:""}),m?g.addFactBoards(h,{id:e.value}):g.addEditDataItem(h,{id:e.value,label:e.label})),factId:h,refKey:"".concat(o.id,"-FactsBoards"),collectionId:l}):null)};var ki=e=>{var t,a;let{fact:r,onCancel:s}=e;const[i,o]=(0,n.useState)(r.data.shareStatus===Ee().visibility.PRIVATE),l=Ae.Z.isMe(null===(t=r.data)||void 0===t||null===(a=t.owner)||void 0===a?void 0:a.id);return i?n.createElement("div",{className:"ghq-facts-factsboards-message"},n.createElement("p",{className:"ghq-facts-factsboards-message-copy"},"Restricted Cards cannot be added to Boards.",l?" Share this Card with your\n          Team to continue.":null),l?n.createElement(Wa.Z,{alignment:Wa.A.Right},n.createElement(ft.ZP,{theme:ft.bn.Gray,style:ft.ZJ.Text,label:"Cancel",onClick:s}),n.createElement(ft.ZP,{theme:ft.bn.Primary,label:"Share with Team",onClick:()=>{d.Z.setShareStatusAndPublicLinkAllowed({cardId:r.id,shareStatus:Ee().visibility.TEAM,saveFact:!0}),o(!1)}})):null):n.createElement("div",{className:"ghq-additional-details__input-helper"},"Boards are organized by topic.")};var Li=e=>{let{required:t,requiresValue:a,allowMultiple:r,className:i,fact:l,isDisabled:c,isTemplate:d,onCreateNewBoard:m,onCancel:u,save:h}=e;const[p,g]=(0,js.Z)(l.id),f=o()(l,"editFact.data.collection.id"),E=o()(l,"editFact.data.collection.slug"),[v,C]=(0,n.useState)(f),[y]=(0,Ue.Z)(Ne.Z.NAVARCHY_P2_ALLOWED);(0,n.useEffect)((()=>{f!==v&&(p.editData.forEach((e=>{g.removeEditDataItem(l.id,e.id)})),C(f))}),[f]);const b=s()("ghq-facts-factsboards",i);return n.createElement(n.Fragment,null,y?n.createElement(gi,{required:t,requiresValue:a,collectionId:f,collectionSlug:E,fact:l,isDisabled:c,isTemplate:d,save:h,onCreateNewBoard:m}):n.createElement(n.Fragment,null,n.createElement("div",{className:"ghq-additional-details__input-label"},d?"Default Boards":"Board"),n.createElement("div",{className:b},n.createElement("div",{className:"ghq-facts-factsboards-boards"},n.createElement(Pi,{allowMultiple:r,isDisabled:c,save:h,collectionId:f,fact:l,onCreateNewBoard:m}),n.createElement(Ei,{fact:l,save:h,collectionId:f}),n.createElement(ki,{fact:l,onCancel:u})))))};const Mi=e=>{let{setView:t}=e;const a=(0,ye.RC)();return n.createElement(ei,{renderTitle:()=>"Edit Boards",renderContent:()=>n.createElement(Li,{save:!0,fact:a.card}),onClickClose:()=>t("DEFAULT")})},Oi=e=>{let{setView:t}=e;const a=(0,ye.RC)();return n.createElement(ei,{renderTitle:()=>"Edit folders",renderContent:()=>{var e,t,r,s;return n.createElement(gi,{requiresValue:!0,save:!0,collectionId:null===(e=a.card.editFact.data)||void 0===e||null===(t=e.collection)||void 0===t?void 0:t.id,collectionSlug:null===(r=a.card.editFact.data)||void 0===r||null===(s=r.collection)||void 0===s?void 0:s.slug,fact:a.card})},onClickClose:()=>t("DEFAULT")})},Fi=e=>{let{closeMenu:t}=e;return n.createElement(ei,{renderTitle:()=>n.createElement("div",{className:"EditPrivateCardFolders__title"},"Edit folders"),renderContent:()=>n.createElement("div",{className:"EditPrivateCardFolders__content"},n.createElement(St.ZP,{style:St.Jo.Bold},"Restricted Cards cannot be added to folders."),n.createElement(St.ZP,null,"Contact this Card's author to request any permissions changes.")),onClickClose:()=>t()})},Ri=e=>{let{setView:t}=e;const a=(0,ye.RC)(),[r,s]=(0,js.Z)(a.card.id),i=(0,Ut.NL)(),o=()=>{d.Z.setShareStatusAndPublicLinkAllowed({cardId:a.card.id,shareStatus:Ee().visibility.TEAM,saveFact:!0,opts:{callback:()=>{var e,t,n;s.loadFactBoards(a.card.id),i.refetchQueries(Xs.infiniteFolderItems(null!==(e=null===(t=a.card.editFact.data)||void 0===t||null===(n=t.collection)||void 0===n?void 0:n.homeBoardSlug)&&void 0!==e?e:""))}}})};return n.createElement(ei,{renderTitle:()=>n.createElement("div",{className:"EditPrivateCardFolders__title"},"Edit folders"),renderContent:()=>n.createElement("div",{className:"EditPrivateCardFolders__content"},n.createElement(St.ZP,{style:St.Jo.Bold},"Restricted Cards cannot be added to folders."),n.createElement(St.ZP,null,"Click the button below to update this Card's permissions and automatically add it to the Collection level (home)."),n.createElement(ft.ZP,{label:"Add to Collection",size:ft.qE.Medium,style:ft.ZJ.Outline,theme:ft.bn.Gray,onClick:o})),onClickClose:()=>t("DEFAULT")})};var xi=e=>{let{closeMenu:t,setView:a}=e;const[r]=(0,_e.Z)(),s=(0,ye.RC)(),[i]=(0,Ue.Z)(Ne.Z.NAVARCHY_P2_ALLOWED);return i?s.card.data.shareStatus===Vt._h.Private?s.originalOwner.email===r.data.email?n.createElement(Ri,{setView:a}):n.createElement(Fi,{closeMenu:t}):n.createElement(Oi,{setView:a}):n.createElement(Mi,{setView:a})};function qi(e){let{children:t}=e;return n.createElement("div",{className:"ghq-CardVisibilityLabelTitle"},t)}function Bi(e){let{children:t}=e;return n.createElement("div",{className:"CardVisibilityLabel__SubText"},t)}function Vi(e){let{children:t}=e;return n.createElement("div",{className:"ghq-CardVisibilityLabelHelperText"},t)}function Ui(e){let{children:t,className:a}=e;const r=s()("ghq-CardVisibilityLabel",a);return n.createElement("div",{className:r},t)}const{TEAM:Hi,PUBLIC:Wi}=Ee().visibility,{NEW:Gi}=le();var zi=()=>{const e=n.useContext(ye.ZP),{card:t,id:a}=e,{shareStatus:r,collection:s,publicLinkAllowed:i}=t.editFact.data,l=o()(s,"roiEnabled",!1),[c]=(0,_e.Z)(),{fileSharingDisabled:m=!1}=c.data.team;return n.createElement(Ui,{className:"ghq-NormalAccessLabel"},n.createElement(qi,null,"Your Guru teammates"," ",n.createElement("span",{className:"ghq-NormalAccessLabel__regular-text"},"with Collection- or Board-level access"," ")),[Hi,Wi].includes(r)&&!i&&!m&&n.createElement(n.Fragment,null,n.createElement("div",null,n.createElement(Os.Z,{name:"imageFileShare",isChecked:r===Wi,label:"Allow teammates to share links to attached images and files outside of Guru",onChange:e=>{const n=t.action!==Gi,r=e?Wi:Hi;d.Z.setShareStatusAndPublicLinkAllowed({cardId:a,shareStatus:r,publicLinkAllowed:!1,saveFact:n})}})),l?n.createElement(Vi,null,"Guru recommends allowing uploaded files to be shared externally when the"," ",n.createElement("a",{href:"https://help.getguru.com/articles/cGBxXMei/What-is-Content-Performance-",target:"_blank"},"Content Performance")," ","feature is turned on for a Collection."):null))};function Yi(){const e=n.useContext(ye.ZP),{card:t}=e,{publicLinkAllowed:a=!1}=t.editFact.data,r=Boolean(t.editFact.data.collection.publicCardsEnabled),[s,i]=Ve(e.id),{data:o=[]}=s,l=[i.SHARE_PUBLIC_CARD].some((e=>o.includes(e))),c=a&&!l?"You do not have permission to change the visibility of this Card.":r?void 0:"Your Collection Owner or Admin has disabled Public Card sharing for this Collection.";return n.createElement(Ui,{className:"ghq-PublicAccessLabel"},n.createElement(qi,null,"Public"),n.createElement(Bi,null,"Anyone with the link"),c?n.createElement(Vi,null,c):null)}var Ki=a(77293);var ji=a(25108);const Ji=new p.Z({name:E.CollectionMembers}),Qi=g.Z.getFlux().actions[Ji.name];Qi||ji.error("error creating actions");var Xi=Qi;const $i=new C.Z({name:E.CollectionMembers,syncFilters:!1});$i.createStore();var eo=g.Z.addStore($i.store);function to(){return to=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},to.apply(this,arguments)}class ao extends n.Component{constructor(e){var t;super(e),t=this,this.renderListLoader=()=>this.props.listProps.showListLoader?n.createElement(Nt.ZP,null):null,this.renderListMessage=()=>{const{listProps:e={}}=this.props;return e.listMessage?n.createElement("div",{className:"ghq-ciwl-list-message"},n.createElement("span",null,e.listMessage)):null},this.composeListItems=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const{listItemGenerator:a}=t.state;return e.map((e=>a(e)))},this.renderListItems=()=>{const{listProps:e,refKey:t,noListItemView:a}=this.props;if(0===e.items.length)return a||null;let r=this.composeListItems(e.items);return e.onEnterWaypoint&&r.push(n.createElement(Bt.h,{key:t,onEnter:e.onEnterWaypoint})),n.createElement("div",{className:"ghq-ciwl-list-items"},r)},this.renderList=()=>{const{listProps:e={}}=this.props,t=s()("ghq-ciwl-list",e.className),a=this.renderListLoader(),r=this.renderListMessage(),i=this.renderListItems();return n.createElement("div",{className:t},r,e.isReloading?n.createElement($e.Z,{className:"ghq-ciwl-list-reloader",isReloading:!0}):null,i,a)},this.composeChipInputChipItems=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.map((e=>({label:e.label,id:e.id,className:s()("ghq-ciwl-chip-input-chip",e.className),icon:e.icon,image:e.image,removeChip:e.removeChip,color:e.color})))},this.renderChipInput=()=>{const{chipInputProps:e,refKey:t}=this.props;return e?n.createElement(Ni.Z,to({},e,{chips:this.composeChipInputChipItems(e.chips),refKey:"ciwl-chip-input-"+t,className:s()("ghq-ciwl-chip-input",e.className)})):null};const a=e.listItemGenerator||this.generateListItemDefault;this.state={listItemGenerator:a}}render(){const e=s()("ghq-ciwl",this.props.className,{"ghq-empty":0===this.props.listProps.items.length}),t=this.renderList(),a=this.renderChipInput();return n.createElement("div",{className:e},t,a)}}ao.propTypes={chipInputProps:D().object,className:D().string,listItemGenerator:D().func,listProps:D().object.isRequired,refKey:D().string.isRequired},ao.defaultProps={listItemGenerator:function(e){let t,a=null;const r=s()("ghq-ciwl-list-item",{"ghq-ciwl-list-item-removable":e.handleRemove,"ghq-ciwl-list-item-mobile":us.ZP.isMobile()});return e.image&&(t=n.createElement("img",{className:"ghq-ciwl-list-item-image",src:e.image})),e.handleRemove&&(a=n.createElement(Ms.Z,{disabled:e.deleteDisabled,className:"ghq-ciwl-list-item-remove-icon",icon:"remove",kind:Ms.Z.kinds.GRAY,size:Ms.Z.sizes.SMALL,onClick:e.handleRemove},e.removeMemberButtonValue)),e.replaceRemove&&(a=e.replaceRemove()),n.createElement("div",{className:r,key:e.id},t,n.createElement("span",{className:"ghq-ciwl-list-item-label"},e.label),a)}};var no=ao;const{NEW:ro,LOADING:so,UPDATING:io}=le();var oo=()=>{const[e,t]=n.useState(""),a=n.useContext(ye.ZP),{card:r}=a,[s]=(0,_e.Z)(),[i,l]=function(e){const[t,a]=(0,De.Z)({store:ha.Z,actions:Ki.Z,onGetState:t=>t.getBySearchId(e),onMustLoad:()=>a.loadCollaborators(e)});return[t,a]}(a.id),[c,d]=function(e){const[t,a]=(0,T.Z)({filterId:e,store:eo,actions:Xi,onMustLoad:t=>e&&t.get({pathVars:[e]})});return[t,a]}(a.collectionId),[m,u,h]=Ve(a.id),{data:p=[]}=m,g=e=>{d.mergeFilterMeta({search:e})},f=e=>{g(e)},E=e=>{l.addEditDataItem(a.id,{id:e.value,type:"user",user:e.meta.user,highestRole:e.meta.highestRole}),g(null)},v=e=>{l.removeEditDataItem(a.id,e)},C=()=>{l.postCollaborators(a.id),g(null)},y=e=>{d.get({pathVars:[a.collectionId],queryParams:{search:c.meta.search},...e})},b=()=>{y()},S=()=>{const a=c.items.data.filter((e=>{const t=e.id===o()(r,"data.owner.email",""),a=r.action===ro&&e.id===s.data.email,n=i.data.concat(i.editData).some((t=>t.id===e.id));return!t&&!a&&!n})).map((e=>({label:gt.Z.getNameFromModel(e.user),image:xn.ZP.getProfileUrl(e.user.profilePicUrl),meta:{highestRole:e.highestRole,user:e.user},type:"menu-item",value:e.id})));if(c.linkHeaders&&c.linkHeaders["next-page"]){const n=c.linkHeaders["next-page"].token;a.push({onEnter:()=>(a=>{if(a===e)return;t(a);const n=c.linkHeaders["next-page"];y({linkHeader:n})})(n),type:"waypoint",value:"card-visibility-waypoint"})}return a},Z={isDisabled:!p.includes(u.SHARE_TO_INDIVIDUAL),chips:i.editData.map((e=>({label:gt.Z.getNameFromModel(e.user),image:xn.ZP.getProfileUrl(e.user.getProfileUrl),id:e.id,removeChip:v}))),handleAction:b,handleInputChange:f,handleMenuItemSelect:E,inputValue:c.meta.search||"",menuItems:S(),menuIsReloading:c.status===io,buttonValue:"Share",handleButtonClick:r.action===ro?null:C,inputPlaceHolderText:"Search users",inputPlaceHolderIcon:"account"},N={showListLoader:i.status===so,items:p.includes(u.READ_INDIVIDUAL_SHARES)?i.data.map((e=>({handleRemove:p.includes(u.UNSHARE_TO_INDIVIDUAL)&&(()=>{l.deleteCollaborator(r.id,e.id,{success:()=>{e.id===s.data.email&&h.loadPermissions(r.data.id)}})}),id:e.id,image:xn.ZP.getProfileUrl(e.user.profilePicUrl),label:gt.Z.getNameFromModel(e.user)}))):[]};return n.createElement(no,{className:"ghq-CollaboratorsChipInputWithList",chipInputProps:Z,listProps:N,refKey:"fact-"+a.id})};const{PRIVATE:lo}=Ee().visibility,{NEW:co,NOT_LOADED:mo}=le();var uo=()=>{const e=n.useContext(ye.ZP),{card:t,id:a}=e,r=t.action===co,[s]=(0,Ue.Z)(Ne.Z.NAVARCHY_P2_ALLOWED),[i]=(0,_e.Z)(),l=r||t.data.owner.email===i.data.email,c=gt.Z.getNameFromModel(t.data.owner),{shareStatus:d,collection:{name:m}}=t.editFact.data,[u,h]=(0,js.Z)(a);u.status===mo&&h.loadFactBoards(a);const p=o()(u,"editData.length",0)>0,[g,f]=Ve(e.id),{data:E=[]}=g,v=d===lo&&[(f.READ_INDIVIDUAL_SHARES,f.SHARE_TO_INDIVIDUAL,f.UNSHARE_TO_INDIVIDUAL)].some((e=>E.includes(e))),C=()=>n.createElement(n.Fragment,null,"Restricted Cards cannot be added to Boards. To share this Card with"," ",n.createElement("em",null,"specific users"),", return to the prior step and remove it from the selected Board(s)."),y=()=>n.createElement(n.Fragment,null,"Restricted Cards are hidden from the Collection view. Selecting this option will remove this Card from any folders you selected during the previous step.");return n.createElement(Ui,{className:"ghq-SpecificUsersAccessLabel"},n.createElement(qi,null,"Restricted"),n.createElement(Bi,null,l?n.createElement("span",null,n.createElement("strong",null,"Only Guru teammates"),n.createElement("span",{className:"ghq-SpecificUsersAccessLabel-collection-text"}," ","(with Collection-level access) that you choose to add to this Card")," "):n.createElement("span",null," ","Only the Card's original author and specified users within the"," ",n.createElement("span",{className:"ghq-SpecificUsersAccessLabel-collection-text"},m)," ","Collection")),p?n.createElement(Vi,null,s?n.createElement(y,null):n.createElement(C,null)):E.includes(f.SHARE_TO_TEAM)?null:n.createElement(Vi,null,"Visibility in Guru can only be changed by"," ",n.createElement("span",{className:"ghq-SpecificUsersAccessLabel-owner-text"},c),", the Card's original author."),v?n.createElement(oo,null):null)},ho=a(42300);const{NEW:po,LOADED:go}=le();function fo(){var e;const[t,a]=(0,n.useState)(0),[r,s]=(0,n.useState)(!1),[i]=(0,Ue.Z)(Ne.Z.NAVARCHY_P2_ALLOWED),o=(0,n.useContext)(ye.ZP),{card:l,id:c}=o,[m,u]=(0,js.Z)(c),[h]=(0,Ue.Z)(Ne.Z.DISABLE_PUBLIC_CARDS),[p,g,f]=Ve(c),{data:E=[],status:v}=p,C=(0,n.useCallback)((e=>{null!==e&&a(e.getBoundingClientRect().top)}),[]),y={maxHeight:"calc(100vh - 2em - ".concat(t,"px)")},{shareStatus:b,publicLinkAllowed:S=!1}=l.editFact.data,Z=l.action===po;(0,n.useEffect)((()=>{const e=Boolean(l.editFact.data.collection.roiEnabled);Z&&d.Z.setShareStatusAndPublicLinkAllowed({cardId:l.id,shareStatus:e?Vt._h.Public:Vt._h.Team,publicLinkAllowed:!1,saveFact:!1})}),[]),(0,n.useEffect)((()=>{l.data.id&&f.loadPermissions(l.data.id)}),[l.data.id,b]);const N=(null==m||null===(e=m.editData)||void 0===e?void 0:e.length)>0||l.board,I=!i&&N,T=r||v!==go||!Z&&l.status!==go,A=[{hasPermission:E.includes(S?g.SHARE_PUBLIC_CARD:g.SHARE_TO_TEAM),className:"ghq-CardVisibility__radio-input",icon:nt.Z.AccountMultiple,label:n.createElement(zi,null),name:"Your Guru Team Access",value:b===Vt._h.Public?JSON.stringify({shareStatus:Vt._h.Public,publicLinkAllowed:!1}):JSON.stringify({shareStatus:Vt._h.Team,publicLinkAllowed:!1}),disabled:!E.includes(S?g.SHARE_PUBLIC_CARD:g.SHARE_TO_TEAM)},{hasPermission:E.includes(g.UNSHARE_TO_TEAM),className:"ghq-CardVisibility__radio-input",icon:nt.Z.UserAdd,label:n.createElement(uo,null),name:"Specific Users Access",value:JSON.stringify({shareStatus:Vt._h.Private,publicLinkAllowed:!1}),disabled:!E.includes(g.UNSHARE_TO_TEAM)||Boolean(I)},{hasPermission:!h&&E.includes(g.SHARE_PUBLIC_CARD),className:"ghq-CardVisibility__radio-input",icon:nt.Z.Globe,label:n.createElement(Yi,null),name:"Public Access",value:b===Vt._h.Public?JSON.stringify({shareStatus:Vt._h.Public,publicLinkAllowed:!0}):JSON.stringify({shareStatus:Vt._h.Team,publicLinkAllowed:!0}),disabled:!E.includes(g.SHARE_PUBLIC_CARD)||!Boolean(l.editFact.data.collection.publicCardsEnabled)}],_=JSON.stringify({shareStatus:b,publicLinkAllowed:S}),w=[];let D=null;A.forEach((e=>{(e.hasPermission||_===e.value)&&w.push(e),_===e.value&&(D=e.label)}));const P="Who can access this Card?",k=w.map(((e,t)=>n.createElement(ho.Z,{key:t,name:e.name,id:"radiobutton-cardvisibility-".concat(t),label:e.label,icon:e.icon,disabled:e.disabled,isChecked:e.value===JSON.stringify({shareStatus:b,publicLinkAllowed:S}),onChange:()=>{((e,t)=>{if(T)return;const a=!Z;a&&s(!0);const{shareStatus:n,publicLinkAllowed:r=!1}=JSON.parse(t);Z&&b===Vt._h.Private&&m.editData.forEach((e=>u.removeEditDataItem(c,e.id))),d.Z.setShareStatusAndPublicLinkAllowed({cardId:c,shareStatus:n,publicLinkAllowed:r,saveFact:a,opts:{callback:()=>{l.action!==po&&n===Vt._h.Private&&u.loadFactBoards(c),s(!1)}}})})(0,e.value)}})));return n.createElement("div",{className:"ghq-CardVisibility","data-testid":"CardVisibility",ref:C,style:y},1===w.length&&D?n.createElement(n.Fragment,null,n.createElement("div",{className:"ghq-CardVisibility__title"},n.createElement(ja.ZP,{level:ja.Yx.H3,style:ja.VH.Medium},P)),n.createElement("div",{className:"ghq-CardVisibility__static-label"},D)):n.createElement(ho.S,{groupLabel:P},k))}var Eo=e=>{let{setView:t}=e;return n.createElement(ei,{renderTitle:()=>"Edit Permissions",renderContent:()=>n.createElement(fo,null),onClickClose:()=>t("DEFAULT")})};var vo=e=>{let{onClose:t,popoverRef:a,triggerRef:r}=e;const{t:i}=(0,Ks.$G)(),[o,l]=(0,n.useState)("DEFAULT"),[{data:{team:c}}]=(0,_e.Z)(),[{items:{data:u}}]=He(c.id),{canEdit:h,card:p,isArchived:g,isOwnedByGuru:f,slug:E}=(0,ye.RC)(),[v]=(0,js.Z)(p.id),C=(0,be.TH)().pathname.includes("/card/".concat(E,"/details")),[y]=(0,Ue.Z)(Ne.Z.CARD_ATTRIBUTES_ALLOWED),[b]=(0,Ue.Z)(Ne.Z.NEW_CARD_ANALYTICS_ALLOWED),[S]=(0,Ue.Z)(Ne.Z.NAVARCHY_P2_ALLOWED),Z=(0,Ut.NL)(),N=!f&&!C,I=h&&!g,T=h&&y&&u.length>0,A=s()("ghq-MoreOptionsMenu",{"ghq-is-not-draggable":m.ZP.isExtension()});(0,ws.Z)({anchor:a,target:r});return n.createElement("div",{className:A,"data-testid":"MoreOptionsMenu",ref:a},"DEFAULT"===o&&n.createElement(wn.ZP,{ariaLabel:"card-more-options",heading:i("features.cards.moreOptionsMenu.title")},b&&n.createElement(wn.sN,{as:wn.ZJ.Anchor,icon:nt.Z.Pulse,to:"/card/".concat(E,"/analytics"),onClick:()=>t()},i("features.cards.moreOptionsMenu.usageAndAnalytics")),N&&n.createElement(wn.sN,{as:wn.ZJ.Anchor,icon:nt.Z.InformationCircle,to:"/card/".concat(E,"/details"),onClick:()=>t()},i("features.cards.moreOptionsMenu.cardDetails")),h&&n.createElement(wn.sN,{icon:nt.Z.ShareVariant,onClick:()=>l("EDIT_PERMISSIONS")},i("features.cards.moreOptionsMenu.editPermissions")),h&&n.createElement(wn.sN,{icon:nt.Z.Folder,onClick:()=>l("EDIT_FOLDERS")},i(S?"features.cards.moreOptionsMenu.editFolders":"features.cards.moreOptionsMenu.editBoards")),T&&n.createElement(wn.sN,{icon:nt.Z.Notepad,onClick:()=>{d.Z.startCardAttribute(p.id),t()}},i("features.cards.moreOptionsMenu.cardAttributes")),I&&n.createElement(wn.sN,{icon:nt.Z.Archive,onClick:()=>{d.Z.startFactArchive(p.id,{callback:S?()=>{v.data.forEach((e=>{Z.refetchQueries(Xs.infiniteFolderItems(e.slug))}))}:()=>{}}),t()}},i("features.cards.moreOptionsMenu.archive"))),"EDIT_PERMISSIONS"===o&&n.createElement(Eo,{setView:l}),"EDIT_FOLDERS"===o&&n.createElement(xi,{setView:l,closeMenu:t}))},Co=a(61483),yo=a(57922),bo=a(22265),So=a(58550),Zo=a(26158);function No(e,t){const{items:{data:a}}=Zo.Z.getFilter(E.GLOBAL);return t.map((e=>a.find((t=>t.id===e)))).filter((t=>{let a=!1;return t.content&&t.content.forEach((t=>{"STATIC"===t.action&&t.matches.forEach((t=>{t.matchItems.forEach((t=>{a=t.id===e}))}))})),a}))}var Io=a(43696),To=a(23525),Ao=function(e,t){let a="".concat(bo.Z.Collections,"/").concat(e,"/contexts");return t&&(a+="/".concat(t)),a},_o={pinFact:function(e,t,a,n){var r,s,i=Ao(e),o={content:(r="FACT",s=t,[{action:"STATIC",matches:[{matchItems:[{id:s,type:r}]}]}]),fieldName:document.title,name:document.title,type:"PIN",url:document.location.href,urlMatchType:"STRING"},l={contentType:"application/json",data:JSON.stringify(o),type:"POST"},c={factId:t};yo.ZP.callApi(this,Io.SAVE_CONTEXT,i,l,c).then(function(){Co.Z.get(E.GLOBAL,{pathVars:[Pe.Z.getEmail()]})}.bind(this)),M.Z.postActivity({type:To.FACT_PINNED,properties:{url:o.url,factId:t,activity:a,activityId:n}}),this.flux.actions.toasts.createToast("Card pinned to page!","fact-card-"+t),$.Z.createToast({content:"Card pinned to page!",id:"fact-card-"+t})},unpinFact:function(e,t,a,n){var r=function(e){return No(e,So.Z.getSuggestionIdsByFactId(e))}(t);r.forEach(function(r){var s,i={contentType:"application/json"},o=Ao(e,r.id);!function(e,t){t.content&&(t.content=t.content.filter((function(t){return"STATIC"!==t.action||(t.matches=t.matches.filter((function(t){return t.matchItems=t.matchItems.filter((function(t){return t.id!==e})),t.matchItems.length>0})),t.matches.length>0)})))}(t,r),r.content.length?(s=Io.SAVE_CONTEXT,i.type="PUT"):(s=Io.DELETE_CONTEXT,i.type="DELETE"),i.data=JSON.stringify(r),M.Z.postActivity({type:To.FACT_UNPINNED,properties:{url:r.url,factId:t,activity:a,activityId:n}}),yo.ZP.callApi(this,s,o,i,{factId:t,integrationId:r.id}).then(function(){Co.Z.get(E.GLOBAL,{pathVars:[Pe.Z.getEmail()]})}.bind(this))}.bind(this)),$.Z.createToast({content:"Removed pin",id:"fact-card-"+t})}},wo=g.Z.addActions({context:_o}),Do=a(57956),Po=(a(60285),a(41637),a(98145),a(82472),a(33105),a(3462),a(33824),a(98052)),ko=a(7813),Lo=a.n(ko),Mo=a(30303);function Oo(){$.Z.createToast({content:"PDF Download failed. Please try again",id:E.GLOBAL,type:Lo().ERROR})}function Fo(e,t){const a=document.createElement("a");a.href=window.URL.createObjectURL(t),a.download="".concat(e,".pdf"),a.dispatchEvent(new MouseEvent("click"))}var Ro=e=>{var t,a,r,s,i,o;let{onClose:l,setMenuView:c}=e;const{t:u}=(0,Ks.$G)(),[h]=(0,_e.Z)(),{canEdit:p,card:g,hasContentROI:f,id:v,isPublic:C,isPublicLinkAllowed:y}=(0,n.useContext)(ye.ZP),b=null===(t=g.editFact.data)||void 0===t?void 0:t.shareStatus,[S,Z]=(0,tt.Z)(v),{preferredPhrase:N,collection:I,syncInfo:T}=g.data,A=So.Z.getSuggestionIdsByFactId(v),_=No(v,A),w=Boolean(_.length),D=f&&Do.Z.hasTrackableLinks(g.data),[P]=(0,Yt.Z)(ai.Z.CAN_PIN_FACT,null===(a=g.data.collection)||void 0===a?void 0:a.id),[k]=(0,Ue.Z)(Ne.Z.PDF_DOWNLOAD_NOT_ALLOWED),[L]=(0,Ue.Z)(Ne.Z.EMBED_CARDS_ALLOWED),[M]=(0,Ue.Z)(Ne.Z.NEW_CARD_ANALYTICS_ALLOWED),O=(null!==(r=null===(s=S.data)||void 0===s?void 0:s.membersWithCardView)&&void 0!==r?r:0)+(null!==(i=null===(o=S.data)||void 0===o?void 0:o.membersWithoutCardView)&&void 0!==i?i:0),F=null!=T&&T.contentSyncType?Lr.jV[T.contentSyncType]:u("features.cards.shareMenu.externalSource");return(0,n.useEffect)((()=>{Z.post({pathVars:[v]})}),[]),n.createElement("div",{className:"ghq-ShareCardMenuItems"},n.createElement("div",{className:"ghq-ShareCardMenuItems-permissions"},n.createElement("p",{className:"ghq-ShareCardMenuItems-permissions-visibility"},y?u("features.cards.shareMenu.visibility.visibleWithLink"):b&&[fe.visibility.TEAM,fe.visibility.PUBLIC].includes(b)?u(C?"features.cards.shareMenu.visibility.publicAccess":"features.cards.shareMenu.visibility.teamAccess",{userAccessTotal:O}):u("features.cards.shareMenu.visibility.visibleWithLink",{userAccessTotal:O})),p?n.createElement(Wa.Z,{alignment:Wa.A.Left},n.createElement(ft.ZP,{label:u("features.cards.shareMenu.editPermissions"),style:ft.ZJ.Anchor,theme:ft.bn.Gray,onClick:()=>c(rc.Permissions)})):null),n.createElement(wn.ZP,{ariaLabel:"share-menu",heading:u("features.cards.shareMenu.title")},!M&&D&&n.createElement(wn.sN,{icon:nt.Z.TrackLink,onClick:()=>c(rc.LinkTracking)},u("features.cards.shareMenu.trackLink")),P&&m.ZP.isExtension()?n.createElement(wn.sN,{icon:w?nt.Z.PinFilled:nt.Z.PinEmpty,onClick:()=>(()=>{h.data.preferences.showPinningConfirmation?d.Z.confirmChangePin(v,!w):(w?wo.unpinFact:wo.pinFact)(null==I?void 0:I.id,v,g.activity,g.activityId);l()})()},u(w?"features.cards.shareMenu.unpinCard":"features.cards.shareMenu.pinCard")):null,(null==T?void 0:T.externalUrl)&&n.createElement(wn.sN,{icon:Lr.TW[T.contentSyncType]||nt.Z.SyncLink,onClick:()=>{(0,os.Y8)({card:g}),l()}},u("features.cards.shareMenu.copySyncLink",{syncName:F})),k?null:n.createElement(wn.sN,{icon:nt.Z.Download,onClick:()=>{!function(e,t){if($.Z.createToast({content:"PDF download starting",id:E.GLOBAL,type:Lo().NO_ICON}),m.ZP.isExtension())return Mo.Z.tellExtension(Po.ZP.DOWNLOAD_PDF,{xmlData:e,pdfName:t},(e=>{let{encodedPDF:a,error:n}=e;if(n)return Oo();{const e=new Blob([Uint8Array.from(a).buffer],{type:"application/pdf"});Fo(t,e)}}));const a=new XMLHttpRequest,{type:n,endpoint:r,boolean:s}=e;a.open("".concat(n),pe.ZP.API_URL+"".concat(r),s),a.responseType="arraybuffer",a.setRequestHeader("Authorization","Basic ".concat(btoa(Pe.Z.getEmail()+":"+Pe.Z.getToken()))),a.onerror=Oo,a.onload=function(){200!==this.status&&Oo();const e=new Blob([this.response],{type:"application/pdf"});Fo(t,e)},a.send()}({type:"GET",endpoint:"/api/v1/cards/".concat(v,"/pdf"),boolean:!0},N),l()}},u("features.cards.shareMenu.downloadAsPdf")),L&&p?n.createElement(wn.sN,{icon:nt.Z.Code,onClick:()=>{(0,os.u6)({card:g}),l()}},u("features.cards.shareMenu.copyEmbed")):null,n.createElement(wn.sN,{icon:nt.Z.Copy,onClick:()=>{(0,os.oH)({card:g,id:"fact-card-".concat(g.id)}),l()}},u("features.cards.shareMenu.copyCardContent"))))},xo=a(43919),qo=a(25108);const Bo=new p.Z({name:E.CardsROI}),Vo=g.Z.getFlux().actions[Bo.name];Vo||qo.error("error creating actions");var Uo=Vo;const Ho=new C.Z({dataType:E.OBJECT,name:E.CardsROI,syncFilters:!1});Ho.createStore();var Wo=g.Z.addStore(Ho.store);function Go(e){const[t,a]=(0,T.Z)({filterId:e,store:Wo,actions:Uo});return[t,a]}var zo=a(37206);const Yo=(e,t)=>{var a;if("blockClickOutsideROIEvent"!==(null===(a=t.target)||void 0===a?void 0:a.id)){if(e.closeImmediately)return void d.Z.discardFact(e.data.id);d.Z.finishContentROI(e.data.id)}},Ko=e=>{let{linkKey:t,linksMap:a,links:n,fact:r}=e;return(e=>{let{fact:t,linkKey:a,links:n,linksMap:r}=e;const s=JSON.parse(t.data.jsonContent),i=s.value.map((e=>e.children.find((e=>"link"===e.type||"file"===e.type)))).filter(Boolean);a?i.forEach((e=>{var t;const i="link"===e.type,o="file"===e.type&&s.entities[e.entityKey];if((i?e.url:null==o?void 0:o.url)===(null==a||null===(t=a.match(/href="(.*)"/))||void 0===t?void 0:t.pop())){const t=e.children[0].text;!0!==r[t]&&(n.push(e),r[t]=!0)}})):i.forEach((e=>{const t=e.children[0].text;!0!==r[t]&&(n.push(e),r[t]=!0)}))})({fact:r,linkKey:t,links:n,linksMap:a}),[a,n]};function jo(){return jo=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},jo.apply(this,arguments)}var Jo=e=>{let{fact:t,createGenericLink:a,useGenericLinks:r,isGenericTemplate:s,email:i,cardsROIActions:o,disabled:l}=e;const[c]=Go(t.id),d=c.status===oe.LOADED?{primary:!0}:{secondary:!0};return n.createElement(We.Z,jo({},d,{key:c.status+c.id,className:"ghq-roi-fact-message__button",disabled:l,value:(m=c.status,m===oe.LOADED?"Copy Content":m===oe.LOADING||m===oe.UPDATING?n.createElement("span",{className:"ghq-roi-fact-message__loading-elipsis"},"Generating",n.createElement("span",null,"."),n.createElement("span",null,"."),n.createElement("span",null,".")):"Generate Content"),onClick:()=>{c.status===oe.LOADED?(e=>{let{fact:t,cardsROI:a,useGenericLinks:n,createGenericLink:r}=e;const s={searchId:t.searchId,searchPosition:t.searchPosition};var i,o,l,c,d,m,u,h;t.activity===le().Activities.RELATED&&(s.headers={[re.s3]:null===(i=t.meta)||void 0===i||null===(o=i.relatedCardMeta)||void 0===o?void 0:o.relatedCardParentId,[re.eB]:le().Activities.RELATED,[re.vz]:null===(l=t.meta)||void 0===l||null===(c=l.relatedCardMeta)||void 0===c?void 0:c.relatedCardPosition,[re.je]:null===(d=t.meta)||void 0===d||null===(m=d.relatedCardMeta)||void 0===m?void 0:m.relatedCardVersion,[re.m6]:null===(u=t.meta)||void 0===u||null===(h=u.relatedCardMeta)||void 0===h?void 0:h.relatedCardSuggestionId});const p={content:a.data.content,htmlContent:!0,id:t.data.id};n&&r&&(p.content=r(p.content)),zo.Z.copyCard(p,t.activity,t.activityId,s),$.Z.createToast({content:"Content copied to clipboard!",id:"fact-card-".concat(t.id)})})({fact:t,cardsROI:c,useGenericLinks:r,createGenericLink:a}):(e=>{let{fact:t,isGenericTemplate:a,email:n,cardsROIActions:r}=e;const s={pathVars:[t.data.id]};a||s.pathVars.push(n),r.get(s)})({fact:t,isGenericTemplate:s,email:i,cardsROIActions:o})}}));var m},Qo=a(25108);const Xo=new p.Z({name:E.CardsROILink}),$o=g.Z.getFlux().actions[Xo.name];$o||Qo.error("error creating actions");var el=$o,tl=a(53442);f.Z.register(E.CardsROILink,{POST:{path:"/cards/:cardId/roi/link/:email"}});const al=new C.Z({dataType:E.OBJECT,name:E.CardsROILink,syncFilters:!1});al.createStore();var nl=g.Z.addStore(al.store);const rl="gmail",sl="outreach",il="salesloft",ol="outlook";function ll(){let e,t=Array.from(document.querySelectorAll(".aaZ")).filter((e=>e.offsetHeight>0));return t.length<1?null:(t=t[0],e=t.querySelectorAll("span[email]"),e.length>0?e[0].getAttribute("email"):null)}const cl={isGmail(){const e=new RegExp(/https:\/\/mail.google.com\/.*/),t=document.querySelector(".bAw");return!(!e||!t)},getEmailTargets:()=>new Promise((e=>{let t;const a=ll(),n=function(){const e=document.querySelector(".Iy");if(!e)return null;const t=Array.from(e.querySelectorAll("span[email]")).filter((e=>e.offsetHeight>0));return t.length>0?t[0].getAttribute("email"):null}();t=a&&n||a&&!n?a:!a&&n?n:"",e(t)}))};const dl={isOutlook:()=>/^https:\/\/(qa|dev|qaie11)?outlook\.getguru\.com/.test(window.location.href),getEmailTargets:()=>new Promise((e=>{try{window.Office.context.mailbox.item.to.getAsync({},(t=>{const a=t.value;e(a.length>0?a[0].emailAddress:"")}))}catch(t){e("")}}))};const ml={isOutreach:()=>new RegExp(/https:\/\/\w*\.outreach\.io\//).test(window.location.href),getEmailTargets:()=>new Promise((e=>{const t=Array.from(document.querySelectorAll("label")).filter((e=>"To:"===e.innerText))[0];e(t?t.nextElementSibling.innerText.trim():null)})),createGenericLink:e=>e.replace(/REPLACE_WITH_CUSTOMER_EMAIL/g,"email").replace(/REPLACE_WITH_REP_EMAIL/g,"sender.email")};const ul={isSalesloft:()=>new RegExp(/https:\/\/app\.salesloft\.com\/app\/\w*\/\d*/).test(window.location.href),getEmailTargets:()=>new Promise((e=>{const t=document.querySelector(".composability-panes--emails--to");e(t?t.querySelector(".ng-binding").innerText.split("<")[1].replace(">",""):null)})),createGenericLink:e=>e.replace(/REPLACE_WITH_CUSTOMER_EMAIL/g,"email_address").replace(/REPLACE_WITH_REP_EMAIL/g,"My.email_address")};const hl=[{appType:rl,isActiveUtil:cl.isGmail,useGenericLinks:!1,util:cl},{appType:sl,isActiveUtil:ml.isOutreach,useGenericLinks:!0,util:ml},{appType:il,isActiveUtil:ul.isSalesloft,useGenericLinks:!0,util:ul},{appType:ol,isActiveUtil:dl.isOutlook,useGenericLinks:!1,util:dl}];var pl={loadUtil(){const e=hl.findIndex((e=>e.isActiveUtil()));return hl[e]}},gl=a(46843),fl=a(25108);function El(){return El=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},El.apply(this,arguments)}const vl="GENERIC";class Cl extends n.Component{constructor(){super(...arguments),this.state={emailInput:"",emailIsValid:!1},this.copyLinkToClipBoard=()=>{const{fact:e,cardsROILink:t}=this.props,{createGenericLink:a,useGenericLinks:n}=this.state,r={searchId:e.searchId,searchPosition:e.searchPosition};e.activity===le().Activities.RELATED&&(r.headers={[re.s3]:o()(e,"meta.relatedCardMeta.relatedCardParentId",null),[re.eB]:le().Activities.RELATED,[re.vz]:o()(e,"meta.relatedCardMeta.relatedCardPosition",null),[re.je]:o()(e,"meta.relatedCardMeta.relatedCardVersion",null),[re.m6]:o()(e,"meta.relatedCardMeta.relatedCardSuggestionId",null)});const s=e.data.id;let i=t.data.link.match(/href="(.*)"/).pop();r.value=i,n&&a&&(i=a(i)),zo.Z.copyLinkInCard(i,s,r),$.Z.createToast({content:"Link copied to clipboard!",id:"fact-card-".concat(e.id)})},this.submitRoiEmailLink=()=>{const{fact:e,isGenericTemplate:t,text:a,href:n}=this.props,{emailInput:r}=this.state,s={pathVars:[e.data.id],success:()=>{},data:JSON.stringify({link:'<a href="'.concat(n,'">').concat(a,"</a>")})};t?el.post(a+n+vl,s):(s.pathVars.push(r),el.post(a+n,s))}}componentDidMount(){const{text:e,href:t}=this.props,a=pl.loadUtil();a&&a.util.getEmailTargets().then((n=>{el.resetFilter(e+t),this.setState({emailInput:n,emailIsValid:gl.Z.isValidEmail(n),useGenericLinks:a.useGenericLinks,createGenericLink:a.util.createGenericLink,isGenericTemplate:!1})}))}componentWillUnmount(){const{text:e,href:t}=this.props;el.resetFilter(e+t)}render(){const{isGenericTemplate:e,cardsROILink:t,text:a,href:r}=this.props,{emailInput:s,emailIsValid:i}=this.state,o=t.status===oe.LOADED&&t.data.link.match(/href="(.*)"/).pop(),l=t.status===oe.LOADED?{primary:!0}:{secondary:!0};return n.createElement("div",{className:"ghq-roi-fact-message__link-section"},n.createElement("a",{className:"ghq-card-content__link"},a),n.createElement("div",{className:"ghq-roi-fact-message__generate-link"},n.createElement("div",{className:"ghq-roi-fact-message__column-seperator"},!e&&n.createElement(tl.Z,{className:"ghq-roi-fact-message__link-input-email",type:"text",id:a+"input-email",value:s,placeholder:"Enter Email Address",handleInputChange:(e,t)=>{const n=gl.Z.isValidEmail(t);this.setState({emailInput:t,emailIsValid:n}),el.resetFilter(a+r)},readOnly:!1})),n.createElement("div",{className:"ghq-roi-fact-message__column-seperator"},n.createElement(tl.Z,{className:"ghq-roi-fact-message__link-input",type:"text",id:a+"input",value:t.status===oe.LOADED?o:"Your trackable link will appear here",handleInputChange:()=>{},readOnly:!0,disabled:t.status!==oe.LOADED,autoComplete:"off",onFocus:e=>{e.target.select()}}),n.createElement(We.Z,El({key:t.status+t.id},l,{className:"ghq-roi-fact-message__button-link",value:t.status===oe.UPDATING||t.status===oe.LOADING?n.createElement("span",{className:"ghq-roi-fact-message__loading-elipsis"},"Generating",n.createElement("span",null,"."),n.createElement("span",null,"."),n.createElement("span",null,".")):t.status===oe.LOADED?"Copy Link":"Generate Link",disabled:e?t.status===oe.UPDATING||t.status===oe.LOADING:!i||t.status===oe.UPDATING||t.status===oe.LOADING,onClick:t.status===oe.LOADED?this.copyLinkToClipBoard:this.submitRoiEmailLink})))))}}var yl=(0,h.Z)((function(e,t){let{text:a,href:n,isGenericTemplate:r}=t;return{cardsROILink:r?nl.getFilter(a+n+vl):nl.getFilter(a+n)}}),((e,t)=>{let{text:a,isGenericTemplate:n}=t;if(e===nl.getName())return n?a+vl:a;fl.error("filter not set")}))([nl],Cl);var bl=e=>{let{isGenericTemplate:t,toggleGenericTemplate:a}=e;return n.createElement(n.Fragment,null,n.createElement("span",{className:"ghq-roi-fact-message__sub-text"},t?"Tracking a specific email address? ":"Sending a bulk email with a sales engagement tool? "),n.createElement("span",{className:"ghq-roi-fact-message__sub-text ghq-underlined",onClick:a},t?"Return to Track Content":"Create a dynamic link."))};var Sl=e=>{let{isGenericTemplate:t}=e;return n.createElement(n.Fragment,null,t?n.createElement(St.ZP,null,"Create a dynamic link below to send in an email template using your sales engagement or automation tool of choice. Visit our"," ",n.createElement(Sn.Z,{to:"https://help.getguru.com/articles/LigpMbbi/Sending-Tracked-Content",target:"_blank"},"help center")," ","for more info."):n.createElement(St.ZP,null,"Track the performance of an asset from this card by linking it to an external email address. You can choose to copy individual links or the entire card below."))};var Zl=(0,Ce.Z)((e=>{var t;let{fact:a,className:r,onClose:i=(()=>{})}=e;const[o,l]=Go(a.id),[c,d]=n.useState(""),[u,h]=n.useState(!1),[p,g]=n.useState(!1),[f,E]=n.useState(null),[v,C]=n.useState(!1),y=(0,xo.y)();n.useEffect((()=>{const e=pl.loadUtil();e&&e.util.getEmailTargets().then((t=>{l.resetFilter(),d(t),h(gl.Z.isValidEmail(t)),g(e.useGenericLinks);E((()=>e.util.createGenericLink)),C(!1)}))}),[]);const b=()=>{C(!v),l.resetFilter()},S=e=>{const t=e.target.value,a=gl.Z.isValidEmail(t);d(t),h(a),l.resetFilter()},Z=a.data.shareStatus===Ee().visibility.PUBLIC,N=s()("ghq-roi-fact-message",r,{"ghq-is-extension":m.ZP.isExtension()}),I=null===(t=a.meta)||void 0===t?void 0:t.trackableLink;let T=[];Ko({linkKey:I,linksMap:{},links:T,fact:a});const A=T.some((e=>"file"===e.type)),_=s()("ghq-roi-cardmenu",{"ghq-roi-cardmenu__large":null===I&&!m.ZP.isExtension(),"ghq-roi-cardmenu__large-extension":null===I&&m.ZP.isExtension(),"ghq-roi-cardmenu__small-extension":null!==I&&m.ZP.isExtension()});return n.createElement("div",{className:_},n.createElement(ei,{renderTitle:()=>v?"Create a Dynamic Link":"Track Link",renderContent:()=>n.createElement("div",{className:N},!Z&&A&&n.createElement("div",{className:"ghq-roi-fact-message_warning"},'Hosted files on this Card are currently inaccessible when sent externally. To share hosted file links, go to Privacy/Sharing within the More Options menu on this Card, and check the box labeled "Allow external file access."'),!I&&n.createElement(n.Fragment,null,n.createElement(Sl,{isGenericTemplate:v}),T.length>0&&n.createElement("div",{className:"ghq-roi-fact-message__individual_link"},"COPY INDIVIDUAL LINKS")),T.map((e=>{var t;const r="file"===e.type;let s;return r&&(s=y.contextState.entities[e.entityKey]),n.createElement(yl,{key:e.children[0].text+"_TRACKING_ROI_LINK_SECTION",node:e,href:r?null===(t=s)||void 0===t?void 0:t.url:e.url,text:e.children[0].text,isGenericTemplate:v,fact:a})})),!I&&n.createElement(n.Fragment,null,n.createElement("div",{className:"ghq-roi-fact-message__seperator"}),n.createElement("div",{className:"ghq-roi-fact-message__entire_card"},"COPY ENTIRE CARD"),v?n.createElement("div",{className:"ghq-roi-fact-message__column-seperator"},n.createElement(Jo,{fact:a,createGenericLink:f,useGenericLinks:p,cardsROIActions:l,email:c,isGenericTemplate:v,disabled:o.status===oe.LOADING||o.status===oe.UPDATING})):n.createElement("div",{className:"ghq-roi-fact-message__column-seperator"},n.createElement("input",{className:"ghq-input ghq-roi-fact-message__link-input",value:c,placeholder:"Enter Email Address",onChange:S}),n.createElement(Jo,{fact:a,createGenericLink:f,useGenericLinks:p,cardsROIActions:l,email:c,isGenericTemplate:v,disabled:!u||o.status===oe.LOADING||o.status===oe.UPDATING})))),renderFooter:()=>n.createElement(bl,{isGenericTemplate:v,toggleGenericTemplate:b}),onClickClose:e=>{Yo(a,e),i()},onClickOutside:e=>Yo(a,e)}))})),Nl=a(71512),Il=a(36492);const Tl=new ii.Z;var Al=e=>(0,Il.a)(["APP_CUES_DATA"],(()=>Tl.get({path:"/users/".concat(e,"/appcuesdata")})));f.Z.register(E.CardMembersAlert,{GET:{path:"/cards/:cardid/members/alert"}});const _l=new C.Z({name:E.CardMembersAlert});_l.createStore();var wl=g.Z.addStore(_l.store),Dl=a(25108);const Pl=new p.Z({name:wl.getName()}),kl=g.Z.getFlux().actions[Pl.name];kl||Dl.error("error creating actions");var Ll=kl,Ml=a(43174),Ol=a.n(Ml),Fl=a(34584);var Rl=e=>{let{user:t,onClick:a,removable:r=!1}=e;const i=n.useContext(Zn.Qu),o=i?"li":"span",l=s()("Pill-sage",{"Pill-sage--listed":i}),c=s()("Pill-sage__button","a11y-color-combo--fog",{"Pill-sage--removable":r}),{profilePicUrl:d}=t,m=gt.Z.getNameFromModel(t),u=()=>n.createElement(pn.Z,{size:pn.Z.sizes.XXSMALL,src:d,initials:gt.Z.getUsersInitials(t),alt:m});return n.createElement(o,{className:l},a?n.createElement("button",{className:c,type:"button","aria-label":m,onClick:a},u(),m,r&&n.createElement(Fl.Z,{color:wt.ZP.Spirit,icon:nt.Z.Close,size:16,shape:Fl.A.Square})):n.createElement("span",{className:c,"aria-label":m},u(),m))};const xl=e=>e.hasOwnProperty("email"),ql=e=>xl(e)?e.email:e.id;function Bl(e){let{chips:t=[],helperText:a,label:r,inputValue:s="",onInput:i,onDeleteChip:o,onSelectItem:l,membersList:c=[],disabled:d=!1,onEnterWaypoint:m,hasWaypoint:u=!1,hasGroupsHidden:h,placeholder:p}=e;const g=(0,n.useMemo)((()=>t.map(ql)),[t]),f=(0,n.useMemo)((()=>c.filter((e=>!g.includes(ql(e))))),[c]),{users:E,groups:v}=(0,n.useMemo)((()=>{const[e,t]=Ol()(f,xl);return{users:e,groups:t}}),[f]),C=u&&f.length>0?ql(f[f.length-1]):null,y=e=>{const t=v.find((t=>t.id===e));void 0!==t&&l(e,t.name);const a=E.find((t=>t.email===e));void 0!==a&&l(e,gt.Z.getNameFromModel(a),a),i("")},b=(0,n.useCallback)(_()((e=>i(e)),400),[]),S=e=>{b(e)};return n.createElement("div",{className:"GroupsAndUsersChipInput"},h?n.createElement(hi.ZP,{serverSideFiltering:!0,label:r,maxPopoverHeight:hi.sI.Small,name:"search-groups",helperText:a,placeholder:p||"Search users",value:s,searchable:!0,disabled:d,onChange:y,onInputChange:e=>S(e)},n.createElement(hi.Fy,{label:"Users"},E.map((e=>n.createElement(hi.Jq,{key:e.email,value:e.email,avatar:e.profilePicUrl,avatarDescription:gt.Z.getNameFromModel(e),initials:gt.Z.getUsersInitials(e)},gt.Z.getNameFromModel(e),ql(e)===C&&n.createElement(Bt.h,{onEnter:m})))))):n.createElement(hi.ZP,{serverSideFiltering:!0,helperText:a,label:r,maxPopoverHeight:hi.sI.Small,name:"search-groups",placeholder:"Search Groups and users",value:s,searchable:!0,disabled:d,onChange:y,onInputChange:e=>S(e)},n.createElement(hi.Fy,{label:"Groups"},v.map((e=>n.createElement(hi.Jq,{key:e.id,value:e.id,icon:nt.Z.AccountMultiple},e.name,ql(e)===C&&n.createElement(Bt.h,{onEnter:m}))))),n.createElement(hi.Fy,{label:"Users"},E.map((e=>n.createElement(hi.Jq,{key:e.email,value:e.email,avatar:e.profilePicUrl,avatarDescription:gt.Z.getNameFromModel(e),initials:gt.Z.getUsersInitials(e)},gt.Z.getNameFromModel(e),ql(e)===C&&n.createElement(Bt.h,{onEnter:m})))))),n.createElement(Zn.KL,null,t.map((e=>null!=e.user?n.createElement(Rl,{removable:!0,user:e.user,key:e.id,onClick:()=>o(e.id)}):n.createElement(Zn.ZP,{removable:!0,key:e.id,iconPrependage:nt.Z.AccountMultiple,title:e.name,onClick:()=>o(e.id)},e.name)))))}var Vl=a(28442),Ul=a(11788),Hl=a(76141),Wl=(a(6063),a(24908));let Gl;!function(e){e.Before="before",e.After="after"}(Gl||(Gl={}));var zl=e=>{let{date:t,handleDateChange:a,handleOutsideClick:r,id:s,initialVisibleMonth:i,maxDate:o=Te()().add(2,"years"),minDate:l=Te()(),onFocusChange:c=(()=>{})}=e;return n.createElement("div",{className:"DatePicker-sage","aria-label":s,role:"dialog"},n.createElement(Hl.DayPickerSingleDateController,{focused:!0,hideKeyboardShortcutsPanel:!0,date:t,initialVisibleMonth:null!=i?i:null,isOutsideRange:e=>!e.isBetween(l,o,"days","[]"),key:t?t.format("YYYY-MM"):0,maxDate:o,minDate:l,navNext:n.createElement("div",{className:"DatePicker-sage__arrow DatePicker-sage__arrow--right",tabIndex:0},n.createElement(fn.Z,{icon:nt.Z.ArrowRight,size:20})),navPrev:n.createElement("div",{className:"DatePicker-sage__arrow DatePicker-sage__arrow--left",tabIndex:0},n.createElement(fn.Z,{icon:nt.Z.ArrowLeft,size:20})),numberOfMonths:1,renderMonthElement:e=>{let{month:t,onMonthSelect:a,onYearSelect:r}=e;return n.createElement("div",{className:"DatePicker-sage__caption"},n.createElement(Wl.ZP,{label:"Month picker",name:"monthPicker",value:t.month().toString(),onChange:e=>a(t,e)},Te().monthsShort().map(((e,t)=>n.createElement(Wl.$m,{key:t,label:e,value:t.toString()})))),n.createElement(Wl.ZP,{label:"Year picker",name:"yearPicker",value:t.year().toString(),onChange:e=>r(t,e)},(()=>{const e=o.diff(l,"years")+1;return Array.from({length:e},((e,t)=>o.year()-t))})().map((e=>n.createElement(Wl.$m,{key:e,label:e.toString(),value:e.toString()})))))},onDateChange:a,onFocusChange:c,onOutsideClick:r}))},Yl=a(5195);var Kl=e=>{let{customAnnouncementDate:t,setCustomDate:a,onSetScheduleButtonDisabled:r}=e;const s=Te()().add(1,"days").set({hour:9,minute:0}),[i,o]=(0,n.useState)(null==t?void 0:t.format("MM/DD/YYYY")),[l,c]=(0,n.useState)("09:00 AM"),[d,m]=(0,n.useState)(""),u=(new Date).toLocaleDateString("en-us",{day:"2-digit",timeZoneName:"long"}).substring(4),h=(0,Vl.m7)(l),p=(0,Vl.nL)(l),g=h<24&&p<60,f=l.length>=5&&g,E=e=>{if(e){e.isValid()&&(o(e.format("MM/DD/YYYY")),a(e.set("hours",h).set("minutes",p)))}};(0,n.useEffect)((()=>(a(s),o(s.format("MM/DD/YYYY")),()=>a(s))),[]),(0,n.useEffect)((()=>{const e=Te()(i).isValid();let a=!0;h&&(p||0===p)&&(a=(0,Vl.tt)(Te()(t).set({hour:h,minutes:p}))),f&&e&&a?(r(!1),E(t),m("")):(m("Please select a date and time in the future"),r(!0))}),[i,t,l]);return n.createElement("div",{className:"ScheduleCustomDateAnnouncement"},n.createElement("div",{className:"ScheduleCustomDateAnnouncement-date-picker-container"},n.createElement(zl,{id:"custom-date-announcement",date:t,handleDateChange:E})),d?n.createElement(Ul.Z,{type:Ul.N.Error},d):null,n.createElement(Fs.Z,{autofocus:!0,label:"Date",icon:nt.Z.Calendar,name:"DateInput",value:i,mask:Yl.t.DateMMDDYYYY,onChange:e=>{const n=Te()(e).isValid();o(e),n&&!Te()(e).isSame(t,"date")?(a(Te()(e).set("hours",h).set("minutes",p)),r(!1)):r(!0)}}),n.createElement(Fs.Z,{label:"Time",icon:nt.Z.Clock,placeholder:"e.g. 01:00 PM, 13:00",name:"DateTextInput",value:l,helperText:null!=u?u:"",mask:Yl.t.DynamicTime,onChange:e=>{c(e),e.length>=5&&E(t)}}))},jl=a(25108);class Jl extends n.Component{constructor(){super(...arguments),this.state={searchValue:""},this.onEnterWaypoint=()=>{const{cardMembersStatus:e,cardMembersLinkHeaders:t,loadWaypoint:a}=this.props,{searchValue:n}=this.state;if(e!==le().LOADED)return;a(n,{linkHeader:t["next-page"]})},this.onSearch=e=>{this.setState({searchValue:e})}}componentDidMount(){const{onMount:e}=this.props;e()}componentDidUpdate(e,t){const{searchValue:a}=t,{searchValue:n}=this.state;a!==n&&this.props.onUpdate(n)}render(){const{chips:e,note:t,handleChipRemoval:a,handleGroupSelect:r,handleNoteInputChange:s,cardGroupsList:i,hasWaypoint:o,card:l,showCustomDatePicker:c,setCustomDate:d,customAnnouncementDate:m,onSetScheduleButtonDisabled:u}=this.props,{searchValue:h}=this.state,p=l.data.shareStatus===Ee().visibility.PRIVATE;return n.createElement("div",{className:"CardAssignmentMustReadBody"},c?n.createElement(Kl,{customAnnouncementDate:m,setCustomDate:d,onSetScheduleButtonDisabled:u}):n.createElement(n.Fragment,null,n.createElement("div",{className:"CardAssignmentMustReadBody__section"},n.createElement(Bl,{hasGroupsHidden:p,hasWaypoint:o,chips:e,label:"Send to",membersList:i,inputValue:h,onInput:this.onSearch,onDeleteChip:a,onSelectItem:r,onEnterWaypoint:this.onEnterWaypoint})),n.createElement("div",{className:"CardAssignmentMustReadBody__section"},n.createElement(Wn.Z,{id:"note",label:"Note",name:"note",placeholder:"Add a note",maxCharacterCount:350,value:t,onChange:s}))))}}function Ql(e,t){if(e===E.CardMembersAlert)return t.id;jl.error("filter not set")}function Xl(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Ll.get(Ql(E.CardMembersAlert,{id:e}),{pathVars:[e],queryParams:{search:t},...a})}var $l=(0,ye.ey)((0,h.Z)((function(e,t){const a=wl.getFilter(Ql(E.CardMembersAlert,t)),n=[...a.items.editData.filter((e=>"user-group"===e.type)).map((e=>e.userGroup)),...a.items.editData.filter((e=>"user"===e.type)).map((e=>null==e?void 0:e.user))];return{cardMembersStatus:a.status,cardMembersLinkHeaders:a.linkHeaders,cardGroupsList:n,hasWaypoint:Boolean(a.linkHeaders&&a.linkHeaders["next-page"]),onMount:function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Xl(t.id,e,a)},onUpdate:function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Xl(t.id,e,a)},loadWaypoint:function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Xl(t.id,e,a)}}}),Ql)([wl],Jl));Jl.propTypes={chips:D().arrayOf(D().shape({id:D().string,name:D().string,user:D().object})),note:D().string,handleChipRemoval:D().func.isRequired,handleGroupSelect:D().func.isRequired,handleNoteInputChange:D().func.isRequired},Jl.defaultProps={chips:[],note:""};var ec=(0,n.forwardRef)(((e,t)=>{let{aria:a,busy:r,children:i,disabled:o,icon:l,label:c,onClick:d,style:m,theme:u}=e;const h=s()("primaryAction",m,u,{"Button-sage--disabled":o}),p=s()("secondaryAction",m,u,{"Button-sage--disabled":o}),[g,f]=(0,n.useState)(!1),E=n.createElement(at.ZP,{aria:a,icon:nt.Z.ChevronDown,disabled:o,style:at.Dd.Standard,tooltipLabel:"More actions",tooltipPosition:at.DU.Bottom,onClick:()=>{f(!g)}});return n.createElement("div",{className:"ComboButton-sage"},n.createElement("span",{className:h},n.createElement(ft.ZP,{busy:r,disabled:o,ref:t,label:c,icon:l,onClick:d})),n.createElement("span",{className:"Button-divider"}),n.createElement("span",{className:p},n.createElement(Ga.Z,{trigger:E},i)))}));var tc=e=>{let{handleCustomDate:t,onClickSend:a,sendButtonDisabled:r}=e;const s=new Date;return n.createElement(ec,{theme:ft.bn.Dark,aria:"more-actions",label:"Send",disabled:r,onClick:a},n.createElement(wn.ZP,{ariaLabel:"Schedule",heading:"Schedule"},s.getHours()<13?n.createElement(wn.sN,{onClick:()=>Sa({hour:13,daysToAdd:0},a)},"Later today at 1:00 PM"):null,s.getDay()<5?n.createElement(wn.sN,{onClick:()=>Sa({hour:9,daysToAdd:1},a)},"Tomorrow at 9:00 AM"):null,1!==s.getDay()?n.createElement(wn.sN,{onClick:()=>(e=>{const t=new Date,a=7-t.getDay()+1,n=new Date(t.getTime()+24*a*60*60*1e3);n.setHours(9),n.setMinutes(0),n.setSeconds(0),e(n.toISOString())})(a)},"Monday at 9:00 AM"):null,n.createElement(wn.sN,{borderTop:!0,onClick:()=>t&&t()},"Custom time")))};var ac=e=>{let{customAnnouncementDate:t,handleCustomDate:a,onClickCancel:r,onClickSend:s,onPreviousMenu:i,scheduleButtonDisabled:o,sendButtonDisabled:l,showCustomDatePicker:c}=e;const[d]=(0,Ue.Z)(Ne.Z.SCHEDULED_ANNOUNCEMENTS_ALLOWED),m=c?o:l;return n.createElement(Wa.Z,{alignment:Wa.A.Right},n.createElement(ft.ZP,{label:c?"Back":"Cancel",theme:ft.bn.Gray,style:ft.ZJ.Text,onClick:c?i:r}),d&&!c?n.createElement(tc,{handleCustomDate:a,sendButtonDisabled:l,onClickSend:s}):n.createElement(ft.ZP,{size:ft.qE.Medium,theme:ft.bn.Dark,disabled:m,label:c?"Schedule":"Send announcement",onClick:()=>{var e;return s(null!==(e=null==t?void 0:t.format())&&void 0!==e?e:"")}}))};var nc=e=>{const[{data:{email:t}}]=(0,_e.Z)(),{refetch:a}=Al(t),[r,s]=(0,n.useState)([]),[i,o]=(0,n.useState)(""),[l,c]=(0,n.useState)(!1),[d,m]=(0,n.useState)(),[u,h]=(0,n.useState)(!0),p=e=>{const t=r.findIndex((t=>t.id===e)),a=[...r.slice(0,t),...r.slice(t+1)];s(a)},g=(e,t,a)=>{const n=r.some((t=>t.id===e)),i=n?r:[...r,{id:e,name:t,user:a}];s(i)},f=e=>{o(e)},v=t=>{const{onClickCancelOrClose:n,serverAssignedId:s,setActiveAnnouncement:o,setShowCommentsTray:l}=e,c=r.map((e=>({id:e.id,name:e.name}))),d={cardId:s,groups:c,note:i,...t&&{scheduledSendDate:t}};Nl.Z.post(E.GLOBAL,{data:JSON.stringify(d),success:e=>{let{data:t}=e;l&&l(!0),o&&o(null==t?void 0:t.alertId),a()}}),n()},{onClickCancelOrClose:C,serverAssignedId:y}=e,b=0===r.length||i.trim().length>350;return n.createElement(ei,{renderTitle:()=>l?"Schedule announcement":"Send an announcement",renderContent:()=>n.createElement($l,{customAnnouncementDate:d,id:y,chips:r,note:i,handleChipRemoval:p,handleGroupSelect:g,handleNoteInputChange:f,showCustomDatePicker:l,setCustomDate:m,onSetScheduleButtonDisabled:h}),renderFooter:()=>n.createElement(ac,{sendButtonDisabled:b,scheduleButtonDisabled:u,showCustomDatePicker:l,handleCustomDate:()=>c(!0),customAnnouncementDate:d,onClickCancel:C,onClickSend:v,onPreviousMenu:()=>c(!1)}),onClickClose:C,onClickOutside:C})};let rc;!function(e){e.Announcement="ANNOUNCEMENT",e.Share="SHARE",e.Permissions="PERMISSIONS",e.LinkTracking="LINK_TRACKING"}(rc||(rc={}));var sc=e=>{let{onClose:t,popoverRef:a,triggerRef:r}=e;const{canSendAnnouncement:i,card:o,isPublicLinkAllowed:l,serverAssignedId:c,setShowCommentsTray:d,setActiveAnnouncement:m}=(0,n.useContext)(ye.ZP),[u,h]=(0,n.useState)(rc.Share);return(0,ws.Z)({anchor:a,target:r}),n.createElement("section",{className:s()("ghq-ShareCardMenu ghq-is-not-draggable",{"ghq-ShareCardMenu-privacy-sharing":u===rc.Permissions,"ghq-ShareCardMenu-announcement":u===rc.Announcement}),ref:a},u===rc.Permissions?n.createElement(ei,{renderTitle:()=>"Privacy and Sharing",renderContent:()=>n.createElement(fo,null),onClickClose:()=>h(rc.Share),onClickOutside:()=>h(rc.Share)}):u===rc.Announcement?n.createElement(nc,{id:o.id,serverAssignedId:c,setShowCommentsTray:d,setActiveAnnouncement:m,onClickCancelOrClose:t}):u===rc.LinkTracking?n.createElement(Zl,{fact:o,onClose:t}):n.createElement(n.Fragment,null,n.createElement("div",{className:"ghq-ShareCardMenu-top-header"},n.createElement("p",{className:"ghq-ShareCardMenu-top-header-info"},"Share card"),n.createElement(at.ZP,{style:at.Dd.Outline,icon:nt.Z.Close,aria:"close menu",onClick:t})),n.createElement("div",{className:"ghq-ShareCardMenu-share-button-container"},n.createElement(Wa.Z,{alignment:Wa.A.Center},n.createElement(ft.ZP,{label:"Copy link",icon:l?nt.Z.LinkPublic:nt.Z.Link,style:ft.ZJ.Outline,theme:ft.bn.Gray,onClick:()=>{(0,os.P3)({card:o}),t()}}),i&&n.createElement(ft.ZP,{label:"Send announcement",icon:nt.Z.MustRead,style:ft.ZJ.Outline,theme:ft.bn.Gray,onClick:()=>h(rc.Announcement)}))),n.createElement(Ro,{setMenuView:h,onClose:t})))};var ic=()=>{const{popoverRef:e,triggerRef:t,showContainer:a,updateContainer:r}=(0,Ws.Z)({containerClass:".ghq-ShareCardMenu"}),{isPublicLinkAllowed:s,isPrivate:i,isArchivedOrInaccessible:o}=(0,n.useContext)(ye.ZP);return n.createElement(n.Fragment,null,n.createElement(ft.ZP,{label:"Share",theme:ft.bn.Dark,ref:t,icon:s?nt.Z.Globe:i?nt.Z.Lock:nt.Z.AccountMultiple,disabled:o,onClick:()=>r(!a)}),a?n.createElement(sc,{popoverRef:e,triggerRef:t,onClose:()=>r(!1)}):null)};const oc=()=>{const{popoverRef:e,triggerRef:t,showContainer:a,updateContainer:r}=(0,Ws.Z)({containerClass:".ghq-MoreOptionsMenu"});return n.createElement(n.Fragment,null,n.createElement(_s,{icon:nt.Z.DotsHorizontal,aria:"more-options",tooltipLabel:"More Options",ref:t,onClick:()=>r(!a)}),a&&n.createElement(vo,{popoverRef:e,triggerRef:t,onClose:()=>r(!1)}))},lc=()=>{const{card:{id:e}}=(0,ye.RC)();return n.createElement(_s,{icon:nt.Z.Pencil,aria:"edit-card",tooltipLabel:"Edit Card",onClick:()=>{pa.ZP.isOpen(e)?d.Z.setAction(e,le().EDITING,{needsEditFact:!0}):d.Z.openFact(e,{editing:!0,maximized:!m.ZP.isExtension()})}})},cc=()=>{const{commentCount:e,hasComments:t,showCommentsTray:a,setShowCommentsTray:r}=(0,ye.RC)(),i=s()("comment-icon-button-container",{"has-comments":t&&e>0});return n.createElement("div",{className:i,"data-testid":"comment-icon-button-container"},n.createElement(_s,{icon:nt.Z.Comment,buttonSelected:a,aria:a?"close-comment-tray":"open-comment-tray",tooltipLabel:a?"Close Comments":"Open Comments",onClick:()=>r(!a)}))};var dc=()=>{const{card:e,serverAssignedId:t,id:a,canClose:r,canEdit:s,canMaximize:i,canView:o,isMaximized:l,isFollowed:c,isOwnedByGuru:d,isPublicLinkAllowed:u,isSynced:h,onClickClose:p,onClickMaximize:g,onClickView:f}=(0,ye.RC)(),[{data:{preferences:E}}]=(0,ls.Z)(),{activeCard:v}=pa.ZP.getFactsTabWindow().data,C=m.ZP.isMacOS(),y="true"!==E.disableCopyCardShortcuts,b=t=>{y&&(t.preventDefault(),(0,os.P3)({card:e}))},S=t=>{if(y){const a=window.getSelection();"Caret"===(null==a?void 0:a.type)&&(t.preventDefault(),(0,os.oH)({card:e,id:"fact-card-".concat(e.id)}))}},Z=t=>{y&&h&&(t.preventDefault(),(0,os.Y8)({card:e}))},N=v!==a,I=C?{handleShiftMetaC:b,handleMetaC:S,handleMetaE:Z,disableListener:N}:{handleCtrlShiftC:b,handleCtrlC:S,handleCtrlE:Z,disableListener:N};return(0,cs.ZP)(I),n.createElement("div",{className:"ghq-CardHeaderRightSection"},!d&&n.createElement(oc,null),s&&n.createElement(lc,null),!d&&n.createElement(cc,null),n.createElement(Ys,{card:e,isFavorited:e.data.favorited,cardId:e.data.id}),!(0,us.tq)()&&n.createElement(_s,{icon:u?nt.Z.LinkPublic:nt.Z.Link,aria:"copy-link",tooltipLabel:"Copy Link",onClick:()=>(0,os.P3)({card:e})}),n.createElement("div",{className:"ghq-CardHeaderRightSection__buttons"},!d&&!h&&n.createElement(hs,{isFollowing:c,id:a,serverAssignedId:t}),n.createElement(ic,null)),i&&n.createElement(_s,{aria:l?"collapse-window":"expand-window",disableWhenArchived:!1,icon:l?nt.Z.CollapseWindow:nt.Z.ExpandWindow,onClick:()=>g(a,l)}),o&&n.createElement(_s,{aria:"expand-window",disableWhenArchived:!1,icon:nt.Z.ExpandWindow,onClick:()=>f(a)}),r&&n.createElement(_s,{aria:"close-card",disableWhenArchived:!1,icon:nt.Z.Close,onClick:()=>p(a)}))};class mc extends n.Component{hasNoVerificationSyncRender(){const{lastSyncDate:e}=this.props,t=Te()(e,"YYYY-MM-DD[T]HH:mm:ss.SSSZZ");return n.createElement(n.Fragment,null,n.createElement("div",{className:"ghq-CardHeaderVerificationSyncInfo__status-text"},"This Card is Synced."),n.createElement("div",{className:"ghq-CardHeaderVerificationSyncInfo__helper-text"},n.createElement("span",null,"Synced Cards have limited functionality. For more information, read our"," "),n.createElement("a",{href:Mr.r.KnowledgeSyncOverview,target:"_blank",rel:"noopener noreferrer"},"help center"),n.createElement("span",null," article.")),n.createElement("div",{className:"ghq-CardHeaderVerificationSyncInfo__date"},n.createElement("span",{className:"ghq-CardHeaderVerificationSyncInfo__date-text"},"Last synced on"," "),n.createElement("span",{className:"ghq-CardHeaderVerificationSyncInfo__date-text ghq-is-bold"},t.format("MMM D, YYYY"),", ",t.format("h:mm a"))))}hasVerificationSyncRender(){var e,t;const{lastSyncDate:a,card:{data:{syncInfo:r}},isSynced:s,isSyncedNoVerification:i,isAdmin:o}=this.props,l=Te()(a,"YYYY-MM-DD[T]HH:mm:ss.SSSZZ");return n.createElement(n.Fragment,null,n.createElement("div",{className:"ghq-CardHeaderVerificationSyncInfo__last-synced"},n.createElement("div",{className:"ghq-CardHeaderVerificationSyncInfo__last-synced-img-wrapper"},n.createElement(fn.Z,{icon:null!==(e=Lr.TW[r.contentSyncType])&&void 0!==e?e:Lr.TW[Lr.ZP.MANUAL],size:20})),n.createElement("div",{className:"ghq-CardHeaderVerificationSyncInfo__helper-text-sync"},n.createElement("p",null,n.createElement("span",{className:"ghq-CardHeaderVerificationSyncInfo__last-synced-origin"},"Last synced from"," ",null!==(t=Lr.jV[r.contentSyncType])&&void 0!==t?t:Lr.jV.UNKNOWN," ",n.createElement("br",null),"on"," "),n.createElement("span",{className:"ghq-CardHeaderVerificationSyncInfo__date-text ghq-is-bold"},l.format("MMM D, YYYY"),", ",l.format("h:mm a"))))),s&&i&&o&&n.createElement("div",{className:"ghq-CardHeaderVerificationSyncInfo__last-synced"},n.createElement("div",{className:"ghq-CardHeaderVerificationSyncInfo__last-synced-svg-wrapper"},n.createElement(Xe.Z,{icon:"user-add",size:20,className:"ghq-CardHeaderVerificationSyncInfo__last-synced-img"})),n.createElement("div",{className:"ghq-CardHeaderVerificationSyncInfo__helper-text-sync"},n.createElement("p",null,n.createElement("span",{className:"ghq-CardHeaderVerificationSyncInfo__last-synced-origin"},"Enable verification for this ",n.createElement("br",null)," collection in"," "),n.createElement("span",{className:"ghq-CardHeaderVerificationSyncInfo__date-text ghq-is-bold"},n.createElement("a",{href:"".concat(pe.ZP.APP_URL,"/settings/team/collections"),rel:"noopener noreferrer"},"Collection Settings"))))),n.createElement("div",{className:"ghq-CardHeaderVerificationSyncInfo__last-synced-text-wrapper-verificationSync"},n.createElement("span",null,"For more information about Synced Cards, read our "),n.createElement("a",{href:Mr.r.KnowledgeSyncOverview,target:"_blank",rel:"noopener noreferrer"},"Help Center"),n.createElement("span",null," article.")))}render(){return Sr.Z.hasKnowledgeSyncVerifiers()?this.hasVerificationSyncRender():this.hasNoVerificationSyncRender()}}var uc=(0,ye.ey)((0,h.Z)((function(){return{isAdmin:Boolean(Pe.Z.getState().data.admin)}}))([Pe.Z],mc)),hc=a(52341),pc=a(43714);class gc extends n.Component{render(){const{verifiers:e}=this.props,t=Sr.Z.hasKnowledgeSyncVerifiers(),a=s()(t?"ghq-VerifyReason__synced-verifiers":"ghq-VerifyReason",{"ghq-is-untrusted":this.props.fact.data.verificationState===le().NEEDS_VERIFICATION,"ghq-no-knowledge-sync-verifiers":!t});if(e.status===le().NOT_LOADED)return null;var r=null;const i=o()(e,"editData[0]",{});return r="user-group"===i.type?"the group, ".concat(o()(i,"userGroup.name",""),","):gt.Z.getPersonalName(i.user),n.createElement("div",{className:a},n.createElement(pc.Z,{fact:this.props.fact,verifierName:r}))}}var fc=gc;f.Z.register(E.VerifiersExperts,{POST:{path:"/verifiers/experts"}});const Ec=new C.Z({name:E.VerifiersExperts});Ec.createStore();var vc=g.Z.addStore(Ec.store),Cc=a(25108);const yc=new p.Z({name:vc.getName()}),bc=g.Z.getFlux().actions[yc.name];bc||Cc.error("error creating actions");var Sc=bc,Zc=a(65185);const Nc=[{label:"Every week",type:"menu-item",value:"7"},{label:"Every 2 weeks",type:"menu-item",value:"14"},{label:"Every month",type:"menu-item",value:"30"},{label:"Every 3 months",type:"menu-item",value:"90"},{label:"Every 6 months",type:"menu-item",value:"180"},{label:"Every year",type:"menu-item",value:"365"}],Ic={value:Ee().verification.SPECIFIC_DATE,label:"On a specific date",topDivider:!0,type:"menu-item"};var Tc={VerificationIntervals:[...Nc]},Ac=a(51879);var _c=e=>{let{fact:t,hasVerificationDate:a,verificationIntervalLabel:r}=e;const{verificationInterval:s,verificationType:i}=t.editFact.data,{isTemplate:o}=t.meta;let l,c,m=s.toString();i===Ee().verificationIntervalType.ABSOLUTE&&(m=Ic.value,s===(0,Vl.EW)(Te()())&&t.action===oe.NEW||(l=Te().utc((0,Vl.dl)(s)).format("MM/DD/YYYY"),c=Te().utc((0,Vl.dl)(s))));const[u,h]=n.useState(!1),[p,g]=n.useState(l||""),[f,E]=n.useState(c||Te()()),v=n.useRef(),C=(()=>{let e=Tc.VerificationIntervals;return a&&!o&&(e=[...e,{...Ic,label:n.createElement(n.Fragment,null,Ic.label)}]),e})();let y;i===Ee().verificationIntervalType.ABSOLUTE?y="On a specific date":m&&C.some((e=>(e.value===m&&(y=e.label),y)));const b=_()((()=>{d.Z.updateFactDetails(t.id)}),1e3);return n.createElement("div",{className:"ghq-RenderVerificationInterval"},n.createElement(Wl.ZP,{required:!0,helperText:"How often should this information be verified?",label:r,name:"VerificationSettings-interval",value:m,onChange:e=>{e===Ee().verification.SPECIFIC_DATE?(d.Z.setVerificationType(t.id,Ee().verificationIntervalType.ABSOLUTE),d.Z.setVerificationInterval(t.id,(0,Vl.EW)(Te()().format("x")))):(d.Z.setVerificationType(t.id,Ee().verificationIntervalType.RELATIVE),d.Z.setVerificationInterval(t.id,parseInt(e)),t.action!==oe.NEW&&d.Z.updateFactDetails(t.id),g(""))}},C.map((e=>n.createElement(Wl.$m,{hasSeparator:e.topDivider,label:e.label,key:e.value,value:e.value})))),i===Ee().verificationIntervalType.ABSOLUTE?n.createElement("div",{className:"ghq-RenderVerificationInterval__datepicker ghq-is-not-draggable",ref:v,onClick:()=>h(!0)},n.createElement(Fs.Z,{name:"date-input",value:p,placeholder:"Choose a date",label:"Date to become untrusted",icon:nt.Z.Calendar,onChange:e=>{const a=(0,Vl.tt)(e);if(a&&!Te()(e).isSame(f,"date")&&E(Te()(e)),p.length>0&&a){const a=Te()(e).format("x");d.Z.setVerificationInterval(t.id,(0,Vl.EW)(a)),t.action!==oe.NEW&&b()}a||d.Z.setVerificationInterval(t.id,(0,Vl.EW)(Te()().format("x"))),g(e)}})):null,u&&n.createElement(Ac.Z,{target:v.current,preferredXPosition:Zc.pX,preferredYPosition:Zc.dv},n.createElement(zl,{date:f,id:"TrustSettings-datepicker",handleDateChange:e=>{const a=(0,Vl.tt)(e),n=Te()((0,Vl.dl)(t.data.verificationInterval));a&&!e.isSame(n,"date")&&(d.Z.setVerificationInterval(t.id,(0,Vl.EW)(e.format("x"))),E(e),t.action!==oe.NEW&&b()),h(!1),g(e.format("MM/DD/YYYY"))},handleOutsideClick:e=>{v.current.contains(e.target)||h(!1)}})))},wc=a(13311),Dc=a.n(wc),Pc=a(77043),kc=a.n(Pc),Lc=a(43696),Mc=a.n(Lc),Oc=a(28490),Fc=a.n(Oc),Rc=a(23416),xc=a(4322);const qc=la().createStore({getName:function(){return"AvailableVerifiersStore"},initialize:function(){this._availableVerifiers=ga.Z.create().setData({}),this._helper=new xc.Z(this),this.bindActions(Wt.default.LOAD_AVAILABLE_VERIFIERS_START,this.onLoadAvailableVerifiersStart,Wt.default.LOAD_AVAILABLE_VERIFIERS_COMPLETE,this.onLoadAvailableVerifiersComplete,Wt.default.LOAD_AVAILABLE_VERIFIERS_ERROR,this.onLoadAvailableVerifiersError,Wt.default.SET_AVAILABLE_VERIFIERS_SEARCH_TERMS,this.onSetAvailableVerifiersSearchTerms,Wt.default.LOGOUT,this.clear)},_createAvailableVerifiers:function(e){let t=ga.Z.create().setId(e).setStatus(le().NOT_LOADED).setData([]);return t.searchTerms="",this._availableVerifiers.data[e]=t,t},_getOrCreateAvailableVerifiers:function(e){let t=this._helper.findById(e,this._availableVerifiers);return t||(t=this._createAvailableVerifiers(e)),t},getById:function(e){return this._getOrCreateAvailableVerifiers(e)},getSearchTerms:function(e){return this._getOrCreateAvailableVerifiers(e).searchTerms},onLoadAvailableVerifiersStart:function(e){this._getOrCreateAvailableVerifiers(e.searchId).setStatus(le().RELOADING),this._helper.onChange()},onLoadAvailableVerifiersComplete:function(e){let t=this._getOrCreateAvailableVerifiers(e.context.searchId);e.headers[Rc.Zj]?t.linkHeaders=Fc()(e.headers[Rc.Zj]):t.linkHeaders=null;let a=null;a="next-page"===e.context.rel?t.data.concat(e.data):e.data||[],t.data=a,t.setStatus(le().LOADED),this._helper.onChange()},onLoadAvailableVerifiersError:function(e){const t=this._getOrCreateAvailableVerifiers(e.context.searchId);this._helper.setErrorFromResponse(t,e),this._helper.onChange()},onSetAvailableVerifiersSearchTerms:function(e){this._getOrCreateAvailableVerifiers(e.searchId).searchTerms=e.searchTerms,this._helper.onChange()},clear:function(){this._availableVerifiers=ga.Z.create().setData({}),this._helper.onChange()}});var Bc=g.Z.addStore(new qc);const Vc={loadAvailableVerifiers:function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=a.cardId?"/cards/".concat(a.cardId,"/members/verify"):"/cards/members/verify?collection=".concat(t);const r={type:"GET"},s={searchId:e,opt_cardId:a.cardId},i=Bc.getSearchTerms(e);i&&(n="".concat(n).concat(a.cardId?"?":"&","search=").concat(encodeURIComponent(i))),a.linkHeader&&(s.rel=a.linkHeader.rel,r.data=r.data||{},r.data.token=a.linkHeader.token),yo.ZP.callApi(this,Mc().LOAD_AVAILABLE_VERIFIERS,n,r,s).then((e=>{a.success&&a.success(e)}))},setSearchTerms:function(e,t){this.dispatch(Wt.default.SET_AVAILABLE_VERIFIERS_SEARCH_TERMS,{searchId:e,searchTerms:t})}};var Uc=g.Z.addActions({availableverifiers:Vc}),Hc=a(53171),Wc=a(57174),Gc=a(63105),zc=a.n(Gc),Yc=a(51463),Kc=a.n(Yc),jc=a(13037),Jc=a(18446),Qc=a.n(Jc);function Xc(e,t,a){return e.length?e.map((e=>{switch(e.type){case"menu-header":return function(e){return n.createElement(jc.Lb,null,e.label)}(e);case"menu-item":return function(e,t,a){const r=Qc()(e.value,t.value||t);return n.createElement(n.Fragment,null,e.topDivider&&n.createElement(mr.Z,{spacing:mr.Z.spacing.Tight}),n.createElement(jc.sN,{selectable:!0,icon:e.icon,image:e.image,firstName:e.firstName,lastName:e.lastName,selected:r,key:e.value,value:e,onSelect:a},n.createElement("span",null,e.label)))}(e,t,a);case"waypoint":return n.createElement(Bt.h,{key:"waypoint-"+e.value,onEnter:e.onEnter})}})):n.createElement(jc.sN,{selectable:!0,type:"MESSAGE"},n.createElement("span",null,"No results found"))}class $c extends n.Component{constructor(e){super(e),this.renderSuggestedMenuItems=()=>{const{selectedItem:e,handleMenuItemSelect:t,suggestedVerifiers:a,closeMenu:r}=this.props,s=o()(a,"experts",[]),i=zc()(s,{type:"user-group"}).map((a=>n.createElement(jc.sN,{selectable:!0,type:"SUGGESTED",selected:a.userGroup.id===e.value,icon:"account-multiple",key:a.userGroup.id,value:a,onSelect:e=>{t(e,{isSuggested:!0}),r()}},n.createElement(Bt.h,{onEnter:this.onSeeSuggestion}),n.createElement("span",null,a.userGroup.name)))),l=zc()(s,{type:"user"}).map((a=>n.createElement(jc.sN,{selectable:!0,type:"SUGGESTED",selected:a.user.email===e.value,image:a.user.profilePicUrl||"",firstName:a.user.firstName,lastName:a.user.lastName,key:a.user.email,value:a,onSelect:e=>{t(e,{isSuggested:!0}),r()}},n.createElement(Bt.h,{onEnter:this.onSeeSuggestion}),n.createElement("span",null,"".concat(a.user.firstName," ").concat(a.user.lastName)))));return l.length||i.length?[n.createElement(jc.Lb,{suggested:!0,key:"suggested-label"},"Suggested Experts"),...i,...l]:null},this.onSeeSuggestion=Kc()((()=>{const{expertSuggestionId:e,fact:t}=this.props,{action:a}=t;M.Z.postActivity({type:Pt.default.EXPERTS_DISPLAYED,properties:{factId:a===oe.NEW?t.id:t.data.id,expertsTask:a===oe.NEW?oe.Activities.CARD_CREATION:oe.Activities.CARD_VERIFICATION,expertSuggestionId:e()},biOnly:!0})}))}componentDidMount(){const{expertSuggestionId:e,fact:t,hasExpertId:a}=this.props,{action:n}=t;a&&!Boolean(t.meta.isTemplate)&&M.Z.postActivity({type:Pt.default.VERIFIER_DROPDOWN_OPENED,properties:{factId:n===oe.NEW?t.id:t.data.id,expertsTask:n===oe.NEW?oe.Activities.CARD_CREATION:oe.Activities.CARD_VERIFICATION,expertSuggestionId:e()},biOnly:!0})}componentWillUnmount(){const{setAvailableVerifiersSearchTerms:e,fact:t}=this.props;e("");const a={};t.isNew||(a.cardId=t.data.id),Uc.loadAvailableVerifiers(t.id,t.editFact.data.collection.id,a)}render(){const{closeMenu:e,menuIsReloading:t,showExperts:a,menuItems:r,selectedItem:s,handleMenuItemSelect:i,fact:o,handleAction:l,setAvailableVerifiersSearchTerms:c,hasExpertId:d}=this.props,m=d&&a;return n.createElement("div",{className:"ghq-TrustSettingsVerifierMenu"},n.createElement($e.Z,{isReloading:t}),n.createElement(jc.ZP,null,n.createElement(jc.wV,{placeholder:"Search by user or group",value:Bc.getSearchTerms(o.id),onDebouncedInput:l,onInput:c}),n.createElement(jc.ZP,{embedded:!0,selectable:!0},m&&this.renderSuggestedMenuItems(),Xc(r,s,(t=>{i(t,{isSuggested:!1}),e()})))))}}$c.propTypes={menuIsReloading:D().bool,showExperts:D().bool,hasExpertId:D().bool,fact:D().object,selectedItem:D().object,menuItems:D().arrayOf(D().shape({})),suggestedVerifiers:D().object,expertSuggestionId:D().func,closeMenu:D().func,handleAction:D().func,setAvailableVerifiersSearchTerms:D().func},$c.defaultProps={menuIsReloading:!1,showExperts:!1,hasExpertId:!1,fact:{},selectedItem:{},menuItems:[],suggestedVerifiers:{},expertSuggestionId:()=>"",closeMenu:()=>{},handleAction:()=>{},setAvailableVerifiersSearchTerms:()=>{}};var ed={getAvailableVerifiersMenuItems:(e,t,a)=>{let n=[{label:"Groups",type:"menu-header"}];zc()(e,(function(e){return"user-group"===e.type})).forEach(function(e){n.push({icon:"account-multiple",label:e.userGroup.name,type:"menu-item",subtype:"user-group",value:e.userGroup.id})}.bind(void 0));let r=[{label:"Members",type:"menu-header"}];zc()(e,(function(e){return"user"===e.type})).forEach(function(e){r.push({label:gt.Z.getPersonalName(e.user),firstName:e.user.firstName,lastName:e.user.lastName,image:xn.ZP.getProfileUrl(e.user.profilePicUrl),type:"menu-item",subtype:"member",value:e.user.email})}.bind(void 0));let s=[];if(n.length>1&&(s=s.concat(n)),r.length>1&&(s=s.concat(r)),a&&a["next-page"]){const e=a["next-page"].token;s.push({onEnter:t.bind(null,e),type:"waypoint",value:"available-verifiers-waypoint"})}return s},getSelectedVerifier:e=>{switch((e=e||{type:"none"}).type){case"user":return{label:gt.Z.getPersonalName(e.user),firstName:e.user.firstName,lastName:e.user.lastName,image:xn.ZP.getProfileUrl(e.user.profilePicUrl),type:"menu-item",value:e.id};case"user-group":return{icon:"account-multiple",label:e.userGroup.name,type:"menu-item",value:e.userGroup.id};case"none":return{icon:"no-verifier",label:"- none -",type:"menu-item",value:"none"};default:return{}}}};function td(){return td=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},td.apply(this,arguments)}var ad=e=>{var t;let{availableVerifiers:a,collaborators:r,disabled:s,expertSuggestionConfig:i,fact:l,hasExpertId:c,placeholder:d,verifierLabel:m,suggestedVerifiers:u,verifiers:h}=e;const[p,g]=n.useState(!0),[f,v]=n.useState(null),C=e=>{if(e!==f){var t;v(e);const n=a.linkHeaders["next-page"];Uc.loadAvailableVerifiers(l.id,null===(t=l.editFact.data.collection)||void 0===t?void 0:t.id,{linkHeader:n})}},y=function(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l;const a={};Boolean(t.meta.isTemplate)&&s||(t.isNew||(a.cardId=t.data.id),Uc.loadAvailableVerifiers(t.id,null===(e=t.editFact.data.collection)||void 0===e?void 0:e.id,a))},b=()=>o()(u,"expertSuggestionId",null),S=()=>{if(!c||Boolean(l.meta.isTemplate))return;const e={data:JSON.stringify(i),success:()=>{(()=>{if(!l.isNew&&l.action!==oe.NEW){const e=h.data[0];M.Z.postActivity({type:Pt.default.CURRENT_VERIFIER_RECORDED,properties:{factId:l.data.id,expertsTask:oe.Activities.CARD_VERIFICATION,currentVerifier:null==e?void 0:e.id,expertSuggestionId:b()},biOnly:!0})}})()}};Sc.post(E.GLOBAL,e)},Z=()=>{y()},N=e=>{Uc.setSearchTerms(l.id,e),g(!e)},I=()=>{var e;const t=Pe.Z.getState();return{id:null===(e=t.data)||void 0===e?void 0:e.email,user:t.data,type:"user"}},T=e=>{if(Y.Z.setEditVerifier(l.id,e),N(""),y(),l.action!==oe.NEW){const t={headers:{[re.$2]:oe.Activities.CARD_VERIFICATION,[re.eB]:Pt.default.VERIFIER_SELECTED,[re.s3]:e.user?e.user.email:e.userGroup.id,[re.e2]:!0,[re.RX]:b()}};Y.Z.saveVerifier(l.id,t)}},A=e=>{let t;if(t=l.isNew&&"PRIVATE"===l.editFact.data.shareStatus?Dc()(kc()([I()],r.editData.filter((e=>e.highestRole===Hc.ZP.AUTHOR)),"id"),{id:e.value}):Dc()(a.data,{id:e.value}),Y.Z.setEditVerifier(l.id,t),N(""),y(),l.action!==oe.NEW){const e={headers:{[re.$2]:oe.Activities.CARD_VERIFICATION,[re.eB]:Pt.default.VERIFIER_SELECTED,[re.s3]:t.id,[re.e2]:!1,[re.RX]:b()}};Y.Z.saveVerifier(l.id,e)}},_=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.isSuggested?T(e):A(e)};n.useEffect((()=>{l.action!==oe.NEW||s||0===h.editData.length&&Y.Z.setEditVerifier(l.id,I())}),[]),n.useEffect((()=>{l.editFact.data.collection&&a.status===oe.NOT_LOADED&&y(),S()}),[]),n.useEffect((()=>{h.status===oe.NOT_LOADED&&l.action!==oe.NEW&&Y.Z.loadVerifiers(l.id)}),[h,l]),n.useEffect((()=>{r.status===oe.NOT_LOADED&&l.action!==oe.NEW&&Ki.Z.loadCollaborators(l.id)}),[l,r]),n.useEffect((()=>{y(),S()}),[l.editFact.data.shareStatus,null===(t=l.editFact.data.collection)||void 0===t?void 0:t.id]);let w=null;h.editData.length>0?w=h.editData[0]:h.data.length>0&&(w=h.data[0]);const D=Boolean(l.meta.isTemplate)&&s?null:ed.getSelectedVerifier(w),P=Boolean(l.meta.isTemplate)&&s?null:(e=>{let t=[];return t=l.isNew&&"PRIVATE"===l.editFact.data.shareStatus?ed.getAvailableVerifiersMenuItems(kc()([I()],r.editData.filter((e=>e.highestRole===Hc.ZP.AUTHOR)),"id"),null):ed.getAvailableVerifiersMenuItems(a.data,C,a.linkHeaders),"none"===e.value?[{label:"- none -",type:"menu-item",value:"none",icon:"no-verifier",isDisabled:!0},...t]:t})(D),k=a.status===oe.RELOADING,L={};if(D){const{label:e,image:t,icon:a,firstName:n,lastName:r}=D;Object.assign(L,{label:e,image:t,icon:a,firstName:n,lastName:r})}return n.createElement("div",{className:"ghq-RenderVerifier"},n.createElement("div",{className:"ghq-RenderVerifier__label-group"},n.createElement("div",{className:"ghq-RenderVerifier__label"},m)),n.createElement(Wc.Z,{disabled:s,popoverFilterId:"TrustSettings-".concat(l.id,"-available-verifiers"),renderSelectedItem:()=>n.createElement(Wc.Z.SelectedItem,td({placeholder:d},L)),renderDropdownToggleIcon:e=>{let{isOpen:t}=e;return n.createElement(fn.Z,{icon:t?nt.Z.ChevronUp:nt.Z.ChevronDown,color:s?"smog":null})},renderMenu:e=>{let{closeMenu:t}=e;return n.createElement($c,{fact:l,selectedItem:D,closeMenu:t,menuIsReloading:k,showExperts:p,hasExpertId:c,menuItems:P,suggestedVerifiers:u,expertSuggestionId:b,handleMenuItemSelect:_,handleAction:Z,setAvailableVerifiersSearchTerms:N})}}),n.createElement("div",{className:"ghq-additional-details__input-helper"},"Who will keep this information up-to-date?"))},nd=a(43387),rd=a(25108);const sd=e=>{if(e===vc.getName())return E.GLOBAL;rd.error("filter not set")},id=n.forwardRef(((e,t)=>{let{availableVerifiers:a,className:r,collaborators:i,disabled:o,expertSuggestionConfig:l,fact:c,hasExpertId:d,hasVerificationDate:m,placeholder:u,verifierLabel:h,verificationIntervalLabel:p,suggestedVerifiers:g,verifiers:f}=e;n.useEffect((()=>()=>{d&&Sc.clearStore()}),[]);const E=s()("ghq-fact-verification-settings",r);return n.createElement("div",{className:E,ref:t},n.createElement(ad,{disabled:o,hasExpertId:d,availableVerifiers:a,collaborators:i,expertSuggestionConfig:l,fact:c,placeholder:u,verifierLabel:h,suggestedVerifiers:g,verifiers:f}),n.createElement(_c,{fact:c,hasVerificationDate:m,verificationIntervalLabel:p}))}));var od=(0,h.Z)(((e,t)=>{let{id:a}=t;const n=pa.ZP.getById(a),r=nd.Z.getBySearchId(n.id),s=vc.getFilter(sd(vc.getName())),i=Sr.Z.hasFeature(Ne.Z.EXPERT_ID_ALLOWED),l=Sr.Z.hasFeature(Ne.Z.VERIFICATION_DATE_ALLOWED),c=s.items.data[0],d=n.editFact.data,m=o()(d,"collection.id"),u=d.preferredPhrase,h=d.content,p=d.tags?d.tags.map((e=>e.value||e.label)):null;return{fact:n,hasExpertId:i,hasVerificationDate:l,availableVerifiers:Bc.getById(n.id),collaborators:ha.Z.getBySearchId(n.id),verifiers:r,suggestedVerifiers:c,expertSuggestionConfig:{type:"expert-verification-config",expertsTask:n.isNew?oe.Activities.CARD_CREATION:oe.Activities.CARD_VERIFICATION,collectionId:m,cardId:n.isNew?n.id:n.data.id,title:u,content:h,tags:p}}}),sd)([Bc,ha.Z,Sr.Z,nd.Z,pa.ZP,vc],id);id.propTypes={disabled:D().bool},id.defaultProps={disabled:!1,verifierLabel:"Verifier",verificationIntervalLabel:"Verification Interval"};var ld=a(7210),cd=a(25108);const dd=new p.Z({name:ld.Z.getName()}),md=g.Z.getFlux().actions[dd.name];md||cd.error("error creating actions");var ud=md;class hd extends n.Component{componentDidMount(){const{onMount:e}=this.props;e()}componentDidUpdate(){const{onUpdate:e}=this.props;e()}render(){const{buttonText:e,onUnverify:t}=this.props;return n.createElement(ft.ZP,{size:ft.qE.Small,label:e,theme:ft.bn.Destructive,style:ft.ZJ.Outline,onClick:t})}}function pd(e,t){t&&t.status!==le().NOT_LOADED||d.Z.loadFact(e,{})}var gd=(0,h.Z)((function(e,t){let{id:a}=t;const n=pa.ZP.getById(a);return{buttonText:o()(n,"data.verificationState")===le().TRUSTED?"Unverify this Card":"Request Verification",onMount:()=>pd(a,n),onUpdate:()=>pd(a,n),onUnverify:()=>{const e={pathVars:[n.data.id],success:()=>{$.Z.createToast({content:"Verification Requested!",id:"fact-card-".concat(n.id)})}};ud.post(v().GLOBAL,e)}}}))([pa.ZP],hd);hd.propTypes={id:D().string.isRequired,buttonText:D().string,onUnverify:D().func},hd.defaultProps={buttonText:"",onMount:()=>{},onUpdate:()=>{},onUnverify:()=>{}};class fd extends n.Component{componentDidMount(){const{onMount:e}=this.props;e()}componentDidUpdate(){const{onUpdate:e}=this.props;e()}render(){const{id:e,unverifyTooltipText:t,canChangeSettings:a,canUnverify:r,isSynced:s,isSyncedNoVerification:i,__extendedCompatProps:o,onClose:l}=this.props,c=o.fact;return n.createElement("div",{className:"ghq-CardVerificationMenu"},n.createElement(ei,{renderTitle:()=>"Verification",renderContent:()=>n.createElement(n.Fragment,null,!(s&&i)&&n.createElement(fc,o),!i&&n.createElement(hc.Z,{fact:c.data}),a&&n.createElement(od,{id:e}),s&&n.createElement(uc,{id:e,canChangeSettings:a}),r&&n.createElement("div",{className:"ghq-CardVerificationMenu__actions"},n.createElement("div",{className:"ghq-CardVerificationMenu__action-button"},n.createElement(gd,{id:e})),n.createElement(Xe.Z,{className:"ghq-CardVerificationMenu__action-tooltip-icon",icon:"circle-question",tooltipped:{children:n.createElement("div",{className:"ghq-CardVerificationMenu__action-tooltip"},t),preferredXPosition:"right",preferredYPosition:"center"},size:16}))),onClickClose:l,onClickOutside:l}))}}var Ed=(0,ye.ey)((0,h.Z)((function(e,t){let{id:a,isTrusted:n,__compatProps:r}=t;const s=pa.ZP.getRealId(a),i=Pe.Z.getState(),l=Be.Z.getByFactId(s),c=nd.Z.getBySearchId(s),d=()=>function(e,t){let{permissions:a,verifiers:n}=t;a.status===le().NOT_LOADED&&qe.Z.loadPermissions(e),n.status===le().NOT_LOADED&&Y.Z.loadVerifiers(e)}(s,{permissions:l,verifiers:c}),m=l.canChangeVerifier&&c.status===le().LOADED&&(o()(c,"data[0].email","")!==i.data.email||n),u={...r,verifiers:c};return{onMount:d,onUpdate:d,canChangeSettings:l.canChangeVerifier,canUnverify:m,unverifyTooltipText:n?"This will bypass this Card's Verification interval, mark it as 'Unverified' and send a notification to the Verifier requesting their review as soon as possible.":"Send a reminder to the assigned Verifier, requesting that they Verify this Card as soon as possible.",loading:[l.status,c.status].some((e=>e!==le().LOADED)),__extendedCompatProps:u}}),(function(){return v().GLOBAL}))([Pe.Z,Be.Z,nd.Z],fd));fd.propTypes={canChangeSettings:D().bool,canUnverify:D().bool,isSynced:D().bool,loading:D().bool,unverifyTooltipText:D().string,onMount:D().func,onUpdate:D().func},fd.defaultProps={canChangeSettings:!1,canUnverify:!1,isSynced:!1,loading:!0,unverifyTooltipText:"",onMount:()=>{},onUpdate:()=>{}};var vd=a(19936);const Cd=e=>{let{trigger:t}=e;return n.createElement(Ga.Z,{trigger:t,containerPosition:Ga.I.Left},n.createElement("div",{className:"ghq-CardHeaderVerificationButton__verified_by_guru-content"},n.createElement(Dt.ZP,{icon:nt.Z.GuruAllBlack,iconSize:28},"This card has been made and verified by Guru.")))};var yd=e=>{let{isTrustMenuOpen:t,setTrustMenuOpen:a=(()=>{})}=e;const{isTrusted:r,isSyncedNoVerification:i,isOwnedByGuru:o,isArchivedOrInaccessible:l}=(0,ye.RC)(),c=(0,n.useRef)(null);(0,n.useEffect)((()=>{var e;null===(e=c.current)||void 0===e||e.focus()}),[]);const d=i?"Synced":r?"Verified":"Unverified",m=n.createElement(vd.ZP,{decoration:n.createElement(Br.Z,{isArchived:l,isSynced:i,isTrusted:r})},!(0,us.tq)()&&!(0,us.xR)()&&d),u=n.createElement(ft.ZP,{ref:c,label:m,icon:(()=>{if(!(0,us.xR)()&&!l)return t?nt.Z.ChevronUp:nt.Z.ChevronDown})(),iconAlignment:ft.vQ.Right,disabled:Boolean((0,us.xR)())||l,onClick:()=>{o||a(!t)}});return n.createElement("div",{className:s()("ghq-CardHeaderVerificationButton",{"ghq-is-archived":l,"ghq-is-embedded":(0,us.xR)()})},o?n.createElement(Cd,{trigger:u}):n.createElement(n.Fragment,null,u,t&&n.createElement(Ed,{onClose:()=>a(!1)})))};var bd=e=>{let{profileName:t,timeDifference:a,userId:r}=e;const{getTrackEventData:s}=(0,dn.Z)(),i=(0,Gr.pv)(r),[o]=(0,Ue.Z)(Ne.Z.EXTENSION_PROFILES_ALLOWED),{onClick:l,to:c}=(0,cn.k)(r,o);return n.createElement("div",{className:"CardHeaderProfilePageLink","data-testid":"card-header-profile-page-link"},!o&&(0,m.p1)()?n.createElement(Sn.Z,{normal:!0,type:Sn.q.LowPriority,to:i},t):n.createElement(ft.ZP,{label:t,style:ft.ZJ.Anchor,url:c,trackEvent:s({activitySubtype:dn.Y.CardHeaderAuthor,userId:r}),onClick:l})," updated ".concat(a))};const Sd=()=>{const{card:{data:e}}=(0,ye.RC)(),{lastModifiedBy:t,lastModified:a}=e;if(!t||!t.id)return null;const r=m.ZP.isExtension(),i=Te()(a).locale("en").fromNow(),o=gt.Z.getNameFromModel(t),l=gt.Z.getUsersInitials(t),c="".concat(o," updated ").concat(i);return n.createElement("div",{"data-testid":"UpdateDetails",title:c},n.createElement(Zt.Z,{initials:l,size:16,src:null==t?void 0:t.profilePicUrl,alt:"".concat(o,"'s profile picture")},n.createElement("div",{className:s()("UpdateDetailsText",{"ghq-UpdateDetailsText-extension":r})},n.createElement(bd,{timeDifference:i,userId:t.id,profileName:o}))))};var Zd=()=>{const{card:{data:{slug:e}},isOwnedByGuru:t}=(0,ye.RC)(),a=(0,be.TH)().pathname.includes("/card/".concat(e,"/details"));return t?null:n.createElement("div",{className:"CardHeaderLeftSection"},a?n.createElement(Sn.Z,{normal:!0,to:"/card/".concat(e),type:Sn.q.LowPriority},"Back to Card"):n.createElement(Sd,null))};const Nd=e=>{let{isTrustMenuOpen:t,setTrustMenuOpen:a}=e;const{isOwnedByGuru:r}=(0,ye.RC)();return r?n.createElement(yd,null):n.createElement("div",{className:"CardHeaderLeftDetails"},n.createElement(yd,{isTrustMenuOpen:t,setTrustMenuOpen:a}),n.createElement(Zd,null))};var Id=e=>{let{isTrustMenuOpen:t,setTrustMenuOpen:a}=e;const{isTrusted:r,isSynced:i,isSyncedNoVerification:o,isArchivedOrInaccessible:l,isLoading:c,hasCardHeaderVerificationAccent:d}=(0,ye.RC)(),[m]=(0,Ue.Z)(Ne.Z.KNOWLEDGE_SYNC_VERIFIERS),u=s()("ghq-CardHeader",{"ghq-is-loading":c,"ghq-is-trusted":r,"ghq-is-synced":m?o:i,"ghq-is-archived":l,"ghq-has-knowledge-sync-verifiers":m,"ghq-has-verification-accent":d});return n.createElement("div",{className:u},pe.ZP.HIDE_CARD_HEADER_NAV?null:n.createElement(Nd,{isTrustMenuOpen:t,setTrustMenuOpen:a}),n.createElement(dc,null))};const Td=e=>{let{creator:t,dateCreated:a,groups:r,id:s}=e;const{setActiveAnnouncement:i,setShowCommentsTray:o,showCommentsTray:l}=(0,n.useContext)(ye.ZP),c=gt.Z.getNameFromModel(t),d=gt.Z.getUsersInitials(t),m=r.map((e=>e.name)),u=bn(m);return n.createElement("div",{className:"ghq-CardAnnouncement"},n.createElement(it.ZP,{modifier:it.QV.Blank},n.createElement(it.R3,null,n.createElement("button",{className:"ghq-CardAnnouncement__trigger",onClick:()=>{i(s),l||o(!0)}},n.createElement(Zt.Z,{alt:"".concat(c,"'s profile picture"),size:28,src:t.profilePicUrl,initials:d},n.createElement("span",{className:"ghq-CardAnnouncement__content"},n.createElement("span",{className:"ghq-CardAnnouncement__title"},c,n.createElement(Zn.ZP,{bold:!0,size:Zn.n8.Small,type:Zn.Rt.Yolk},"Unread")),n.createElement("span",{className:"ghq-CardAnnouncement__metadata"},n.createElement(It.Z,{hideCurrentYear:!0,date:a}),"\u2022",n.createElement(fn.Z,{icon:nt.Z.MustReadFilled,size:14,color:wt.ZP.Twilight}),n.createElement("span",{className:"ghq-CardAnnouncement__recipients"},"To ",u)))),n.createElement(fn.Z,{icon:nt.Z.ChevronRight,size:18,color:wt.ZP.Twilight})))))};var Ad=()=>{const{knowledgeAlerts:e,setActiveAnnouncement:t,setShowCommentsTray:a,slug:r}=(0,n.useContext)(ye.ZP),s=(0,be.$B)("/card/".concat(r,"/announcements/:announcementId"));return(0,n.useEffect)((()=>{if(e.length>0){let n;n=null!=s&&s.isExact?s.params.announcementId:e[e.length-1].id,t(n),a(!0)}}),[]),n.createElement(n.Fragment,null,null==e?void 0:e.map((e=>n.createElement(Td,{creator:e.creator,dateCreated:e.dateCreated,groups:e.groups,id:e.id,key:e.id}))))},_d=a(70724),wd=a(91512),Dd=a(10744),Pd=a(17233);class kd extends n.Component{constructor(){super(...arguments),this.componentDidMount=()=>{const{kcsId:e,KCSCards:t}=this.props,a=this.findSource();t.status===oe.NOT_LOADED&&e&&a&&_d.Z.get(e,{queryParams:{conversationId:e,platform:a}})},this.findSource=()=>{const{hasSource:e}=this.props;switch(e){case ge.ZP.ZENDESK:return wd.gf;case ge.ZP.LIVEPERSON:return wd.hv;case ge.ZP.SALESFORCE:return wd.yP;default:return null}},this.handleChange=e=>{var t;const{kcsId:a,id:n,linkedCards:r,card:s,auth:i}=this.props,o=null!==(t=s.data.id)&&void 0!==t?t:n,l=this.findSource();e?_d.Z.post(a,{data:JSON.stringify({conversationId:a,platform:l,cardId:o}),success:()=>{r.some((e=>e.card.id===o))?_d.Z.replaceData(r,a):_d.Z.replaceData([{card:{...s.data,boards:Ai.Z.getByFactId(o).data},date:(new Date).toISOString(),user:i.data},...r.filter((e=>e.card.id!==o))],a)}}):_d.Z.delete(a,{pathVars:[o],queryParams:{conversationId:a,platform:l},success:()=>{_d.Z.replaceData(r.filter((e=>e.card.id!==o)),a)}})}}render(){const{kcsId:e,cardIsMarked:t,hasSource:a}=this.props;return null===e||!1===a?null:n.createElement("div",{className:"KCSToggle__wrapper","data-testid":"KCSToggle"},n.createElement("div",{className:"KCSToggle__option"},n.createElement(Os.Z,{label:"Link to ticket",name:"KCS-option",isChecked:t,onChange:this.handleChange}),n.createElement(at.ZP,{shape:at.e7.Round,style:at.Dd.Standard,tooltipPosition:at.DU.Right,aria:"kcsLinkToTicketInfo",icon:nt.Z.InformationCircle,tooltipLabel:"Link this Card to ticket #".concat(e," if it\n            helped you resolve the issue. This helps your team keep track\n            of ticket activity.")})))}}var Ld=(0,h.Z)(((e,t)=>{var a;const n=Pe.Z.getState(),{meta:{conversationId:r=null,source:s=null}}=Dd.Z.getFilter("KCSScrape"),i=Pd.Z.getFilter(r,E.GLOBAL),{items:{data:o=[]}}=i,l=null!==(a=t.card.data.id)&&void 0!==a?a:t.id;return{auth:n,kcsId:r,hasSource:s,cardIsMarked:o.some((e=>e.card.id===l)),linkedCards:o,KCSCards:i}}))([Dd.Z,Pd.Z,Pe.Z],kd);var Md=()=>{const{card:e,id:t,isArchived:a,canDrag:r}=(0,ye.RC)(),i=s()("ghq-CardHomeSidebar",{"ghq-is-disabled":a,"ghq-can-drag":r});return n.createElement("div",{className:i},Sr.Z.hasKCSReports()&&m.ZP.isExtension()&&n.createElement(Ld,{card:e,id:t}))},Od=a(77541),Fd=a(73727);function Rd(){return Rd=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},Rd.apply(this,arguments)}class xd extends n.Component{constructor(){super(...arguments),this.handleMouseEnter=e=>{this.props.showTooltip(e),this.props.onMouseEnter(e)},this.handleMouseLeave=e=>{this.props.hideTooltip(e),this.props.onMouseLeave(e)}}render(){const{children:e,to:t,tooltipIsOpen:a,showTooltip:r,hideTooltip:i,className:o,...l}=this.props,c=s()("ghq-UnstyledLink",o),d=s()("ghq-UnstyledLink","ghq-UnstyledLink--external",o),m=s()("ghq-UnstyledLink","ghq-UnstyledLink--internal",o);return t?t&&/^https?:\/\//.test(t)?n.createElement("a",Rd({href:t,target:"_blank",rel:"noopener noreferrer"},l,{className:d,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave}),e):n.createElement(Fd.rU,Rd({to:t},l,{className:m,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave}),e):n.createElement("span",Rd({},l,{className:c,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave}),e)}}var qd=(0,yn.Z)(xd);xd.defaultProps={onMouseEnter:()=>{},onMouseLeave:()=>{}};var Bd=a(93351),Vd=a(17029),Ud=a.n(Vd),Hd=a(43177),Wd=a(40780),Gd=a(36831);var zd=tr()({displayName:"TagChipInput",mixins:[(0,ar.Z)(Gd.Z)],propTypes:{tags:D().array.isRequired,removeTag:D().func.isRequired,addTag:D().func.isRequired,createTag:D().func,onInputChange:D().func,pickCategories:D().bool,usedCategories:D().bool,focusOnMount:D().bool},getDefaultProps:()=>({tags:[],onInputChange:()=>{},noMatchCreate:!1,pickCategories:!1,focusOnMount:!1,inputPlaceHolderText:"Add existing tags, or create a new one"}),getInitialState:()=>({inputValue:"",prevTagOrder:[]}),getStateFromFlux(){const{usedCategories:e}=this.props;let t;return t=e?Gd.Z.getUsedCategories():Gd.Z.getCategories(),{categories:t}},componentDidMount(){const{usedCategories:e}=this.props;e?Wd.Z.loadUsedTagCategories():Wd.Z.loadTagCategories()},UNSAFE_componentWillReceiveProps(){const{tags:e}=this.props,t=this.updateTagOrder(this.tagsToCorrectFormat(e));this.setState({prevTagOrder:t.map((e=>e.label))})},filterMenuItems:e=>e.menuItems,updateTagOrder(e){const{prevTagOrder:t}=this.state,a=e.length>t.length;if(a&&0===t.length)return e;a&&e.some((e=>!t.includes(e.label)&&(t.push(e.label),!0)));return e.sort(((e,a)=>t.indexOf(e.label)<t.indexOf(a.label)?-1:1))},handleInputChange(e){const{onInputChange:t}=this.props;this.setState({inputValue:e}),t(e)},handleClearInput(){this.setState({inputValue:""})},categoryTagsToMenuItems(e){const{tags:t}=this.props,a=[];return e.data.forEach((e=>{const n={label:e.name,value:e.id,id:e.id,type:"menu-header"};a.push(n),e.tags&&e.tags.forEach((e=>{if(t.some((t=>t.id===e.id)))return;const n={label:"".concat(e.value),value:e.id,type:"menu-item",meta:{label:e.value,id:e.id,removeChip:this.props.removeTag,chipType:"tag"}};a.push(n)}))})),a},categoryToMenuItems(e){return e.data.map((e=>({label:e.name,value:e.id,type:"menu-item",icon:"folder",meta:{label:e.name,id:e.id,removeChip:this.props.removeTag}})))},tagsToCorrectFormat(e){return e.map((e=>e.label?(e.removeChip=this.props.removeTag,e):{label:e.value,value:e.id,id:e.id,categoryName:e.categoryName,categoryId:e.categoryId,type:"menu-item",removeChip:this.props.removeTag}))},getDefaultCategoryId(){var e;const{categories:t}=this.state;return null===(e=t.data.find((e=>e.defaultCategory)))||void 0===e?void 0:e.id},handleMenuItemSelect(e){const{addTag:t}=this.props;if("notexactmatch"===e.key)this.handleNotExactMatchInput();else if(t&&e.meta){const{removeChip:a,...n}=e.meta;t(n)}},handleNotExactMatchInput(){const{inputValue:e}=this.state,{createTag:t}=this.props;_i.Z.hasPermission(ai.Z.CAN_CREATE_TAG)&&t(this.getDefaultCategoryId(),e)},renderNotExactMatch(){const{inputValue:e}=this.state,{createTag:t,tags:a}=this.props,r=_i.Z.hasPermission(ai.Z.CAN_CREATE_TAG),s=a.find((t=>t.value===e));if(!t||s)return null;let i="Create new tag named ".concat(e,"?");r||(i="Contact an admin to create this tag.");return{rawContent:n.createElement("div",null,n.createElement("div",null,n.createElement("span",null,"Tag not found ")),n.createElement("div",{className:"ghq-chip-input-not-found-message"},n.createElement("span",null,i))),type:"menu-item",key:"notexactmatch"}},render(){const{noResultsItem:e,refKey:t,tags:a,pickCategories:r,isDisabled:s,allowMultiple:i,focusOnMount:o,inputPlaceHolderText:l,onMount:c}=this.props,{inputValue:d,categories:m}=this.state,u=this.renderNotExactMatch(),h=this.tagsToCorrectFormat(a),p=this.updateTagOrder(h),g=r?this.categoryToMenuItems(m):this.categoryTagsToMenuItems(m);return n.createElement("div",null,n.createElement(Ni.Z,{chips:i?p:[],isDisabled:s,handleAction:()=>{},handleInputChange:this.handleInputChange,handleMenuItemSelect:this.handleMenuItemSelect,inputPlaceHolderText:l,inputPlaceHolderIcon:"search",inputValue:d,clearInput:this.handleClearInput,menuItems:g,refKey:t+"TagPickerChipInput",notExactMatchItem:u,noResultsItem:e,focusOnMount:o,onMount:c}))}});class Yd extends n.Component{constructor(){super(...arguments),this.createTag=(e,t)=>{const{fact:a,onNewTag:n}=this.props,r={tagValue:t,factId:a.id,categoryId:e,removeTag:this.removeTag};a.action===oe.NEW&&d.Z.mergeMeta(a.id,{selectedTags:[...o()(a,"meta.selectedTags",[]),{type:null,value:t,isNew:!0}]}),d.Z.startCreateTag(r),n&&n()},this.addTag=e=>{const{fact:t,save:a}=this.props,n=t.editFact.data.tags||[],r=Cr()(n);r.push(e),a?d.Z.addTag(t.id,e.id):(d.Z.mergeMeta(t.id,{selectedTags:[...o()(t,"meta.selectedTags",[]),{type:o()(e,"type",null),value:e.label,isNew:!1,id:e.id}]}),d.Z.setTags(t.id,r))},this.removeTag=e=>{const{fact:t,save:a}=this.props,n=(t.editFact.data.tags||[]).filter((t=>t.id!==e));a?d.Z.removeTag(t.id,e):d.Z.setTags(t.id,n)},this.trackTagsMenuOpened=()=>{const{fact:e}=this.props;if(e.action===oe.NEW&&!Boolean(e.meta.isTemplate)){const t=JSON.stringify([{featureName:Na.Z.AIS_TAGS,activitySubType:Pt.default.TAGS_DROPDOWN_OPENED,data:{suggestionId:null,task:oe.Activities.CARD_CREATION}}]);M.Z.postActivity({type:Pt.default.TAGS_DROPDOWN_OPENED,properties:{factId:e.id},biOnly:!0},{headers:{[re.Kg]:t}})}}}renderCurrentTagChips(){const{fact:e}=this.props;return(e.editFact.data.tags||[]).map((e=>{let{value:t,label:a,id:r}=e;return n.createElement(fi.Z,{className:"ghq-tag-chip",id:r,key:r,label:t||a,removeChip:this.removeTag})}))}render(){const{fact:e,isDisabled:t,className:a}=this.props,r="tagChipInput-"+e.id,i=s()("ghq-fact-tags-container",a);return n.createElement("div",{className:i},n.createElement(zd,{tags:e.editFact.data.tags,isDisabled:t,removeTag:this.removeTag,createTag:this.createTag,addTag:this.addTag,refKey:r,noResultsItem:null,onMount:this.trackTagsMenuOpened}),n.createElement("div",{className:"ghq-fact-tags__current-tags"},this.renderCurrentTagChips()))}}Yd.propTypes={fact:D().object.isRequired,save:D().bool};var Kd=Yd;function jd(){return jd=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},jd.apply(this,arguments)}class Jd extends n.Component{constructor(){super(...arguments),this.state={showButton:!1,showMenu:!1,expanded:!1},this.searchForTag=e=>{const t=m.ZP.isExtension()?Ud().EXT_MAIN:Ud().APP_MAIN;Od.Z.setSearchParams(t,[{type:Bd.ZP.TAG,value:e}]),Od.Z.search(t)},this.showButton=()=>this.setState((()=>({showButton:!0}))),this.hideButton=()=>this.setState((e=>e.showMenu?null:{showButton:!1})),this.toggleMenu=()=>this.setState((e=>({showMenu:!e.showMenu}))),this.closeMenu=()=>this.setState((e=>e.showMenu?{showMenu:!1,showButton:!1}:null)),this.toggleExpanded=()=>this.setState((e=>({expanded:!e.expanded}))),this.handleClickOutside=()=>this.closeMenu(),this.setCardTagbarRef=e=>this.edit=e,this.renderExpandTab=()=>{const{expanded:e}=this.state;return n.createElement("div",{className:"ghq-CardTagbar__expand-tab",onClick:this.toggleExpanded},n.createElement("span",null,e?"Show Less":"Show More"),n.createElement(Xe.Z,{className:"ghq-CardTagbar__expand-tab-icon",size:12,icon:e?"chevron-down":"chevron-up"}))}}static getDerivedStateFromProps(e,t){return!e.expandable&&t.expanded?{expanded:!1}:null}render(){const{tags:e,canEditTags:t,isArchived:a,isMenuLocked:r,expandable:i,canDrag:o,__compatProps:l}=this.props,{showButton:c,showMenu:d,expanded:u}=this.state,h=s()("ghq-CardTagbar",{"ghq-is-expanded":u,"ghq-can-drag":o}),p=s()("ghq-CardTagbar__edit-button",{"ghq-is-shown":c&&t,"ghq-is-active":d});return n.createElement("div",{className:h,onMouseEnter:this.showButton,onMouseLeave:this.hideButton},n.createElement("div",{className:"ghq-CardTagbar__tag-icon"},n.createElement(Xe.Z,{icon:"tag",size:18})),n.createElement("div",{className:"ghq-CardTagbar__tags",ref:e=>this.tags=e},n.createElement(Zn.KL,null,e.map((e=>{let{value:t,id:a}=e;return n.createElement(Zn.ZP,{withBorder:!0,key:a,title:t,onClick:()=>this.searchForTag({label:t,id:a})},t)})))),i&&this.renderExpandTab(),n.createElement("div",{className:"ghq-CardTagbar__edit",ref:this.setCardTagbarRef},!a&&n.createElement(We.Z,{small:!0,className:p,icon:"pencil",iconSize:14,onClick:this.toggleMenu}),d&&n.createElement(Xn.Z,{poll:!0,lockX:r,target:this.edit,preferredXPosition:"center",preferredYPosition:"top"},n.createElement("div",{className:"ghq-CardTagbar__menu"},n.createElement(ei,{renderTitle:()=>"Edit Tags",renderContent:()=>n.createElement(Kd,jd({save:!0,onNewTag:this.closeMenu},l)),renderFooter:()=>n.createElement("div",{className:"ghq-CardTagbar__footer"},n.createElement(qd,{to:"".concat(pe.ZP.APP_URL,"/settings/tag-management"),target:"_blank",className:"ghq-CardTagbar__footer-link"},"Manage all tags",n.createElement("span",null,n.createElement(Xe.Z,{className:"ghq-CardTagbar__icon",icon:"launch",size:12})))),onClickClose:this.closeMenu,onClickOutside:this.closeMenu})))),m.ZP.isExtension()&&n.createElement(Xe.Z,{className:"ghq-factcard__resize",icon:"resize",size:12}))}}var Qd=(0,ye.ey)((0,h.Z)((function(e,t){let{id:a}=t;const n=Be.Z.getByFactId(a);return{tags:o()(pa.ZP.getById(a),"data.tags",[]),canEditTags:n.canEditTags,isMenuLocked:!pa.ZP.getState().dragging}}))([pa.ZP,Be.Z],(0,ve.Z)((0,Hd.Z)((function(e,t){if(!t.tags)return;const a=t.tags.offsetHeight<t.tags.scrollHeight,n=t.tags.offsetHeight<=20;return t.state.expanded&&n?{expandable:!1}:t.state.expanded&&!a?{expandable:!0}:{expandable:a}}),Jd,{interval:1e3})))),Xd=a(19883),$d=a(25108);const em=new p.Z({name:Xd.Z.getName()}),tm=g.Z.getFlux().actions[em.name];tm||$d.error("error creating actions");var am=tm;const nm="SINGLELINE",rm="MULTILINE";function sm(e){const{onClose:t,id:a}=e,[r]=He(Pe.Z.getTeamId()),[i,l]=function(e){const[t,a]=(0,T.Z)({filterId:e,store:Xd.Z,actions:am,onMustLoad:t=>e&&t.get({pathVars:[e]})});return[t,a]}(a),[c,d]=n.useState({}),u=s()("ghq-CardAttributes",{"ghq-CardAttributes__extension":m.ZP.isExtension()}),h=(e,t)=>{d({...c,[e]:t})},p=()=>{const e={cardAttributeValues:[]};for(let t in c)e.cardAttributeValues.push({cardAttributeId:t,content:c[t]});l.put({pathVars:[a],data:JSON.stringify(e),success:()=>{l.clearStore()},error:()=>{}}),t()};return n.createElement("div",{className:u},n.createElement(ei,{renderTitle:()=>"Card Attributes",renderContent:()=>{if(r.status===le().LOADED&&i.status===le().LOADED){const e={};r.items.data.map((t=>e[t.id]={title:t.content,type:t.type})),i.items.data.map((t=>e[t.cardAttributeId].content=t.content));const t=[];for(let a in e)t.push(n.createElement("div",{className:"ghq-CardAttributes__input-section"},n.createElement("div",{className:"ghq-CardAttributes__input-title"},e[a].title),e[a].type===nm&&n.createElement(tl.Z,{className:"ghq-CardAttributes__input",id:a,type:"text",value:o()(c,"".concat(a),e[a].content),handleInputChange:h}),e[a].type===rm&&n.createElement(tl.Z,{className:"ghq-CardAttributes__text-area",id:a,rows:3,textarea:!0,type:"text",value:o()(c,"".concat(a),e[a].content),handleInputChange:h})));return n.createElement("div",{className:"ghq-CardAttributes__content"},n.createElement("div",null,t))}return n.createElement("div",{className:"ghq-CardAttributes__loader"},n.createElement("sageLoader",null))},renderFooter:()=>n.createElement("div",{className:"ghq-CardAttributes__footer"},n.createElement(We.Z,{negative:!0,value:"Cancel",onClick:t}),n.createElement(We.Z,{primary:!0,value:"Save",onClick:p})),onClickClose:t,onClickOutside:t}))}function im(e){const{id:t,onClose:a}=e,[r]=He(Pe.Z.getTeamId()),[i,l]=n.useState({}),c=s()("ghq-CardAttributes",{"ghq-CardAttributes__extension":m.ZP.isExtension()}),u=(e,a)=>{const n={...i,[e]:a};l(n),d.Z.setCardAttributes(t,n)};return n.createElement("div",{className:c},n.createElement(ei,{renderTitle:()=>"Card Settings",renderContent:()=>{if(r.status===le().LOADED){const e=r.items.data.map((e=>n.createElement("div",{className:"ghq-CardAttributes__input-section"},n.createElement("div",{className:"ghq-CardAttributes__input-title"},e.content),e.type===nm&&n.createElement(tl.Z,{className:"ghq-CardAttributes__input",id:e.id,type:"text",value:o()(i,"".concat(e.id),""),handleInputChange:u}),e.type===rm&&n.createElement(tl.Z,{className:"ghq-CardAttributes__text-area",id:e.id,rows:3,textarea:!0,type:"text",value:o()(i,"".concat(e.id),""),handleInputChange:u}))));return n.createElement("div",{className:"ghq-CardAttributes__content"},n.createElement("div",{className:"ghq-CardAttributes__title"},"CARD ATTRIBUTES"),n.createElement("div",null,e))}return n.createElement("div",{className:"ghq-CardAttributes__loader"},n.createElement(Nt.ZP,null))},onClickClose:a}))}sm.propTypes={id:D().string.isRequired,onClose:D().func},sm.defaultProps={onClose:()=>{}},im.propTypes={id:D().string.isRequired,onClose:D().func};var om=a(56893),lm=a(64925);f.Z.register(E.CardsRelated,{GET:{path:"/cards/:cardId/related"}});const cm=new C.Z({name:E.CardsRelated,dataType:E.OBJECT,syncFilters:!1});cm.createStore();var dm=g.Z.addStore(cm.store),mm=a(25108);const um=new p.Z({name:dm.getName()}),hm=g.Z.getFlux().actions[um.name];hm||mm.error("error creating actions");var pm=hm;var gm=a(28449);var fm=e=>{let{parentCardId:t}=e;const[a]=function(e){return(0,T.Z)({filterId:e,store:dm,actions:pm,onMustLoad:t=>{t.get({pathVars:[e]})}})}(t),{data:{cards:r=[],version:s,suggestionId:i},status:o}=a,l=n.useContext(ye.ZP),c=pe.ZP.USE_EMBEDDED_GURU||(0,gm.V)();if(o!==u.S.Loaded||0===r.length||c)return null;const h=m.ZP.isExtension()||!(null!=l&&l.isMaximized);return n.createElement("aside",{className:"ghq-CardsRelatedView"},n.createElement(gn.ZP,{spacing:gn.sJ.Tall},n.createElement(ja.ZP,{level:ja.Yx.H2,style:ja.VH.Small},"Users who viewed this Card also viewed:"),n.createElement(es.Z,{marker:es.Z.markers.DISC,spacing:es.Z.spaces.NONE},r.map(((e,a)=>n.createElement(es.H,{key:e.id},n.createElement(Sn.Z,{to:"".concat(m.ZP.isExtension()?"https://app.getguru.com":"","/card/").concat(e.slug),normal:!0,type:Sn.q.HighPriority,onClick:h?()=>((e,a)=>{d.Z.openFact(e,{maximized:!m.ZP.isExtension(),activity:le().Activities.RELATED,activityId:t,headers:{[re.vz]:a,[re.je]:s,[re.m6]:i},meta:{relatedCardMeta:{relatedCardPosition:a,relatedCardVersion:s,relatedCardParentId:t,relatedCardSuggestionId:i}}})})(e.id,a):null},e.preferredPhrase)))))))},Em=a(40590);class vm extends n.Component{constructor(){super(...arguments),this.renderBreadcrumb=()=>{const{fact:e,hasBreadcrumbs:t}=this.props,a=o()(e,"data.id",e.id);return t?n.createElement("div",{className:"ghq-fact-content__bread-crumb"},n.createElement(lm.Z,{clickable:!0,id:a,collectionName:e.data.collection.name,collectionColor:e.data.collection.color,collectionSlug:e.data.collection.slug,renderEmpty:()=>n.createElement("span",{className:"ghq-CardBreadcrumb__no-boards"}," \u203a ",n.createElement("span",{className:"ghq-CardBreadcrumb__no-boards-text"},"not on a Board"))})):null},this.onCopy=e=>{const{fact:t}=this.props;if(t.action===oe.EDITING||t.action===oe.NEW)return;const a={};t.activity===oe.Activities.RELATED&&(a.headers={[re.s3]:o()(t,"meta.relatedCardMeta.relatedCardParentId",null),[re.eB]:oe.Activities.RELATED,[re.vz]:o()(t,"meta.relatedCardMeta.relatedCardPosition",null),[re.je]:o()(t,"meta.relatedCardMeta.relatedCardVersion",null),[re.m6]:o()(t,"meta.relatedCardMeta.relatedCardSuggestionId",null)}),zo.Z.copyCardEvent(e,t.data.id,t.activity,t.activityId,a)},this.renderReadOnlyFactEditor=()=>{const{fact:e}=this.props,t=e.data.content,a=e.data.cardType===oe.FILE;return t||a?n.createElement(om.Z,{readOnly:!0,id:e.id,renderHeader:this.renderBreadcrumb,fact:e}):null}}componentDidMount(){const{fact:e,boardStatus:t}=this.props;t===oe.NOT_LOADED&&e.data.id&&Zi.Z.loadFactBoards(e.data.id)}componentDidUpdate(){const{fact:e,boardStatus:t}=this.props;t===oe.NOT_LOADED&&e.data.id&&Zi.Z.loadFactBoards(e.data.id)}render(){const{fact:e}=this.props,t=o()(e,"data.id",null)?n.createElement(fm,{parentCardId:e.data.id}):null;if(e.action===oe.NEW)return null;const a=this.renderReadOnlyFactEditor();return n.createElement(n.Fragment,null,a,t)}}var Cm=(0,h.Z)((function(e,t){const{fact:a}=t,n=Ai.Z.getByFactId(a.data.id);return{contentConversionSpotCheckFollower:Em.Z.getFilter(E.GLOBAL).data.contentConversionSpotCheckFollower,boards:n.data,boardStatus:n.status,hasBreadcrumbs:!0}}))([Ai.Z,Sr.Z,Em.Z],vm);class ym extends n.Component{constructor(e){super(e),this.statsTriggerRef=void 0,this.statsTriggerRef=n.createRef()}render(){const{id:e,__compatProps:t,history:a,hasAnnouncementsInComments:r,hasCardAttributes:i,hasKnowledgeAlerts:l,knowledgeAlerts:c,slug:m}=this.props,{fact:u}=t,h=s()("ghq-CardHome__constrained-width-scrolled",{"ghq-is-mobile":(0,us.tq)()}),p=(0,be.LX)(a.location.pathname,{path:"/card/".concat(m,"/announcements/:announcementId/insight")}),g=o()(u,"data.collection.roiEnabled",!1)&&u.messageKey===Ee().messageKey.ROI&&n.createElement(Zl,{fact:u}),f=u.messageKey===Ee().messageKey.CARD_ATTRIBUTE&&n.createElement(sm,{id:u.data.id,onClose:()=>d.Z.finishCardAttribute(e)}),E=s()("ghq-CardHome",{"ghq-is-pop-up":!(0,us.tq)()});return n.createElement("div",{className:E},null!=p&&p.isExact?n.createElement(hn,{announcementId:p.params.announcementId,triggerRef:this.statsTriggerRef,onClose:()=>a.push({pathname:"/card/".concat(m)})}):null,g,i&&f,n.createElement("div",{className:"ghq-CardHome__body"},n.createElement(Md,null),n.createElement("div",{className:"ghq-CardHome__full-width-scroller"},l&&c.length>0&&r?n.createElement("div",{className:"ghq-CardHome__announcements"},n.createElement(Ad,null)):null,n.createElement("div",{className:h},n.createElement(Cm,t)))),n.createElement(Qd,null))}}var bm=(0,h.Z)((()=>({hasCardAttributes:Sr.Z.hasCardAttributes(),hasKnowledgeAlerts:Sr.Z.hasKnowledgeAlerts(),hasAnnouncementsInComments:Sr.Z.hasAnnouncementsInComments()})))([Sr.Z],(0,be.EN)((0,ye.ey)(ym))),Sm=a(60644);f.Z.register(E.AssistFeedback,{POST:{path:"/assist/feedback"}});const Zm=new C.Z({dataType:E.OBJECT,name:E.AssistFeedback});Zm.createStore();var Nm=g.Z.addStore(Zm.store),Im=a(25108);const Tm=new p.Z({name:Nm.getName()}),Am=g.Z.getFlux().actions[Tm.name];Am||Im.error("error creating actions");var _m=Am,wm=a(25108);const Dm=e=>{if(e===E.Assist)return E.GLOBAL;wm.error("filter not set")};class Pm extends n.PureComponent{constructor(e){super(e),this.onSubmitFeedback=()=>{this.setState({feedbackType:"positive",feedbackNote:"This suggestion was helpful"},this.onComplete)},this.onSubmitAdditionalFeedback=e=>{e.preventDefault(),this.onComplete()},this.onComplete=()=>{const{feedbackNote:e,feedbackType:t}=this.state,{factId:a,suggestionId:n,onFeedbackComplete:r}=this.props;d.Z.mergeMeta(a,{agentAssistFeedbackStage:null}),_m.post(E.GLOBAL,{data:JSON.stringify({feedbackType:t,comment:e,cardId:a,suggestionId:n}),success:()=>{r(),this.setState({feedbackComplete:!0})}})},this.onToggleAdditionalFeedback=()=>{d.Z.mergeMeta(this.props.factId,{agentAssistFeedbackStage:ge.Mz}),this.setState({additionalFeedback:!this.state.additionalFeedback,feedbackType:"negative"})},this.handleAdditionalFeedbackMenuItemSelect=e=>{d.Z.mergeMeta(this.props.factId,{agentAssistFeedbackStage:ge.Mz}),this.setState({selectedItem:e,showInput:!1,feedbackNote:e.label}),"Other"===e.label&&(d.Z.mergeMeta(this.props.factId,{agentAssistFeedbackStage:ge.eD}),this.setState({showInput:!0}))},this.renderOtherSuggestionInput=()=>{const{factId:e}=this.props;return n.createElement(tl.Z,{id:"OtherSuggestion-"+e,type:"text",className:"ghq-SuggestionFeedback__input",value:this.state.inputValue,handleInputChange:this.handleChange})},this.handleChange=(e,t)=>{this.setState({feedbackNote:t,inputValue:t})},this.renderSuggestionFeedbackQuestion=()=>{const{feedbackComplete:e,additionalFeedback:t}=this.state;return e||t?null:n.createElement("div",{className:"ghq-SuggestionFeedback__content"},n.createElement("span",{className:"ghq-SuggestionFeedback__text"},"Was this suggestion helpful?"),n.createElement(We.Z,{className:"ghq-SuggestionFeedback__button",value:"yes",icon:"thumbs-up",iconSize:20,onClick:this.onSubmitFeedback}),n.createElement(We.Z,{className:"ghq-SuggestionFeedback__button",value:"no",icon:"thumbs-down",iconSize:20,onClick:this.onToggleAdditionalFeedback}))},this.renderFeedbackQuestion=()=>{const{factId:e}=this.props,{feedbackComplete:t,additionalFeedback:a}=this.state,r=this.state.selectedItem,s=this.state.showInput?this.renderOtherSuggestionInput():null;return!a||t?null:n.createElement("div",{className:"ghq-SuggestionFeedback__additional"},n.createElement("div",{className:"ghq-SuggestionFeedback__text"},"Well, shucks. Sorry to hear that we weren't much help."),n.createElement("div",{className:"ghq-SuggestionFeedback__text"},"Let us know why so we can continue to improve this feature"),n.createElement("form",{className:"ghq-SuggestionFeedback__form",onSubmit:this.onSubmitAdditionalFeedback},n.createElement(et.Z,{items:[{label:"The content on this Card was not relevant",type:"menu-item"},{label:"I already used this Card in this conversation",type:"menu-item"},{label:"Other",type:"menu-item"}],selectedItem:r,className:"ghq-SuggestionFeedback__select-box",refKey:"SuggestionFeedback-"+e,handleItemClick:this.handleAdditionalFeedbackMenuItemSelect}),n.createElement(We.Z,{branded:!0,className:"ghq-SuggestionFeedback__submit-button",icon:"check",iconSize:20,type:"submit"}),n.createElement(We.Z,{tertiary:!0,className:"ghq-SuggestionFeedback__back-button",icon:"close",iconSize:20,onClick:this.onToggleAdditionalFeedback}),s))},this.renderFeedbackCompleteMessage=()=>{const{feedbackComplete:e,feedbackType:t}=this.state,a="positive"===t?"Thanks for the feedback! Glad we could help.":"Thanks for the feedback!";return e?n.createElement("div",{className:"ghq-SuggestionFeedback__content"},a):null},this.renderFeedback=e=>n.createElement("div",{className:"ghq-SuggestionFeedback ghq-is-".concat(e)},this.renderSuggestionFeedbackQuestion(),this.renderFeedbackQuestion(),this.renderFeedbackCompleteMessage()),this.timeout={enter:0,exit:2500},this.state={additionalFeedback:!1,feedbackComplete:!1,showInput:!1,feedbackNote:"",feedbackType:"",inputValue:""}}UNSAFE_componentWillMount(){const{factId:e}=this.props;d.Z.mergeMeta(e,{agentAssistFeedbackStage:ge.Jf})}componentWillUnmount(){const{factId:e}=this.props;d.Z.mergeMeta(e,{agentAssistFeedbackStage:null})}render(){return n.createElement(Sm.default,{unmountOnExit:!0,in:this.props.in,timeout:this.timeout},this.renderFeedback)}}Pm.propTypes={onFeedbackComplete:D().func,factId:D().string},Pm.defaultProps={onFeedbackComplete:()=>{}};var km=(0,h.Z)((()=>({suggestionId:Dd.Z.getFilter(Dm(E.Assist)).data.suggestionId})),Dm)([Dd.Z],Pm),Lm=a(51644);var Mm=function(e){const{title:t,fact:a,onActionComplete:r,type:s}=e,i=_i.Z.hasPermission(ai.Z.CAN_EDIT_FACT,o()(a,"data.collection.id")),l=o()(a,"data.collection.collectionType","")===Lm.Z.EXTERNAL;return n.createElement("div",{className:"ghq-DuplicateCardsCardActions"},n.createElement("span",{className:"ghq-DuplicateCardsCardActions__title"},"".concat(t,": ")),!l&&i&&n.createElement(n.Fragment,null,n.createElement("span",{className:"ghq-DuplicateCardsCardActions__edit",onClick:function(){d.Z.setAction(a.id,le().EDITING,{needsEditFact:!0}),d.Z.mergeMeta(a.id,{editTrackingEvent:Pt.default.KNOWLEDGE_DUPE_CARD_EDITED}),r()}},n.createElement(Xe.Z,{icon:"pencil",size:14}),n.createElement("span",null,"Edit")),n.createElement("span",{className:"ghq-DuplicateCardsCardActions__archive",onClick:function(){d.Z.startCustomConfirmKey(a.id,s===Ee().knowledgeDuplicates.PRIMARY?Ee().knowledgeDuplicates.ARCHIVE_PRIMARY:Ee().ARCHIVE),r()}},n.createElement(Xe.Z,{icon:"archive",size:14}),n.createElement("span",null,"Archive"))),n.createElement("span",{className:"ghq-DuplicateCardsCardActions__dismiss",onClick:function(){d.Z.startCustomConfirmKey(a.id,s===Ee().knowledgeDuplicates.PRIMARY?Ee().knowledgeDuplicates.DISMISS_PRIMARY:Ee().knowledgeDuplicates.DISMISS_SECONDARY),r()}},n.createElement(Xe.Z,{icon:"circle-x",size:14}),n.createElement("span",null,"Dismiss")),l&&n.createElement("span",{className:"ghq-DuplicateCardsCardActions__synced"},"This is a Synced Card that has limited available actions."))};function Om(){const e=n.useContext(ye.ZP),[t,a]=n.useState(!1),r=("view"===(s=e.card).action||null==s.action)&&null==s.messageKey;var s;return e.activity===le().Activities.AGENT_ASSIST_SUGGESTION&&t?n.createElement(km,{factId:e.id,onFeedbackComplete:()=>{a(!1)}}):e.activity===le().Activities.DUPLICATE_CARDS_PRIMARY&&r?n.createElement(Mm,{title:"Primary Card Actions",fact:e.card,type:"primary",onActionComplete:()=>{a(!1)}}):e.activity===le().Activities.DUPLICATE_CARDS_SECONDARY&&r?n.createElement(Mm,{title:"Duplicate Card Actions",fact:e.card,type:"secondary",onActionComplete:()=>{a(!1)}}):null}var Fm=a(59704),Rm=a.n(Fm),xm=a(17563),qm=a(40413),Bm=a(25108);class Vm extends n.Component{constructor(e){super(e),this.state={cardDiffOpen:!1},this.toggleTrustMenu=()=>this.props.setTrustMenuOpen(!this.props.isTrustMenuOpen),this.escKeyPress=e=>{"Escape"===e.key&&(this.setState({cardDiffOpen:!1}),e.stopPropagation())},this.openCardDiffModal=()=>{this.cardRef.current.addEventListener("keydown",this.escKeyPress),this.setState({cardDiffOpen:!0})},this.closeCardDiffModal=()=>{this.cardRef.current.removeEventListener("keydown",this.escKeyPress,!0),this.setState({cardDiffOpen:!1})},this.showDiff=()=>{const{id:e,lastTrustedVersion:t,currentVersion:a}=this.props;Fr.Z.addCardDiff(e,t,a),this.openCardDiffModal()},this.cardRef=n.createRef()}componentDidMount(){this.props.onMount()}componentDidUpdate(){this.props.onUpdate()}render(){const{cardDiffOpen:e}=this.state,{reason:t,loading:a,currentVersion:r,lastTrustedVersion:s,isUntrusted:i,onHandleVerify:o,showUpdateIntervalButton:l}=this.props;return a?null:n.createElement("div",{className:"ghq-CardUntrustedPrompt",ref:this.cardRef},n.createElement("div",{className:"CardUntrustedPrompt__current-changes"},n.createElement("div",null,t),r!==s&&-1!==r&&-1!==s&&i&&n.createElement("div",{className:"CardUntrustedPrompt__view-current-changes"},n.createElement(Sn.Z,{normal:!0,type:Sn.q.HighPriority,label:"View changes",to:"!#",onClick:this.showDiff},"View changes"))),n.createElement("div",{className:"ghq-CardUntrustedPrompt__buttons"},n.createElement("div",{className:"ghq-CardUntrustedPrompt__button"},l?n.createElement(ft.ZP,{size:ft.qE.Small,theme:ft.bn.Destructive,label:"Update Interval",onClick:this.toggleTrustMenu}):n.createElement(ft.ZP,{size:ft.qE.Small,theme:ft.bn.Destructive,label:"Verify",onClick:o}))),e&&n.createElement(Ur.Z,{onClose:this.closeCardDiffModal}))}}const Um=e=>{let{verificationReasons:t=[],verificationType:a}=e;return t.includes(le().EXPIRED)&&a===Ee().verificationIntervalType.ABSOLUTE};function Hm(e,t){if(!e)return"";const{verificationReason:a,lastModified:r,lastVerified:s,nextVerificationDate:i,verificationType:o}=e.data,l=Te()(r).format("MMM D, YYYY"),c=o===Ee().verificationIntervalType.ABSOLUTE?Te().utc(i).format("MMM D, YYYY"):Te()(i).format("MMM D, YYYY"),d=e.data||e,m=Te().utc(d.verificationInitiationDate).format("MMM D, YYYY"),u=gt.Z.getPersonalName(d.verificationInitiator),h=gt.Z.getPersonalName(d.lastModifiedBy),p="This Card is unverified.";return s?a===le().UPDATE?n.createElement("p",null,n.createElement("strong",null,p),n.createElement("br",null),n.createElement("em",null,h," edited it on ",l)):a===le().NEW_VERIFIER?n.createElement("p",null,n.createElement("strong",null,p),n.createElement("br",null),n.createElement("em",null,u," reassigned this Card to ",t," on ",m,".")):a===le().REQUESTED?n.createElement("p",null,n.createElement("strong",null,p),n.createElement("br",null),n.createElement("em",null,"Verification requested by ",u," on ",m,".")):a||o!==Ee().verificationIntervalType.ABSOLUTE?a?void 0:n.createElement("p",null,n.createElement("strong",null,p),n.createElement("br",null),n.createElement("em",null,"It expired on ",c,".")):n.createElement("p",null,n.createElement("strong",null,p),n.createElement("br",null),n.createElement("em",null,"It expired on ",c,".")," ",n.createElement("br",null),n.createElement("em",null,"You\u2019ll need to schedule a new verification interval before Verifying.")):"".concat(p," ").concat(t," ").concat("you"===t?"haven't":"hasn't"," verified it since it was created.")}function Wm(e,t){let{verifiers:a,history:n}=t;n&&n.status!==le().NOT_LOADED||Rr.Z.loadCardHistory(e),a.status===le().NOT_LOADED&&Y.Z.loadVerifiers(e)}var Gm=(0,ye.ey)((0,h.Z)((function(e,t){var a;let{id:n}=t;const r=Hr.Z.getById(n),s=pa.ZP.getById(n),i=qm.Z.getFilter(E.FactsFeaturedUnverified===E.FactsFeaturedUnverified?E.GLOBAL:void Bm.error("filter not set")),l=nd.Z.getBySearchId(n),c=o()(s,"activity","")===Pt.default.FEATURED_CARDS_SUGGESTED,{source:m,type:u}=xm.parse(location.search),h=o()(l,"editData[0]",{}),p="user-group"===h.type?"your group, ".concat(o()(h,"userGroup.name",""),","):gt.Z.getPersonalName(h.user),g=[o()(i.data,"mostPopular",{}),o()(i.data,"longestOverdue",{}),o()(i.data,"highAlert",{}),o()(i.data,"exclusivelyYours",{})],f=Rm()(g,{id:n});return{onMount:()=>Wm(n,{verifiers:l,history:r}),onUpdate:()=>Wm(n,{verifiers:l,history:r}),onHandleVerify:()=>function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{source:a,type:n,isFeatured:r,isInFeaturedCards:s}=t;let i=null;r&&(i={[re.eB]:Pt.default.FEATURED_CARDS_SUGGESTED}),s&&n&&(i={[re.eB]:n});const o=a?{[re.WI]:a}:null,l={headers:{...i,...o}};d.Z.verifyFact(e,l)}(n,{isFeatured:c,isInFeaturedCards:f,source:m,type:u}),source:m,type:u,loading:l.status!==le().LOADED,reason:Hm(s,p),currentVersion:o()(r,"data.cardVersions[0].version",-1),lastTrustedVersion:o()(r,"data.lastVerified.data.version",-1),showUpdateIntervalButton:Um(null!==(a=null==s?void 0:s.data)&&void 0!==a?a:{})}}))([pa.ZP,Hr.Z,nd.Z],Vm)),zm=(a(27207),a(50361)),Ym=a.n(zm),Km=a(16897),jm=a(25108);const Jm=g.Z.getFlux().dispatcher,Qm=new Kt.Z({name:E.FactEditor,boundActions:{redoFactEditor(e,t){Jm.dispatch({type:Wt.REDO_FACT_EDITOR,payload:{filterId:e,opts:t}})},undoFactEditor(e,t){Jm.dispatch({type:Wt.UNDO_FACT_EDITOR,payload:{filterId:e,opts:t}})},updateFactEditor(e,t,a){Jm.dispatch({type:"".concat(Wt.UPDATE_FACT_EDITOR_).concat(t),payload:{filterId:e,opts:a}})},updateFactEditorCustom(e,t){Jm.dispatch({type:Wt.UPDATE_FACT_EDITOR_CUSTOM,payload:{filterId:e,operation:t}})},deleteFactEditorNode(e,t){Jm.dispatch({type:Wt.DELETE_FACT_EDITOR_NODE,payload:{filterId:e,nodeKey:t}})},manipulateTable(e,t,a,n,r){Jm.dispatch({type:Wt.MANIPULATE_TABLE,payload:{filterId:e,table:t,row:a,cell:n,type:r}})},updateFactEditorNode(e,t,a,n){Jm.dispatch({type:Wt.UPDATE_FACT_EDITOR_NODE,payload:{filterId:e,node:t,updates:a,opts:n}})},updateFactEditorMark(e,t,a,n,r){Jm.dispatch({type:Wt.UPDATE_FACT_EDITOR_MARK,payload:{filterId:e,node:t,mark:a,updates:n,opts:r}})},updateFactEditorNodeText(e,t,a){Jm.dispatch({type:Wt.UPDATE_FACT_EDITOR_NODE_TEXT,payload:{filterId:e,node:t,text:a}})},setFactEditorMenu(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=arguments.length>2?arguments[2]:void 0;Jm.dispatch({type:Wt.SET_FACT_EDITOR_MENU,payload:{filterId:e,type:t,opts:a}})},setFactEditorTableData(e,t,a,n,r){Jm.dispatch({type:Wt.SET_FACT_EDITOR_TABLE_DATA,payload:{filterId:e,node:t,rows:a,columns:n,opts:r}})}}}),Xm=g.Z.getFlux().actions[Qm.name];Xm||jm.error("error creating actions");var $m=Xm;f.Z.register(E.KnowledgeDuplicates,{GET:{path:"/cards/duplicates"},POST:{path:"/cards/dismissDuplicate"}});const eu=new C.Z({name:E.KnowledgeDuplicates,dataType:E.OBJECT,syncFilters:!1,transformPayloadOnGetComplete:e=>{const{data:t={}}=e;return t.groups&&t.groups.forEach((e=>{e.card.popularityScore=e.popularityScore;let t=[];e.duplicates.forEach((e=>{e.card.popularityScore=e.popularityScore,e.card.similarityScore=e.similarityScore,t.push(e.card)})),e.duplicates=t})),e},boundActions:[Wt.default.ARCHIVE_FACT_START,function(e){const t=e.factId,a=this._getFilter(E.GLOBAL);if(a.editData.groups){const e=a.editData.groups.filter((e=>e.card.id!==t));e.forEach((e=>{e.duplicates=e.duplicates.filter((e=>e.id!==t))})),a.editData.groups=e.filter((e=>0!==e.duplicates.length)),this._onChange()}},Wt.default.ARCHIVE_FACT_COMPLETE,function(){const e=this._getFilter(E.GLOBAL);e.syncCapable.data=e.editData,this._onChange()},Wt.default.ARCHIVE_FACT_ERROR,function(){const e=this._getFilter(E.GLOBAL);e.editData=o()(e,"syncCapable.data",{groups:[]}),this._onChange()},Wt.default.KNOWLEDGE_DUPLICATES_DISMISS_FACT,function(e){const t=this._getFilter(E.GLOBAL);t.editData.groups.forEach((t=>{t.duplicates=t.duplicates.filter((t=>t.id!==e))})),t.editData.groups=t.editData.groups.filter((e=>0!==e.duplicates.length)),this._onChange()},Wt.default.KNOWLEDGE_DUPLICATES_DISMISS_FACT_GROUP,function(e){const t=this._getFilter(E.GLOBAL);t.editData.groups=t.editData.groups.filter((t=>t.card.id!==e)),this._onChange()}]});eu.createStore();var tu=g.Z.addStore(eu.store),au=a(25108);const nu=g.Z.getFlux().dispatcher,ru=new p.Z({name:tu.getName(),boundActions:{dismissFact(e){nu.dispatch({type:Wt.KNOWLEDGE_DUPLICATES_DISMISS_FACT,payload:e})},dismissFactGroup(e){nu.dispatch({type:Wt.KNOWLEDGE_DUPLICATES_DISMISS_FACT_GROUP,payload:e})}}}),su=g.Z.getFlux().actions[ru.name];su||au.error("error creating actions");var iu=su;const ou={1:{imageUrl:"common/images/first-card-created.svg",heading:"You created your first Card! Future you says thanks.",body:"Now, your team can find and use your expertise in a snap."},5:{imageUrl:"common/images/fifth-card-created.svg",heading:"That\u2019s your 5th Card\u2014you\u2019re on a roll!",body:"Short, focused knowledge is easier to use and faster to find."},10:{imageUrl:"common/images/tenth-card-created.svg",heading:"A perfect 10, welcome to the double digits club!",body:"You\u2019ve made knowledge sharing part of your workflow."}};var lu=e=>{let{nthCardCreated:t}=e;const a=t&&ou[t];return n.createElement("div",{className:s()("ghq-SavedFactSuccessMessage",{"ghq-SavedFactSuccessMessage--attaboy-success":a})},a?n.createElement(n.Fragment,null,n.createElement("div",{className:"ghq-SavedFactSuccessMessage__image"},n.createElement("img",{alt:"You created ".concat(t," ").concat((0,_t.B$)("card",parseInt(t,10)),"!"),role:"presentation",src:xt.Z.getURL(a.imageUrl)})),n.createElement(St.ZP,{style:St.Jo.Bold},a.heading),n.createElement(St.ZP,null,a.body)):n.createElement(n.Fragment,null,n.createElement(fn.Z,{icon:nt.Z.Check,size:100,color:wt.ZP.Slime}),n.createElement(St.ZP,null,"Card successfully published!")))},cu=a(99303);var du=a(50196),mu=a(86178),uu=a(47271);var hu=e=>{let{title:t,description:a,onClickTemplate:r,canEditTemplate:i,onEditTemplate:o,className:l}=e;const c=s()("CardTemplateListItem__button",l);return n.createElement("div",{className:"CardTemplateListItem"},n.createElement("button",{className:c,"data-testid":"card-template-list-item",type:"button",onClick:r},n.createElement("span",{className:"CardTemplateListItem__title"},t),n.createElement("span",{className:"CardTemplateListItem__description"},a)),i&&n.createElement("div",{className:"CardTemplateListItem__actions"},n.createElement(uu.Z,null,n.createElement(uu.S,{aria:"icon-button",icon:nt.Z.Pencil,tooltipLabel:"Edit Template",tooltipPosition:mu.DU.Left,onClick:o}))))};function pu(){return n.createElement("div",{className:"ghq-CreateContentActionDivider"},n.createElement("div",{className:"ghq-CreateContentActionDivider__horizontal-rule"}),n.createElement("p",{className:"ghq-CreateContentActionDivider__action-divider-text"},"or"),n.createElement("div",{className:"ghq-CreateContentActionDivider__horizontal-rule"}))}var gu=a(16790);let fu,Eu;!function(e){e.Gray="CreateContentButton-sage--gray",e.Primary="CreateContentButton-sage--primary"}(fu||(fu={})),function(e){e.Left="CreateContentButton-sage-align--left",e.Center="CreateContentButton-sage-align--center"}(Eu||(Eu={}));var vu=e=>{let{description:t,icon:a,onClick:r,textAlign:i=Eu.Center,theme:o=fu.Primary,title:l}=e;const c=s()("Button-sage CreateContentButton-sage__button",o,i);return n.createElement("div",{className:"CreateContentButton-sage"},n.createElement("button",{"aria-label":l,type:"button",className:c,onClick:r},n.createElement("div",{className:"CreateContentButton-sage__label"},a?n.createElement(fn.Z,{icon:a}):null,l),t&&n.createElement("div",{className:"CreateContentButton-sage__description-text"},t)))};function Cu(e){let{createTemplate:t}=e;return n.createElement("div",{className:"ghq-CreateCardModal__empty-template-content"},n.createElement(ja.ZP,{level:ja.Yx.H3,style:ja.VH.Medium},"Create a Template"),n.createElement(St.ZP,null,"Keep your Cards clean and consistent by creating reusable Templates for your Team."),n.createElement(ft.ZP,{dataTestID:"create-a-template-button",style:ft.ZJ.Outline,theme:ft.bn.Primary,label:"Create a Template","aria-label":"Create a Template",onClick:t}),n.createElement("div",{className:"ghq-CreateCardModal__template-suggestions"},n.createElement(Nn.Z,null,"Want some inspiration?"),n.createElement(Sn.Z,{to:"https://www.getguru.com/templates",type:Sn.q.HighPriority,target:"_blank"},"View Cards created by our Guru Community.")))}function yu(){const e=n.useContext(ye.ZP),{id:t,card:a}=e,[r]=(0,Ue.Z)(Ne.Z.SHARED_DRAFTS_ALLOWED);n.useEffect((()=>{d.Z.mergeMeta(t,{isCreateCardModalOpen:!0})}),[]);const[i]=(0,_e.Z)(),[l]=(0,du.Z)(i.data.email),c=e=>{if(!e)return;const t=l.items.editData.filter((e=>e.roles.includes(Hc.S7)||e.roles.includes(Hc.XG))).find((t=>t.collection.id===e.id));return Boolean(t)},u=e=>{d.Z.hideFactMessage(t),d.Z.editJSONContent(t,e.jsonContent,ce.Z),d.Z.editContent(t,e.content),d.Z.editTitle(t,e.templateTitle)},h=e=>{if(e.boards){let n=e.boards;a.board&&a.meta.templateId&&(n=e.boards.filter((e=>e.id!==a.board.id))),n.forEach((e=>{Zi.Z.addEditDataItem(t,{id:e.id,label:e.title})}))}},p=e=>{e.tags&&d.Z.setTags(t,e.tags),e.verificationInterval&&d.Z.setVerificationInterval(t,e.verificationInterval)},g=()=>{d.Z.mergeMeta(t,{isTemplate:!0,isCreateCardModalOpen:!1}),a.board&&(d.Z.editCollection(t,a.board.data.collection),Zi.Z.addEditDataItem(t,{id:a.board.id,label:a.board.data.title})),d.Z.hideFactMessage(t)},f=()=>{a.data.collection&&d.Z.editCollection(t,a.data.collection),d.Z.hideFactMessage(t),setTimeout((()=>{d.Z.mergeMeta(t,{isCreateCardModalOpen:!1})}),50),$m.updateFactEditorCustom(t,(e=>{const t=e.value.document.getBlocks().get(0);e.focus().moveToEndOfNode(t)}))},[C,y]=n.useState(),[b,S]=n.useState({search:null,currentPage:{}}),[Z]=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{currentPage:t,search:a,filterId:r=v().GLOBAL,pathVars:s}=e,[i,o]=(0,T.Z)({filterId:r,store:U.Z,actions:z});return n.useEffect((()=>{o.get({linkHeader:t,queryParams:{search:a},pathVars:s})}),[t,a,s]),[i,o]}({...b,filterId:t}),N=U.Z.getFilter(E.GLOBAL).items.data.length>0,I=Z.items.data,A=null!==b.search,_=n.useRef(null),w=o()(Z,"linkHeaders[next-page]",{}),D=w.token&&b.currentPage.token!==w.token,P=I.length>0,k=_i.Z.hasPermission(ai.Z.CAN_EDIT_TEMPLATES),L=k&&!m.ZP.isExtension(),M=[le().LOADING,le().NOT_LOADED].includes(Z.status),O=Z.status===le().UPDATING,F=Z.status===le().LOADED,R=()=>n.createElement(n.Fragment,null,n.createElement("div",{className:"ghq-CreateCardModal__template-list-header"},n.createElement(ja.ZP,{level:ja.Yx.H3,style:ja.VH.Small},"Templates created by your Team"),n.createElement(Nn.Z,{style:Nn.W.Dim},"Use Templates and keep your Cards clean and consistent."),n.createElement("div",{className:"ghq-CreateCardModal__search-bar"},n.createElement("div",{className:"ghq-CreateCardModal__search-section"},n.createElement(gu.Z,null,n.createElement("label",{htmlFor:"searchCardTemplates"},"Search Card templates")),n.createElement(fn.Z,{icon:nt.Z.Search}),n.createElement(cu.Z,{id:"searchCardTemplates",className:"ghq-CreateCardModal__search-input",focusOnMount:!1,placeholder:"Search Card templates",value:C,handleInputChange:e=>y(e),handleAction:e=>{_.current=null,S({search:e,currentPage:{}})}})),L&&n.createElement(ft.ZP,{icon:nt.Z.NewTemplate,label:"Create new template",style:ft.ZJ.Text,theme:ft.bn.Primary,onClick:g}))),n.createElement("div",{className:"ghq-CreateCardModal__template-list"},O&&n.createElement($e.Z,{isReloading:O}),P?n.createElement(n.Fragment,null,I.map(((e,s)=>n.createElement(n.Fragment,{key:s},D&&s===I.length-10&&n.createElement(Bt.h,{onEnter:()=>{_.current!==w.token&&(S({search:b.search,currentPage:w}),_.current=w.token)}}),n.createElement(hu,{key:s,title:e.templateTitle,description:e.description,className:"ghq-CreateCardModal__template-list-item",canEditTemplate:L,onClickTemplate:()=>(e=>{d.Z.mergeMeta(t,{isTemplate:!1,contentFromTemplate:e,templateId:e.id,isCreateCardModalOpen:!1}),p(e);const n=a.data.collection?a.data.collection:c(e.collection)?e.collection:null;if(d.Z.editCollection(t,n),n&&e.collection&&n.id===e.collection.id)e.cardVerifier&&Y.Z.setEditVerifier(t,e.cardVerifier),h(e);else if(n&&e.cardVerifier){const n="user-group"===e.cardVerifier.type?e.cardVerifier.userGroup.name:e.cardVerifier.id;return Uc.setSearchTerms(t,n),void Uc.loadAvailableVerifiers(t,a.data.collection.id,{success:n=>{n.data&&n.data.some((t=>t.id===e.cardVerifier.id))&&Y.Z.setEditVerifier(t,e.cardVerifier),u(e),Uc.setSearchTerms(t,""),Uc.loadAvailableVerifiers(t,a.data.collection.id)}})}if(r){const t=a.editorSession.editingDraftId;X.put(a.id,{data:JSON.stringify({associatedDraftId:t,cardId:a.id,content:e.content,jsonContent:e.jsonContent,title:e.title,contentSchemaVersion:ce.Z}),pathVars:[t]})}u(e)})(e),onEditTemplate:n=>{n.stopPropagation(),(e=>{if(d.Z.mergeMeta(t,{isTemplate:!0,contentFromTemplate:e,templateTitle:e.templateTitle,templateDescription:e.description,isCreateCardModalOpen:!1}),p(e),a.board&&!e.collection)return d.Z.editCollection(t,null),u(e);e.collection&&(c(e.collection)?(d.Z.editCollection(t,e.collection),h(e),e.cardVerifier&&Y.Z.setEditVerifier(t,e.cardVerifier)):d.Z.editCollection(t,null)),u(e)})(e)}}))))):n.createElement("div",{className:"ghq-CreateCardModal__no-results"},"No Templates Found"))),x=s()("ghq-CreateCardModal__template-actions",{"ghq-has-templates":N}),q=s()("ghq-CreateCardModal__title",{"ghq-can-drag":m.ZP.isExtension()}),B=s()("ghq-CreateCardModal__body",{"ghq-CreateCardModal__scroll":m.ZP.isExtension()}),V=_i.Z.getState().usersCollectionsStatus===le().LOADED;return!M&&V&&(F||P||A)?N||k||O?n.createElement(n.Fragment,null,n.createElement("div",{className:q},n.createElement(ja.ZP,{level:ja.Yx.H2,style:ja.VH.Large},"Create Card")),n.createElement("div",{className:B},n.createElement("div",{className:"ghq-CreateCardModal__create-content-button-wrapper"},n.createElement(vu,{title:"Create a new Card",description:"Start from scratch.",icon:"plus",onClick:f})),n.createElement("div",{className:"ghq-CreateCardModal__create-content-action-divider-wrapper"},n.createElement(pu,null)),n.createElement("div",{className:x},N||O?R():L&&!N?n.createElement(Cu,{createTemplate:g}):f()))):(f(),null):n.createElement(Nt.ZP,null)}const bu=1500,Su={transition:"opacity ".concat(200,"ms ease-out"),opacity:0},Zu={entering:{opacity:1},entered:{opacity:1},exiting:{opacity:0},exited:{opacity:0}};var Nu=e=>{let{hideAlert:t,delayTime:a=bu,children:r}=e;const[s,i]=n.useState(!1);return n.useEffect((()=>{let e,n;return s||(i(!0),e=setTimeout((()=>{i(!1),n=setTimeout(t,200)}),a)),()=>{clearTimeout(e),clearTimeout(n)}}),[]),n.createElement(Sm.default,{in:s,timeout:200},(e=>n.createElement("div",{style:{...Su,...Zu[e]}},r)))};function Iu(e){let{factId:t}=e;return n.createElement("div",{className:"ghq-fact-msgaction-container"},n.createElement(Xe.Z,{icon:"alert",size:30}),n.createElement("h2",{className:"DraftErrorMessage__header"},"Something went wrong"),n.createElement(St.ZP,null,"No need to worry - your progress hasn't been lost. Please return to the Card editor and try again."),n.createElement(Ps.Z,{className:"ghq-fact-msgaction-button",kind:Ps.Z.kinds.PRIMARY,size:Ps.Z.sizes.MEDIUM,onClick:()=>d.Z.hideFactMessage(t)},"Go back"))}var Tu=a(25108);const Au=g.Z.getFlux().dispatcher,_u=new Kt.Z({name:E.DraftsAutosave,boundActions:{updatePreviousDrafts(e,t){Au.dispatch({type:Wt.UPDATE_PREVIOUS_DRAFTS,payload:{filter:e,payload:t}})}}}),wu=g.Z.getFlux().actions[_u.name];wu||Tu.error("error creating actions");var Du=wu;var Pu=e=>{let{header:t,message:a,primaryAction:r,primaryButton:s,secondaryButton:i,secondaryAction:o,hideMessage:l,backToEditor:c}=e;return n.createElement("div",{className:"ghq-fact-msgaction-container"},n.createElement("div",{className:"ghq-fact-msgaction-header-text"},t),n.createElement("div",{className:"ghq-fact-msgaction-text"},a),n.createElement("div",{className:"ghq-fact-msgaction-button-row"},n.createElement(Wa.Z,{alignment:Wa.A.Center},n.createElement(ft.ZP,{"data-testid":"Draft confirmation secondary button",theme:ft.bn.Gray,style:ft.ZJ.Outline,label:i,onClick:o}),n.createElement(ft.ZP,{theme:(d=s,["Close","Switch","Leave"].includes(d)?ft.bn.Destructive:ft.bn.Primary),label:s,onClick:r}))),c&&n.createElement(ft.ZP,{theme:ft.bn.Gray,style:ft.ZJ.Text,label:"Back to Editor",onClick:()=>l()}));var d};function ku(){return ku=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},ku.apply(this,arguments)}function Lu(e){var t,a,r,s;let{fact:i,primaryActionCallback:o=(()=>{}),secondaryActionCallback:l=(()=>{}),isBack:c=!1,isClose:m=!1,isCancel:u=!1,isSwitching:h=!1}=e;const p=i.action===oe.NEW,g=null===(t=i.meta)||void 0===t?void 0:t.isTemplate,f=ae.C.canAutoSave({editorSession:i.editorSession}),v=(null==i||null===(a=i.data)||void 0===a?void 0:a.id)||(null==i||null===(r=i.editFact)||void 0===r||null===(s=r.data)||void 0===s?void 0:s.id),C={header:"Close Editor?",message:"You will lose any progress or changes you made to this Card if you close without publishing.",primaryButton:"Close",secondaryButton:"Cancel",backToEditor:!1},y={header:"Save this Card as a Draft?",message:"You can access your drafts at any time in the My Tasks tab.",secondaryButton:"Discard draft",primaryButton:"Save draft",backToEditor:!0},b={header:"Save this Card as a Draft?",message:"You can access your drafts at any time in the My Tasks tab.",secondaryButton:"Discard draft",primaryButton:"Save draft",backToEditor:!0},S={header:"Switch to draft version?",message:"You will lose any unsaved progress or changes you made since opening this Card.",secondaryButton:"Cancel",primaryButton:"Switch",backToEditor:!1},Z=()=>{const e=i.editorSession.editingDraftId;e&&X.delete(i.id,{pathVars:[e],meta:{factId:v},success:()=>{$.Z.createToast({content:"Draft deleted."}),Du.resetFilter(i.id)},error:()=>{$.Z.createToast({content:"Unable to delete draft.",id:E.GLOBAL,type:Lo().ERROR})}})},N=()=>d.Z.discardFact(i.id),I=()=>d.Z.hideFactMessage(i.id),T=()=>p?y:b;let A={};return g?A=c?{...{header:"Leave Editor?",message:"You will lose any progress or changes you've made to this template if you leave without saving.",primaryButton:"Leave",secondaryButton:"Continue editing",backToEditor:!1},primaryAction:()=>o(),secondaryAction:()=>I()}:{...{header:"Close Editor?",message:"You will lose any progress or changes you've made to this template if you close without saving.",primaryButton:"Close",secondaryButton:"Continue editing",backToEditor:!1},primaryAction:()=>N(),secondaryAction:()=>I()}:c?A={...T(),primaryAction:()=>he.save(i),secondaryAction:()=>{Z(),l()}}:u?A=f?{...T(),primaryAction:()=>he.save(i),secondaryAction:()=>{Z(),l()}}:{...C,primaryAction:()=>N(),secondaryAction:()=>I()}:m?A=f?{...T(),primaryAction:()=>he.save(i),secondaryAction:()=>{Z(),N()}}:{...C,primaryAction:()=>N(),secondaryAction:()=>I()}:h&&(A={...S,primaryAction:()=>{ae.C.switchDraft({fact:i,draft:i.switchEditorContent}),I()},secondaryAction:()=>{I()}}),n.createElement(Pu,ku({},A,{hideMessage:I}))}let Mu;!function(e){e.center="center",e.top="top",e.bottom="bottom"}(Mu||(Mu={}));var Ou=e=>{let{loading:t,icon:a,customMessage:r,text:i,subtext:o,alignment:l=Mu.center,handleCancel:c}=e;const d=s()("ghq-simple-fact-message","ghq-is-aligned-".concat(l));return n.createElement("div",{className:d},c&&n.createElement("div",{className:"ghq-simple-message-options"},n.createElement(at.ZP,{aria:"Close modal",style:at.Dd.Standard,icon:nt.Z.Close,onClick:c})),a&&n.createElement(Xe.Z,{icon:a,size:72}),t&&n.createElement(Nt.ZP,null),r?r():n.createElement("div",null,n.createElement("p",{className:"ghq-simple-fact-message__text"},i),n.createElement("p",{className:"ghq-simple-fact-message__subtext"},o)))};function Fu(){return Fu=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},Fu.apply(this,arguments)}function Ru(e,t){e.status!==le().ERROR&&t&&(t.status===le().SAVING?e.status=le().SAVING:t.status===le().ERROR?(e.status=le().ERROR,e.message=t.messageText,e.extended=t.extendedText,e.errorObject=t.errorObject):t.status===le().CONFIRM&&(e.confirmKey=t.confirmKey))}function xu(e){let{items:t,handleItemClick:a,selectedValue:r}=e;return n.createElement("div",{className:"ghq-fact-message-category-picker"},n.createElement("span",null,"Add this Tag to an existing Category (optional)"),n.createElement(et.Z,{className:"ghq-fact-message-category-picker__select-input",items:t,selectedValue:r,refKey:"cardCreate",handleItemClick:a}))}const qu="processing",Bu="warn",Vu="info",Uu="success",Hu=(0,Ce.Z)(class extends n.Component{constructor(){super(...arguments),this.renderTop=()=>{const{title:e,icon:t}=this.props;if(!e&&!t)return null;const a=n.createElement("div",null,e),r=n.createElement(Xe.Z,{icon:t});return n.createElement("div",{className:"ghq-fact-msgaction-text"},a,r)},this.renderHiddenInput=()=>n.createElement("input",{style:{position:"absolute",top:-50},ref:"input",type:"text"}),this.handleEscape=e=>{const{handleConfirm:t,handleCancel:a}=this.props;e.stopImmediatePropagation(),a?a():t(),pe.ZP.APP_ELEMENT.focus()},this.handleEnter=e=>{const{handleConfirm:t}=this.props;e.stopImmediatePropagation(),t(),pe.ZP.APP_ELEMENT.focus()},this.renderSingleButton=()=>{const{buttonClassName:e}=this.props,t=s()("ghq-fact-msgaction-single-button",e);if(this.props.handleCancel)return null;const a=this.props.confirmButtonType||{primary:!0};return n.createElement(We.Z,Fu({className:t},a,{value:this.props.confirmName,onClick:this.props.handleConfirm}))},this.renderButtonPair=()=>{if(!this.props.handleCancel)return null;const e=this.props.isDestructiveConfirm?{destructive:!0}:{primary:!0};return n.createElement("div",{className:"ghq-fact-msgaction-button-pair"},n.createElement(We.Z,{negative:!0,value:"Cancel",onClick:this.props.handleCancel}),n.createElement(We.Z,Fu({},e,{disabled:this.props.actionDisable,value:this.props.confirmName,onClick:this.props.handleConfirm})))},this.renderSecondMessage=()=>this.props.secondActionText?n.createElement("div",{className:"ghq-fact-msgaction-text"},this.props.secondActionText):null}componentDidMount(){P.findDOMNode(this.refs.input).focus()}render(){const{previewChip:e,firstActionText:t,headerText:a,renderBody:r}=this.props,s=this.renderTop(),i=this.renderHiddenInput(),o=this.renderSingleButton(),l=this.renderButtonPair(),c=this.renderSecondMessage();return n.createElement("div",{className:"ghq-fact-msgaction-window"},i,n.createElement("div",{className:"ghq-fact-msgaction-container"},s,n.createElement("div",{className:"ghq-fact-msgaction-header-text"},a),n.createElement("div",{className:"ghq-fact-msgaction-text"},t),e,o,c,r,l))}}),Wu=tr()({displayName:"OptOutCheckbox",mixins:[(0,ar.Z)(Pe.Z)],getStateFromFlux(){var e=Pe.Z.getState(),t=Ym()(e.data.preferences);return{optOut:"false"===t[this.props.preference],preferences:t}},changePreference(){const{preference:e}=this.props,{optOut:t}=this.state;O.Z.savePreference(e,t),this.setState({optOut:!t})},render(){const{optOut:e}=this.state;return n.createElement(Os.Z,{name:"opt-out",isChecked:e,label:"Don't show me this again",onChange:this.changePreference})}}),Gu=e=>{let{fact:t}=e;const[{items:{editData:a},status:r}]=ys(t.id),s=a.map((e=>e.title)),i=![le().NOT_LOADED,le().LOADING].includes(r);return n.createElement("div",{className:"ghq-fact-msgaction-window"},n.createElement("div",{className:"ghq-fact-msgaction-container"},n.createElement("div",{className:"ghq-fact-msgaction-header-text"},"Remove from Favorites"),i&&n.createElement("div",{className:"ghq-fact-msgaction-text"},"This Card is in the following lists:"," ",(0,_t.O6)({list:s}),".",n.createElement("br",null)," Are you sure you would like to remove this Card from your Favorites?"),n.createElement("div",{className:"ghq-fact-msgaction-button-pair"},n.createElement(We.Z,{negative:!0,value:"Cancel",onClick:()=>d.Z.hideFactMessage(t.id)}),n.createElement(We.Z,{destructive:!0,value:"Remove",onClick:()=>{d.Z.hateFact(t.id),d.Z.hideFactMessage(t.id)}}))))},zu=e=>{d.Z.setFactMessage({factId:e.id,messageKey:le().CREATING_NEW_CARD}),d.Z.mergeMeta(e.id,{isTemplate:null,contentFromTemplate:null,templateTitle:"",templateDescription:"",templateId:null}),d.Z.editJSONContent(e.id,""),d.Z.editContent(e.id,""),d.Z.editTitle(e.id,""),$m.clearStore(),d.Z.editCollection(e.id,null),Ai.Z.clear(),d.Z.setTags(e.id,[]),Y.Z.setEditVerifier(e.id,{id:Pe.Z.getEmail(),user:{email:Pe.Z.getEmail(),firstName:Pe.Z.getFirstName(),lastName:Pe.Z.getLastName()},type:"user"}),d.Z.setVerificationInterval(e.id,90)};var Yu=tr()({displayName:"FactMessage",mixins:[(0,ar.Z)(Gd.Z,Sr.Z)],getStateFromFlux(){const e=Gd.Z.getCategories(),t=e.data.find((e=>e.defaultCategory)),a=t?t.id:"",n=e.data.map((e=>({value:e.id,label:e.defaultCategory?"--None--":e.name,type:"menu-item"})));return{tagCategories:e,defaultCategoryId:a,selectedCategory:""===o()(this,"state.selectedCategory")?a:o()(this,"state.selectedCategory",a),tagCategoryMenuitems:n}},getInitialState:()=>({isMobile:(0,us.tq)()}),handleResize:_()((function(){this.setState({isMobile:(0,us.tq)()})}),100),componentDidMount:function(){window.addEventListener("resize",this.handleResize)},componentWillUnmount:function(){window.removeEventListener("resize",this.handleResize)},messageOptions:{saving:{style:qu,loading:!0},saved:{hideCancel:!0,customMessage:e=>()=>n.createElement(lu,{nthCardCreated:e.nthCardCreated}),isAlert:!0,delayTime:3e3},asked:{headerText:"Your question has been asked",text:"Check your notifications to track your question's status and answer.",confirmAction:"closeFact",confirmName:"Got it!",hideCancel:!0},creating_new_card:{handleCancel:!0,cancelAction:"closeFact",style:"creating-new-card",id:"creating_new_card",customMessage:e=>()=>n.createElement(yu,{key:e.id})},error:{style:Bu,icon:"circle-x",hideCancel:!0},error_402:{style:Vu,confirmAction:"launchUpgrade",confirmName:"Upgrade Now",text:"Oh No! Another member of your team saved the last card in the Free edition before you did.",textMore:"to create more cards."},error_403:{style:Bu,hideCancel:!0,customMessage:e=>()=>n.createElement("div",{className:"ghq-simple-fact-message"},n.createElement("img",{src:xt.Z.getURL("common/images/permissions.svg")}),n.createElement("div",{className:"ghq-simple-fact-message__403"},n.createElement(St.ZP,null,'To view the Card "',e.extendedText,'" request access from'," ",n.createElement(Sn.Z,{to:ie().TEAM_ADMIN},"your Guru admins."))))},draft_error:{hideCancel:!0,customMessage:e=>()=>n.createElement(Iu,{factId:e.id})},confirm_archive:{text:"Are you sure you want to archive this Card?",confirmAction:"archiveFact",confirmName:"Archive Card",isDestructiveConfirm:!0},confirm_archivePrimary:{text:n.createElement("div",null,n.createElement("b",null,"Are you sure you would like to archive the Primary Card?"),n.createElement("br",null),n.createElement("br",null),"Doing so will also dismiss this entire Duplicate group from your team's queue."),confirmAction:"archiveFactDuplicates",confirmName:"Archive",isDestructiveConfirm:!0},confirm_deleteTemplate:{customMessage:e=>()=>n.createElement("div",{className:"ghq-fact-msgaction-container"},n.createElement("div",{className:"ghq-fact-msgaction-header-text"},"Delete Template"),n.createElement("div",{className:"ghq-fact-msgaction-text"},'Are you sure you would like to delete the Template "',e.meta.contentFromTemplate.templateTitle,'"?'," ",n.createElement("i",null,"This action cannot be undone.")),n.createElement("div",{className:"ghq-fact-msgaction-button-pair"},n.createElement(We.Z,{large:!0,negative:!0,value:"Cancel",onClick:()=>d.Z.hideFactMessage(e.id)}),n.createElement(We.Z,{large:!0,destructive:!0,value:"Delete",onClick:()=>{const t={};t.pathVars=[e.meta.contentFromTemplate.id],z.delete(e.meta.contentFromTemplate.id,t),d.Z.discardFact(e.id)}})))},confirm_dismissPrimary:{text:n.createElement("div",null,n.createElement("b",null,"Are you sure you would like to dismiss the Primary Card?"),n.createElement("br",null),n.createElement("br",null),"Doing so would remove it from this Duplicate group for your entire team."),confirmAction:"dismissFactPrimary",confirmName:"Dismiss Group",isDestructiveConfirm:!1},confirm_dismissSecondary:{text:n.createElement("div",null,n.createElement("b",null,"Are you sure you would like to dismiss this Duplicate Card?"),n.createElement("br",null),n.createElement("br",null),"Doing so would remove it from this Duplicate group for your entire team."),confirmAction:"dismissFactSecondary",confirmName:"Dismiss Card",isDestructiveConfirm:!1},confirm_keepDraft_back:{hideCancel:!0,customMessage:e=>()=>n.createElement(Lu,{isBack:!0,fact:e,secondaryActionCallback:()=>zu(e)})},confirm_keepDraft_backFromTemplate:{hideCancel:!0,customMessage:e=>()=>n.createElement(Lu,{isBack:!0,fact:e,primaryActionCallback:()=>zu(e)})},confirm_keepDraft_switch:{hideCancel:!0,customMessage:e=>()=>n.createElement(Lu,{isSwitching:!0,fact:e})},confirm_backFromCard:{headerText:"Confirm Leaving Editor",text:"You will lose the contents of this Card if you go back without saving. Are you sure you'd like to continue?",confirmAction:"handleBackToNew",confirmName:"Go Back",isDestructiveConfirm:!0},confirm_backFromTemplate:{headerText:"Confirm Leaving Editor",text:"You will lose any changes you've made if you go back without saving. Are you sure you'd like to continue?",confirmAction:"handleBackToNew",confirmName:"Go Back",isDestructiveConfirm:!0},confirm_close:{headerText:"Confirm closing Editor",text:"You will lose the contents of this Card if you close without saving.  Are you sure you'd like to continue?",confirmAction:"closeFact",confirmName:"Close Editor",isDestructiveConfirm:!0},confirm_keepDraft_close:{hideCancel:!0,customMessage:e=>()=>n.createElement(Lu,{isClose:!0,fact:e})},confirm_removeFromFavorites:{customMessage:e=>()=>n.createElement(Gu,{fact:e})},confirm_keepDraft_cancel:{hideCancel:!0,customMessage:e=>()=>n.createElement(Lu,{isCancel:!0,fact:e,secondaryActionCallback:()=>(e=>{d.Z.clearActionAndStatusAndResetEditFact(e.id),d.Z.hideFactMessage(e.id)})(e)})},confirm_cancel:{headerText:"Confirm closing Editor",text:"You will lose the contents of this Card if you close without saving.  Are you sure you'd like to continue?",confirmAction:"cancelFact",confirmName:"Close Editor",isDestructiveConfirm:!0},confirm_close_QUESTION:{headerText:"Are you sure?",text:"You will lose the content of this question if you close without submitting it.",confirmAction:"closeFact",confirmName:"Close Question",isDestructiveConfirm:!0},confirm_cancel_QUESTION:{headerText:"Are you sure?",text:"You will lose the content of this question if you close without submitting it.",confirmAction:"cancelFact",confirmName:"Close Question",isDestructiveConfirm:!0},confirm_pinfact:{confirmAction:"pinFact",confirmName:"Pin Card",confirmOptOutPreference:"showPinningConfirmation",style:Vu},confirm_unpinfact:{confirmAction:"unpinFact",confirmName:"Unpin Card",confirmOptOutPreference:"showPinningConfirmation"},confirm_createtag:{confirmAction:"createTag",confirmName:"Save",displayTagPreview:!0,style:"createtag",text:"Save this tag to be reused by your team?"},confirm_createboard:{confirmAction:"createBoard",confirmName:"Save",displayBoardPreview:!0,style:"createboard",text:"Save this Board to be reused by your team?"},confirm_cleartags:{text:"Are you sure you want to clear all remaining tags?",confirmAction:"clearTags",confirmName:"Clear Tags"}},handleBackToNew(){const{fact:e}=this.props;d.Z.setFactMessage({factId:e.id,messageKey:le().CREATING_NEW_CARD}),d.Z.mergeMeta(e.id,{isTemplate:null,contentFromTemplate:null,templateTitle:"",templateDescription:"",templateId:null}),d.Z.editJSONContent(e.id,""),d.Z.editContent(e.id,""),d.Z.editTitle(e.id,""),$m.clearStore(),d.Z.editCollection(e.id,null),Ai.Z.clear(),d.Z.setTags(e.id,[]),Y.Z.setEditVerifier(e.id,{id:Pe.Z.getEmail(),user:{email:Pe.Z.getEmail(),firstName:Pe.Z.getFirstName(),lastName:Pe.Z.getLastName()},type:"user"}),d.Z.setVerificationInterval(e.id,90)},handleTagCategorySelected(e){this.setState({selectedCategory:e.value})},renderTagCategoryPicker(){const{selectedCategory:e,tagCategoryMenuitems:t}=this.state;return n.createElement(xu,{items:t,selectedValue:e,handleItemClick:this.handleTagCategorySelected})},hideAlert(){const{defaultCategoryId:e}=this.state;this.props.fact.action===le().DOA?d.Z.discardFact(this.props.fact.id):this.props.sharers&&this.props.sharers.status===le().ERROR&&Ki.Z.loadCollaborators(this.props.fact.data.id),d.Z.hideFactMessage(this.props.fact.id),this.setState({selectedCategory:e})},completeMessage(){this.hideAlert(),this.props.onComplete&&this.props.onComplete()},launchUpgrade(){g.Z.getFlux().actions.license.showUpgrades()},closeFact(){d.Z.discardFact(this.props.fact.id)},cancelFact(){d.Z.clearActionAndStatus(this.props.fact.id),d.Z.hideFactMessage(this.props.fact.id)},archiveFact(){d.Z.archiveFact(this.props.fact.data.id,{callback:this.props.fact.callback})},archiveFactDuplicates(){const e={headers:{[re.eB]:Pt.default.KNOWLEDGE_DUPE_CARD_ARCHIVED}};d.Z.archiveFact(this.props.fact.data.id,e)},dismissFactPrimary(){const{fact:e}=this.props,t=[{featureName:"aisDuplicates",data:{task:"duplicatesManager",suggestionId:tu.getFilter(E.GLOBAL).data.kdSuggestionId,primaryCardUid:e.data.id,duplicateCards:[]}}],a={success:()=>{d.Z.discardFact(e.data.id),iu.dismissFactGroup(e.data.id)},data:JSON.stringify({primaryCardId:e.data.id,collectionId:e.data.collection.id,duplicateCardIds:[]}),headers:{[re.Kg]:JSON.stringify(t),[re.eB]:Pt.default.KNOWLEDGE_DUPE_DISMISSED}};iu.post(E.GLOBAL,a)},dismissFactSecondary(){const{fact:e}=this.props,t=[{featureName:"aisDuplicates",data:{task:"duplicatesManager",suggestionId:tu.getFilter(E.GLOBAL).data.kdSuggestionId,primaryCardUid:e.meta.knowledgeDuplicatesPrimaryCard.id,duplicateCards:[e.data.id]}}],a={success:()=>{d.Z.discardFact(e.data.id),iu.dismissFact(e.data.id)},data:JSON.stringify({primaryCardId:e.meta.knowledgeDuplicatesPrimaryCard.id,collectionId:e.meta.knowledgeDuplicatesPrimaryCard.collection.id,duplicateCardIds:[{duplicateCardId:e.data.id,collectionId:e.data.collection.id}]}),headers:{[re.Kg]:JSON.stringify(t),[re.eB]:Pt.default.KNOWLEDGE_DUPE_DISMISSED}};iu.post(E.GLOBAL,a)},pinFact(){const{fact:e}=this.props;wo.pinFact(e.data.collection.id,e.data.id,e.activity,e.activityId),d.Z.hideFactMessage(this.props.fact.id)},unpinFact(){const{fact:e}=this.props;wo.unpinFact(e.data.collection.id,e.data.id,e.activity,e.activityId),d.Z.hideFactMessage(this.props.fact.id)},updateFactBoardOnSuccess(e){const{fact:t}=this.props,{id:a,title:n}=e.data;t.data.id?Zi.Z.addFactBoards(t.data.id,{id:a}):Zi.Z.addEditDataItem(t.id,{id:a,title:n,type:"menu-item",removeChip:t.newBoard.removeChip})},createBoard(){const{fact:e}=this.props;const t={data:{...e.newBoard},success:t=>{var a;this.updateFactBoardOnSuccess(t),null===(a=e.newBoard)||void 0===a||a.createNewBoardCallback(t)}};Km.Z.quickCreateBoard(t),d.Z.hideFactMessage(this.props.fact.id)},createTag(){const{selectedCategory:e,defaultCategoryId:t}=this.state,{fact:a}=this.props;var n=a.newTag;const r=o()(a.meta,"selectedTags",[]),s=r.findIndex((e=>e.value===n.value)),i={fact:a,removeTag:n.removeTag,callback:e=>{r[s]={...r[s],id:e.data.id},d.Z.mergeMeta(a.id,{selectedTags:r})}};Wd.Z.createTag(e,n.value,i),d.Z.hideFactMessage(this.props.fact.id),this.setState({selectedCategory:t})},clearTags(){var e=this.props.fact;e.data.id?d.Z.clearTags(e.data.id):d.Z.setTags(e.id,[])},getVerifierName(){var e=this.props.fact.data.verifiers[0];return"user"===e.type?gt.Z.getNameFromModel(e.user):"user-group"===e.type?e.userGroup.name:void 0},getConsolidatedStatus(){var e={status:this.props.fact.messageKey,confirmKey:this.props.fact.confirmKey,errorObject:this.props.fact.errorObject,message:this.props.fact.messageText,extended:this.props.fact.extendedText};return Ru(e,this.props.sharers),Ru(e,this.props.verifiers),e},getMessageOptions(){const{fact:e}=this.props;var t=this.getConsolidatedStatus(),a=t.status,n=null;return"error"===a&&t.errorObject&&t.errorObject.status?n=this.messageOptions[a+"_"+t.errorObject.status]:a===le().CONFIRM&&e.editFact.data.cardType===le().QUESTION?n=this.messageOptions[a+"_"+t.confirmKey+"_"+le().QUESTION]:a===le().CONFIRM&&(n=this.messageOptions[a+"_"+t.confirmKey]),n||(n=this.messageOptions[a]),n&&((n=Ym()(n)).style=n.style||qu,n.text=n.text||t.message,n.extended=t.extended,n.handleCancel=n.hideCancel?null:this[n.cancelAction]||this.hideAlert,n.handleConfirm=this[n.confirmAction]||this.completeMessage,Sr.Z.hasNavarchyPhaseTwoAllowed()&&n.text&&(n.text=n.text.replaceAll("Board","folder"))),n},renderSimpleMessage(e){const{fact:t}=this.props,a=e.customMessage?e.customMessage(t):null,r=s()("ghq-fact-message-container","ghq-fact-message-container-"+e.style,{"ghq-fact-message-container__extension":(0,m.p1)(),"ghq-fact-message-container__extension-full-width":(0,m.p1)()&&e.style===Uu||e.style===Bu});let i;"creating_new_card"===e.id&&this.state.isMobile&&(i="top");var o=n.createElement("div",{className:r},n.createElement("div",{className:"ghq-fact-background-"+e.style}),n.createElement(Ou,{customMessage:a,text:e.text,subtext:e.subtext,icon:e.icon,loading:e.loading,handleCancel:e.handleCancel,alignment:i}));return e.isAlert&&(o=n.createElement(Nu,{hideAlert:this.completeMessage,delayTime:e.delayTime},o)),o},renderConfirmMessage(e){const{tagCategories:t}=this.state,{fact:a}=this.props;let r=null;const i=e.confirmOptOutPreference;i&&(r=n.createElement(Wu,{preference:i}));let o=null;e.displayTagPreview&&a.newTag?o=n.createElement(fi.Z,{className:"action-message-chip",label:a.newTag.value,id:a.newTag.value}):e.displayBoardPreview&&(o=n.createElement(fi.Z,{className:"action-message-chip",label:a.newBoard.title,id:a.newBoard.title}));let l=e.text;e.appendVerifierName&&(l+=this.getVerifierName());let c=null;"createTag"===e.confirmAction&&t.data.length>1&&(c=this.renderTagCategoryPicker());const d="createTag"===e.confirmAction&&t.status!==le().LOADED,u=s()("ghq-fact-message-container","ghq-fact-message-container-"+e.style,{"ghq-fact-message-container__extension":(0,m.p1)(),"ghq-fact-message-container__extension-full-width":(0,m.p1)()&&e.style===Uu||e.style===Bu});return n.createElement("div",{className:u},n.createElement("div",{className:"ghq-fact-background-"+e.style}),n.createElement(Hu,Fu({buttonClassName:"ghq-fact-message-button",firstActionText:l,previewChip:o,renderBody:c,actionDisable:d},e)),r)},render(){var e=this.getMessageOptions(),t=null;return e&&e.confirmAction?t=this.renderConfirmMessage(e):e&&(t=this.renderSimpleMessage(e)),t}});const Ku=e=>{if(!e)return;const{firstName:t,lastName:a,email:n}=e;return t||a||n?t&&a?"".concat(t," ").concat(a):n:void 0},ju=e=>{let{kaToAnnouncementsAllowed:t,displayName:a,note:r}=e;return t?n.createElement(n.Fragment,null,"New announcement from ".concat(a).concat(null!=r&&r.length?":":"")):n.createElement(n.Fragment,null,"".concat(a," requested that you read this Card."))},Ju=e=>{var t;let{location:a,knowledgeAlerts:r,id:s,alertId:i,cardId:o,onClickReadConfirmation:l}=e;const{state:c}=(0,be.TH)(),[d]=(0,_e.Z)(),[,u]=Pa(i),{value:h}=(0,ke.Z)("source"),p=(0,Ut.NL)();return n.createElement("div",{className:"KnowledgeAlertBannerHeader__button"},n.createElement(ft.ZP,{size:ft.qE.Small,label:"I read it",trackEvent:{name:Pt.default.ANNOUNCEMENT_READ,activityId:i,activityMetaData:[{featureName:Na.Z.ANNOUNCEMENTS,data:{cardId:o}}],activitySource:(null==c||null===(t=c.eventTrack)||void 0===t?void 0:t.activitySource)||h,application:m.ZP.isExtension()?kt.Nu.ChromeExt:kt.Nu.WebApp,eventType:Pt.default.ANNOUNCEMENT_READ,userId:d.data.email},onClick:()=>{l(a,r,s,(()=>{p.invalidateQueries(["announcements"]),u.clearStore()}))}}))};var Qu=e=>{let{knowledgeAlerts:t,expanded:a,setExpanded:r,onClickReadConfirmation:s,id:i,location:o}=e;const[l]=(0,Ue.Z)(Ne.Z.KA_TO_ANNOUNCEMENTS_ALLOWED);if(null==t||!t.length)return null;if(1===t.length){const{creator:e,note:a,cardId:r,id:c}=t[0];if(!e)return null;const d=Ku(e);return n.createElement("div",{className:"KnowledgeAlertBannerHeader"},n.createElement("div",{className:"KnowledgeAlertBannerHeader__details"},n.createElement("div",null,n.createElement("p",{className:"KnowledgeAlertBannerHeader__request-text"},n.createElement(ju,{kaToAnnouncementsAllowed:l,displayName:d,note:a})),n.createElement("p",null,a))),n.createElement(Ju,{location:o,id:i,cardId:r,alertId:c,knowledgeAlerts:t,onClickReadConfirmation:s}))}const c=t.length,d=t.map((e=>Ku(e.creator))).filter(((e,t,a)=>a.indexOf(e)===t)).filter((e=>null!=e)).join(", "),m=t.map((e=>e.id)).join(","),u=t[0].cardId;return n.createElement("div",{className:"KnowledgeAlertBannerHeader"},n.createElement("div",{className:"KnowledgeAlertBannerHeader__details"},n.createElement("div",{className:"KnowledgeAlertBannerHeader__caret"},n.createElement(at.ZP,{aria:"knowledge-alert-banner-caret",icon:a?nt.Z.MenuDown:nt.Z.MenuRight,iconSize:16,shape:at.e7.Square,style:at.Dd.Standard,tooltipLabel:a?"Collapse":"Expand",tooltipPosition:mu.DU.Right,onClick:()=>r(!a)})),n.createElement("div",null,n.createElement("p",{className:"KnowledgeAlertBannerHeader__request-text"},l?"You've been sent ".concat(c," announcements for this Card"):"There are ".concat(c," requests for you to read this Card")),n.createElement("p",null,l?"Announcements from: ".concat(d):"Requests from: ".concat(d)))),n.createElement(Ju,{location:o,id:i,cardId:u,alertId:m,knowledgeAlerts:t,onClickReadConfirmation:s}))};var Xu=e=>{let{creator:t,date:a,note:r}=e;return n.createElement("div",{className:"KnowledgeAlertBannerItem"},n.createElement("div",{className:"KnowledgeAlertBannerItem__content"},n.createElement("div",{className:"KnowledgeAlertBannerItem__header"},n.createElement("span",{className:"KnowledgeAlertBannerItem__creator"},Ku(t)),n.createElement("span",null," ","- ",n.createElement(It.Z,{date:a}))),n.createElement("p",{className:"KnowledgeAlertBannerItem__note"},r)))};var $u=(0,be.EN)((e=>{let{location:t}=e;const a=n.useContext(ye.ZP),{knowledgeAlerts:r,onClickReadConfirmation:i,id:o}=a,[l,c]=n.useState(!1),d=s()("KnowledgeAlertBanner",{"KnowledgeAlertBanner--expanded":l});return n.createElement(n.Fragment,null,n.createElement("div",{className:d},n.createElement(Qu,{knowledgeAlerts:r,expanded:l,setExpanded:c,location:t,id:o,onClickReadConfirmation:i})),l&&n.createElement("div",{className:"KnowledgeAlertBanner__body"},null==r?void 0:r.map((e=>n.createElement(Xu,{key:e.id,creator:e.creator,date:e.dateCreated,note:e.note})))))}));var eh=(0,be.EN)((function(){var e,t;const{canDrag:a,hasAnalytics:r,hasComments:i,hasDetails:o,id:l,isArchived:c,isUntrusted:d,isOwnedByGuru:m,knowledgeAlerts:h,setShowCommentsTray:p,showCommentsTray:g,slug:f,__compatProps:E}=(0,ye.RC)(),[v]=(0,_e.Z)(),C=(0,be.k6)(),y=(0,be.TH)(),[b]=He(null===(e=v.data)||void 0===e||null===(t=e.team)||void 0===t?void 0:t.id),[S]=Ve(l),[Z]=(0,Ue.Z)(Ne.Z.KNOWLEDGEALERTS_ALLOWED),[N]=(0,Ue.Z)(Ne.Z.CARD_ATTRIBUTES_ALLOWED),[I]=(0,Ue.Z)(Ne.Z.ENABLE_ANNOUNCEMENTS_COMMENTS),[T,A]=n.useState(!1);(0,n.useEffect)((()=>{C.location.search.includes("comments")&&p(!0)}),[C.location.search]);const _=s()("ghq-CardShell"),w=s()("ghq-CardShell__upper-content",{"ghq-can-drag":a}),D=!c&&d&&S.canVerify,P=D||c,k=!m&&i&&g,L=!m&&o,M=!m&&r;return n.createElement("div",{className:_},n.createElement("div",{className:w},n.createElement(Id,{isTrustMenuOpen:T,setTrustMenuOpen:e=>A(e)}),P&&n.createElement("div",{className:"ghq-CardShell__prompt"},D&&n.createElement(Gm,{isTrustMenuOpen:T,setTrustMenuOpen:e=>A(e)}),c&&n.createElement(ze,null)),Z&&h.length>0&&!I?n.createElement("div",{className:"ghq-CardShell__knowledge-alert"},n.createElement($u,null)):null),n.createElement("div",{className:"ghq-CardShell__lower-content"},n.createElement(n.Fragment,null,n.createElement(be.rs,null,M&&n.createElement(xe,{path:"/card/:id/:title/analytics",render:()=>n.createElement(Lt,null)}),L&&n.createElement(xe,{path:"/card/:id/:title/details",render:()=>n.createElement(is,null)}),n.createElement(xe,{path:"/card/:id/:title?",render:()=>N?b.status===u.S.Loaded?n.createElement(bm,E):n.createElement(n.Fragment,null):n.createElement(bm,E)}),n.createElement(be.l_,{to:{pathname:"/card/".concat(f),search:"".concat(y.search)}})),n.createElement(Yu,E),k&&n.createElement(kr,{title:"Comments"},n.createElement(Pr,null)))),n.createElement(Ze(),null,n.createElement(Om,null)))}));function th(){return th=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},th.apply(this,arguments)}class ah extends n.Component{render(){return n.createElement(ye.ZP.Consumer,null,(e=>{let{slug:t}=e;return n.createElement(be.VA,null,n.createElement(be.rs,null,n.createElement(be.AW,{path:"/card/".concat(t),render:e=>n.createElement(eh,th({},e,this.props))}),n.createElement(be.l_,{to:"/card/".concat(t)})))}))}}var nh=a(39693),rh=a.n(nh),sh=a(60500);f.Z.register(E.HasCreatedCard,{GET:{path:"/users/:email/cardcreated"}});const ih=new C.Z({name:E.HasCreatedCard,dataType:v().OBJECT});ih.createStore();var oh=g.Z.addStore(ih.store),lh=a(25108);const ch=new p.Z({name:oh.getName()}),dh=g.Z.getFlux().actions[ch.name];dh||lh.error("error creating actions");var mh=dh,uh=a(11167),hh=a(32872);const ph=e=>{var t;let{previousDrafts:a,draftEdits:n,context:r,factTitleAndContent:s}=e;if(!(e=>Boolean(e&&e.id&&e.content&&e.title))(n))return a;const i={content:n.content===Ee().defaults.CONTENT?s.content:n.content,preferredPhrase:n.title===Ee().defaults.TITLE?s.title:n.title},o={[n.id]:{}},l={...a}||o;let c=l[n.id];l[n.id]={...c,...i};const d=null===(t=r.data)||void 0===t?void 0:t.associatedDraftId;let m=d&&l[d];return m&&d&&(l[d]={...m,...i}),l},gh=e=>e.indexOf("new")>-1?void 0:e,fh=e=>{let{fact:t,draft:a}=e;return a?ee.n.isAutoSaved({draft:a})&&ae.C.isViewUnpublished({fact:t})?de.V.UserSaved:ee.n.type({draft:a}):de.V.AutoSaved},Eh=e=>{const{content:t,jsonContent:a,preferredPhrase:n,id:r}=ae.C.getEditorInfoFromFact({fact:e}),s=ae.C.activeDraft({editorSession:e.editorSession});return{associatedDraftId:ee.n.coercedAssociatedDraftId({draft:s}),cardId:gh(r),content:t||Ee().defaults.CONTENT,jsonContent:a,title:n||Ee().defaults.TITLE,saveType:fh({fact:e,draft:s}),contentSchemaVersion:ce.Z}},vh=e=>{let{editorData:t,previousDrafts:a,updateAutoSaveDetails:n,hasSharedDrafts:r,isNewCard:s,factId:i}=e;return(e,o)=>{const{id:l,preferredPhrase:c,content:d}=t,{data:u}=e,h=ph({previousDrafts:a,draftEdits:e.data,context:o,factTitleAndContent:{title:c,content:d}});Du.updatePreviousDrafts(l,h),n({autosaving:!1,lastAutosaved:u.lastModified||null}),r&&!s&&$.Z.createToast({content:"Draft created.",id:m.ZP.isExtension()?"".concat(E.GLOBAL,"-extension"):"fact-card-".concat(i)})}};var Ch={save:e=>{let{fact:t,previousDrafts:a,updateAutoSaveDetails:n}=e;const{id:r}=t.editFact.data,s=ae.C.activeDraft({editorSession:t.editorSession}),i=Sr.Z.hasSharedDraftsAllowed(),o=ee.n.id({draft:s});if(!(e=>{var t;let{fact:a,draft:n}=e;const r=a.editFact.data,{content:s,preferredPhrase:i}=r,o=""!==s&&""!==i,l=a.data.archived,c=null===(t=a.meta)||void 0===t?void 0:t.isTemplate,d=ae.C.canAutoSave({editorSession:a.editorSession}),m=!(0,hh.E4)(a);return!(l||c||m||!d||!o||n&&((e,t)=>{const{content:a,preferredPhrase:n}=e,{content:r,preferredPhrase:s}=t;return s===n&&r===a})(r,n))})({fact:t,draft:o&&a[o]}))return;Du.updatePreviousDrafts(r,a);const l=o?[o]:null,c=t.editFact.data,d=JSON.stringify(Eh(t)),m={data:d,success:vh({editorData:c,previousDrafts:a,updateAutoSaveDetails:n}),...l?{pathVars:l}:{}};if(ee.n.isPersisted({draft:s}))X.put(r,m);else{t.editorSession.hasCreatedDraftWhileEditing=!0;const e={data:d,success:vh({editorData:c,previousDrafts:a,updateAutoSaveDetails:n,hasSharedDrafts:i,isNewCard:t.action===oe.NEW,factId:t.id}),...l?{pathVars:l}:{}};X.post(r,e)}n({autosaving:!0,lastAutosaved:null})},updatePreviousDrafts:ph};function yh(e){let{suggestedTags:t,suggestionId:a,tagsOnFact:n,selectedTagsMeta:r}=e;const s=n.map((e=>{const{type:t,value:a,isNew:n,id:s}=r.find((t=>t.id===e.id))||{};return{type:t,wasSuggestedNew:"suggested-new"===t,isNew:n,value:a,id:s}})).map(((e,a)=>{let n={tagId:e.id,tagName:encodeURIComponent(e.value),tagOrder:a+1};return t.some((t=>t.id===e.id&&"suggested-existing"===e.type))?{...n,isFromSuggested:!0,isNew:!1}:t.some((t=>t.value===e.value&&"suggested-new"===t.type&&"suggested-new"===e.type))?{...n,isFromSuggested:!0,isNew:!0}:t.some((t=>t.value===e.value&&(e.wasSuggestedNew||e.isNew)))||e.isNew?{...n,isFromSuggested:!1,isNew:!0}:{...n,isFromSuggested:!1,isNew:!1}}));return s.length?{featureName:Na.Z.AIS_TAGS,activitySubType:Pt.default.TAGS_SELECTED,data:{suggestionId:a,task:oe.Activities.CARD_CREATION,tagsSelected:s}}:null}var bh=a(73443),Sh=a(37811),Zh=a(13798),Nh=a(23327),Ih=a(46440);const Th=e=>{let{children:t,newCardActionButtons:a,existingCardActionButtons:r,isPublishMenuOpen:s,setIsPublishMenuOpen:i,handlePublish:o}=e;return n.createElement(Ih.o.Provider,{value:{newCardActionButtons:a,existingCardActionButtons:r,isPublishMenuOpen:s,setIsPublishMenuOpen:i,handlePublish:o}},t)};var Ah=a(8509);class _h{}_h.isFactNewerThanDraft=e=>{const t=Ah.T.selectedDraft({switcher:e.editorSession.draftSwitcher,drafts:e.editorSession.drafts});return e.data.lastModified>ee.n.lastModified({draft:t})},_h.buildDraftAlertMessage=e=>{const t=Ah.T.selectedDraft({switcher:e.editorSession.draftSwitcher,drafts:e.editorSession.drafts});if(e.data.archived){const t=e.slug||e.data.slug;return n.createElement("span",null,"The published version of this Card has been archived by",n.createElement("b",null," ".concat(gt.Z.getPersonalName(e.data.lastModifiedBy))),", and must be restored in order to continue editing this draft."," ",n.createElement(Sn.Z,{to:"".concat(pe.ZP.APP_URL,"/card/").concat(t),target:"_blank"},"View archived Card"))}if(ae.C.isViewPublished({editorSession:e.editorSession}))return"A draft version of this Card exists. You can switch to it using the dropdown above.";if(null==t||!t.id)return null;if(!_h.isFactNewerThanDraft(e))return;return n.createElement("span",null,"The published version of this card was changed by",n.createElement("b",null," ".concat(gt.Z.getPersonalName(e.data.lastModifiedBy)," ")),"since you last modified this draft. ",(()=>{if(Ah.T.isVisible({switcher:e.editorSession.draftSwitcher,drafts:e.editorSession.drafts}))return;const t=e.slug||e.data.slug;return n.createElement(Sn.Z,{to:"".concat(pe.ZP.APP_URL,"/card/").concat(t),target:"_blank"},"View Published Card")})())};var wh=e=>{let{verificationState:t,nextVerificationDate:a,verificationInterval:r,verificationReasons:s,verificationType:i}=e;const o="Publish",l=null==s?void 0:s.includes(le().EXPIRED);let c,d;i===Ee().verificationIntervalType.ABSOLUTE?(d=Te().utc((0,Vl.dl)(r)).format(),c=Te().utc(a).format()):(d=Te()().add(r,"days").format(),c=Te()(a).format());const m=e=>n.createElement(It.Z,{date:e}),u=t===Vt.$Z.Untrusted?n.createElement("span",null,"This Card will remain Untrusted"):n.createElement(n.Fragment,null,n.createElement("span",null,"This Card will be trusted until "),m(c)),h=l&&i===Ee().verificationIntervalType.ABSOLUTE?n.createElement("span",null,"This Card cannot be Verified at this time because its verification date has expired and needs to be updated. You can update the interval on the published Card."):n.createElement(n.Fragment,null,n.createElement("span",null,"This Card will be trusted until "),m(d));return n.createElement("div",{className:"ghq-EditFactActionButtonsTooltipMessage"},n.createElement("p",{className:"ghq-EditFactActionButtonsTooltipMessage__label"},o),n.createElement("p",{className:"ghq-EditFactActionButtonsTooltipMessage__text"},u),n.createElement("p",{className:"ghq-EditFactActionButtonsTooltipMessage__label"},"".concat(o," and Verify")),n.createElement("p",{"data-testid":"next-verification-date-after-interval",className:"ghq-EditFactActionButtonsTooltipMessage__text"},h))};var Dh=e=>{let{fact:t}=e;const a=t.data,r={preferredXPosition:"left",preferredYPosition:"center",message:n.createElement(wh,{verificationState:null==a?void 0:a.verificationState,nextVerificationDate:null==a?void 0:a.nextVerificationDate,verificationInterval:null==a?void 0:a.verificationInterval,verificationType:null==a?void 0:a.verificationType,verificationReasons:null==a?void 0:a.verificationReasons})};return n.createElement(Xe.Z,{className:"ghq-EditFactActionButtonsTooltip",tooltipped:r,size:15,icon:"information-circle"})};var Ph=e=>{var t,a,r,s,i;let{fact:o,teamHasTemplates:l,isDisabled:c,isPublishVerifyDisabled:d,isFirstPanel:m,isLastPanel:u,isVerifier:h,handleBack:p,handleBackToCreateCard:g,handleCancel:f,handleNext:E,handleSave:v,handleSaveWithoutVerify:C}=e;const y=o.data.id,[b,S]=(0,n.useState)(!1),[Z,N]=(0,n.useState)(!0),I=(e=>{let{isFirstPanel:t,isDisabledProp:a}=e;const[{data:{userAttributes:n}}]=(0,_e.Z)();if(t)return a;const r="LIGHT"===(e=>{let{userAttributes:t}=e;return"READ_ONLY"===t.ACCESS_TYPE&&"FREE"===t.BILLING_TYPE?"LIGHT":"CORE"})({userAttributes:n});return a||r})({isFirstPanel:m,isDisabledProp:c}),[T,A]=(0,tt.Z)(y),_=o.action===oe.NEW,w=o.action===oe.EDITING,D=null===(t=o.meta)||void 0===t?void 0:t.questionId,P=ae.C.isViewUnpublished({fact:o}),k=(0,us.tq)(),L=null!==(a=null===(r=o.meta)||void 0===r?void 0:r.isTemplate)&&void 0!==a&&a,M=k?ft.qE.Small:ft.qE.Medium,O=null!==(s=null===(i=T.data.analytics)||void 0===i?void 0:i.followers)&&void 0!==s?s:0,F=!P&&h&&u,R=w&&O>0,x=R&&Z,q=L?"Save Template":"Publish Card";(0,n.useEffect)((()=>{A.post({pathVars:[y]})}),[]);const B=!P&&_&&m&&l;return n.createElement(n.Fragment,null,n.createElement(Wa.Z,{alignment:Wa.A.Right},R&&n.createElement(n.Fragment,null,n.createElement(Os.Z,{name:"notify-followers",label:"Notify",isChecked:Z,onChange:()=>{N(!Z)}}),n.createElement("div",{className:"EditFactActionsButtons__NotifyFollowers"},n.createElement(ft.ZP,{style:ft.ZJ.Anchor,label:"".concat(O," Card ").concat((0,_t.B$)("Follower",O)),onClick:()=>S(!0)})),n.createElement("div",{className:"EditFactActionsButtons__divider"})),B?n.createElement(ft.ZP,{size:M,theme:ft.bn.Gray,style:ft.ZJ.Text,label:"Back",onClick:()=>g(o)}):(!P||!m)&&n.createElement(ft.ZP,{size:M,theme:ft.bn.Gray,style:ft.ZJ.Text,label:m?"Cancel":"Back",onClick:m?()=>f(o.action):p}),D?n.createElement(ft.ZP,{disabled:I,size:M,theme:ft.bn.Primary,label:u?"Answer":"Next step",onClick:u?v():E}):n.createElement(ft.ZP,{disabled:I,size:M,theme:ft.bn.Primary,label:u?q:"Next step",onClick:u?C(x):E}),F&&n.createElement(n.Fragment,null,n.createElement(ft.ZP,{disabled:d,size:M,theme:ft.bn.Branded,label:"Publish and Verify",onClick:v(x)}),n.createElement(Dh,{fact:o}))),b?n.createElement(ot,{title:"".concat(O," ").concat((0,_t.B$)("Follower",O)),onClose:()=>S(!1)},n.createElement(At,{cardId:y})):null)},kh=a(51210);const Lh=new ii.Z;var Mh=()=>{var e;const{data:t,fetchNextPage:a,hasNextPage:n,isFetchingNextPage:r,refetch:s}=(0,ri.N)(["legacyDrafts"],(e=>(e=>{let{token:t}=e;return Lh.getPaginated({path:"/personalcarddrafts",...t&&{queryParams:{...t&&{token:t}}}})})({token:e.pageParam})),{getNextPageParam:e=>null==e?void 0:e.token});return{legacyDrafts:null!==(e=null==t?void 0:t.pages.flatMap((e=>e.data)))&&void 0!==e?e:[],fetchNextPageOfLegacyDrafts:a,hasNextPageOfLegacyDrafts:n,legacyDraftsAreLoadingNextPage:r,refetchLegacyDrafts:s}},Oh=a(69209);var Fh=e=>{let{fact:t,children:a}=e;const{data:{id:r},editorSession:{editingDraftId:s,drafts:i},messageKey:o}=t,[l,c]=(0,n.useState)("hasDrafts"in t.data&&t.data.hasDrafts&&!s),d="hasDrafts"in t.data&&t.data.hasDrafts,m=Object.keys(i)[0],[{status:h},p]=(0,Oh.Z)({filterId:r,preventOnLoad:!0}),{refetchLegacyDrafts:g}=Mh();return(0,n.useEffect)((()=>{const e=!r&&o===oe.CREATING_NEW_CARD,a=!d&&!s;if(e){t.editorSession.hasCreatedDraftWhileEditing=!0;const e={jsonContent:kh.A,preferredPhrase:"",cardId:void 0,contentSchemaVersion:ce.Z};X.post(t.id,{data:JSON.stringify(e)})}else{if(a)return t.editorSession.hasCreatedDraftWhileEditing=!0,void X.post(t.id,{data:JSON.stringify(Eh(t)),pathVars:[s]});p.get({queryParams:{cardId:r}})}}),[]),(0,n.useEffect)((()=>{m&&!s&&ae.C.switchDraft({fact:t,draft:i[m]})}),[m,s]),(0,n.useEffect)((()=>{(s||h===u.S.Loaded)&&c(!1)}),[s,h]),(0,n.useEffect)((()=>()=>{t.meta.isLegacyDraft&&g()}),[]),l?null:n.createElement(n.Fragment,null,a)},Rh=a(14381),xh=a(91781),qh=a(36930);const Bh=new ii.Z;var Vh=e=>{let{draftId:t,collectionId:a,collectionName:r}=e;const{draftCollaborators:s}=(0,xh.ZP)({draftId:t}),{data:i=[]}=(0,Il.a)(["draft",t,a,s],(()=>Bh.get({path:"/drafts/".concat(t,"/checkaccess?collectionId=").concat(a)})),{enabled:!!a}),o=i&&i.length>0,l=i&&i.length>1,c=i&&2===i.length,d=null==i?void 0:i.map(((e,t)=>{var a;const n=t===i.length-1&&l?"and ":"";var r,s;return e.type===qh.l.user?"".concat(n).concat(null===(r=e.user)||void 0===r?void 0:r.firstName," ").concat(null===(s=e.user)||void 0===s?void 0:s.lastName):"".concat(n).concat(null===(a=e.userGroup)||void 0===a?void 0:a.name," (Group)")})).join(", "),m=c?null==d?void 0:d.replace(",",""):d,u="".concat(m," ").concat(l?"don't":"doesn't"," have read and/or author\n    permissions in the ").concat(r," collection.");return o?n.createElement(Ul.Z,{customContent:!0,type:Ul.N.Alert},n.createElement("div",{className:"CollectionAccessAlert__text","data-testid":"collection-access-uppertext"},u," ",n.createElement("br",null)," You can:"),n.createElement(es.Z,{marker:es.Z.markers.DISC},n.createElement(es.H,null,"Ask an Admin to grant permissions"),n.createElement(es.H,null,"Proceed without changing permissions. ",m," ","will lose access."))):null},Uh=a(30998),Hh=a.n(Uh),Wh=a(43396),Gh=a(6634),zh=a(25108);function Yh(){return Yh=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},Yh.apply(this,arguments)}const Kh=tr()({displayName:"QuestionCollectionsSelectInput",propTypes:{label:D().string,refKey:D().string.isRequired,questionId:D().string.isRequired,selectedCollection:D().object,className:D().string,disabled:D().bool,filteredCollectionIds:D().arrayOf(D().string),handleSelected:D().func,isAnsweringWithNewCard:D().bool},mixins:[(0,ar.Z)(Gh.Z)],getDefaultProps:()=>({handleSelected:()=>{},allowedRoles:["*"],filteredCollectionIds:[],isAnsweringWithNewCard:!0}),getStoreFilterName(e){if(e===E.QuestionCollections)return this.props.questionId.concat(this.props.isAnsweringWithNewCard);zh.error("filter not set")},getStateFromFlux(){return{questionCollections:Gh.Z.getFilter(this.getStoreFilterName(E.QuestionCollections))}},UNSAFE_componentWillMount(){const{questionId:e,isAnsweringWithNewCard:t}=this.props,{questionCollections:a}=this.state;a.status===le().NOT_LOADED&&Wh.Z.get(this.getStoreFilterName(E.QuestionCollections),{pathVars:[e],queryParams:{isAnsweringWithNewCard:t.toString()}})},convertSelectedCollection(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;if(!e)return{};const a=Hh()(t,(t=>t.id===e.id)),n=Cr()(t[a])||{};return delete n.icon,delete n.type,delete n.description,n},getMenuItems(){const{questionCollections:e}=this.state;return e.items.editData.map((e=>{const{name:t,description:a,id:n,color:r}=e;return{id:n,description:a,color:r,label:t,value:n,type:"menu-item",icon:"collection"}}))},handleMenuItemSelect(e){const{handleSelected:t}=this.props,a=Cr()(e);delete a.icon,delete a.type,delete a.description,t(a),this.setState({value:a})},render(){const{selectedCollection:e,label:t,...a}=this.props,{questionCollections:r}=this.state,s=this.getMenuItems(),i=this.state.value||this.convertSelectedCollection(e,s),o=r.status===le().LOADING;return n.createElement(et.Z,Yh({},a,{label:t,handleAction:this.handleAction,handleInputChange:this.setTeamMembersSearchTerms,handleItemClick:this.handleMenuItemSelect,items:s,menuIsReloading:o,selectedItem:i,className:"ghq-QuestionsSelectInput"}))}});var jh,Jh=Kh,Qh=a(38542),Xh=a(21136);!function(e){e.Any="*"}(jh||(jh={}));var $h=e=>{let{allowedRoles:t=[jh.Any],className:a,disabled:r,required:s,filteredCollectionIds:i=[],handleSelected:o,label:l,noExternal:c=!0,placeholder:d,refKey:m,selectedCollectionId:u=""}=e;const[h]=(0,_e.Z)(),[p]=(0,du.Z)(h.data.email),[g,f]=n.useState(u),[E,v]=n.useState([]);n.useEffect((()=>{const e=p.items.editData.reduce(((e,a)=>{const{collection:{collectionType:n,color:r,emoji:s,id:o,name:l,slug:d},roles:m}=a;if(!(!c||n!==Lm.Z.EXTERNAL))return e;if(i.some((e=>e.includes(o))))return e;return!!t.includes(jh.Any)||t.some((e=>m.includes(e)))?(e.push({id:o,roles:m,emoji:s,iconColor:r,collectionType:n,slug:d,label:l,value:o}),e):e}),[]);v(e)}),[]);return n.createElement("div",{className:a},n.createElement(Xh.ZP,{requirementLabel:s?ui.Required:void 0,required:s,helperText:"Collections are organized by department or category.",disabled:r,label:l,name:m,placeholder:d,value:g,onChange:e=>{const t=E.find((t=>t.id===e));o(t),f(e)}},E.map((e=>n.createElement(Xh.N_,{customIcon:n.createElement(Qh.Z,{color:e.iconColor,emoji:e.emoji}),icon:nt.Z.CollectionFilled,iconColor:(0,wt.x9)(e.iconColor,wt.ZP.Bluejay),customColor:e.iconColor,key:e.id,label:e.label,value:e.value})))))};var ep=e=>{let{disabled:t=!1,fact:a,handleCollectionSelect:r}=e;const s=Boolean(a.meta.isTemplate),i=a.editFact.data.collection?a.editFact.data.collection.id:null,l=a.meta.forcedCollection&&!s;return o()(a,"meta.questionId")?n.createElement(Jh,{label:"Collection",placeholder:"Choose a Collection",refKey:"".concat(a.id,"-UsersCollectionsSelectInput"),handleSelected:r,selectedCollection:a.editFact.data.collection,disabled:t||a.meta.forcedCollection,questionId:a.meta.questionId,isAnsweringWithNewCard:!0}):n.createElement($h,{label:s?"Default Collection":"Collection",required:!s,placeholder:"Choose a Collection",refKey:"".concat(a.id,"-UsersCollectionsSelectInput"),handleSelected:r,allowedRoles:[Hc.S7,Hc.XG],selectedCollectionId:i,disabled:t||l})};var tp=e=>{let{fact:t}=e;const[a]=(0,_e.Z)(),[r]=function(e){const[t,a]=(0,T.Z)({filterId:e,store:oh,actions:mh,onMustLoad:t=>t.get({pathVars:[e]})});return[t,a]}(a.data.email),{status:s,data:{hasCreatedCard:i}}=r;return i||s!==oe.LOADED?null:n.createElement("div",{className:"ghq-additional-details__draft-callout"},n.createElement(gn.ZP,null,n.createElement("div",null,n.createElement("span",{className:"ghq-additional-details__draft-callout-leader"},"Collections and Boards organize Cards by topic.")," ","Not ready to publish?"," ",n.createElement(ft.ZP,{style:ft.ZJ.Anchor,label:"Save as a draft.",onClick:()=>he.save(t)}))))},ap=a(66934);f.Z.register(E.CardsAutotag,{POST:{path:"/cards/autotag"}});const np=new C.Z({name:E.CardsAutotag,dataType:E.OBJECT,transformPayloadOnPostComplete:e=>{const{data:t={}}=e,{suggestedTags:a=[]}=t;return a.forEach((e=>{if("suggested-new"!==e.type)return e;e.id=Zr.Z.getId()})),e}});np.createStore();var rp=g.Z.addStore(np.store),sp=a(25108);const ip=new p.Z({name:rp.getName()}),op=g.Z.getFlux().actions[ip.name];op||sp.error("error creating actions");var lp=op;var cp=a(70765);function dp(e){let{availableTagSuggestions:t,onAddTag:a,onCreateTag:r}=e;const{suggestedExistingMenuItems:s,suggestedNewMenuItems:i}=t.reduce(((e,t)=>{let s,i,o;switch(t.type){case"suggested-existing":s=t.value,o=e.suggestedExistingMenuItems,i=e=>{a(e)};break;case"suggested-new":s="+ ".concat(t.value),o=e.suggestedNewMenuItems,i=e=>{r(e)}}const l=n.createElement(jc.sN,{selectable:!0,type:"SUGGESTED",key:t.id,value:t,onSelect:e=>{i(e)}},n.createElement("span",null,s));return o.push(l),e}),{suggestedExistingMenuItems:[],suggestedNewMenuItems:[]});return[...s.length?[n.createElement(jc.Lb,{suggested:!0,key:"TagsMenu-menu-label-suggested-existing-tags"},"Suggested Tags"),...s]:[],...i.length?[n.createElement(jc.Lb,{suggested:!0,key:"TagsMenu-menu-label-suggested-new-tags"},"New Tags"),...i]:[]]}function mp(e){let{availableTagCategories:t,onAddTag:a}=e;return t.map((e=>{const{tags:t}=e;return[n.createElement(jc.Lb,{key:e.key},e.name),...t.map((e=>n.createElement(jc.sN,{selectable:!0,key:e.id,value:e,onSelect:e=>{a(e)}},e.value)))]}))}function up(e){let{onCreateTag:t,searchInput:a,availableTagCategories:r,currentTags:s}=e;const i=e=>e.value.toLowerCase()===a.toLowerCase(),o=n.createElement("div",null,n.createElement("div",null,"Tag not found "),n.createElement("div",null,n.createElement("b",null,"Create new tag named ",a,"?")));return r.reduce(((e,t)=>t.tags.some(i)||e),!1)||s.some(i)||!a?[]:[n.createElement(jc.sN,{wrap:!0,selectable:!0,key:"TagsMenu-menu-item-not-exact-match",value:a,onSelect:e=>{t(e)}},o)]}function hp(e){let{fact:t,tagsSuggestionId:a,availableTagSuggestions:r,availableTagCategories:s,searchInput:i,currentTags:l,closeMenu:c,onAddTag:d,onCreateTag:m,liveInputRef:u}=e;const h=n.useRef(!1);return n.useEffect((()=>{if(h.current||!r.length)return;const e=JSON.stringify([{featureName:Na.Z.AIS_TAGS,activitySubType:Pt.default.TAGS_DISPLAYED,data:{suggestionId:a,task:oe.Activities.CARD_CREATION}}]);M.Z.postActivity({type:Pt.default.TAGS_DISPLAYED,properties:{factId:t.id},biOnly:!0},{headers:{[re.Kg]:e}}),h.current=!0})),n.createElement(jc.ZP,{className:"ghq-NewFactTags__menu",wcoExemptClickOutsideElements:[o()(u.current,"decoratedComponentReference.input",null)],onClickOutside:()=>{c()}},[...dp({availableTagSuggestions:r,onCreateTag:m,onAddTag:d}),...mp({availableTagCategories:s,onAddTag:d}),...up({availableTagCategories:s,currentTags:l,searchInput:i,onCreateTag:m})])}const pp=(0,Ce.Z)((e=>e.children()));var gp=(0,ap.Z)((function(e){let{fact:t,isDisabled:a}=e;const[r]=(0,_e.Z)(),i=o()(r,"data.team.id",""),l=o()(t.editFact.data,"collection.id",""),c={data:JSON.stringify({factId:t.id,type:"auto-tag-request-config",autoTagTask:oe.Activities.TAG,teamId:i,collectionId:l,title:o()(t.editFact.data,"preferredPhrase",""),content:o()(t.editFact.data,"content","")})},[m,u]=function(e){const{collectionId:t}=e,[a,n]=(0,T.Z)({filterId:t,store:rp,actions:lp,onMustLoad:a=>t&&a.post(e)});return[a,n]}(c),[h]=(0,cp.Z)(),[p,g]=n.useState(""),f=n.useRef(null),E=n.useRef(null),v=o()(t.editFact.data,"tags",[]),C=o()(m,"data.suggestedTags",[]),y=o()(m,"data.autoTaggingSuggestionId","");n.useEffect((()=>{l&&u.post(c)}),[l]);const b=function(e,t,a,n){let r=[],s=[];return o()(n,"data",[]).forEach((e=>{s=s.concat(o()(e,"tags",[]))})),e.forEach((e=>{t.some((t=>t.value===e.value))||r.some((t=>t.value===e.value))||r.push(e)})),r=r.filter((e=>"suggested-existing"===e.type||!s.some((t=>t.value===e.value)))),a?[]:r}(C,v,p,h),S=function(e,t,a){return e.data.map((e=>{const n=o()(e,"tags",[]);return{...e,tags:n.filter((e=>!t.some((t=>t.id===e.id)))).filter((e=>e.value.toLowerCase().includes(a.toLowerCase())))}})).filter((e=>e.tags.length))}(h,v,p),Z=e=>{const a=[...v,e];g(""),d.Z.mergeMeta(t.id,{selectedTags:[...o()(t,"meta.selectedTags",[]),{type:o()(e,"type",null),value:e.value,isNew:!1,id:e.id}]}),d.Z.setTags(t.id,a)},N=e=>{const a=v.filter((t=>t.id!==e));d.Z.setTags(t.id,a)},I=e=>{const a={tagValue:o()(e,"value",e),factId:t.id,categoryId:null===(n=h.data.find((e=>e.defaultCategory)))||void 0===n?void 0:n.id,removeTag:N};var n;g("");const r=!e.type&&C.some((t=>"suggested-new"===t.type&&t.value===e.value));d.Z.mergeMeta(t.id,{selectedTags:[...o()(t,"meta.selectedTags",[]),{type:o()(e,"type",null),value:o()(e,"value",e),isNew:!0,ignoredFromSuggested:r}]}),d.Z.startCreateTag(a)};return n.createElement("div",{className:"ghq-NewFactTags"},n.createElement(jc.O_,null,(e=>{let{isMenuOpen:r,openMenu:i,closeMenu:o}=e;const l=s()("ghq-NewFactTags__search",{"ghq-is-disabled":a,"ghq-is-open":r});return n.createElement("div",{className:l,ref:f,disabled:a},n.createElement(Xe.Z,{className:"ghq-NewFactTags__icon",icon:"search",size:18}),n.createElement(cu.Z,{focusOnMount:!1,type:"text",className:"ghq-NewFactTags__input",value:p,ref:E,placeholder:"Add existing tags, or create a new one",handleInputChange:e=>{g(e)},handleAction:()=>{},onClick:()=>{r||(i(),(()=>{const e=JSON.stringify([{featureName:Na.Z.AIS_TAGS,activitySubType:Pt.default.TAGS_DROPDOWN_OPENED,data:{suggestionId:y,task:oe.Activities.CARD_CREATION}}]);M.Z.postActivity({type:Pt.default.TAGS_DROPDOWN_OPENED,properties:{factId:t.id},biOnly:!0},{headers:{[re.Kg]:e}})})())}}),n.createElement(pp,{handleEscape:e=>{o(),e.preventDefault(),e.stopPropagation()}},(()=>r?n.createElement(Ac.Z,{sameWidthAsTarget:!0,target:f.current},n.createElement(hp,{fact:t,tagsSuggestionId:y,liveInputRef:E,availableTagSuggestions:b,availableTagCategories:S,currentTags:v,searchInput:p,closeMenu:o,onAddTag:function(){Z(...arguments)},onCreateTag:function(){I(...arguments),o()}})):null)))})),n.createElement("div",{className:"ghq-NewFactTags__current-tags"},v.map((e=>n.createElement(fi.Z,{key:e.id,id:e.id,label:e.value,removeChip:e=>N(e)})))))}));var fp=e=>{let{fact:t,hasAutoTaggingEnabled:a}=e;const r=Boolean(t.meta.isTemplate),s=!t.editFact.data.collection;return a&&!r?n.createElement(gp,{fact:t,isDisabled:s,popoverFilterId:"".concat(t.id,"-new-fact-tags-menu")}):n.createElement(Kd,{fact:t,isDisabled:s})};var Ep=e=>{var t,a,r;let{fact:s,hasAutoTaggingEnabled:i}=e;const[o]=(0,Ue.Z)(Ne.Z.NAVARCHY_P2_ALLOWED),l=Boolean(null==s||null===(t=s.meta)||void 0===t?void 0:t.isTemplate),c=l?"Default Tags":"Tags",d=null==s||null===(a=s.editFact)||void 0===a||null===(r=a.data)||void 0===r||!r.collection;return n.createElement(n.Fragment,null,n.createElement("div",{className:"ghq-additional-details__input"},n.createElement(Li,{required:o,fact:s,isDisabled:d,isTemplate:l})),n.createElement("div",{className:"ghq-additional-details__input"},n.createElement("div",{className:"ghq-additional-details__input-label"},c),n.createElement(fp,{fact:s,hasAutoTaggingEnabled:i}),n.createElement("div",{className:"ghq-additional-details__input-helper"},"Tags help users search for Cards faster.")))};var vp=e=>{var t,a;let{fact:r,handleClose:i,hasAutoTaggingEnabled:o}=e;const[{data:{email:l}}]=(0,_e.Z)(),c=Sr.Z.hasFeature(Ne.Z.PUBLISH_MESSAGES_ALLOWED),m=Sr.Z.hasFeature(Ne.Z.SHARED_DRAFTS_ALLOWED),[h]=(0,du.Z)(l),p=s()("ghq-additional-details",{"ghq-is-loading":h.status!==u.S.Loaded}),g=Boolean(r.meta.isTemplate),f=e=>{const t=h.items.data.find((t=>t.collection.id===e.value));d.Z.editCollection(r.id,t.collection)},E=!g,v=c&&!g?()=>n.createElement(Rh.Z,null):null,C=null===(t=r.editFact.data.collection)||void 0===t?void 0:t.id,y=null===(a=r.editFact.data.collection)||void 0===a?void 0:a.name,b=r.editorSession.editingDraftId;return n.createElement("div",{className:p},h.status===u.S.Loaded&&n.createElement(ei,{renderButtons:v,renderTitle:()=>"".concat(g?"Template":"Card"," Settings"),renderContent:()=>n.createElement("div",{className:"ghq-additional-details__content"},g&&n.createElement(gn.ZP,{spacing:gn.sJ.Short},"Set defaults below if you would like certain Card Settings to display by default when Authors create Cards from this Template."),n.createElement(ja.ZP,{level:ja.Yx.H2,style:ja.VH.Medium},"Collection settings"),E&&n.createElement(tp,{fact:r}),n.createElement("div",{className:"ghq-additional-details__input"},n.createElement(ep,{fact:r,handleCollectionSelect:f})),m&&n.createElement(Vh,{draftId:b,collectionId:C,collectionName:y}),n.createElement(Ep,{fact:r,hasAutoTaggingEnabled:o})),onClickClose:i}))};var Cp=function(e){let{fact:t,onClose:a}=e;const r=Sr.Z.hasFeature(Ne.Z.PUBLISH_MESSAGES_ALLOWED),s=o()(t.meta,"isTemplate",!1),i=s?"Default Verifier":"Verifier",l=s?"Default Verification Interval":"Verification Interval",c=Boolean(t.editFact.data.collection),d=s&&!c,m=r&&!s?()=>n.createElement(Rh.Z,null):null;return n.createElement("div",{className:"ghq-additional-details"},n.createElement(ei,{renderButtons:m,renderTitle:()=>"".concat(s?"Template":"Card"," Settings"),renderContent:()=>n.createElement("div",{className:"ghq-additional-details__content"},s&&n.createElement(gn.ZP,{spacing:gn.sJ.Short},"Set defaults below if you would like certain Card Settings to display by default when Authors create Cards from this Template."),n.createElement(ja.ZP,{level:ja.Yx.H2,style:ja.VH.Medium},"Verification settings"),n.createElement("div",{className:"ghq-additional-details__section"},n.createElement(od,{id:t.id,disabled:d,placeholder:d?"To set a Verifier, go back and choose a Collection":null,verifierLabel:i,verificationIntervalLabel:l})),!s&&n.createElement(fo,null)),onClickClose:a}))};var yp=e=>{var t,a,r;let{fact:s,isDisabled:i,handleSaveDraft:o}=e;s.action,oe.NEW;const l=null===(t=s.meta)||void 0===t?void 0:t.isTemplate,c=ae.C.isViewUnpublished({fact:s}),d=s.action===oe.EDITING&&ae.C.isViewPublished({editorSession:s.editorSession}),m=null===(a=s.data)||void 0===a?void 0:a.hasDrafts,u=null===(r=s.editorSession)||void 0===r?void 0:r.hasCreatedDraftWhileEditing;let h;if(l||d&&m&&!u)return null;h=!c;const p=h?"Save as draft":"Save draft",g=(0,us.tq)()?Ls.Z.sizes.SMALL:Ls.Z.sizes.MEDIUM;return n.createElement(Ls.Z,{kind:Ls.Z.kinds.GRAY,size:g,disabled:i,onClick:()=>{o({isSaveAsDraft:h})}},p)},bp=a(5320),Sp=a(24839);const Zp=function(e,t){const a={content:t.content,preferredPhrase:t.preferredPhrase||t.title};return t.jsonContent&&(a.jsonContent=t.jsonContent),e.null=a,e},Np=function(e,t,a){const n={content:t.content,preferredPhrase:t.preferredPhrase||t.title};return t.jsonContent&&(n.jsonContent=t.jsonContent),e[a]=n,e};const Ip=new ra.Z({name:E.DraftsAutosave,syncFilters:!1,dataType:E.OBJECT,boundActions:[Wt.UPDATE_PREVIOUS_DRAFTS,function(e){const{filter:t}=e,a=Object.assign({},e.payload);this._getFilter(t).editData=a,this._onChange()},f.Z[Sp.Z.getName()].GET.action+Wt._COMPLETE,function(e){const t=e.context.filterId,a=e.context.queryParams,n=""===e.data?[]:e.data?e.data:[];if(a){const e=this._getFilter(t);n.forEach((t=>{Np(e.editData,t,ee.n.id({draft:t}))})),this._onChange()}},Wt.CREATE_FACT,function(e){const t=e.newId,a=this._getFilter(t),n=e.editorSession&&e.editorSession.draftSwitcher.selectedDraftId;n?Np(a.editData,e,n):Zp(a.editData,e),this._onChange()},Wt.LOAD_FACT_COMPLETE,function(e){const t=e.data,a=t.id,n=this._getFilter(a);Zp(n.editData,t),this._onChange()},f.Z[K.Z.getName()].DELETE.action+Wt._COMPLETE,function(e){var t;const a=null===(t=e.context)||void 0===t?void 0:t.factId,n=e.context.pathVars[0];if(a){delete this._getFilter(a).editData[n],this._onChange()}}]});Ip.createStore();var Tp=g.Z.addStore(Ip.store),Ap=a(49768),_p=a(64804),wp=a(25108);const Dp=new ii.Z,Pp=(e,t)=>{switch(e){case E.UsersCollections:case vc.getName():case rp.getName():return E.GLOBAL;case Ap.Z.getName():const e=nd.Z.getBySearchId(o()(t,"fact.id",null)),a=o()(e,"data",[]).filter((e=>"user-group"===e.type));if(a.length)return a[0].id;break;case U.Z.getName():return E.GLOBAL;default:return void wp.error("filter not set")}};class kp extends n.Component{constructor(e){super(e),this.fact=void 0,this.debouncedAutoSave=_()((()=>{const{disableDraftSaves:e,fact:t,previousDraft:a}=this.props;if(this.isAutosaving()||e)return;const n=t.editorSession.editingDraftId;t.meta.isLegacyDraft&&n?Dp.put({path:"/personalcarddrafts/".concat(n),body:Eh(t)}):Ch.save({fact:t,previousDrafts:a,updateAutoSaveDetails:e=>{this.setState(e)}})}),2e3),this.handleBack=()=>{this.setState({prevIndex:this.state.currentIndex}),this.setState({currentIndex:this.state.currentIndex-1})},this.handleBackToCreateCard=e=>{const t=e.editFact.data.content,a=e.editFact.data.preferredPhrase,n=e.meta.templateTitle,r=e.meta.templateDescription;e.meta.isTemplate||!a&&!t?e.meta.isTemplate&&(t||a||n||r)?d.Z.startCustomConfirmKey(e.id,"backFromTemplate"):(d.Z.setFactMessage({factId:e.id,messageKey:oe.CREATING_NEW_CARD}),d.Z.mergeMeta(e.id,{isTemplate:null,contentFromTemplate:null,templateTitle:"",templateDescription:"",templateId:null}),d.Z.editJSONContent(e.id,""),d.Z.editContent(e.id,""),d.Z.editTitle(e.id,""),$m.clearStore(),d.Z.editCollection(e.id,null),Ai.Z.clear(),d.Z.setTags(e.id,[]),Y.Z.setEditVerifier(e.id,this.getSelf()),d.Z.setVerificationInterval(e.id,90)):d.Z.startCustomConfirmKey(e.id,"backFromCard")},this.handleNext=()=>{const{fact:e,boards:t,usersCollections:a,disableDraftSaves:n}=this.props,{currentIndex:r,prevIndex:s}=this.state;(0,hh.$1)({fact:e,boards:t,prevIndex:s,currentIndex:r,usersCollections:a,disableDraftSaves:n})&&(this.setState({prevIndex:this.state.currentIndex}),this.setState({currentIndex:this.state.currentIndex+1}))},this.getSelf=()=>({id:Pe.Z.getEmail(),user:{email:Pe.Z.getEmail(),firstName:Pe.Z.getFirstName(),lastName:Pe.Z.getLastName()},type:"user"}),this.getKnowledgeClipperHeaders=()=>{const{fact:e}=this.props;return{activitySubType:Pt.default.CLIPPER_CREATE_CARD_FINISHED,activitySource:e.clipperURLSource}},this.getAISuggestExpertsTrackingHeaders=()=>{const{verifiers:e,suggestedVerifiers:t}=this.props;let a=e.editData[0];if(!a)return{};const n={[re.$2]:oe.Activities.CARD_CREATION,[re.eB]:Pt.default.VERIFIER_SELECTED,[re.s3]:a.user?a.user.email:a.userGroup.id,[re.e2]:!1,[re.RX]:o()(t,"expertSuggestionId",null)},r=a.user?Boolean(a.user.expertIdRank):Boolean(a.userGroup.expertIdRank);return this.getSelf().id===a.id?{...n,[re.eB]:Pt.default.DEFAULT_VERIFIER_SELECTED}:r?{...n,[re.e2]:!0}:n},this.getActivityTrackingHeaders=()=>{const{fact:e,cardsAutotagStoreData:t}=this.props,{confirmKey:a}=e,n=o()(t,"suggestedTags",[]),r=o()(t,"autoTaggingSuggestionId",null),s=o()(e,"editFact.data.tags",[]),i=o()(e.meta,"selectedTags",[]),l=this.getAISuggestExpertsTrackingHeaders(),c=yh({suggestedTags:n,suggestionId:r,tagsOnFact:s,selectedTagsMeta:i}),d=rh()([c]);[Pt.default.CLIPPER_CREATE_CARD_CLICKED,Pt.default.CLIPPER_SEARCH_CLICKED].includes(a)&&d.push(this.getKnowledgeClipperHeaders());const m={featureName:Pt.default.CARD_CREATED,data:{source:JSON.parse(localStorage.getItem(Sh.F.CardCreationSource))}};d.push(m);return{...l,...d.length>0&&{[re.Kg]:JSON.stringify(d)}}},this.handlePublish=e=>{let{notifyFollowers:t,verifyCard:a,revisionNote:n}=e;const{fact:r,board:s,isVerifier:i}=this.props,{id:o,boardId:l,action:c,editFact:{data:{verificationInterval:m,verificationType:u}}}=r,h=Boolean(r.meta.isTemplate),p=i||r.action===oe.EDITING||!(0,hh.$g)({verificationInterval:m,verificationType:u});let g=null;if(s&&(g=e=>{const t=Cr()(s.editBoard.items);t.some((t=>t.id===e.data.id&&(t=e.data,!0)))||t.unshift(e.data);const a={items:t};Km.Z.changeBoard(s.id,a)}),p)if(h){const e=r.editFact.data.collection?{id:r.editFact.data.collection.id}:null,{content:t,jsonContent:a,shareStatus:n}=r.editFact.data,s={content:t,jsonContent:a,shareStatus:n,verificationInterval:m,boards:Ai.Z.getByFactId(o).editData.filter(Boolean),cardVerifier:nd.Z.getBySearchId(o).editData[0],templateTitle:r.meta.templateTitle,description:r.meta.templateDescription,cardTitle:r.editFact.data.preferredPhrase,collection:e,tags:r.editFact.data.tags,factId:o,contentSchemaVersion:ce.Z},i={data:JSON.stringify(s),success:()=>{d.Z.discardAllFacts()}};r.meta.contentFromTemplate?(i.pathVars=[r.meta.contentFromTemplate.id],z.put(r.meta.contentFromTemplate.id,i)):z.post(o,i)}else{const e={extended:c===oe.NEW,collectionId:r.editFact.data.collection.id,hideAfter:l&&c===oe.NEW,clearFile:!0,suppressVerification:!a,notifyFollowers:t,revisionNote:n,headers:c===oe.NEW?this.getActivityTrackingHeaders():{},callback:g};Boolean(r.meta.templateId)&&(e.cardTemplateId=r.meta.templateId),mh.clearStore(),d.Z.saveFact(o,e),localStorage.removeItem(Sh.F.CardCreationSource)}ts.Z.clearQuery("template_id")},this.handleSave=e=>()=>{const{fact:t,board:a,isVerifier:n}=this.props,{id:r,boardId:s,action:i,editFact:{data:{verificationInterval:l,verificationType:c}}}=t,m=e=>{if(a){const t=Cr()(a.editBoard.items);t.some((t=>t.id===e.data.id&&(t=e.data,!0)))||t.unshift(e.data);const n={items:t};Km.Z.changeBoard(a.id,n)}t.meta.isLegacyDraft=!1};if(n||t.action===oe.EDITING||!(0,hh.$g)({verificationInterval:l,verificationType:c})){const a={extended:i===oe.NEW,collectionId:t.editFact.data.collection.id,hideAfter:s&&i===oe.NEW,clearFile:!0,notifyFollowers:e,callback:m};o()(t,"meta.questionId")&&(a.questionId=t.meta.questionId),d.Z.saveFact(r,a),ts.Z.clearQuery("template_id")}},this.handleSaveWithoutVerify=e=>()=>{const{fact:t,isVerifier:a,boards:n}=this.props,{id:r,boardId:s,action:i,editFact:{data:{verificationInterval:o,verificationType:l}}}=t,c=Boolean(t.meta.isTemplate);if(a||t.action===oe.EDITING||!(0,hh.$g)({verificationInterval:o,verificationType:l}))if(c){const e=t.editFact.data.collection?{id:t.editFact.data.collection.id}:null,{content:a,jsonContent:s,shareStatus:i}=t.editFact.data,l={content:a,jsonContent:s,shareStatus:i,verificationInterval:o,boards:n,cardVerifier:nd.Z.getBySearchId(r).editData[0],templateTitle:t.meta.templateTitle,description:t.meta.templateDescription,cardTitle:t.editFact.data.preferredPhrase,collection:e,tags:t.editFact.data.tags,factId:r,contentSchemaVersion:ce.Z},c={data:JSON.stringify(l),success:()=>{d.Z.discardAllFacts()}};t.meta.contentFromTemplate?(c.pathVars=[t.meta.contentFromTemplate.id],z.put(t.meta.contentFromTemplate.id,c)):z.post(r,c)}else{const a={extended:i===oe.NEW,collectionId:t.editFact.data.collection.id,hideAfter:s&&i===oe.NEW,clearFile:!0,suppressVerification:!0,notifyFollowers:e,headers:i===oe.NEW?this.getActivityTrackingHeaders():{},callback:()=>{t.meta.isLegacyDraft=!1}};Boolean(t.meta.templateId)&&(a.cardTemplateId=t.meta.templateId),mh.clearStore(),d.Z.saveFact(r,a),t.meta.isLegacyDraft=!1,localStorage.removeItem(Sh.F.CardCreationSource)}ts.Z.clearQuery("template_id")},this.handleClose=()=>{const{fact:e,hasSharedDrafts:t}=this.props,a=Object.keys(e.editorSession.drafts)[0],n=e.editorSession.drafts[a],r=e.editorSession.hasCreatedDraftWhileEditing,s=!(0,bh.Id)(e)&&r&&t;!ae.C.isViewUnpublished({fact:e})||e.data.archived||t?(s&&X.delete(E.GLOBAL,{meta:{factId:ee.n.cardId({draft:n})},pathVars:[ee.n.id({draft:n})]}),e.meta.isLegacyDraft&&Dp.put({path:"/personalcarddrafts/".concat(e.editorSession.editingDraftId),body:Eh(e)}),d.Z.discardFact(e.id,{doNotConfirm:t})):he.save(e),e.onCancel&&e.onCancel(),ts.Z.clearQuery("template_id")},this.handleCancel=e=>{const{fact:t}=this.props;e===oe.NEW?d.Z.discardFact(t.id,{doNotConfirm:!0}):d.Z.cancelEdit(t.id),t.onCancel&&t.onCancel(),ts.Z.clearQuery("template_id")},this.focusEditor=()=>{const{fact:e}=this.props;$m.updateFactEditorCustom(e.id,(e=>{const t=e.value.document.getBlocks().get(0);e.focus().moveToEndOfNode(t)}))},this.renderFactDetails=()=>{const{fact:e,isMaximized:t,hasSharedDrafts:a}=this.props,{autosaving:r,lastAutosaved:i}=this.state,o=s()("ghq-edit-fact__editor",{"ghq-is-maximized":t,"ghq-is-mobile":(0,us.tq)()}),l=ae.C.shouldShowDraftAlert({fact:e})&&!a?_h.buildDraftAlertMessage(e):null,c=n.createElement(om.Z,{fact:e,autosaving:r,lastAutosaved:i,editTitle:void 0,editContent:void 0,editJSONContent:void 0,alertMessage:l,draftsViewCounter:e.editorSession.draftDisplayCounter,isArchived:Boolean(e.data.archived),isTemplate:e.meta.isTemplate,readOnly:!1,onClose:this.handleClose});return a?n.createElement("div",{className:o},n.createElement(Fh,{fact:e},c)):n.createElement("div",{className:o},c)},this.setIsPublishMenuOpen=e=>{this.setState({isPublishMenuOpen:e})};const{fact:t,hasAutoTaggingEnabled:a,hasCardAttributes:r}=this.props,i=[this.renderFactDetails];this.props.fact.action===oe.NEW&&(i.push((()=>n.createElement(vp,{fact:t,handleClose:this.handleClose,hasAutoTaggingEnabled:a}))),i.push((()=>n.createElement(Cp,{fact:this.props.fact,onClose:this.handleClose})))),r&&this.props.fact.action===oe.NEW&&o()(R.getFilter(Pe.Z.getTeamId()),"items.data",[]).length>0&&i.push((()=>n.createElement(im,{id:t.id,onClose:this.handleClose}))),this.state={panels:i,currentIndex:0,prevIndex:0,autosaving:!1,lastAutosaved:"",isPublishMenuOpen:!1}}componentDidMount(){const{auth:e,fact:t,usersCollections:a}=this.props;if(a.status===oe.NOT_LOADED){const{email:t}=e.data,a={pathVars:[t]};uh.Z.get(Pp(E.UsersCollections,this.props),a)}if(!(0,hh.t3)(a)&&a.status===oe.LOADED){const e=Dc()(a.items.data,(e=>e.roles.includes(Nh.u.Author)||e.roles.includes(Nh.u.CollAdmin)));d.Z.editCollection(t.id,null==e?void 0:e.collection)}this.props.onMount(),this.checkHasCreatedCard()}checkHasCreatedCard(){const{auth:{data:{email:e}}}=this.props;oh.getFilter(e).status===oe.NOT_LOADED&&mh.get(e,{pathVars:[e]})}isAutosaving(){const{autosaving:e}=this.state;return e}componentDidUpdate(e){var t;const{fact:a,usersCollections:n,hasMultiplayerEnabled:r}=this.props,s=!(null!==(t=a.meta)&&void 0!==t&&t.isCreateCardModalOpen),i=a.meta.isLegacyDraft;if((s&&!r||i&&r)&&this.debouncedAutoSave(),n.status===oe.LOADED&&e.usersCollections.status!==oe.LOADED&&!(0,hh.t3)(n)){const e=Dc()(n.items.data,(e=>e.roles.includes(Nh.u.Author)||e.roles.includes(Nh.u.CollAdmin)));d.Z.editCollection(a.id,null==e?void 0:e.collection)}this.props.onUpdate()}render(){var e,t,a,r;const{currentIndex:i,panels:o,prevIndex:l,isPublishMenuOpen:c}=this.state,{fact:d,boards:u,isVerifier:h,hasPublishMessageFF:p,hasMultiplayerEnabled:g,teamHasTemplates:f,usersCollections:E,disableDraftSaves:v,hasSharedDrafts:C}=this.props,y=s()("ghq-edit-fact__bottom-bar",{"ghq-can-drag":(0,m.p1)(),"ghq-has-publish-message-ff":p}),b=o[i](),S=o.length===i+1,Z=0===i,N=d.action===oe.EDITING,I=!(0,hh.$1)({fact:d,boards:u,prevIndex:l,currentIndex:i,isVerifier:h,ignoreVerificationStatus:N,usersCollections:E,disableDraftSaves:v}),T=!(0,hh.$1)({fact:d,boards:u,prevIndex:l,currentIndex:i,usersCollections:E,disableDraftSaves:v}),A=I&&Z;(0,Zh.Li)("In editfact",JSON.stringify({fact:d}));const _=s()("ghq-edit-fact__content",{"ghq-is-extension":(0,m.p1)()}),w=null!==(e=null===(t=d.meta)||void 0===t?void 0:t.isTemplate)&&void 0!==e&&e,D=null!==(a=null===(r=d.meta)||void 0===r?void 0:r.questionId)&&void 0!==a&&a,P=w?"Save Template":"Publish",k=[{label:Z?"Close":"Back",disabled:!1,theme:ft.bn.Gray,style:ft.ZJ.Outline,onClick:Z?this.handleClose:this.handleBack},{label:(0,hh.Bw)({isQuestion:Boolean(D),isLastPanel:S,lastPanelButtonTextForNewPublishFlow:P}),disabled:I,theme:ft.bn.Dark,style:ft.ZJ.Outline,onClick:S?this.handleSaveWithoutVerify(!0):this.handleNext}],L=[{label:"Close",disabled:!1,theme:ft.bn.Gray,style:ft.ZJ.Outline,onClick:this.handleClose},{label:"Publish",disabled:!1,theme:ft.bn.Dark,style:ft.ZJ.Outline,onClick:()=>this.setIsPublishMenuOpen(!c)}],M=g&&C;return n.createElement("div",{className:"ghq-edit-fact",ref:e=>{this.fact=e}},n.createElement(Th,{newCardActionButtons:k,existingCardActionButtons:L,isPublishMenuOpen:c,setIsPublishMenuOpen:this.setIsPublishMenuOpen,handlePublish:this.handlePublish},n.createElement("div",{className:_},b)),p?null:n.createElement("div",{className:y},n.createElement("div",{className:"ghq-edit-fact__bottom-bar-left-content"},!M&&!C&&n.createElement(yp,{fact:d,isDisabled:A,handleSaveDraft:e=>{let{isSaveAsDraft:t}=e;he.save(d,{isSaveAsDraft:t}),ts.Z.clearQuery("template_id")}})),n.createElement("div",{className:"ghq-edit-fact__bottom-bar-right-content"},n.createElement(Ph,{fact:d,teamHasTemplates:f,isDisabled:I,isPublishVerifyDisabled:T,isFirstPanel:Z,isLastPanel:S,isVerifier:h,handleBack:this.handleBack,handleBackToCreateCard:this.handleBackToCreateCard,handleCancel:this.handleCancel,handleNext:this.handleNext,handleSave:this.handleSave,handleSaveWithoutVerify:this.handleSaveWithoutVerify}))),p&&w?n.createElement("div",{className:y},n.createElement("div",{className:"ghq-edit-fact__bottom-bar-right-content"},n.createElement(Ph,{fact:d,teamHasTemplates:f,isDisabled:I,isPublishVerifyDisabled:T,isFirstPanel:Z,isLastPanel:S,isVerifier:h,handleBack:this.handleBack,handleBackToCreateCard:this.handleBackToCreateCard,handleCancel:this.handleCancel,handleNext:this.handleNext,handleSave:this.handleSave,handleSaveWithoutVerify:this.handleSaveWithoutVerify}))):null)}}function Lp(e,t){let{verifiers:a,groupMembers:n,props:r}=t;if(e.startsWith("new"))return;if(a.status===oe.NOT_LOADED&&Y.Z.loadVerifiers(e),!o()(a,"data[0]"))return;a.status===oe.LOADED&&"user"!==a.data[0].type&&a.data[0].id&&n.status===oe.NOT_LOADED&&sh.Z.get(Pp(Ap.Z.getName(),r),{pathVars:[a.data[0].id]})}var Mp=(0,be.EN)((0,ye.ey)((0,h.Z)(((e,t)=>{const{fact:a}=t;let n=null;a.board&&(n=bp.Z.getByBoardId(a.board.id));const r=Pe.Z.getState(),s=nd.Z.getBySearchId(a.id),i=vc.getFilter(Pp(vc.getName(),t)),l=o()(rp.getFilter(Pp(rp.getName(),t)),"data",{}),c=i.items.data[0],d=Pp(Ap.Z.getName(),t),m=d?Ap.Z.getFilter(d):null,u=s.data.some((e=>{if("user"===e.type)return e.user.email===r.data.email}))||m&&m.items.data.some((e=>e.user.email===r.data.email)),h=Sr.Z.hasFeature(Ne.Z.AUTO_TAGGING_ALLOWED),p=Sr.Z.hasFeature(Ne.Z.MULTIPLAYER_EDITING_ALLOWED),g=Sr.Z.hasCardAttributes(),f=U.Z.getFilter(Pp(E.TemplatesCards,t)),v=Tp.getFilter(a.editFact.data.id).editData,C=Sr.Z.hasSharedDraftsAllowed(),y=Sr.Z.hasFeature(Ne.Z.PUBLISH_MESSAGES_ALLOWED);return{auth:r,usersCollections:_p.Z.getFilter(Pp(E.UsersCollections,t)),board:n,boards:Ai.Z.getByFactId(a.id).editData.filter(Boolean),hasSharedDrafts:C,previousDraft:v,isVerifier:u,verifiers:s,suggestedVerifiers:c,cardsAutotagStoreData:l,hasAutoTaggingEnabled:h,hasMultiplayerEnabled:p,hasCardAttributes:g,hasPublishMessageFF:y,teamHasTemplates:Boolean(f.items.data.length),onMount:()=>Lp(a.id,{verifiers:s,groupMembers:m,props:t}),onUpdate:()=>Lp(a.id,{verifiers:s,groupMembers:m,props:t})}}))([_p.Z,Pe.Z,bp.Z,Ai.Z,Tp,Sr.Z,nd.Z,Ap.Z,vc,rp,U.Z],kp))),Op=a(28523),Fp=a(4445),Rp=a(21576);var xp=e=>{let{canEdit:t=!1,changeView:a,fact:r,verifiers:s}=e;const[i]=(0,_e.Z)(),[o]=Ve(r.id||r.data.id),l=o.canVerify,c=i.data.email===r.data.owner.email,d=gt.Z.getPersonalName(r.data.owner),m=(()=>{const e=s.data[0];if(!e)return Ee().verifier.UNASSIGNED;if("user-group"===e.type)return e.userGroup.name;if("user"===e.type){const t=e.user.email===i.data.email;return c&&t?"Yourself":t?"You":gt.Z.getNameFromModel(e.user)}return null})(),u=t&&(l||c),h=Te()(r.data.dateCreated).fromNow();return n.createElement("div",{className:"ghq-question-label"},n.createElement("div",{className:"ghq-question-label__info"},n.createElement("p",null,n.createElement("strong",null,d," "),n.createElement("span",null,"asked "),m&&n.createElement("strong",null,m," ")),u?n.createElement(ft.ZP,{label:"(change)",style:ft.ZJ.Anchor,onClick:()=>a(le().Views.CHANGE_ANSWERER)}):null,n.createElement("p",{className:"ghq-question-label__time"},h)),n.createElement("p",{className:"ghq-question-label__title"},r.data.preferredPhrase))},qp=a(51710),Bp=a(26965);var Vp=e=>{let{fact:t}=e;const a=(0,n.useRef)("omnisearch"),r="question-search-".concat(t.data.id);return n.createElement("div",{className:"ghq-question-search-card-container"},n.createElement(Bp.Z,{label:"Search all Cards",name:r}),n.createElement(qp.Z,{inputId:r,isAnsweringWithNewCard:!1,questionId:t.data.id,ref:a,refKey:t.data.id}))},Up=a(18512),Hp=a(97674),Wp=a(81992);var Gp=e=>{let{changeView:t,closeButton:a,fact:r,verifiers:s}=e;const[i,o]=(0,Rp.Z)(r.data.id),[l,c]=(0,n.useState)(null),u=(()=>{let e=[];return i.data&&(e=i.data.map(((e,t)=>{const a=e.id===l,{searchId:r,searchSessionId:s}=i,o=r?t:null,d=r?le().Activities.SEARCH:le().Activities.BROWSE,m=n.createElement(uu.Z,null,n.createElement(uu.S,{aria:"Open Card",icon:nt.Z.Launch,tooltipLabel:"Open Card",onClick:()=>{(0,Wp.d)({card:e,activity:d,searchId:r,searchSessionId:s,searchPosition:o})}}));return n.createElement(es.H,{key:e.id},n.createElement(Hp.Z,{activity:d,buttonBar:m,card:e,isSelected:a,searchId:r,searchSessionId:s,searchPosition:o,onClick:t=>((e,t)=>{null==t||t.preventDefault(),c(l===e?null:e)})(e.id,t)}))}))),e})(),h=n.createElement(Wa.Z,{alignment:Wa.A.Right},n.createElement(ft.ZP,{label:"Back",style:ft.ZJ.Text,theme:ft.bn.Gray,onClick:()=>{d.Z.setAction(r.id,null),o.clear(r.data.id),t(le().Views.DISCUSSION)}}),n.createElement(ft.ZP,{disabled:null===l,label:"Answer question",theme:ft.bn.Primary,onClick:()=>{Fp.Z.answerQuestionWithCard(r.data.id,l,{context:{fact:r}})}}));return n.createElement(it.ZP,{scrollable:!0},n.createElement(it.MM,{appendage:a,draggable:m.ZP.isExtension()},"Answer with an existing Card"),n.createElement(it.R3,null,n.createElement(xp,{fact:r,verifiers:s}),n.createElement(Vp,{fact:r}),u.length||i.status===le().NOT_SEARCHED?n.createElement(es.Z,{spacing:es.Z.spaces.TIGHT},u):n.createElement(Up.Z,{key:"searchmsg",searchState:i.status,searchedMessage:"No Cards were found. Choose a different search term or click 'Back' and select 'Create new Card' to answer this question."})),n.createElement(it.v3,{draggable:m.ZP.isExtension()},h))},zp=a(24163),Yp=a(32950);const Kp=e=>{let{onCancel:t,onSave:a}=e;return n.createElement("div",{className:"ghq-comment-edit-meta-container"},n.createElement("div",{className:"ghq-cancel-comment-edit"},"esc to"," ",n.createElement("span",{className:"ghq-comment-action-text",onClick:t},"cancel")),n.createElement("div",{className:"ghq-save-comment-edit"},"enter to"," ",n.createElement("span",{className:"ghq-comment-action-text",onClick:a},"save changes")))},jp=e=>{let{owner:t,isError:a}=e;return a?n.createElement("div",{className:"ghq-cmt-pic-container ghq-is-error"},n.createElement(Xe.Z,{icon:"alert",size:22})):n.createElement("div",{className:"ghq-cmt-pic-container"},n.createElement(pn.Z,{size:pn.Z.sizes.SMALL,src:xn.ZP.getProfileUrl(t.profilePicUrl),initials:gt.Z.getUsersInitials(t),alt:gt.Z.getNameFromModel(t)}))},Jp=tr()({displayName:"CommentRow",mixins:[br.Mixin("editComment")],getInitialState(){return{showNameMenu:!1,startSelection:-1,endSelection:-1,searchNameText:null,isEditing:!1,commentText:this.props.comment.editData.content}},componentDidMount(){this.forceUpdate()},componentDidUpdate(e,t){if(this.state.isEditing&&!t.isEditing){var a=P.findDOMNode(this.refs.editComment);const e=90;a.focus(),a.value="",a.value=this.state.commentText;const t=a.scrollHeight;a.style.height="auto",a.style.height=Math.min(t,e)+"px",a.scrollTop=t,a.oninput=function(){const t=a.scrollHeight;a.style.height="auto",a.style.height=Math.min(t,e)+"px"}}},isCommentOwner(){return this.props.comment.editData.owner.email===this.props.auth.data.email},deleteComment(){const{fact:e,comment:t,commentsStoreFilterId:a}=this.props;Ot.Z.delete(a,{pathVars:[e.data.id,t.editData.id]})},editComment(){const e=this.props.comment.editData.content;this.setState({commentText:e,isEditing:!0})},unresolveComment(){const{fact:e,comment:t,commentsStoreFilterId:a}=this.props,n={pathVars:[e.data.id,t.editData.id],success:()=>{$.Z.createToast({content:"Your comment has been reopened"})},error:()=>{$.Z.createToast({content:"Uh oh! Something went wrong.",id:E.GLOBAL,type:Lo().ERROR})}};zp.Z.put(a,n)},useAsAnswer(){this.dismissMenu(),this.props.onAnswer(this.state.commentText)},checkForSaveCancel(e){var t=!0;switch(e.keyCode){case na.ZP.Enter:e.shiftKey||(this.saveEdit(),t=!1);break;case na.ZP.Escape:this.cancelEdit(),t=!1}t||(e.stopPropagation(),e.preventDefault())},cancelEdit(){this.setState({commentText:this.props.comment.editData.content,isEditing:!1})},saveEdit(e){const{fact:t,comment:a,commentsStoreFilterId:n}=this.props,{commentText:r}=this.state,s={onRetry:this.saveEdit.bind(null,!0),isError:!1};e?s.isRetrying=!0:s.isSending=!0;const i={pathVars:[t.data.id,a.editData.id],success:this.onCommentEditSuccess,error:this.onCommentEditError,data:JSON.stringify({content:r}),meta:{comment:a,onRetry:this.saveEdit}};Ot.Z.put(n,i),Ot.Z.mergeFilterItemMeta(n,a.editData.id,s),this.setState({isEditing:!1})},onCommentEditSuccess(e,t){const{comments:a,commentsStoreFilterId:n}=this.props;a.forEach((e=>(t.comment.editData.id!==e.id||Ot.Z.mergeFilterItemMeta(n,e.id,{isRetrying:!1,isSending:!1}),e)))},onCommentEditError(e,t){const{commentsStoreFilterId:a}=this.props;Ot.Z.replaceFilterItemMeta(a,t.comment.editData.id,{isSending:!1,isRetrying:!1,isError:!0,onRetry:t.onRetry})},changeCommentText(e){var t=this.getMentionState(e);t.commentText=e.target.value,this.setState(t)},retrySendingComment(){const{comment:e,fact:t,commentsStoreFilterId:a}=this.props,n={pathVars:[t.data.id],data:JSON.stringify({content:e.editData.content}),success:this.onCommentSendingRetrySuccess,error:this.onCommentSendingRetryError,meta:{comment:e}};Ot.Z.post(a,n),Ot.Z.replaceFilterItemMeta(a,e.editData.id,{isRetrying:!0,isError:!1})},onCommentSendingRetrySuccess(e,t){const{comments:a,commentsStoreFilterId:n}=this.props,r=Cr()(a).filter((e=>t.comment.editData.id!==e.id));Ot.Z.replaceEditData(n,r)},onCommentSendingRetryError(e,t){const{commentsStoreFilterId:a}=this.props;Ot.Z.replaceFilterItemMeta(a,t.comment.editData.id,{isRetrying:!1,isError:!0})},renderCommentContent(){if(this.state.isEditing)return n.createElement("textarea",{"data-testid":"comment-textarea",className:"ghq-comment-textarea",ref:"editComment",value:this.state.commentText,key:"comment",onChange:this.changeCommentText,onBlur:this.hideNameMenu,onKeyDown:this.checkForName});const e=this.props.comment.editData.content;return n.createElement("span",{className:"ghq-cmt-text"},n.createElement($n.Z,null,n.createElement(Ht.ZP,{properties:{target:"_blank",rel:"noopener noreferrer"}},e)))},renderCommentMentionList(){const{fact:e}=this.props,{editComment:t}=this.refs;return t?n.createElement(Xn.Z,{poll:!0,target:t},n.createElement(ir,{factId:e.data.id,targetNode:t})):null},setPopoverAnchorTarget(e){Yp.Z.mergeData(this.props.popoverFilterId,{anchorProps:{target:e,preferredXPosition:Zc.R3}})},canShowCommentMenu(e){let{inTransition:t,isEditing:a,canAnswer:n,isQuestion:r,canManageBasedonCollPerms:s}=e;const i=!t&&!a,o=this.isCommentOwner()||s||r&&n;return i&&o},getSendingStatus(){const{comment:e}=this.props,{meta:t}=e;return t.isError?Mt.JI.Error:t.isSending?Mt.JI.Updating:t.isRetrying?Mt.JI.Retrying:""},render(){const{canAnswer:e,canManageBasedonCollPerms:t,comment:a,fact:r,commentsStoreFilterId:i}=this.props,{isEditing:o}=this.state,{isSending:l,isError:c,isRetrying:d}=a.meta,m=l||c||d,u=r.data.cardType,h=()=>t||this.isCommentOwner(),p=this.canShowCommentMenu({inTransition:m,isEditing:o,canAnswer:e,isQuestion:()=>u===le().QUESTION,canManageBasedonCollPerms:t});var g=null;o&&(g=this.checkForSaveCancel);const f=this.renderCommentContent(),E=this.renderCommentMentionList(),v=s()("ghq-comment",{"ghq-comment-editing":o,"ghq-is-discussion":u===le().QUESTION,"ghq-is-sending":a.meta.isSending||a.meta.isRetrying,"ghq-is-error":a.meta.isError});return n.createElement("div",{className:v,"data-testid":"CommentRow",onKeyDown:g},n.createElement(n.Fragment,null,n.createElement("div",{className:"Comment__upper-content"},n.createElement("div",{className:"Comment__user-info"},n.createElement(Hn,{isHero:!0,comment:a.editData,commentSendingStatus:this.getSendingStatus(),isCommentOwner:this.isCommentOwner(),onRetry:this.retrySendingComment})),p&&n.createElement("div",{className:"Comment__actions"},u===le().CARD&&(0,Ft.Sn)(a.editData)&&h()&&n.createElement(at.ZP,{tooltipPosition:at.DU.Left,dataTestId:"resolve-comment-button",style:at.Dd.Standard,aria:"Resolve",icon:nt.Z.Check,iconColor:at.EY.Primary,tooltipLabel:"Resolve",onClick:()=>{(0,Ft.qB)({message:"Your comment has been resolved",filterId:i,commentId:a.editData.id,factId:r.data.id})}}),n.createElement(Fn,{canAnswer:e,canManageBasedonCollPerms:t,comment:a,fact:r,isOwner:this.isCommentOwner(),isSavingNewComment:a.meta.isSending,deleteComment:this.deleteComment,editComment:this.editComment,unresolveComment:this.unresolveComment,useAsAnswer:this.useAsAnswer}))),f,n.createElement(jp,{owner:a.editData.owner,isError:c}),o&&n.createElement(Kp,{onCancel:this.cancelEdit,onSave:this.saveEdit}),E))}});var Qp=(0,ap.Z)((0,h.Z)((function(e,t){var a;const{AuthStore:n,PermissionsStore:r}=e,s=n.getState(),{comment:i,fact:o,queryType:l}=t,c=null===(a=o.data.collection)||void 0===a?void 0:a.id,d=o.data.cardType===le().QUESTION;return{canManageBasedonCollPerms:r.hasPermission(ba.v.CanDeleteAnyComments,c),isOwner:i.editData.owner.email===s.data.email,commentsStoreFilterId:d?o.id:(0,Ft.q6)({factId:o.data.id,queryType:l})}}))([Pe.Z,_i.Z],Jp)),Xp=a(25108);const $p=(e,t)=>{if(!e!==E.Comments)return t.fact.id;Xp.error("filter not set")};class eg extends n.Component{constructor(){super(...arguments),this.state={isCommenting:!1},this.handleEscape=e=>{const{isCommenting:t}=this.state;t&&(e.stopImmediatePropagation(),pe.ZP.APP_ELEMENT.focus(),this.setState({isCommenting:!1}))},this.isOwner=()=>{const{auth:e,fact:t}=this.props;return e.data.email===t.data.owner.email},this.isAnswerer=()=>{const{factPermissions:e}=this.props;return e.canVerify},this.answerWithComment=e=>{const{fact:t}=this.props;let a,n;t.data.preferredPhrase.length>=200?(a="",n="".concat(t.data.preferredPhrase,"\n\n      ").concat(e)):(a=t.data.preferredPhrase,n=e),d.Z.createFact({title:a,content:n,questionId:t.data.id,questionAsker:t.data.owner,onCancel:this.clickAnswerCancel})},this.clickAnswerCancel=()=>{const{changeView:e,fact:t}=this.props;d.Z.setAction(t.data.id,null),e(le().Views.DISCUSSION)},this.switchToDeleteModal=()=>{const{changeView:e}=this.props;e(le().Views.DELETE_QUESTION)},this.switchToAnswerMethodModal=()=>{const{changeView:e}=this.props;e(le().Views.CHOOSE_ANSWER_METHOD)},this.renderComments=()=>{const{comments:e,fact:t}=this.props;if(t.data.archived)return null;if(!e||e.status===le().LOADING)return n.createElement("div",{className:"ghq-question-comment-loading-container"},n.createElement(Nt.ZP,null));if(!e.items.editData.length)return n.createElement("p",null,"There are no comments on this question.");const a=e.items.editData.map(((t,a,r)=>{const s={editData:t,meta:e.items.meta[t.id]||{}};return n.createElement(Qp,{key:s.editData.id,comment:s,comments:r,auth:this.props.auth,fact:this.props.fact,factId:this.props.factId,isVerifier:this.isAnswerer(),onAnswer:this.answerWithComment})}));return a.reverse(),a},this.renderButtonCommentBar=()=>{const{isCommenting:e}=this.state,{fact:t}=this.props;return t.data.archived?null:e?n.createElement(Ir,{fact:this.props.fact,focusOnMount:!0,onAddComment:()=>{this.setState({isCommenting:!1})},onEscape:()=>{this.setState({isCommenting:!1})}}):n.createElement(ft.ZP,{icon:nt.Z.Comment,label:"Add a comment",style:ft.ZJ.Outline,theme:ft.bn.Gray,onClick:()=>this.setState((()=>({isCommenting:!0})))})},this.renderBottomBar=()=>{const{fact:e}=this.props;return e.data.archived?null:this.isOwner()||this.isAnswerer()?n.createElement(it.v3,{draggable:m.ZP.isExtension()},n.createElement(ft.ZP,{label:"Archive question",style:ft.ZJ.Text,theme:ft.bn.Destructive,onClick:this.switchToDeleteModal}),this.isAnswerer()?n.createElement(Wa.Z,{alignment:Wa.A.Right},n.createElement(ft.ZP,{label:"Answer question",theme:ft.bn.Primary,onClick:this.switchToAnswerMethodModal})):null):null}}componentDidMount(){const{fact:e,factPermissions:t}=this.props;t.status===le().NOT_LOADED&&qe.Z.loadPermissions(e.id)}componentDidUpdate(){var e;this.refs.comments&&((e=P.findDOMNode(this.refs.comments)).scrollTop=e.scrollHeight)}render(){const{changeView:e,closeButton:t,fact:a,verifiers:r,factPermissions:s}=this.props;if(!a.data.archived&&s.status!==le().LOADED||r.status!==le().LOADED)return n.createElement(Nt.ZP,null);const i=this.renderComments(),o=this.renderButtonCommentBar(),l=this.renderBottomBar();return n.createElement(it.ZP,{scrollable:!0},n.createElement(it.MM,{appendage:t,draggable:m.ZP.isExtension()},"Question"),n.createElement(it.R3,null,n.createElement(xp,{canEdit:!0,fact:a,verifiers:r,changeView:e}),n.createElement("div",{className:"ghq-question-comments",ref:"comments"},n.createElement("p",{className:"ghq-question-comments-title"},"Comments"),i),o),l)}}var tg=(0,Ce.Z)((0,h.Z)(((e,t)=>{const{CommentsStore:a}=e,{fact:n}=t;return{comments:a.getFilter($p(E.Comments,t)),factPermissions:Be.Z.getByFactId(n.id||n.data.id)}}),$p)([Rt.Z,Be.Z],eg),!0),ag=a(25108);const ng=new p.Z({name:E.QuestionAnswerers}),rg=g.Z.getFlux().actions[ng.name];rg||ag.error("error creating actions");var sg=rg;const ig=new C.Z({name:E.QuestionAnswerers,syncFilters:!1});ig.createStore();var og=g.Z.addStore(ig.store),lg=a(25108);const cg=e=>{switch(e){case og.getName():case vc.getName():return E.GLOBAL;default:return void lg.error("filter not set")}};class dg extends n.Component{constructor(e){super(e),this.onMenuMount=()=>{const{fact:e,hasExpertIdLicense:t}=this.props,a=Boolean(e.editFact.data.preferredPhrase.length);t&&a?this.getExpertAnswerers():this.trackDropdownOpened()},this.onMenuUnmount=()=>{const{hasExpertIdLicense:e,onMenuUnmount:t}=this.props;t(),e&&(this.onSeeSuggestion=Kc()((()=>{const{fact:e,expertSuggestionId:t}=this.props;M.Z.postActivity({type:Pt.default.EXPERTS_DISPLAYED,properties:{factId:e.action===oe.NEW?e.id:"",expertsTask:oe.Activities.QNA,expertSuggestionId:t},biOnly:!0})})),Sc.clearStore())},this.trackDropdownOpened=()=>{const{expertSuggestionId:e,fact:t}=this.props;M.Z.postActivity({type:Pt.default.VERIFIER_DROPDOWN_OPENED,properties:{factId:t.action===oe.NEW?t.id:"",expertsTask:oe.Activities.QNA,expertSuggestionId:e},biOnly:!0})},this.getExpertAnswerers=()=>{const{fact:e}=this.props,t={data:JSON.stringify({type:"qa-expert-verification-config",expertsTask:oe.Activities.QNA,content:e.editFact.data.preferredPhrase}),success:()=>{this.trackDropdownOpened()}};Sc.post(E.GLOBAL,t)},this.onSeePlaceholderAnswerer=e=>{const{onSeePlaceholderWaypoint:t}=this.props;e!==this.state.waypointId&&(this.setState({waypointId:e}),t())},this.renderSelectedItem=()=>{const{selectedItem:e}=this.props;return"user-group"===e.type?n.createElement(Xh.N_,{icon:"account-multiple",label:e.userGroup.name,value:e.id}):"user"===e.type?n.createElement(Xh.N_,{avatar:xn.ZP.getProfileUrl(e.user.profilePicUrl),avatarDescription:gt.Z.getPersonalName(e.user),label:gt.Z.getPersonalName(e.user),value:e.id}):null},this.renderMenuItems=(e,t)=>{const{selectedItem:a}=this.props;return e.reduce(((e,r)=>{if("user-group"===r.type){var s;if(r.userGroup.id===(null===(s=a.userGroup)||void 0===s?void 0:s.id))return e;e.groupMenuItems.push(n.createElement(Xh.N_,{icon:"account-multiple",key:r.id,label:r.userGroup.name,value:r.id},t?n.createElement(Bt.h,{onEnter:this.onSeeSuggestion}):null))}else if("user"===r.type){var i;if(r.user.email===(null===(i=a.user)||void 0===i?void 0:i.email))return e;e.userMenuItems.push(n.createElement(Xh.N_,{avatar:xn.ZP.getProfileUrl(r.user.profilePicUrl),avatarDescription:gt.Z.getPersonalName(r.user),key:r.id,label:gt.Z.getPersonalName(r.user),value:r.id},t?n.createElement(Bt.h,{onEnter:this.onSeeSuggestion}):null))}return e}),{groupMenuItems:[],userMenuItems:[]})},this.renderAnswererMenuItems=()=>{const{answerers:e,linkHeader:t}=this.props,a=this.renderMenuItems(e);let r=null;return t&&(r=n.createElement(Bt.h,{onEnter:this.onSeePlaceholderAnswerer.bind(this,t.token)})),{waypoint:r,...a}},this.renderSuggestedMenuItems=()=>{const{experts:e,hasExpertIdLicense:t,hideExperts:a}=this.props;if(!t||a)return null;const{groupMenuItems:r,userMenuItems:s}=this.renderMenuItems(e,!0);return r.length||s.length?n.createElement(Xh.De,{kind:Xh.$A.Mellow,label:"Suggested Experts"},r,s):null},this.handleSelect=e=>{const{answerers:t,experts:a,onSelect:n}=this.props,r=a.find((t=>t.id===e)),s=t.find((t=>t.id===e));r?(delete r.id,n(r,{isSuggested:!0})):s&&n(s,{isSuggested:!1})};const{fact:t}=this.props;this.state={waypointId:null},this.onSeeSuggestion=Kc()((()=>{const{expertSuggestionId:e}=this.props;M.Z.postActivity({type:Pt.default.EXPERTS_DISPLAYED,properties:{factId:t.action===oe.NEW?t.id:"",expertsTask:oe.Activities.QNA,expertSuggestionId:e},biOnly:!0})}))}componentDidMount(){this.props.onMount()}render(){const{fact:e,label:t,onInput:a,selectedItem:r}=this.props,{groupMenuItems:s,userMenuItems:i,waypoint:o}=this.renderAnswererMenuItems(),l=r.id||"";return n.createElement("div",{className:"ghq-NewQuestionAnswerersDropdown"},n.createElement(Xh.ZP,{label:t,name:"Question-".concat(e.id,"-answerers"),value:l,onBlur:this.onMenuUnmount,onChange:this.handleSelect,onFocus:this.onMenuMount,onInputChange:_()(a,250)},this.renderSelectedItem(),this.renderSuggestedMenuItems(),s.length?n.createElement(Xh.De,{label:"Groups"},s):null,i.length?n.createElement(Xh.De,{label:"Users"},i):null,o))}}const mg=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{questionId:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{search:a}=og.getFilter(cg(og.getName())).meta;sg.get(cg(og.getName()),{pathVars:t?[t]:[],queryParams:{search:a},...e})},ug=e=>{sg.mergeFilterMeta(cg(og.getName()),{search:e})};var hg=(0,h.Z)((()=>{const e=og.getFilter(cg(og.getName())),t=o()(e,"items.data",[]),a=o()(e,"meta.search",null),n=o()(e,"linkHeaders['next-page']"),r=vc.getFilter(cg(vc.getName())),s=o()(r,"items.data[0]",null);return{answerers:t,experts:o()(s,"experts",[]).map((e=>{let t;return"user-group"===e.type?t="expert-".concat(e.userGroup.id):"user"===e.type&&(t="expert-".concat(e.user.email)),{...e,id:t}})),expertSuggestionId:o()(s,"expertSuggestionId",null),hasExpertIdLicense:Sr.Z.hasFeature(Ne.Z.EXPERT_ID_ALLOWED),hideExperts:Boolean(a),linkHeader:n,onInput:e=>{ug(e),mg()},onMenuUnmount:()=>{ug(null),mg()},onMount:mg,onSeePlaceholderWaypoint:()=>{mg({linkHeader:n})}}}),cg)([og,vc],dg);dg.propTypes={answerers:D().array,experts:D().array,expertSuggestionId:D().string,fact:D().object,hasExpertIdLicense:D().bool,hideExperts:D().bool,label:D().string,linkHeader:D().object,onInput:D().func,onMenuUnmount:D().func,onMount:D().func,onSeePlaceholderWaypoint:D().func,onSelect:D().func,selectedItem:D().object},dg.defaultProps={fact:{},label:"Who should answer?",onSelect:()=>{},selectedItem:{}};class pg extends n.Component{constructor(){super(...arguments),this.state={selectedItem:null},this.getAnswerer=()=>{const{verifiers:e}=this.props,{selectedItem:t}=this.state,a=e.data[0];return t||a},this.selectAnswerer=e=>{const{fact:t}=this.props;Y.Z.setEditVerifier(t.data.id,e),this.setState({selectedItem:e})},this.changeAnswerer=()=>{const{fact:e,onCancel:t}=this.props;Y.Z.saveVerifier(e.data.id,{callback:t})}}render(){const{closeButton:e,onCancel:t,fact:a}=this.props,r=this.getAnswerer();return n.createElement(it.ZP,null,n.createElement(it.MM,{appendage:e,draggable:m.ZP.isExtension()},"Reassign question"),n.createElement(it.R3,null,n.createElement(hg,{fact:a,label:"Who should answer this question?",selectedItem:r,onSelect:this.selectAnswerer})),n.createElement(it.v3,{draggable:m.ZP.isExtension()},n.createElement(Wa.Z,{alignment:Wa.A.Right},n.createElement(ft.ZP,{label:"Back",style:ft.ZJ.Text,theme:ft.bn.Gray,onClick:t}),n.createElement(ft.ZP,{label:"Save changes",theme:ft.bn.Primary,onClick:this.changeAnswerer}))))}}pg.propTypes={closeButton:D().element,fact:D().object.isRequired,onCancel:D().func,verifiers:D().object.isRequired},pg.defaultProps={onCancel:()=>{}};var gg=pg;class fg extends n.Component{render(){const{changeView:e,closeButton:t,fact:a}=this.props,{ANSWER_WITH_EXISTING_CARD:r}=le().Views,{onCancel:s}=this.props;return n.createElement(it.ZP,null,n.createElement(it.MM,{appendage:t,draggable:m.ZP.isExtension()},"How would you like to answer?"),n.createElement(it.R3,null,n.createElement(St.ZP,null,"You can either create a new Card or search within existing Cards to answer this question.")),n.createElement(it.v3,{draggable:m.ZP.isExtension()},n.createElement(Wa.Z,{alignment:Wa.A.Right},n.createElement(ft.ZP,{label:"Back",style:ft.ZJ.Text,theme:ft.bn.Gray,onClick:s}),n.createElement(ft.ZP,{label:"Create new Card",style:ft.ZJ.Outline,theme:ft.bn.Primary,onClick:()=>{d.Z.createFact({preferredPhrase:a.data.preferredPhrase,content:"",questionId:a.meta.questionId,tasksQuestionsFilterId:a.meta.tasksQuestionsFilterId,questionAsker:a.data.owner})}}),n.createElement(ft.ZP,{label:"Find existing Card",style:ft.ZJ.Outline,theme:ft.bn.Primary,onClick:()=>{e(r)}}))))}}fg.propTypes={changeView:D().func.isRequired,closeButton:D().element,onCancel:D().func.isRequired};var Eg=fg,vg=a(44371),Cg=a(79545);class yg extends n.Component{constructor(){super(...arguments),this.getTasks=()=>{Cg.Z.get(v().GLOBAL,{success(){vg.Z.getNoCache(v().GLOBAL,{pathVars:[Pe.Z.getEmail()]})}})},this.archiveQuestion=()=>{const{fact:e}=this.props;d.Z.archiveFact(e.data.id||e.id,{callback:this.getTasks}),d.Z.discardFact(e.data.id||e.id)}}render(){const{closeButton:e,fact:t,onCancel:a}=this.props;return n.createElement(it.ZP,null,n.createElement(it.MM,{appendage:e,draggable:m.ZP.isExtension()},"Archive question"),n.createElement(it.R3,null,n.createElement(St.ZP,null,"Are you sure you want to archive this question?"),n.createElement(St.ZP,{style:St.Jo.Bold},t.data.preferredPhrase)),n.createElement(it.v3,{draggable:m.ZP.isExtension()},n.createElement(Wa.Z,{alignment:Wa.A.Right},n.createElement(ft.ZP,{label:"Back",style:ft.ZJ.Text,theme:ft.bn.Gray,onClick:a}),n.createElement(ft.ZP,{label:"Archive question",theme:ft.bn.Destructive,onClick:this.archiveQuestion}))))}}yg.propTypes={closeButton:D().element,fact:D().object.isRequired,onCancel:D().func.isRequired};var bg=yg,Sg=a(25108);const Zg=e=>{switch(e){case nd.Z.getName():case vc.getName():return E.GLOBAL;default:return void Sg.error("filter not set")}};class Ng extends n.Component{constructor(e){var t;super(e),t=this,this.changeContent=e=>{const{fact:t}=this.props;let a=e.replace(/\u200B/g,"");a=a.replace(/\t/g,"    "),d.Z.editTitle(t.id,a)},this.getAnswererHeaders=()=>{const{fact:e}=this.props,{questionContent:t,selectedAnswerer:a,suggestionId:n}=this.state,r=Boolean(n),s=t!==e.editFact.data.preferredPhrase,i={[re.$2]:le().Activities.QNA,[re.eB]:Pt.default.VERIFIER_SELECTED,[re.s3]:a.user?a.user.email:a.userGroup.id,[re.e2]:!1,[re.RX]:null};return r&&!s?{...i,[re.e2]:!0,[re.RX]:n}:i},this.clickSave=()=>{const{selectedAnswerer:e}=this.state,{fact:t}=this.props,a={headers:this.getAnswererHeaders()};Fp.Z.askQuestion(t,[e],a)},this.doSearch=e=>{e.length<10||Fp.Z.searchForSimilarMatches(this.props.fact.id,this.props.fact.editFact.data.preferredPhrase)},this.focus=()=>{this.setState({focused:!0})},this.offFocus=()=>{this.setState({focused:!1})},this.handleMenuItemSelect=function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{expertSuggestionId:n,fact:r}=t.props;t.setState({questionContent:r.editFact.data.preferredPhrase,suggestionId:a.isSuggested?n:null}),t.handleAnswererSelect(e)},this.handleAnswererSelect=e=>{const{fact:t}=this.props;this.setState({selectedAnswerer:e}),Y.Z.setEditVerifier(t.id,e)},this.renderAnswerersDropdown=()=>{const{fact:e}=this.props,{selectedAnswerer:t}=this.state;return n.createElement(hg,{fact:e,selectedItem:t,onSelect:this.handleMenuItemSelect})};const{fact:a,answerer:r}=this.props;this.state={focused:!1,questionContent:o()(a,"editFact.data.preferredPhrase",null),suggestionId:null},r&&(this.state.selectedAnswerer=r)}componentDidMount(){P.findDOMNode(this.refs.search).focus()}render(){const{closeButton:e,closeCard:t,fact:a,questionIsntEmpty:r,showSimilarMatches:s,toggleSimilarMatches:i}=this.props,o=a.editFact.data.preferredPhrase,{selectedAnswerer:l}=this.state,c=!l||!r,d=n.createElement(Wa.Z,{alignment:Wa.A.Right},n.createElement(ft.ZP,{label:"Cancel",style:ft.ZJ.Text,theme:ft.bn.Gray,onClick:t}),n.createElement(ft.ZP,{disabled:c,label:"Ask question",theme:ft.bn.Primary,onClick:this.clickSave}));let u=null;var h=!1;a.similarMatches&&(h=a.similarMatches.status===le().SEARCHING,a.similarMatches.data.length>0&&(u=n.createElement("div",{className:"ghq-question-show-similar-matches-wrapper"},n.createElement("p",{className:"ghq-question-show-similar-matches"},"Guru has found similar matches."),s?n.createElement(ft.ZP,{label:"Hide Cards",style:ft.ZJ.Anchor,onClick:i}):n.createElement(ft.ZP,{label:"Show Cards",style:ft.ZJ.Anchor,onClick:i}))));const p=this.renderAnswerersDropdown();return n.createElement(it.ZP,{scrollable:!0},n.createElement(it.MM,{draggable:m.ZP.isExtension(),appendage:e},"Ask an Expert"),n.createElement(it.R3,null,n.createElement("div",{className:"ghq-question-field-wrapper"},n.createElement("div",{className:"ghq-question-field"},n.createElement(cu.Z,{id:"question-input",ref:"search",placeholder:this.state.focused?"":"Type your question here",value:o,handleAction:this.doSearch,handleInputChange:this.changeContent,alreadyHandling:h,isTextArea:!0,onFocus:this.focus,onBlur:this.offFocus})),u),p),n.createElement(it.v3,{draggable:m.ZP.isExtension()},d))}}var Ig=(0,h.Z)(((e,t)=>{const{fact:a}=t,n=o()(nd.Z.getBySearchId(a.id),"editData[0]",null),r=vc.getFilter(Zg(vc.getName())),s=o()(r,"items.data[0]",null);return{answerer:n,expertAnswerers:o()(s,"experts",[]),expertSuggestionId:o()(s,"expertSuggestionId",null),questionIsntEmpty:Boolean(o()(a,"editFact.data.preferredPhrase","").trim())}}),Zg)([nd.Z,vc],Ng);Ng.propTypes={closeCard:D().func.isRequired,fact:D().object.isRequired,showSimilarMatches:D().bool,toggleSimilarMatches:D().func.isRequired};class Tg extends n.Component{constructor(e){super(),this.handleClickOutside=e=>{const t=e.target===document.getElementsByClassName("ghq-fact-glass")[0];if(!m.ZP.isExtension()&&t){if(this.state.view===le().Views.ANSWER_WITH_EXISTING_CARD)return e.stopImmediatePropagation(),d.Z.setAction(this.props.fact.data.id,null),d.Z.setCardState(this.props.fact.data.id,le().Views.DISCUSSION),void this.setState({view:le().Views.DISCUSSION});d.Z.discardFact(this.props.fact.id)}},this.handleEscape=e=>{const{topCardID:t,fact:a}=this.props,n=P.findDOMNode(pe.ZP.APP_ELEMENT);a.status!==le().CONFIRM&&(m.ZP.isExtension()?t===a.id&&n.contains(document.activeElement)?this.state.view===le().Views.ANSWER_WITH_EXISTING_CARD&&(e.stopImmediatePropagation(),d.Z.setAction(a.data.id,null),d.Z.setCardState(a.data.id,le().Views.DISCUSSION),this.setState({view:le().Views.DISCUSSION})):d.Z.discardFact(this.props.fact.id):this.state.view===le().Views.ANSWER_WITH_EXISTING_CARD&&(e.stopImmediatePropagation(),d.Z.setAction(a.data.id,null),d.Z.setCardState(a.data.id,le().Views.DISCUSSION),this.setState({view:le().Views.DISCUSSION})))},this.changeView=e=>{this.setState({view:e}),d.Z.setCardState(this.props.fact.id,e)},this.hasUnsavedChanges=()=>{const e=this.props.fact;if(!e.editFact)return!1;const t=e.data.content,a=e.editFact.data.content,n=e.data.preferredPhrase,r=e.editFact.data.preferredPhrase;return t!==a||n!==r},this.closeCard=()=>{this.props.fact.action===le().EDITING&&this.hasUnsavedChanges()?d.Z.startFactClose(this.props.fact.data.id||this.props.fact.id):(this.state.newAnswerer&&Y.Z.saveVerifier(this.props.fact.data.id||this.props.fact.id),d.Z.discardFact(this.props.fact.data.id||this.props.fact.id))},this.toggleSimilarMatches=()=>{this.setState((e=>({showSimilarMatches:!e.showSimilarMatches})))},this.renderSimilarMatches=()=>{if(!this.props.fact.similarMatches)return null;const e=this.props.fact.similarMatches.data.map(function(e){return n.createElement(Op.Z,{card:e,key:this.props.fact.id+"-search-similar-match-"+e.id,actionable:!1,loadCardMaximized:this.props.fact.maximized})}.bind(this));return n.createElement("div",{className:s()("ghq-question-similar-matches-container",{"ghq-question-similar-matches-container-visible":this.state.showSimilarMatches})},n.createElement("div",{className:"ghq-question-similar-matches"},e))},this.state={showSimilarMatches:!1,view:e.initialView,newAnswerer:!1}}componentDidMount(){const{fact:e}=this.props;e.action!==le().NEW&&Y.Z.loadVerifiers(e.id)}renderView(){const{hasCloseButton:e}=this.props,t=e?n.createElement(at.ZP,{aria:"close question",icon:nt.Z.Close,style:at.Dd.Standard,onClick:this.closeCard}):null;if(this.props.fact.action===le().NEW)return n.createElement(Ig,{fact:this.props.fact,closeButton:t,closeCard:this.closeCard,showSimilarMatches:this.state.showSimilarMatches,toggleSimilarMatches:this.toggleSimilarMatches});switch(this.state.view){case le().Views.DISCUSSION:return n.createElement(tg,{auth:this.props.auth,changeView:this.changeView,closeButton:t,fact:this.props.fact,factId:this.props.fact.data.id,initialView:this.props.initialView,verifiers:this.props.verifiers});case le().Views.DELETE_QUESTION:return n.createElement(bg,{closeButton:t,fact:this.props.fact,onCancel:()=>this.changeView(le().Views.DISCUSSION)});case le().Views.CHANGE_ANSWERER:return n.createElement(gg,{closeButton:t,fact:this.props.fact,verifiers:this.props.verifiers,onCancel:()=>this.changeView(le().Views.DISCUSSION)});case le().Views.CHOOSE_ANSWER_METHOD:return n.createElement(Eg,{closeButton:t,fact:this.props.fact,changeView:this.changeView,onCancel:()=>this.changeView(le().Views.DISCUSSION)});case le().Views.ANSWER_WITH_EXISTING_CARD:return n.createElement(Gp,{auth:this.props.auth,closeButton:t,fact:this.props.fact,verifiers:this.props.verifiers,changeView:this.changeView})}}render(){const e=this.renderView(),t=this.renderSimilarMatches(),a=s()("ghq-question-container",{"ghq-new-question":this.props.fact.action===le().NEW,"ghq-discussion":this.state.view===le().Views.DISCUSSION&&"new"!==this.props.fact.action,"ghq-answer-with-existing":this.state.view===le().Views.ANSWER_WITH_EXISTING_CARD,"ghq-question-prompt":[le().Views.CHANGE_ANSWERER,le().Views.CHOOSE_ANSWER_METHOD,le().Views.DELETE_QUESTION].includes(this.state.view),"ghq-in-extension":m.ZP.isExtension()});return n.createElement("div",{className:a,"data-testid":"Question card"},e,t,n.createElement(Yu,this.props))}}var Ag=(0,h.Z)(((e,t)=>({verifiers:nd.Z.getBySearchId(t.fact.id)})))([nd.Z],(0,Ce.Z)((0,ve.Z)(Tg,null,[".ghq-factcard-container"])));Tg.propTypes={initialView:D().string,verifiers:D().shape({})},Tg.defaultProps={initialView:le().Views.DISCUSSION,verifiers:{},hasCloseButton:!0};var _g=a(23525),wg={N:"N",NE:"NE",SE:"SE",S:"S",SW:"SW",W:"W",NW:"NW"};class Dg extends n.Component{constructor(){super(...arguments),this.state={dragging:!1,tempHeight:0},this.setTempHeight=e=>{this.setState(e)},this.startDrag=()=>{d.Z.startFactDrag(this.props.fact.id),this.setState({dragging:!0})},this.onMouseUp=()=>{d.Z.stopFactDrag(this.props.fact.id,this.props.fact.width,this.props.fact.height),this.props.sendResizeEvent(),this.setState({dragging:!1})},this.getNewXPos=e=>{var t=this.props.fact.left,a=this.props.fact.width;switch(e=Math.min(window.innerWidth,e),e=Math.max(0,e),this.props.dir){case wg.E:case wg.NE:case wg.SE:a=e-this.props.fact.left;break;case wg.W:case wg.NW:case wg.SW:t=e,a=this.props.fact.left-e+this.props.fact.width}return a<500&&(t=this.props.fact.left,a=this.props.fact.width),{x:t,width:a}},this.getNewYPos=e=>{var t=this.props.fact.top,a=this.props.fact.height?this.props.fact.height:this.state.tempHeight;switch(e=Math.min(window.innerHeight,e),e=Math.max(0,e),this.props.dir){case wg.N:case wg.NE:case wg.NW:t=e,a=this.props.fact.top-e+(this.props.fact.height?this.props.fact.height:this.state.tempHeight);break;case wg.S:case wg.SE:case wg.SW:a=e-this.props.fact.top}return a<420&&(t=this.props.fact.top,a=this.props.fact.height?this.props.fact.height:this.state.tempHeight),{y:t,height:a}},this.onMouseMove=e=>{if(this.state.dragging){var t=this.getNewXPos(e.clientX),a=this.getNewYPos(e.clientY);d.Z.moveFact(this.props.fact.id,t.x,a.y,t.width,a.height),e.stopPropagation(),e.preventDefault()}}}componentDidMount(){this.props.fact.height||yr.Z.setTimeout(function(){this.setTempHeight({tempHeight:document.getElementById(this.props.fact.id).offsetHeight})}.bind(this),0)}componentDidUpdate(e,t){this.state.dragging&&!t.dragging?(document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)):!this.state.dragging&&t.dragging&&(document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp))}render(){var e=12,t={width:e,height:e,position:"absolute",zIndex:"15"},a="ghq-fact-resizer-"+this.props.dir.toLowerCase(),r=this.props.fact.height?this.props.fact.height:this.state.tempHeight;switch(this.props.dir){case wg.N:t.top=-6,t.left=6,t.width=this.props.fact.width-e;break;case wg.NE:t.top=-6,t.right=-6;break;case wg.E:t.top=6,t.right=-6,t.height=r-e;break;case wg.SE:t.bottom=-6,t.right=-6;break;case wg.S:t.bottom=-6,t.left=6,t.width=this.props.fact.width-e,t.zIndex=-1;break;case wg.SW:t.bottom=-6,t.left=-6,t.zIndex=16,t.width=20,t.height=20;break;case wg.W:t.top=6,t.left=-6,t.height=r-e;break;case wg.NW:t.top=-6,t.left=-6}return n.createElement("div",{className:a,style:t,onMouseDown:this.startDrag})}}class Pg extends n.Component{constructor(){super(...arguments),this.state={eventSent:!1},this.sendResizeEvent=()=>{this.state.eventSent||(M.Z.postActivity({type:_g.RESIZE_FACT,properties:{factId:this.props.fact.id,isNew:!this.props.fact.data.id,width:this.props.fact.width,height:this.props.fact.height},biOnly:!0}),this.setState({eventSent:!0}))}}render(){var e=[];for(var t in wg)e.push(n.createElement(Dg,{key:t,dir:t,fact:this.props.fact,sendResizeEvent:this.sendResizeEvent}));return n.createElement("div",null,e)}}var kg=Pg;let Lg,Mg;!function(e){e.All="ALL",e.Core="CORE",e.Light="LIGHT",e.Pending="PENDING"}(Lg||(Lg={})),function(e){e.FirstName="FIRSTNAME",e.LastName="LASTNAME",e.Email="EMAIL"}(Mg||(Mg={}));var Og=a(64469);const Fg=new ii.Z,Rg=g.Z.getFlux().dispatcher,xg=async(e,t)=>Fg.get({path:"/people/".concat(e),queryParams:t});var qg=(e,t)=>{const a=(0,Ut.NL)(),n=(e=>["Person",e])(e),{data:r,isFetched:s,isLoading:i,isError:o}=(0,Il.a)(n,(()=>xg(e,t)),{enabled:Boolean(e)}),l=(0,Og.D)((t=>{let{person:a}=t;return(async(e,t)=>Fg.put({path:"/people/".concat(e),body:t}))(e,a)}),{onSuccess:(e,t)=>{let{callback:r}=t;e&&(a.setQueryData(n,(()=>e)),Rg.dispatch({type:Wt.default.UPDATE_USER_AUTH,payload:{filterId:e.userId,propertiesToUpdate:{firstName:e.firstName,lastName:e.lastName,displayName:e.displayName}}}),r&&r())}});return{person:null!=r?r:{},updatePerson:l.mutate,isFetched:s,isLoading:i,isError:o}},Bg=a(77843);const Vg="UserPinnedCards",Ug=new ii.Z;var Hg=e=>{let{userId:t,preventOnLoad:a}=e;const n=(0,Ut.NL)(),r=[Vg,t,"data"],s=()=>{n.invalidateQueries([Vg])},i=(0,Il.a)([Vg,r],{queryFn:()=>(async e=>Ug.get({path:"/users/".concat(e,"/pins")}).catch((e=>{if(new RegExp(/404/).test(e.message))return[]})))(t),enabled:!a}),o=(0,Og.D)((e=>{let{cardId:a}=e;return(async(e,t)=>Ug.put({path:"/users/".concat(e,"/pins/").concat(t)}))(t,a)}),{onSuccess:s}),l=(0,Og.D)((e=>{let{cardId:a}=e;return(async(e,t)=>Ug.delete({path:"/users/".concat(e,"/pins/").concat(t)}))(t,a)}),{onSuccess:s});return{cards:i.data,get:i.refetch,isFetched:i.isFetched,isLoading:i.isLoading,pinCard:o.mutate,unpinCard:l.mutate}};const Wg=(0,n.createContext)(void 0),Gg=e=>{let{children:t,profileId:a}=e;return n.createElement(Wg.Provider,{value:a},t)};var zg=e=>{var t;const{id:a}=(0,be.UO)(),r=(0,n.useContext)(Wg),s=null!==(t=null!=a?a:r)&&void 0!==t?t:e;if(!s)throw new Error("profile id is not available");return s};var Yg=e=>{var t,a,n;const r=zg(e),s=qg(r,{extended:"true"}),i=null!==(t=null!==(a=null===(n=s.person)||void 0===n?void 0:n.userId)&&void 0!==a?a:r)&&void 0!==t?t:e,o=(0,Bg.Z)(i,Boolean(i)),l=Hg({userId:i,preventOnLoad:!Boolean(i)});return{isLoading:s.isLoading||o.isLoading||l.isLoading,profile:s,follows:o,pinnedCards:l}},Kg=a(34725),jg=a(9656);const Jg=new ii.Z,Qg="PEOPLE_DIRECT_REPORTS";var Xg=e=>{var t,a;let{userId:n,preventOnLoad:r}=e;const s=(0,ri.N)((e=>[Qg,e])(n),(e=>(async(e,t)=>Jg.getPaginated({path:"/people/".concat(e,"/directreports"),queryParams:t?{token:t}:void 0}))(n,e.pageParam)),{staleTime:0,enabled:!r,getNextPageParam:e=>null==e?void 0:e.token});return{...s,data:null!==(t=null===(a=s.data)||void 0===a?void 0:a.pages.flatMap((e=>e.data)))&&void 0!==t?t:[]}},$g=a(1604);const ef=$g.z.object({displayName:$g.z.string().optional(),email:$g.z.string().email(),firstName:$g.z.string().optional(),id:$g.z.string().uuid(),joinedDate:$g.z.string().optional(),lastName:$g.z.string().optional(),profilePicUrl:$g.z.string().optional(),status:$g.z.enum(["PENDING","ACTIVE"]).optional(),userId:$g.z.string().uuid(),userProfile:$g.z.object({role:$g.z.string().optional(),roleLevel:$g.z.string().optional(),useCaseList:$g.z.array($g.z.object({description:$g.z.string()})).optional()}).optional()}),tf=$g.z.object({aboutMe:$g.z.string().optional(),bestWayToWorkWithMe:$g.z.string().optional(),whatImWorkingOn:$g.z.string().optional()}),af=$g.z.object({custom:tf.optional(),email:$g.z.string().email(),firstName:$g.z.string({errorMap:()=>({message:"First name required"})}).trim().min(1),jobTitle:$g.z.string({errorMap:()=>({message:"Job title required"})}).trim().min(1),lastName:$g.z.string({errorMap:()=>({message:"Last name required"})}).trim().min(1),manager:ef.optional(),profilePicUrl:$g.z.string().optional(),pronouns:$g.z.string().optional(),startDate:$g.z.string().optional(),workingHours:$g.z.string().optional(),workLocationName:$g.z.string().optional(),workTeamName:$g.z.string().optional()}),nf=af.keyof().enum,rf=tf.keyof().enum;var sf=e=>{let{children:t,name:a,title:r}=e;return n.createElement("fieldset",{className:"ProfileEditSection ProfileEditSection--".concat(a)},r?n.createElement("legend",{className:"ProfileEditSection__title"},n.createElement(ja.ZP,{level:ja.Yx.H3,style:ja.VH.Large},r)):null,t)};var of=e=>{let{onUpdate:t,isLockedSyncField:a,openFileSelector:r,plainFiles:s,filesContent:i,fileUploadErrors:o}=e;const[,l]=(0,ls.Z)(),{profile:{person:c}}=Yg(),[d,m]=(0,n.useState)(null==c?void 0:c.profilePicUrl),[u,h]=(0,n.useState)(!1),{profilePicUrl:p}=nf;(0,n.useEffect)((()=>{null!=c&&c.profilePicUrl&&m(null==c?void 0:c.profilePicUrl)}),[null==c?void 0:c.profilePicUrl]),(0,n.useEffect)((()=>{var e;null!==(e=s[0])&&void 0!==e&&e.name&&m(i[0].content)}),[s]),(0,n.useEffect)((()=>{(null==o?void 0:o.length)>0?h(!0):h(!1)}),[o]);const g=a(p);return n.createElement(sf,{name:"avatar"},n.createElement(pn.Z,{alt:"profile picture",initials:gt.Z.getUsersInitials(c),src:xn.ZP.getProfileUrl(d),size:88}),n.createElement("div",{className:"ProfileEditAvatar__description"},n.createElement("p",{className:"ProfileEditAvatar__description-title"},g?"Profile picture":"Add a profile picture"),n.createElement("p",null,"Photos help your teammates recognize you"),g?null:n.createElement(Wa.Z,{alignment:Wa.A.Left},n.createElement(ft.ZP,{label:"Choose photo",size:ft.qE.Small,theme:ft.bn.Gray,style:ft.ZJ.Outline,onClick:()=>{l.createProfileImage({hideUploadModal:!0}),r()}}),d&&n.createElement(ft.ZP,{label:"Remove photo",size:ft.qE.Small,onClick:()=>{m(""),t({field:p,value:""})}}))),u&&n.createElement(Ul.Z,{type:Ul.N.Error,onClose:()=>h(!1)},"Images must be smaller than 2MB."))},lf=a(56457);var cf=()=>{const{profile:{person:e}}=Yg(),{email:t}=nf;return n.createElement(sf,{name:"contact",title:"Contact"},n.createElement(Fs.Z,{disabled:!0,icon:nt.Z.EmailEnvelope,label:"Email",name:t,placeholder:e.email,helperText:n.createElement(n.Fragment,null,n.createElement(Sn.Z,{to:Mr.r.ChangeEmailAddress},"Learn more")," ","about updating your email")}),e.slackProfileDetails&&e.slackProfileDetails.length>0?n.createElement("section",{className:"Contact__slack-link"},n.createElement(lf.ZP,{level:lf.y5.H3,style:lf.Lx.Small},"Slack Profile Link"),n.createElement(es.Z,{divided:!0,spacing:es.Z.spaces.TIGHT},e.slackProfileDetails.map((e=>{let{slackTeamUrl:t}=e;return n.createElement(es.H,{key:t},n.createElement(Dt.ZP,{icon:nt.Z.Slack},t))}))),n.createElement(St.ZP,{style:St.Jo.Dim},"Slack profile links are imported automatically when the Guru Slack app is installed. Users viewing your profile will only see a link to your Slack profile if they belong to the same Slack workspace.")):null)};function df(e){return!e.success}function mf(e){let{form:t,schema:a}=e;const n=a.safeParse(t);return df(n)?n.error.issues:[]}function uf(e){let t,{field:a,schema:n,value:r}=e;if(n instanceof $g.z.ZodObject&&n.shape){t=$g.z.object({[a]:n.shape[a]}).safeParse({[a]:r})}else t=n.safeParse({[a]:r});if(df(t))return t.error.issues[0]}const hf=e=>{let{field:t,errors:a}=e;return a.find((e=>e.path.some((e=>e===t))))};var pf=e=>{var t,a,r,s,i;let{errors:o,onBlur:l,onUpdate:c,updates:d,isLockedSyncField:m}=e;const{profile:{person:u}}=Yg(),{firstName:h,lastName:p,pronouns:g}=nf;return n.createElement(sf,{name:"name"},n.createElement(Fs.Z,{requirementLabel:ui.Required,label:"First Name",name:h,disabled:m(h),errorMessage:null===(t=hf({field:h,errors:o}))||void 0===t?void 0:t.message,value:null!==(a=d.firstName)&&void 0!==a?a:u.firstName,onChange:e=>c({field:h,value:e}),onBlur:e=>l({field:h,value:e})}),n.createElement(Fs.Z,{requirementLabel:ui.Required,name:p,label:"Last Name",disabled:m(p),errorMessage:null===(r=hf({field:p,errors:o}))||void 0===r?void 0:r.message,value:null!==(s=d.lastName)&&void 0!==s?s:u.lastName,onChange:e=>c({field:p,value:e}),onBlur:e=>l({field:p,value:e})}),n.createElement(Fs.Z,{label:"Pronouns",name:g,disabled:m(g),value:null!==(i=d.pronouns)&&void 0!==i?i:u.pronouns,helperText:"Let teammates know which pronouns you use",onChange:e=>c({field:g,value:e})}))},gf=a(31745),ff=a(14293),Ef=a.n(ff),vf=a(73588);var Cf,yf=(0,n.forwardRef)(((e,t)=>{var a;let{value:r,onChange:s,disabled:i,autofocus:o}=e;const l=(0,n.useRef)(!1),c=zg(),d=(0,vf.Z)({context:"direct-reports"}),[m,u]=(0,n.useState)(""),[h,p]=(0,n.useState)([]),{manager:g}=nf;(0,n.useEffect)((()=>{r&&u(gt.Z.getNameFromModel(r))}),[r]),(0,n.useEffect)((()=>{var e;const t=null===(e=d.data)||void 0===e?void 0:e.people;if("success"===d.status&&!Ef()(t)){const e=t.filter((e=>e.id!==c));p(e)}}),[null===(a=d.data)||void 0===a?void 0:a.people]),((e,t)=>{const a=(0,n.useRef)(!1);(0,n.useEffect)((()=>{a.current&&e(),a.current=!0}),t)})((()=>{l.current=!0,Boolean(m)?d.search(m):(s(),d.clear())}),[m]);const f=_()(u,200),E=l.current?void 0:"Begin typing to find your manager";return n.createElement(Xh.ZP,{autofocus:o,disabled:i,emptyState:E,label:"Manager",name:g,ref:t,value:null==r?void 0:r.id,onChange:e=>{const t=h.find((t=>t.id===e));t&&(s(t),p([t]))},onBlur:()=>{r||u("")},onInputChange:f},h.map((e=>n.createElement(Xh.N_,{avatar:e.profilePicUrl,avatarDescription:gt.Z.getNameFromModel(e),initials:gt.Z.getUsersInitials(e),key:e.id,label:gt.Z.getNameFromModel(e),value:e.id}))))})),bf=a(71942);!function(e){e.DISPLAY="MM/DD/YYYY",e.INTERNAL="YYYY-MM-DD"}(Cf||(Cf={}));const Sf=e=>{let{popoverRef:t,triggerRef:a,value:r,onChange:s,onClose:i}=e;(0,bf.Z)({anchor:t,offsetYAmount:2,preferredXPosition:Zc.sU,target:a});return n.createElement("div",{className:"StartDatePicker__popover",ref:t,"data-testid":"start-date-picker"},n.createElement(zl,{id:"start-date-picker",date:Te()(r),minDate:Te()().subtract(50,"years"),handleDateChange:e=>{e&&(s(e.format(Cf.DISPLAY)),i())},handleOutsideClick:i}))},Zf=(e,t)=>{let{value:a,onChange:r,disabled:s,autofocus:i}=e;const[o,l]=(0,n.useState)(""),{popoverRef:c,showContainer:d,triggerRef:m,updateContainer:u}=(0,Ws.Z)({containerClass:".StartDatePicker"}),{startDate:h}=nf;(0,n.useEffect)((()=>{l(a?(0,Vl.Kj)(a,Cf.DISPLAY):"")}),[a]);const p=e=>{l(e),Boolean(e)?Te()(e,Cf.DISPLAY,!0).isValid()&&r(Te()(e).format(Cf.INTERNAL)):r()};return n.createElement("div",{className:"StartDatePicker"},n.createElement("div",{ref:m},n.createElement(Fs.Z,{autofocus:i,icon:nt.Z.Calendar,label:"Start date",name:h,disabled:s,mask:Yl.t.DateMMDDYYYY,value:o,onFocus:()=>u(!0),onChange:p})),d?n.createElement(Sf,{popoverRef:c,triggerRef:m,value:a,onChange:p,onClose:()=>u(!1)}):null)};var Nf=(0,n.forwardRef)(Zf);var If=e=>{var t,a,r,s,i,o,l,c;let{errors:d,onBlur:m,onUpdate:u,updates:h,isLockedSyncField:p}=e;const{profile:{person:g}}=Yg(),{jobTitle:f,manager:E,startDate:v,workTeamName:C,workLocationName:y,workingHours:b}=nf,{location:S}=(0,be.k6)(),Z=null===(t=S.state)||void 0===t?void 0:t.fieldToFocus,N=(0,n.useRef)(null),I=Boolean(Z);(0,gf.Z)(N.current,I,{behavior:"smooth"});const T=(0,n.useRef)(null==g?void 0:g.manager);(0,n.useEffect)((()=>{T.current=g.manager}),[g.manager]);return n.createElement(sf,{name:"overview",title:"Overview"},n.createElement(Fs.Z,{requirementLabel:ui.Required,errorMessage:null===(a=hf({field:f,errors:d}))||void 0===a?void 0:a.message,disabled:p(f),label:"Job title",name:f,value:null!==(r=h.jobTitle)&&void 0!==r?r:g.jobTitle,onChange:e=>u({field:f,value:e}),onBlur:e=>m({field:f,value:e})}),n.createElement(Fs.Z,{autofocus:Z===C,ref:Z===C?N:null,icon:nt.Z.Teams,label:"Team",name:C,disabled:p(C),value:null!==(s=h.workTeamName)&&void 0!==s?s:g.workTeamName,onChange:e=>u({field:C,value:e})}),n.createElement(Fs.Z,{autofocus:Z===y,ref:Z===y?N:null,icon:nt.Z.Location,label:"Work location",name:y,disabled:p(y),value:null!==(i=h.workLocationName)&&void 0!==i?i:g.workLocationName,onChange:e=>u({field:y,value:e})}),n.createElement(Nf,{autofocus:Z===v,ref:Z===v?N:null,value:null!==(o=h.startDate)&&void 0!==o?o:g.startDate,disabled:p(v),onChange:e=>u({field:v,value:e})}),n.createElement(Fs.Z,{autofocus:Z===b,ref:Z===b?N:null,icon:nt.Z.Clock,helperText:'Let teammates know when you\'re normally working. Ex: "9 AM - 5 PM EST"',label:"Working hours",name:b,disabled:p(b),value:null!==(l=h.workingHours)&&void 0!==l?l:g.workingHours,onChange:e=>u({field:b,value:e})}),n.createElement(yf,{autofocus:Z===E,ref:Z===E?N:null,value:null!==(c=h.manager)&&void 0!==c?c:T.current,disabled:p(E),onChange:e=>{T.current=e,u({field:E,value:e})}}))},Tf=a(81439);f.Z.register(E.SearchCards,{POST:{path:"/search/cards"}});const Af=new C.Z({name:E.SearchCards,dataType:E.OBJECT,replaceArrayDataOnPostOrPut:!0});Af.createStore();var _f=g.Z.addStore(Af.store),wf=a(25108);const Df=new p.Z({name:_f.getName()}),Pf=g.Z.getFlux().actions[Df.name];Pf||wf.error("Error creating actions");var kf=Pf;var Lf=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:E.GLOBAL;const[t,a]=(0,T.Z)({filterId:e,store:_f,actions:kf});return[t,a]};var Mf=(e,t)=>{let{value:a,onChange:r,pinnedCards:s=[],disabled:i}=e;const o=10===(null==s?void 0:s.length),[l,c]=Lf(),d=(0,ti.Z)(l.status),m=i||o,{cards:h=[]}=l.data,p=(e=>e.filter((e=>!s.some((t=>t.id===e.id)))))(h),g=_()((e=>{if(Boolean(e)){const t={queryType:Tf.x.SearchCards,searchTerms:e};c.post({data:JSON.stringify(t)})}else r(),c.clearStore()}),200),f=l.status===u.S.Updating&&[u.S.Loaded,u.S.Updating].includes(d)||l.status===u.S.Loaded?void 0:"Begin typing to find a Card";return n.createElement("div",{className:"CardSelect"},n.createElement(Xh.ZP,{label:"Search for Cards to add",name:"card-search",value:null==a?void 0:a.id,disabled:m,emptyState:f,helperText:o?"Only ".concat(10," Cards can be pinned."):"",placeholder:"Search for Cards to add",onChange:e=>{r(e)},onBlur:()=>{a||c.clearStore()},onInputChange:g},p.map((e=>{let{id:t,preferredPhrase:a}=e;return n.createElement(Xh.N_,{key:t,label:a,value:t})}))))};var Of=e=>{let{cards:t=[],showDate:a,showDeleteButton:r,onRemove:s}=e;if(0===t.length)return null;const i=e=>n.createElement(It.Z,{date:e.dateCreated}),o=e=>n.createElement(uu.Z,null,n.createElement(uu.S,{aria:"".concat(e.id,"_unpin-card"),icon:nt.Z.Close,tooltipLabel:"Remove from list",onClick:()=>{if(s)return s(e.id)}}));return n.createElement("div",{className:"PinnedCardList"},n.createElement(es.Z,{spacing:es.Z.spaces.TIGHT},t.map((e=>n.createElement(es.H,{key:e.id},n.createElement(Hp.Z,{card:e,stats:a?i(e):void 0,buttonBar:r?o(e):void 0}))))))};var Ff=()=>{const{pinnedCards:{cards:e,isLoading:t,pinCard:a,unpinCard:r}}=Yg(),s=t;return n.createElement(sf,{name:"pinned-cards",title:"Pinned Cards"},n.createElement(St.ZP,{style:St.Jo.Dim},"Feature knowledge you'd like your teammates to be aware of when they are reaching out or working with you."),n.createElement(Mf,{pinnedCards:e,disabled:s,onChange:e=>{e&&a({cardId:e})}}),s&&n.createElement(Nt.ZP,null),n.createElement(Of,{showDeleteButton:!0,cards:e,showDate:!1,onRemove:e=>{e&&r({cardId:e})}}))},Rf=a(91262);const xf=e=>{const t=t=>{var a;return null!==(a=Object.values(ja.Yx).slice(e-2)[t-1])&&void 0!==a?a:ja.Yx.H6};return{a:e=>{let{children:t,href:a=""}=e;return n.createElement("a",{href:a,className:"TextLink-sage",target:"_blank"},t)},blockquote:e=>{let{children:t}=e;return n.createElement("blockquote",{className:"MarkdownContent-sage__blockquote"},t)},code:e=>{let{children:t,inline:a}=e;return n.createElement("code",{className:s()("MarkdownContent-sage__code",{"MarkdownContent-sage__code--inline":a})},t)},em:e=>{let{children:t}=e;return n.createElement("em",{className:"MarkdownContent-sage__copy--italicized"},t)},h1:e=>{let{children:a,level:r}=e;return n.createElement(ja.ZP,{level:t(r),style:ja.VH.Large},a)},h2:e=>{let{children:a,level:r}=e;return n.createElement(ja.ZP,{level:t(r),style:ja.VH.Medium},a)},h3:e=>{let{children:a,level:r}=e;return n.createElement(ja.ZP,{level:t(r),style:ja.VH.Small},a)},hr:()=>n.createElement(mr.Z,null),li:e=>{let{children:t}=e;return n.createElement(es.H,null,t)},ol:e=>{let{children:t}=e;return n.createElement(es.Z,{as:es.Z.elements.OL,marker:es.Z.markers.DECIMAL,spacing:es.Z.spaces.TIGHT},t)},p:e=>{let{children:t}=e;return n.createElement(St.ZP,null,t)},pre:e=>{let{children:t}=e;return n.createElement("pre",{className:"MarkdownContent-sage__pre"},t)},strong:e=>{let{children:t}=e;return n.createElement("strong",{className:"MarkdownContent-sage__copy--bold"},t)},ul:e=>{let{children:t}=e;return n.createElement(es.Z,{marker:es.Z.markers.DISC,spacing:es.Z.spaces.TIGHT},t)}}};var qf=e=>{let{content:t,maxHeadingLevel:a}=e;return n.createElement(Rf.D,{className:"MarkdownContent-sage",components:xf(a)},t)};var Bf=()=>{const[e,t]=(0,n.useState)(!1),[a,r]=(0,n.useState)(!1);return{isActive:e||a,triggerProps:{onMouseEnter:()=>t(!0),onMouseLeave:()=>t(!1),onFocus:()=>r(!0),onBlur:()=>r(!1)}}};function Vf(){return Vf=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},Vf.apply(this,arguments)}var Uf=e=>{let{emptyMessage:t,emptyImageUrl:a,fieldToFocus:r}=e;const{triggerProps:s}=Bf(),[i]=(0,_e.Z)();return n.createElement(Fd.rU,Vf({className:"EmptyQuestionTile",target:(0,m.p1)()?"_blank":void 0,to:e=>({...e,pathname:(0,cn.Q)(e,i.data.id),state:{fieldToFocus:r}})},s),n.createElement("div",{className:"EmptyQuestionTile__image"},n.createElement("img",{alt:"",role:"presentation",src:xt.Z.getURL(a)}),n.createElement(fn.Z,{icon:nt.Z.Pencil,color:wt.ZP.Vacuum,size:24})),n.createElement(St.ZP,{style:St.Jo.Dim},t))};let Hf;!function(e){e.AboutMe="Help your teammates get to know you! Highlight your past experiences, hobbies, skills, or expertise \u2013 whatever makes you, you!",e.WhatImWorkingOn="Highlight your current projects and focus. Share your work, whether it's crushing support tickets or keeping the lights on.",e.BestWayToWorkWithMe="Set up successful collaboration. Add your communication, collaboration, and feedback preferences so your teammates know your style from the start.",e.HelperText="Tip: You can use markdown to format this text and include links"}(Hf||(Hf={}));const Wf=e=>{let{title:t,content:a="",isProfileOwner:r,emptyMessage:s,emptyImageUrl:i,fieldToFocus:o}=e;const l=0===a.trim().length;return l&&!r?null:n.createElement("section",{className:"ProfileQuestion"},n.createElement("header",{className:"ProfileQuestion__header"},n.createElement(ja.ZP,{level:ja.Yx.H3,style:ja.VH.Large},t)),l?n.createElement(Uf,{emptyMessage:s,emptyImageUrl:i,fieldToFocus:o}):n.createElement(qf,{maxHeadingLevel:4,content:a}))};var Gf=()=>{var e;const{profile:{person:t}}=Yg(),a=Ae.Z.isMe(t.userId),{aboutMe:r,whatImWorkingOn:s,bestWayToWorkWithMe:i}=null!==(e=null==t?void 0:t.custom)&&void 0!==e?e:{},{aboutMe:o,whatImWorkingOn:l,bestWayToWorkWithMe:c}=rf;return n.createElement(n.Fragment,null,n.createElement(Wf,{title:"About me",content:r,isProfileOwner:a,emptyMessage:Hf.AboutMe,emptyImageUrl:"common/images/empty-about-me.svg",fieldToFocus:o}),n.createElement(Wf,{title:"What I'm working on",content:s,isProfileOwner:a,emptyMessage:Hf.WhatImWorkingOn,emptyImageUrl:"common/images/empty-working-on.svg",fieldToFocus:l}),n.createElement(Wf,{title:"Best way to work with me",content:i,isProfileOwner:a,emptyMessage:Hf.BestWayToWorkWithMe,emptyImageUrl:"common/images/empty-working-with-me.svg",fieldToFocus:c}))};var zf=e=>{var t,a,r,s,i,o,l,c,d,m;let{onUpdate:u,updates:h}=e;const{location:p}=(0,be.k6)(),g=null==p||null===(t=p.state)||void 0===t?void 0:t.fieldToFocus,f=(0,n.useRef)(null),E=Boolean(g);(0,gf.Z)(f.current,E,{behavior:"smooth"});const{profile:{person:v}}=Yg(),{custom:C}=nf,{aboutMe:y,whatImWorkingOn:b,bestWayToWorkWithMe:S}=rf;return n.createElement(sf,{name:"questions"},n.createElement(Wn.Z,{autofocus:g===y,ref:g===y?f:null,name:y,label:"About me",labelAppendage:Hf.AboutMe,helperText:Hf.HelperText,value:null!==(a=null===(r=h.custom)||void 0===r?void 0:r.aboutMe)&&void 0!==a?a:null===(s=v.custom)||void 0===s?void 0:s.aboutMe,onChange:e=>u({field:C,value:{...h.custom,aboutMe:e}})}),n.createElement(Wn.Z,{autofocus:g===b,ref:g===b?f:null,name:b,label:"What I'm working on",labelAppendage:Hf.WhatImWorkingOn,helperText:Hf.HelperText,value:null!==(i=null===(o=h.custom)||void 0===o?void 0:o.whatImWorkingOn)&&void 0!==i?i:null===(l=v.custom)||void 0===l?void 0:l.whatImWorkingOn,onChange:e=>u({field:C,value:{...h.custom,whatImWorkingOn:e}})}),n.createElement(Wn.Z,{autofocus:g===S,ref:g===S?f:null,name:S,label:"Best way to work with me",labelAppendage:Hf.BestWayToWorkWithMe,helperText:Hf.HelperText,value:null!==(c=null===(d=h.custom)||void 0===d?void 0:d.bestWayToWorkWithMe)&&void 0!==c?c:null===(m=v.custom)||void 0===m?void 0:m.bestWayToWorkWithMe,onChange:e=>u({field:C,value:{...h.custom,bestWayToWorkWithMe:e}})}))},Yf=a(71880);var Kf=e=>{var t,a;let{onCancel:r}=e;const s=(0,Ut.NL)(),{profile:{person:i,isLoading:o,updatePerson:l}}=Yg(),[c,d]=(0,n.useState)({}),[m,h]=(0,ls.Z)(),p=(null===(t=m.image)||void 0===t?void 0:t.status)===u.S.Updating||(null===(a=m.image)||void 0===a?void 0:a.status)===u.S.Loading,[g,{plainFiles:f,filesContent:E,errors:v}]=(0,Kg.s)({accept:[".jpg",".jpeg",".png",".gif"],maxFileSize:2,multiple:!1,readAs:"DataURL"}),C=(0,ti.Z)(c),[y,b]=(0,n.useState)([]),S=Ae.Z.isMe(i.userId),Z=i.synced,N=e=>{var t;return(null!==(t=i.syncedFields)&&void 0!==t?t:[]).includes(e)},I=(e,t)=>{l({person:{...t,profilePicUrl:e},callback:()=>{r()}})},T=e=>{let{field:t,value:a}=e;const n={...c,[t]:a};d(n)},A=e=>{let{field:t,value:a}=e;const n=uf({field:t,value:a,schema:af});let r=y.filter((e=>e.path[0]!==t));n&&r.push(n),b(r)};return n.createElement("form",{className:"ProfileEditForm","aria-label":"Editing profile",name:"profile-edit-form",onSubmit:e=>{var t;if(e.preventDefault(),!Boolean(C))return void r();const a={...i,...c,custom:{...i.custom,...c.custom}},n=mf({form:a,schema:af});if(b(n),n.length>0)return;const o=i.profilePicUrl&&"profilePicUrl"in c;null!==(t=f[0])&&void 0!==t&&t.name?h.saveProfileImage(f[0],(e=>I(e,a)),{hideSuccessToast:!0,savingFromProfile:!0}):o?h.deleteProfileImage((e=>{I(e,a)})):l({person:a,callback:async()=>{"manager"in c&&await s.invalidateQueries([Qg]),r()}})}},n.createElement("header",{className:"ProfileEditForm__header"},n.createElement(lf.ZP,{level:lf.y5.H2,style:lf.Lx.Normal},"Editing profile"),n.createElement(ks.Z,{alignment:ks.A.Right},n.createElement(ft.ZP,{label:"Cancel",style:ft.ZJ.Outline,theme:ft.bn.Gray,onClick:r}),n.createElement(ft.ZP,{label:"Publish changes",theme:ft.bn.Dark,type:ft.g6.Submit,busy:o||p}))),n.createElement("div",{className:"ProfileEditForm__content"},Z?n.createElement(Ul.Z,{customContent:!0,type:Ul.N.Info,icon:nt.Z.Synced,iconSize:40},n.createElement("strong",null,"Some fields are pulled from an external source"),n.createElement("p",null,"To keep your profile up to date, some information is updated from an external source and is not editable in Guru. To update this information, contact"," ",n.createElement(Sn.Z,{to:(0,Yf.d)(jg.rO)},"your admins"),".")):null,n.createElement(pf,{errors:y,updates:c,isLockedSyncField:N,onUpdate:T,onBlur:A}),n.createElement(of,{isLockedSyncField:N,openFileSelector:g,plainFiles:f,filesContent:E,fileUploadErrors:v,onUpdate:T}),n.createElement(cf,null),n.createElement(If,{errors:y,updates:c,isLockedSyncField:N,onUpdate:T,onBlur:A}),n.createElement(zf,{updates:c,onUpdate:T}),S&&n.createElement(Ff,null)))},jf=a(43263);var Jf=()=>{const{profile:{person:e},follows:{followData:{isFollowable:t,isFollowedByCurrentUser:a},followPerson:r}}=Yg(),[{data:{admin:s}}]=(0,_e.Z)(),[i]=(0,Ue.Z)(Ne.Z.ORG_CHART_ALLOWED),o=i&&e.status===jf.J.Active&&(null==e?void 0:e.id),l=e.status===jf.J.Active,c=Ae.Z.isMe(e.userId),d={activitySource:kt.ni.UI,application:kt.Nu.WebApp,userId:e.userId},m=l&&(c||s);return l?n.createElement("div",{className:"ProfileHeaderActions"},o?n.createElement(at.ZP,{aria:"link-to-orgchart",icon:nt.Z.OrgChart,iconSize:16,tooltipPosition:mu.DU.Top,tooltipLabel:"Show in Org Chart",url:(0,Gr.lH)(e.id)}):null,t&&!c?n.createElement(ft.ZP,{label:a?"Unfollow":"Follow",style:ft.ZJ.Outline,theme:ft.bn.Gray,icon:a?nt.Z.NotificationsFilled:nt.Z.Notifications,trackEvent:{name:Pt.default.PROFILE_FOLLOW_BUTTON_CLICKED,eventType:Pt.default.PROFILE_FOLLOW_BUTTON_CLICKED,activitySubtype:a?"unfollow":"follow",...d},onClick:()=>r({})}):null,m?n.createElement(ft.ZP,{label:"Edit",style:ft.ZJ.Outline,theme:ft.bn.Gray,icon:nt.Z.Pencil,trackEvent:{name:Pt.default.EDIT_PROFILE_CLICK,eventType:Pt.default.EDIT_PROFILE_CLICK,...d},url:(0,Gr.Hl)(e.id)}):null):n.createElement("div",{className:"ProfileHeaderActions"},n.createElement(ft.ZP,{disabled:!0,style:ft.ZJ.Outline,theme:ft.bn.Gray,label:"Deactivated account",icon:nt.Z.Archive}))};var Qf=()=>{const{profile:{isFetched:e,person:t}}=Yg(),[{data:{preferences:a}}]=(0,ls.Z)(),r=s()("ProfileHeader",{"ProfileHeader--deactivated":e&&t.status!==jf.J.Active,"ghq-can-drag":(0,m.p1)()}),i=pa.ZP.getOpenFacts(),o=(0,m.p1)()&&(1===i.length||"false"===a.hasExtensionCardTabs);return n.createElement("header",{className:r},o?n.createElement(at.ZP,{aria:"Close profile",iconColor:at.EY.Dark,icon:nt.Z.Close,style:at.Dd.Standard,tooltipPosition:at.DU.Top,onClick:()=>{d.Z.discardFact(t.userId)}}):null,n.createElement("div",{className:"ProfileHeader__details"},n.createElement(pn.Z,{alt:"profile picture",initials:gt.Z.getUsersInitials(t),src:xn.ZP.getProfileUrl(t.profilePicUrl),size:88}),n.createElement("div",{className:"ProfileHeader__personal-info"},n.createElement("div",{className:"ProfileHeader__name-role"},n.createElement(lf.ZP,{level:lf.y5.H1,style:lf.Lx.Normal},gt.Z.getNameFromModel(t)),n.createElement("div",{className:"ProfileHeader__role"},n.createElement("p",null,t.jobTitle),t.pronouns&&n.createElement("p",{className:"ProfileHeader__pronouns"},t.jobTitle&&n.createElement("span",null,"\u2022"),t.pronouns))),n.createElement(Jf,null))))};var Xf=()=>{const[{data:{preferences:{hasExtensionCardTabs:e}}}]=(0,ls.Z)(),t=pa.ZP.getOpenFacts(),a=pa.ZP.getFactsTabWindow().data,r=(0,m.p1)()&&(1===t.length||"false"===e);return n.createElement("div",{className:"ProfileNotFound"},r?n.createElement(at.ZP,{style:at.Dd.Standard,iconColor:at.EY.Dark,aria:"close-profile",icon:nt.Z.Close,onClick:()=>d.Z.discardFact(a.activeCard)}):null,n.createElement($r.Z,{imageUrl:"common/images/profile-not-found.svg",heading:"Profile not found",bodyCopy:"This profile doesn't exist or you don't have access to view it."}))},$f=a(41609),eE=a.n($f);const tE=new ii.Z;var aE=e=>{const t=["PeopleIntegration",e,"data"],{data:a,isFetched:n,refetch:r}=(0,Il.a)(t,(()=>(async e=>tE.get({path:"/teams/".concat(e,"/people/integration/config")}))(e)));return{data:a,isFetched:n,refetch:r}},nE=a(69572),rE=a.n(nE);const sE=e=>{let{size:t,user:a}=e;return n.createElement("div",{className:"AvatarPileAvatar"},n.createElement(pn.Z,{alt:gt.Z.getNameFromModel(a),src:a.profilePicUrl,initials:gt.Z.getUsersInitials(a),size:t}))};var iE=e=>{let{users:t}=e;const a=rE()(t,3),r=2===a.length,i=3===a.length,o=r||i?pn.Z.sizes.XXSMALL:pn.Z.sizes.XSMALL,l=s()("AvatarPile",{"AvatarPile--has-two":r,"AvatarPile--has-three":i});return n.createElement("div",{className:l,"data-testid":"AvatarPile"},a.map((e=>n.createElement(sE,{key:e.id,size:o,user:e}))))};var oE=e=>{let{header:t,content:a,icon:r,title:s,users:i=[]}=e;return n.createElement("span",{className:"OverviewTile"},n.createElement("span",{className:"OverviewTile__visual"},r?n.createElement(fn.Z,{icon:r,size:20}):n.createElement(iE,{users:i})),n.createElement("span",{className:"OverviewTile__content"},n.createElement("h4",{className:"OverviewTile__header"},t),n.createElement("p",{className:"OverviewTile__description",title:"string"==typeof a?a:s},a)))};function lE(){return lE=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},lE.apply(this,arguments)}const cE=n.createContext({closePopover:()=>{}}),dE=()=>(0,n.useContext)(cE),mE=e=>{let{triggerRef:t,popoverRef:a,closePopover:r,children:s}=e;return(0,bf.Z)({anchor:a,offsetYAmount:8,preferredXPosition:Zc.sU,target:t}),n.createElement(cE.Provider,{value:{closePopover:r}},n.createElement("div",{className:"PopoverOverviewTile__popover Popover-sage__container",ref:a},s))};var uE=e=>{let{content:t,header:a,popoverContent:r,icon:s,users:i=[],handleClick:o=(()=>{})}=e;const{isActive:l,triggerProps:c}=Bf(),{triggerRef:d,popoverRef:m,showContainer:u,updateContainer:h}=(0,Ws.Z)({containerClass:".PopoverOverviewTile"});return n.createElement("div",{className:"PopoverOverviewTile Popover-sage"},n.createElement("button",lE({className:"PopoverOverviewTile__trigger"},c,{ref:d,onClick:()=>{h(!u),o()}}),n.createElement(oE,{content:t,header:a,icon:l?nt.Z.ChevronDown:null!=s?s:void 0,users:l?[]:i})),u?n.createElement(mE,{triggerRef:d,popoverRef:m,closePopover:()=>h(!1)},r):null)},hE=a(5585);var pE=()=>{const{profile:{person:e},follows:t}=Yg(),[{data:{id:a}}]=(0,_e.Z)();return{profile:e,follows:t,isProfileOwner:Ae.Z.isMe(null==e?void 0:e.userId),trackEvent:e=>{(0,hE.b9)(e,{eventType:e,type:"click",userId:a,activitySource:kt.ni.UI,application:kt.Nu.WebApp})}}};const gE=e=>{let{userId:t}=e;const{data:a,hasNextPage:r,fetchNextPage:s}=Xg({userId:t}),{closePopover:i}=dE(),[o]=(0,Ue.Z)(Ne.Z.EXTENSION_PROFILES_ALLOWED);return n.createElement("div",{className:"DirectReportsTile__popover","data-testid":"direct-reports-tile-popover"},n.createElement(wn.ZP,{ariaLabel:"direct-reports-menu",heading:"Direct reports"},a.map((e=>{var t;const{onClick:a,to:r}=(0,cn.k)(null!==(t=e.userId)&&void 0!==t?t:e.id,o);return n.createElement(wn.sN,{as:wn.ZJ.Anchor,to:r,key:e.id,onClick:()=>{a(),i()}},n.createElement(Zt.Z,{alt:gt.Z.getNameFromModel(e),initials:gt.Z.getUsersInitials(e),src:e.profilePicUrl},gt.Z.getNameFromModel(e)))})),r?n.createElement("li",{"data-testid":"list-waypoint"},n.createElement(Bt.h,{onEnter:()=>s()})):null))};var fE=()=>{const{profile:{directReports:e=[],totalNumDirectReports:t=0,userId:a=""}}=pE();if(0===t)return null;return n.createElement("li",{className:"ProfileOverview__tile","data-testid":"profile-overview-tile-direct-reports"},n.createElement(uE,{content:(()=>{if(t>2)return"".concat(gt.Z.getNameFromModel(e[0])," and ").concat(t-1," more");return e.map((e=>gt.Z.getNameFromModel(e))).join(" and ")})(),header:"Direct reports",popoverContent:n.createElement(gE,{userId:a}),users:e}))};function EE(){return EE=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},EE.apply(this,arguments)}var vE=e=>{let{header:t,content:a,icon:r,url:s,users:i,target:o,handleClick:l=(()=>{})}=e;const{isActive:c,triggerProps:d}=Bf(),m="string"==typeof s&&(/^mailto:/.test(s)||/^https?:\/\//.test(s)),u=c?nt.Z.Launch:r,h={className:"LinkOverviewTile",...d};return m?n.createElement("a",EE({href:s},h,{target:o,onClick:l}),n.createElement(oE,{header:t,content:a,icon:u,users:i})):n.createElement(Fd.rU,EE({to:s},h,{target:o,onClick:l}),n.createElement(oE,{header:t,content:a,icon:u,users:i}))};var CE=()=>{const{profile:{email:e},trackEvent:t}=pE();return e?n.createElement("li",{className:"ProfileOverview__tile","data-testid":"profile-overview-tile-email"},n.createElement(vE,{header:"Email",content:e,url:"mailto:".concat(e),title:e,icon:nt.Z.EmailEnvelope,handleClick:()=>{t(Pt.default.PROFILE_EMAIL_TILE_CLICKED)}})):null};const yE={activitySource:kt.ni.UI,application:kt.Nu.WebApp},bE=e=>!Ef()(e),SE=e=>{let{emptyMessage:t,list:a,fetchNext:r}=e;const{closePopover:s}=dE(),[i]=(0,Ue.Z)(Ne.Z.EXTENSION_PROFILES_ALLOWED),o=a.map((e=>e.user)).filter(bE);return 0===o.length?n.createElement("div",{className:"FollowsTile__list--empty"},t):n.createElement(wn.ZP,{ariaLabel:"follows-list"},o.map((e=>{const{onClick:t,to:a}=(0,cn.k)(e.id,i);return n.createElement(wn.sN,{as:wn.ZJ.Anchor,to:a,key:e.id,onClick:()=>{t(),s()}},n.createElement(Zt.Z,{alt:gt.Z.getNameFromModel(e),initials:gt.Z.getUsersInitials(e),src:e.profilePicUrl},gt.Z.getNameFromModel(e)))})),r?n.createElement("li",{"data-testid":"list-waypoint"},n.createElement(Bt.h,{onEnter:()=>r()})):null)},ZE=()=>{const[e,t]=(0,n.useState)("followers"),{profile:{firstName:a="This user"},follows:{followData:{followersCount:r=0,followingCount:s=0},following:i,followers:o,fetchNextPageOfFollowers:l,fetchNextPageOfFollowing:c},isProfileOwner:d}=pE(),[{data:{id:m}}]=(0,_e.Z)(),u="".concat(d?"You don't":"".concat(a," doesn't")," have any followers.").concat(d?"":" Be the first to follow them!"),h="".concat(d?"You aren't":"".concat(a," isn't")," following anyone.");return n.createElement("div",{className:"FollowsTile__popover","data-testid":"follows-tile-popover"},n.createElement(wr.ZP,{activeTab:e,setActiveTab:t},n.createElement(wr.v0,null,n.createElement(wr.OK,{tabId:"followers",trackEvent:{name:Pt.default.PROFILE_FOLLOWERS_TAB_CLICKED,eventType:Pt.default.PROFILE_FOLLOWERS_TAB_CLICKED,userId:m,...yE}},"Followers (",r,")"),n.createElement(wr.OK,{tabId:"following",trackEvent:{name:Pt.default.PROFILE_FOLLOWING_TAB_CLICKED,eventType:Pt.default.PROFILE_FOLLOWING_TAB_CLICKED,userId:m,...yE}},"Following (",s,")")),n.createElement(wr.x4,{tabId:"followers"},n.createElement(SE,{emptyMessage:u,list:o,fetchNext:l})),n.createElement(wr.x4,{tabId:"following"},n.createElement(SE,{emptyMessage:h,list:i,fetchNext:c}))))};var NE=()=>{const{follows:{followData:{followersCount:e=0,followingCount:t=0},followers:a,following:r,isLoading:s},trackEvent:i}=pE();if(0===e&&0===t||s)return null;const o=a.concat(r).reduce(((e,t)=>(t.user&&e.push(t.user),e)),[]),l=(0,_t.B$)("Follower",e);return n.createElement("li",{className:"ProfileOverview__tile","data-testid":"profile-overview-tile-follows"},n.createElement(uE,{content:"".concat(e," ").concat(l," \u2022 ").concat(t," Following"),header:"Following",popoverContent:n.createElement(ZE,null),users:o,handleClick:()=>i(Pt.default.PROFILE_FOLLOWERS_TILE_CLICKED)}))};function IE(){return IE=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},IE.apply(this,arguments)}var TE=e=>{let{header:t,content:a,icon:r,fieldToFocus:s}=e;const{isActive:i,triggerProps:o}=Bf(),[l]=(0,_e.Z)();return n.createElement(Fd.rU,IE({},o,{target:(0,m.p1)()?"_blank":void 0,to:e=>({...e,pathname:(0,cn.Q)(e,l.data.id),state:{fieldToFocus:s}}),className:"EmptyStateOverviewTile"}),n.createElement(oE,{header:t,content:a,icon:i?nt.Z.Pencil:r}))};var AE=()=>{const{profile:{manager:e},isProfileOwner:t,trackEvent:a}=pE(),[r]=(0,Ue.Z)(Ne.Z.EXTENSION_PROFILES_ALLOWED);if(!t&&!e)return null;const{manager:s}=nf,{onClick:i,to:o}=(0,cn.k)(null==e?void 0:e.id,r);return n.createElement("li",{className:"ProfileOverview__tile","data-testid":"profile-overview-tile-manager"},e&&o?n.createElement(vE,{header:"Manager",content:gt.Z.getNameFromModel(e),title:gt.Z.getNameFromModel(e),users:[e],url:o,handleClick:()=>{i(),a(Pt.default.PROFILE_MANAGER_TILE_CLICKED)}}):n.createElement(TE,{header:"Manager",content:"Add manager",icon:nt.Z.UserAdd,fieldToFocus:s}))};const _E=e=>{let{slackProfileDetails:t}=e;const{closePopover:a}=dE();return n.createElement("div",{className:"SlackTile__popover","data-testid":"slack-tile-popover"},n.createElement(wn.ZP,{ariaLabel:"slack-menu"},t.map((e=>{let{slackTeamName:t,slackTeamUrl:r}=e;return n.createElement(wn.sN,{as:wn.ZJ.Anchor,to:r,key:r,onClick:a},n.createElement(Dt.ZP,{icon:nt.Z.Slack},n.createElement("span",{className:"SlackTile__slack-info"},n.createElement("span",{className:"SlackTile__slack-team-name"},t)," ","(",null==r?void 0:r.replace("https://","").split("/")[0],")")))}))))};var wE=()=>{const{trackEvent:e,profile:{slackProfileDetails:t}}=pE();return t&&0!==(null==t?void 0:t.length)?n.createElement("li",{className:"ProfileOverview__tile","data-testid":"profile-overview-tile-slack"},1===t.length?n.createElement(vE,{header:"Messaging",content:"Slack",url:t[0].slackTeamUrl,title:"Slack",icon:nt.Z.Slack,target:"_blank",handleClick:()=>{e(Pt.default.PROFILE_SLACK_TILE_CLICKED)}}):n.createElement(uE,{content:"Slack",header:"Messaging",icon:nt.Z.Slack,popoverContent:n.createElement(_E,{slackProfileDetails:t})})):null};var DE=()=>{const{profile:{startDate:e},isProfileOwner:t}=pE();if(!t&&!e)return null;const{startDate:a}=nf;return n.createElement("li",{className:"ProfileOverview__tile","data-testid":"profile-overview-tile-start-date"},e?n.createElement(oE,{header:"Start date",content:(0,Vl.Kj)(e),title:e,icon:nt.Z.Calendar}):n.createElement(TE,{header:"Start date",content:"Add start date",icon:nt.Z.Calendar,fieldToFocus:a}))};var PE=()=>{const{profile:{workTeamName:e},isProfileOwner:t}=pE();if(!t&&!e)return null;const{workTeamName:a}=nf;return n.createElement("li",{className:"ProfileOverview__tile","data-testid":"profile-overview-tile-team"},e?n.createElement(oE,{header:"Team",content:e,title:e,icon:nt.Z.Teams}):n.createElement(TE,{header:"Team",content:"Add team",icon:nt.Z.Teams,fieldToFocus:a}))};var kE=()=>{const{profile:{workingHours:e},isProfileOwner:t}=pE();if(!t&&!e)return null;const{workingHours:a}=nf;return n.createElement("li",{className:"ProfileOverview__tile","data-testid":"profile-overview-tile-working-hours"},e?n.createElement(oE,{header:"Working hours",content:e,title:e,icon:nt.Z.Clock}):n.createElement(TE,{header:"Working hours",content:"Add working hours",icon:nt.Z.Clock,fieldToFocus:a}))};var LE=()=>{const{profile:{workLocationName:e},isProfileOwner:t}=pE();if(!t&&!e)return null;const{workLocationName:a}=nf;return n.createElement("li",{className:"ProfileOverview__tile","data-testid":"profile-overview-tile-work-location"},e?n.createElement(oE,{header:"Work location",content:e,title:e,icon:nt.Z.Location}):n.createElement(TE,{header:"Work location",content:"Add location",icon:nt.Z.Location,fieldToFocus:a}))};const ME=(e,t)=>t.every((t=>Ef()(e[t])));var OE=()=>{const[{data:{id:e}}]=(0,_e.Z)(),{isLoading:t}=Yg(),a=(e=>{const{profile:{person:t},follows:{followData:a}}=Yg();if(eE()(t)&&eE()(a))return!0;if(e===t.id)return!1;const n=ME(t,["email","joinedDate","manager","workTeamId","workTeamName","workLocationId","workLocationName"]),r=ME(a,["followersCount","followingCount"]);return n&&r})(e),r=(()=>{var e;const[{data:{team:t}}]=(0,_e.Z)(),{data:a}=aE(t.id);return Boolean(null==a||null===(e=a.peopleProfileSpec)||void 0===e?void 0:e.displayEmail)})();return t||a?null:n.createElement("section",{className:"ProfileOverview"},n.createElement("header",{className:"ProfileOverview__header"},n.createElement(ja.ZP,{level:ja.Yx.H2,style:ja.VH.Large},"Overview")),n.createElement("ul",{className:"ProfileOverview__tiles"},n.createElement(PE,null),n.createElement(LE,null),n.createElement(kE,null),n.createElement(DE,null),n.createElement(AE,null),n.createElement(fE,null),n.createElement(NE,null),r?n.createElement(CE,null):null,n.createElement(wE,null)))};var FE=()=>n.createElement("div",{className:"ProfilePending"},n.createElement($r.Z,{imageUrl:"common/images/profile-not-found.svg",heading:"This user hasn't logged in to fill out their profile",bodyCopy:"You can check back later or give them a nudge to fill it out!"}));const RE=()=>n.createElement("header",{className:"ProfilePinnedCards__header"},n.createElement(ja.ZP,{level:ja.Yx.H3,style:ja.VH.Large},"Pinned Cards"));var xE=()=>{var e;const{pinnedCards:t}=Yg(),a=t.isFetched,r=null!==(e=t.cards)&&void 0!==e?e:[];return a&&0!==r.length?n.createElement("section",{className:"ProfilePinnedCards"},n.createElement(RE,null),n.createElement(Of,{showDate:!0,cards:r})):null},qE=a(74490);let BE,VE;!function(e){e.DateCreated="dateCreated",e.LastUpdated="lastModified"}(BE||(BE={})),function(e){e.Oldest="ASC",e.Newest="DESC"}(VE||(VE={}));var UE=e=>{let{sortParams:t,setSortParams:a}=e;const{type:r,direction:s}=t,i=e=>{a({type:e,direction:VE.Newest})},o=e=>{a({type:r,direction:e})},l=n.createElement(ft.ZP,{icon:nt.Z.SortList,label:"Sort: ".concat({dateCreated:"Date Created",lastModified:"Last Updated"}[r]),size:ft.qE.Small});return n.createElement("div",{className:"PublishedCardSorter"},n.createElement(Ga.Z,{trigger:l},n.createElement(wn.ZP,{ariaLabel:"Published Cards Sort",heading:"Sort by"},n.createElement(wn.sN,{checked:r===BE.DateCreated,onClick:()=>i(BE.DateCreated)},"Date Created"),n.createElement(wn.sN,{checked:r===BE.LastUpdated,onClick:()=>i(BE.LastUpdated)},"Last Updated"),n.createElement(wn.sN,{borderTop:!0,checked:s===VE.Newest,onClick:()=>o(VE.Newest)},"Newest first"),n.createElement(wn.sN,{checked:s===VE.Oldest,onClick:()=>o(VE.Oldest)},"Oldest first"))))};const HE=e=>{let{sortParams:t,card:a}=e;const r=t.type;return r===BE.DateCreated?n.createElement(It.Z,{date:a.dateCreated}):r===BE.LastUpdated?n.createElement(It.Z,{date:a.lastModified}):void 0};var WE=e=>{let{cards:t,sortParams:a,cardsLoadedStatus:r,onEnterWaypoint:s}=e;const i=[u.S.Updating,u.S.Loading].includes(r);return n.createElement("div",{className:"PublishedCardList"},n.createElement(es.Z,{spacing:es.Z.spaces.TIGHT},t.map((e=>n.createElement(es.H,{key:e.id},n.createElement(Hp.Z,{card:e,stats:HE({sortParams:a,card:e})}))))),i&&n.createElement("div",{className:"PublishedCardList__loader"},n.createElement(Nt.ZP,null)),n.createElement(Bt.h,{onEnter:s}))};var GE=e=>{let{userId:t,firstName:a,isFollowable:r}=e;const s=Ae.Z.isMe(t);let i,o;return i=s?"You haven't":a?"".concat(a," hasn't"):"This user hasn't",s?o="All Cards you publish will be featured here on your profile.":r&&(o="You can follow them to get notified about Cards they publish."),n.createElement("div",{className:"PublishedCards__empty-state"},n.createElement($r.Z,{imageUrl:"common/images/empty-published-cards.svg",heading:"".concat(i," published any Cards yet"),bodyCopy:o}))};var zE=()=>{var e,t;const{profile:{person:a,isFetched:r},follows:{followData:{isFollowable:s}}}=Yg(),i=null==a?void 0:a.email,[{headers:{[Rc.ZD]:o},linkHeaders:l,status:c,items:{data:d}},m]=(0,qE.Z)(i,{preventOnLoad:!0}),h=null!==(e=null==l||null===(t=l["next-page"])||void 0===t?void 0:t.token)&&void 0!==e?e:"",p=(0,n.useRef)(""),g=(null==o?void 0:o.length)>0?parseInt(o):0,f=c===u.S.Loaded&&void 0===o,[E,v]=(0,n.useState)({type:BE.LastUpdated,direction:VE.Newest}),C={queryType:"cards",sorts:[{type:E.type,dir:E.direction}],query:{type:Bd.jS.ORIGINAL_OWNER,email:i,op:"EQ"},collectionIds:[]};(0,n.useEffect)((()=>{r&&m.post({data:JSON.stringify(C)})}),[E,i]);const y=()=>n.createElement("header",{className:"ProfilePublishedCards__header"},0===g?n.createElement(ja.ZP,{level:ja.Yx.H3,style:ja.VH.Large},"Published Cards"):n.createElement(n.Fragment,null,n.createElement("div",null,n.createElement(ja.ZP,{level:ja.Yx.H3,style:ja.VH.Large},"Published Cards"),n.createElement(St.ZP,{style:St.Jo.Dim},"".concat(g," Cards"))),n.createElement(UE,{sortParams:E,setSortParams:v})));return n.createElement("section",{className:"ProfilePublishedCards"},r&&n.createElement(n.Fragment,null,n.createElement(y,null),f?n.createElement(GE,{userId:a.userId,firstName:a.firstName,isFollowable:s}):n.createElement(WE,{cards:d,sortParams:E,cardsLoadedStatus:c,onEnterWaypoint:()=>{var e;c===u.S.Loaded&&p.current!==h&&(p.current=h,e=h,m.post({data:JSON.stringify(C),queryParams:{token:e},meta:{forceAppendDataOnPostOrPut:!0,unshiftFlag:!1}}))}})))};var YE=e=>{let{profileId:t}=e;const{isLoading:a,profile:{person:r,isError:i}}=Yg(t),o=(0,be.TH)(),l=(0,be.LX)(o.pathname,{path:"/people/:id/edit",exact:!0}),c=(0,be.k6)(),[{data:{admin:d}}]=(0,_e.Z)(),u=Ae.Z.isMe(r.userId),h=()=>{const e=(0,Gr.pv)(r.id);c.push(e)};if(l&&(u||d))return n.createElement(Gg,{profileId:t},n.createElement(Kf,{onCancel:h}));const p=s()("ProfilePage",{"ProfilePage--loading":a,"ghq-is-extension":m.ZP.isExtension()});return i?n.createElement(Xf,null):(null==r?void 0:r.status)!==Lg.Pending||r.deleted?(a||!l||u||d||h(),n.createElement(Gg,{profileId:t},n.createElement("div",{className:p},a?n.createElement(Nt.ZP,{size:Nt.wx.Large,dataTestId:"loading-profile-page"}):n.createElement("section",{className:"ProfilePage__content"},n.createElement(Qf,null),n.createElement(OE,null),n.createElement(Gf,null),n.createElement(xE,null),n.createElement(zE,null))))):n.createElement(FE,null)};const KE=L()("div"),jE=(e,t)=>{if(e!==Ap.Z.getName())return null;{const e=nd.Z.getBySearchId(o()(t,"fact.id",null)),a=o()(e,"data",[]).filter((e=>"user-group"===e.type));if(a.length)return a[0].id}};class JE extends n.Component{constructor(e){super(e),this._questionTypes=[le().QUESTION,le().Views.ANSWER_WITH_EXISTING_CARD,le().Views.CHANGE_ANSWERER,le().Views.CHOOSE_ANSWER_METHOD,le().Views.DELETE_QUESTION,le().Views.DISCUSSION],this._softCardHeight="auto",this.startDrag=e=>{if(pa.ZP.isMaximized())return;var t=window.getComputedStyle(e.target,null).cursor;if(0!==e.button||"move"!==t)return void d.Z.focusFact(this.props.fact.id);const a=P.findDOMNode(this),n=a.offsetTop,r=a.offsetLeft;d.Z.startFactDrag(this.props.fact.id,e.clientX-r,e.clientY-n),this.setState({dragging:!0})},this.onMouseUp=()=>{d.Z.stopFactDrag(),this.setState({dragging:!1})},this.onMouseMove=e=>{if(this.state.dragging){var t=pa.ZP.getById(this.props.fact.id);d.Z.moveFact(this.props.fact.id,e.clientX-t.relativeLeft,e.clientY-t.relativeTop),e.stopPropagation(),e.preventDefault()}},this.isModified=e=>this.props.fact.data[e]!==this.props.fact.editFact.data[e],this.hasUnsavedChanges=()=>this.isModified("content")||this.isModified("preferredPhrase"),this.handleClose=()=>{const{EDITING:e,NEW:t}=le(),{action:a,fact:n,history:r}=this.props,s=a===e||a===t,i=Sr.Z.hasSharedDraftsAllowed();if(!ae.C.isViewUnpublished({fact:n})||n.data.archived||i)if(s&&this.hasUnsavedChanges())d.Z.startFactClose(n.id);else{const e={fact:n,doNotConfirm:i};d.Z.discardFact(n.id,e)}else he.save(n);ts.Z.replace({...r,state:{openAnswerGenerator:Boolean(n.meta.answerId)}}),ts.Z.clearQuery("template_id")},this.isQuestionAndShouldntClose=()=>this.props.fact.data.cardType===le().QUESTION&&this.props.fact.cardState!==le().Views.DISCUSSION&&"new"!==this.props.fact.action,this.getItemType=()=>{const{fact:e}=this.props;let t=e.data.cardType;!t&&e.editFact&&(t=e.editFact.data.cardType),t=t||le().CARD;const a=e.cardState;return a&&t===le().QUESTION?a:e.data.type===le().PROFILE?le().PROFILE:t},this.handleResize=_()((()=>{this.setState({isFullScreen:(0,us.tq)()})}),100),this.handleClickOutside=e=>{const{fact:t}=this.props,a=e.target===document.getElementsByClassName("ghq-fact-glass")[0];this.isQuestionAndShouldntClose()||(this.state.updateAnswerer&&Y.Z.saveVerifier(this.props.fact.data.id),!m.ZP.isExtension()&&a&&(t.onCancel&&t.onCancel(),this.handleClose()))},this.handleEscape=e=>{const{isTopCard:t,fact:a}=this.props,n=P.findDOMNode(pe.ZP.APP_ELEMENT);if(!e.target.className.includes("ghq-chip-input-live-input")&&a.status!==le().CONFIRM&&!this.isQuestionAndShouldntClose()){if(this.state.updateAnswerer&&Y.Z.saveVerifier(this.props.fact.data.id),!m.ZP.isExtension())return a.onCancel&&a.onCancel(),void this.handleClose();t&&n.contains(document.activeElement)&&(e.stopImmediatePropagation(),a.onCancel&&a.onCancel(),this.handleClose())}},this.isCardVerifier=()=>{const{verifiers:e}=this.props;return o()(e,"data",[]).some((e=>{const t=Pe.Z.getEmail();if("user"===e.type&&t===e.id)return!0;if("user-group"===e.type){const{groupMembers:e}=this.props;if(e)return o()(e,"items.data",[]).some((e=>{let{id:a}=e;return a===t}))}return!1}))},this.setDisabledDraftSaves=e=>{this.setState({disableDraftSaves:e})},this.state={activeAnnouncement:null,dragging:!1,showCommentsTray:!1,showVerifierName:!1,isFullScreen:(0,us.tq)(),disableDraftSaves:!1}}UNSAFE_componentWillMount(){this.props.fact.action===le().EDITING&&this.props.fact.status===le().LOADING&&O.Z.savePreferencesToCardDefaultEditDimensions(this.props.fact.id),this.props.fact.action===le().NEW&&this.props.loadTemplatesIfNeeded()}componentWillUnmount(){window.removeEventListener("resize",this.handleResize)}componentDidMount(){const{hasCardAttributes:e}=this.props;if(e){const e=Pe.Z.getTeamId();V.get(e,{pathVars:[e]})}window.addEventListener("resize",this.handleResize)}UNSAFE_componentWillReceiveProps(e){this.props.fact.action!==le().EDITING&&e.fact.action===le().EDITING&&O.Z.savePreferencesToCardDefaultEditDimensions(e.fact.id),!this.props.fact.data.id&&e.fact.data.id&&O.Z.savePreferencesToCardDefaultEditDimensions(e.fact.data.id)}componentDidUpdate(e,t){const{isTopCard:a}=e,{fact:n,isTopCard:r}=this.props;this.state.dragging&&!t.dragging?(document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)):!this.state.dragging&&t.dragging&&(document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp));const s=this.getItemType();if(!this._questionTypes.includes(s)&&this._card&&!this.props.fact.height&&"auto"===this._softCardHeight){const e=window.getComputedStyle(this._card).height;this._softCardHeight=e}!1===a&&!0===r&&M.Z.postActivity({type:Pt.default.FACT_REVEALED,properties:{factId:n.id},biOnly:!0})}render(){const{collaborators:e,factBoards:t,verifiers:a,fact:r,routerless:i,isMaximized:o,templateListLength:l,teamAttributes:c,hasCardAttributes:d}=this.props,{isFullScreen:u,disableDraftSaves:h}=this.state,p=s()("ghq-factcard__shell",{"ghq-is-maximized":o});if(r.status!==le().ERROR&&(r.status===le().LOADING||!r.data))return null;const g={zIndex:"".concat(r.zIndex)};let f=null;this.props.isMaximized||(g.position="fixed !important",g.width="".concat(Math.max(r.width,Ee().size.MIN_WIDTH),"px"),g.height="".concat(Math.max(r.height,Sr.Z.hasKCSReports()?Ee().size.KCS_FEATURE_FLAG_MIN_HEIGHT:Ee().size.MIN_HEIGHT),"px"),g.maxHeight="95vh",g.top="".concat(r.top,"px"),g.left="".concat(r.left,"px"),f=n.createElement(kg,{fact:r}));let E=null;switch(this.getItemType()){case le().PROFILE:E=n.createElement(YE,{profileId:r.id});break;case le().CARD:case le().FILE:E=[le().EDITING,le().NEW].includes(r.action)?n.createElement(n.Fragment,null,n.createElement(Yu,{fact:r,factBoards:t,sharers:e,verifiers:a}),d?c.status===le().LOADED?n.createElement(Mp,{fact:r}):null:n.createElement(Mp,{fact:r})):n.createElement("div",{className:p},i?n.createElement(ah,null):n.createElement(eh,null));break;case le().QUESTION:E=n.createElement(Ag,{auth:this.props.auth,fact:r,comments:this.state.comments,collaborators:this.state.collaborators,allowMaximized:this.props.allowMaximized});break;case le().Views.ANSWER:E=n.createElement(Ag,{auth:this.props.auth,fact:r,initialView:le().Views.ANSWER,allowMaximized:this.props.allowMaximized});break;case le().Views.ANSWER_WITH_EXISTING_CARD:E=n.createElement(Ag,{auth:this.props.auth,fact:r,comments:this.state.comments,collaborators:this.state.collaborators,initialView:le().Views.ANSWER_WITH_EXISTING_CARD,allowMaximized:this.props.allowMaximized});break;case le().Views.DELETE_QUESTION:case le().Views.CHANGE_ANSWERER:case le().Views.CHOOSE_ANSWER_METHOD:case le().Views.ANSWER:case le().Views.DISCUSSION:E=n.createElement(Ag,{auth:this.props.auth,fact:r,initialView:le().Views.DISCUSSION,updateAnswerer:()=>this.setState({updateAnswerer:!0}),allowMaximized:this.props.allowMaximized})}const v=s()("ghq-factcard-container",{"ghq-factcard-question":this._questionTypes.includes(this.getItemType()),"ghq-is-editing":[le().NEW,le().EDITING].includes(r.action),"ghq-is-extension":m.ZP.isExtension(),"ghq-is-webapp":!m.ZP.isExtension(),"ghq-factcard-notransition":r.dragging,"ghq-factcard-has-feedback":r.meta.agentAssistFeedbackStage===ge.Jf,"ghq-factcard-has-additional-feedback":r.meta.agentAssistFeedbackStage===ge.Mz,"ghq-factcard-has-additional-feedback-input":r.meta.agentAssistFeedbackStage===ge.eD,"ghq-resize-card-creation-modal":!m.ZP.isExtension()&&!u&&r.messageKey===le().CREATING_NEW_CARD,"ghq-card-creation-empty-state":!l,"ghq-is-mobile":u}),C={activeAnnouncement:this.state.activeAnnouncement,showCommentsTray:this.state.showCommentsTray,onClickClose:this.handleClose,setActiveAnnouncement:e=>this.setState({activeAnnouncement:e}),setShowCommentsTray:e=>this.setState({showCommentsTray:e}),disableDraftSaves:h,setDisableDraftSaves:this.setDisabledDraftSaves};return n.createElement(ye.ZP.Provider,{value:(0,ye.XL)(r,this.props,C)},n.createElement(KE,{"data-no-focus-lock":!0,id:r.id,style:g,className:v,onMouseDown:this.startDrag},n.createElement("div",{ref:e=>this._card=e,className:"ghq-factcard-buttons-and-content"},E,f,n.createElement(fr.FN,{filter:"fact-card-".concat(r.id)}))))}}var QE=(0,ve.Z)((0,Ce.Z)((0,h.Z)(((e,t)=>{const{CollaboratorsStore:a,FactBoardsStore:n,FactPermissionsStore:r,VerifiersStore:s,TemplatesCardsStore:i,LicenseStore:o}=e,{fact:l}=t,c=jE(Ap.Z.getName(),t),d=i.getFilter(E.GLOBAL),m=o.hasCardAttributes();return{auth:Pe.Z.getState(),teamAttributes:R.getFilter(Pe.Z.getTeamId()),collaborators:a.getBySearchId(l.data.id),factBoards:n.getByFactId(l.data.id||l.id),permissions:r.getByFactId(l.id),verifiers:s.getBySearchId(l.id),groupMembers:c?Ap.Z.getFilter(c):null,templateListLength:d.items.data.length,loadTemplatesIfNeeded:()=>{if(i.getFilter(E.GLOBAL).status===le().NOT_LOADED)return z.get(Pe.Z.getTeamId())},hasCardAttributes:m}}),jE)([Pe.Z,ha.Z,pa.ZP,Ai.Z,Be.Z,Ap.Z,nd.Z,U.Z,Sr.Z,R],JE)));JE.propTypes={isMaximized:D().bool};var XE=a(57371),$E=a(30129),ev=a(61657),tv=a(95783);class av extends n.Component{constructor(e){super(e),this.cardTabRef=n.createRef()}componentDidMount(){this.props.isActive&&this.cardTabRef.current&&this.cardTabRef.current.scrollIntoView({behavior:"smooth"})}componentDidUpdate(e){this.props.tabOrderIndex.acc!==e.tabOrderIndex.acc&&this.cardTabRef.current&&this.cardTabRef.current.scrollIntoView({behavior:"smooth"})}render(){const{hasBorderTop:e,hasBorderLeft:t,className:a,isActive:r,name:i,onClick:o,onClickClose:l,verificationState:c,isEditing:d,isSynced:m,isNew:u,isQuestion:h,isError:p,isCreatingNew:g}=this.props,f=s()("CardTabsTab",a,{"ghq-is-new":u&&r,"ghq-is-active":r,"ghq-is-clickable":o,"ghq-has-border-left":t,"ghq-has-border-top":e,"ghq-is-loading":null===c&&r,"ghq-is-verified":c===le().TRUSTED&&r&&!m,"ghq-is-unverified":c===le().NEEDS_VERIFICATION&&r&&!m,"ghq-is-synced":m&&r,"ghq-has-knowledge-sync-verifiers":Sr.Z.hasKnowledgeSyncVerifiers()}),E=s()("CardTabsTab__close",{"ghq-is-active":r});return n.createElement("div",{ref:this.cardTabRef,className:f,"data-testid":"CardTab",onClick:o||null},(h||d||u)&&n.createElement("span",{className:"CardTabsTab__is-editing"},n.createElement(Xe.Z,{className:E,icon:h?"question":(d||u)&&"pencil",size:12})),n.createElement("span",{className:"CardTabsTab__name"},g?"Create Card":u&&0===i.length?"Untitled":p?"ERROR":i),l&&n.createElement(Xe.Z,{className:E,icon:"close",size:12,onClick:l}))}}av.propTypes={name:D().string.isRequired,hasBorderTop:D().bool,hasBorderLeft:D().bool,isActive:D().bool,onClick:D().func,onClickClose:D().func,tabOrderIndex:D().shape({num:D().number,acc:D().number})},av.defaultProps={hasBorderTop:!1,hasBorderLeft:!1,isActive:!1,onClick:null,onClickClose:null,verificationState:null,isEditing:!1,isSynced:!1,isNew:!1,isQuestion:!1,isError:!1,tabOrderIndex:{num:1,acc:0}};var nv=a(76462);const rv=(0,n.createContext)({activeTabId:"",handleClose:()=>{},handleOnClick:()=>{}}),sv=e=>{let{children:t,...a}=e;return n.createElement(rv.Provider,{value:a},t)},iv=e=>{let{id:t,prependage:a,children:r}=e;const{activeTabId:i,handleClose:o,handleOnClick:l}=(0,n.useContext)(rv),c=i===t;return n.createElement(wn.sN,{prependage:a,appendage:n.createElement(at.ZP,{aria:"close-tab",icon:nt.Z.Close,iconSize:12,tooltipLabel:"Close tab",style:at.Dd.Standard,onClick:()=>o(t)}),onClick:()=>l(t)},n.createElement("span",{className:s()({"OverflowTab__content--active":c}),"data-testid":c?"OverflowTab--active":"OverflowTab--inactive"},r))},ov=e=>{let{item:t}=e;const{id:a,meta:r,name:s}=t,{isNew:i,isSynced:o,verificationState:l}=r;return n.createElement(iv,{id:a,prependage:n.createElement(Br.Z,{isTrusted:l===le().TRUSTED&&!o,isSynced:o})},i&&0===s.length?"Untitled":s)},lv=e=>{let{item:t}=e;const{id:a}=t,{isFetched:r,person:s}=qg(a);return r?n.createElement(iv,{id:a,prependage:n.createElement(pn.Z,{src:s.profilePicUrl,alt:s.displayName,size:pn.Z.sizes.XXSMALL})},s.displayName):n.createElement(wn.sN,{key:a,onClick:()=>{}},n.createElement(Nt.ZP,{dataTestId:"OverflowTabs__profile--loader",size:Nt.wx.Small}))};var cv=e=>{let{activeTabId:t,overflowItems:a,onClickTab:r,onClickTabClose:s=(()=>{})}=e;const[i]=(0,Ue.Z)(Ne.Z.FAVORITE_LISTS_ALLOWED),[o]=(0,Ue.Z)(Ne.Z.EXTENSION_PROFILES_ALLOWED),[l,c]=(0,n.useState)(!1),[d,m]=(0,n.useState)(""),u=(0,n.useRef)(null),h=o?"Other Cards and profiles":"Other Cards";return n.createElement("div",{className:"OverflowTabs",ref:u},n.createElement(Ga.Z,{containerPosition:Ga.I.Left},n.createElement(wn.ZP,{ariaLabel:h},n.createElement(sv,{activeTabId:t,handleClose:s,handleOnClick:e=>{r&&r({clickedTabId:e,isInOverflow:!0})}},a.map((e=>"PROFILE"===e.data.type?n.createElement(lv,{item:e,key:e.id}):n.createElement(ov,{item:e,key:e.id})))),i?n.createElement(wn.sN,{borderTop:!0,icon:nt.Z.FavoriteEmpty,onClick:()=>c(!0)},"Save all open Cards as a new list"):null)),l?n.createElement(Ac.Z,{poll:!0,target:u.current},n.createElement(Hs.Z,{title:"Save All Tabs as New List",newListName:d,handleInputChange:e=>m(e),handleCreateList:()=>{const e=[];a.forEach((t=>{(0,Vt.r3)(t.data)&&e.push({type:"fact",id:t.id})})),nv.Z.post(E.GLOBAL,{data:JSON.stringify({title:d,items:e})}),c(!1),m("")},onClickClose:()=>c(!1)})):null)};const dv=e=>{let{blockRef:t,direction:a,currentTabWidth:n}=e;const r={top:0,behavior:"smooth"};r.left="left"===a?-n:n,t.scrollBy(r)};function mv(e){let{tabItems:t,className:a,activeTabCardId:r,onClickTab:i,onClickTabClose:l}=e;const[c,d]=n.useState(),[m,u]=n.useState(!1),[h,p]=n.useState(!1),[g,f]=n.useState(!1),E=t.filter((e=>{var t;return(null===(t=e.data)||void 0===t?void 0:t.type)===le().PROFILE})).map((e=>e.id)),v=(0,ev.h)({queries:[...E.map((e=>({queryKey:["openProfile",e],queryFn:()=>xg(e)})))]}),C=v.some((e=>e.isLoading));(0,tv.Z)((()=>{c.scrollWidth>c.offsetWidth?(c.scrollLeft>0?u(!1):u(!0),c.scrollWidth-(c.scrollLeft+c.clientWidth)<1?p(!0):p(!1),f(!0)):f(!1)}),500);const y=s()("CardTabs",a);return n.createElement("div",{className:"CardTabs__nav"},g&&n.createElement(Xe.Z,{className:"CardTabs_nav-chevron-left ".concat(m&&"ghq-is-disabled"),icon:"chevron-left",size:14,onClick:m?()=>{}:()=>dv({blockRef:c,direction:"left",currentTabWidth:120})}),n.createElement("div",{className:y,ref:d},t.map(((e,t,a)=>{var s,c;let{id:d,name:m,tabOrderIndex:u,data:h,meta:{verificationState:p,isEditing:g,isNew:f,isQuestion:E,isError:y,isSynced:b,isCreatingNew:S}}=e;const Z=o()(a,"[".concat(t-1,"].id"))!==r&&r!==d&&0!==t,N=null==v?void 0:v.find((e=>((e,t)=>{var a,n;return[null===(a=e.data)||void 0===a?void 0:a.id,null===(n=e.data)||void 0===n?void 0:n.userId].includes(t)})(e,d))),I=null!==(s=null==N||null===(c=N.data)||void 0===c?void 0:c.displayName)&&void 0!==s?s:"",T=C?null:m||I,A=I?!N.isSuccess:y;return n.createElement(av,{className:"CardTabs__tab",hasBorderLeft:Z,key:d,name:T,verificationState:N?le().TRUSTED:p,isEditing:g,isNew:f,isError:!C&&A,isQuestion:E,isSynced:b,isActive:[d,h.id].includes(r),isCreatingNew:S,tabOrderIndex:u,onClick:()=>{i({clickedTabId:d})},onClickClose:e=>{e.stopPropagation(),l(d)}})}))),g&&n.createElement(Xe.Z,{className:"CardTabs_nav-chevron-right ".concat(h&&"ghq-is-disabled"),icon:"chevron-right",size:14,onClick:h?()=>{}:()=>dv({blockRef:c,direction:"right",currentTabWidth:120})}),n.createElement(cv,{activeTabId:r,overflowItems:t,onClickTab:i,onClickTabClose:l}))}mv.propTypes={activeTabCardId:D().string,className:D().string,tabItems:D().arrayOf(D().shape({id:D().string,name:D().string})),onClickTab:D().func,onClickTabClose:D().func},mv.defaultProps={activeTabCardId:null,className:"",tabItems:[],onClickTab:null,onClickTabClose:null};class uv extends n.Component{constructor(){super(...arguments),this.onClickTab=e=>{let{clickedTabId:t}=e;const{openCardId:a}=this.props;d.Z.setFactsTabWindowActiveCard(t),a!==t&&M.Z.postActivity({type:Pt.default.FACT_REVEALED,properties:{factId:t},biOnly:!0})},this.closeCard=e=>{d.Z.discardFact(e)}}render(){const{openCardId:e,tabItems:t}=this.props;return n.createElement(mv,{ref:this.handleRef,activeTabCardId:e,className:"ExtensionCardTabs",tabItems:t,onClickTab:this.onClickTab,onClickTabClose:this.closeCard})}}uv.propTypes={openCardId:D().string,tabItems:D().arrayOf(D().shape({id:D().string,name:D().string}))},uv.defaultProps={openCardId:null,tabItems:[]};var hv=uv;class pv extends n.Component{constructor(e){super(e),this.getItemType=()=>{const{fact:e}=this.props;let t=e.data.cardType;!t&&e.editFact&&(t=e.editFact.data.cardType),t=t||le().CARD;const a=e.cardState;return a&&t===le().QUESTION?a:e.data.type===le().PROFILE?le().PROFILE:t},this.state={activeAnnouncement:null,showCommentsTray:!1}}componentDidMount(){const e=Pe.Z.getTeamId();Sr.Z.hasCardAttributes()&&V.get(e,{pathVars:[e]})}shouldComponentUpdate(e){return!e.hidden||!this.props.hidden}render(){var e,t;const{fact:a,factBoards:r,collaborators:i,verifiers:o,canClose:l,auth:c,teamAttributes:m,hidden:u}=this.props,h={fact:a},p={activeAnnouncement:this.state.activeAnnouncement,canClose:l,canDrag:!0,canMaximize:l,canView:!1,hasCardHeaderVerificationAccent:l,hasComments:null===(e=!a.data.archived)||void 0===e||e,hasDetails:null===(t=!a.data.archived)||void 0===t||t,isMaximized:pa.ZP.getFactsTabWindow().data.maximize,showCommentsTray:this.state.showCommentsTray,onClickMaximize:()=>{d.Z.setFactsTabWindowMaximized(null)},setActiveAnnouncement:e=>this.setState({activeAnnouncement:e}),setShowCommentsTray:e=>this.setState({showCommentsTray:e})};let g=null;const f=this.getItemType();switch(f){case le().PROFILE:g=n.createElement(YE,{profileId:a.id});break;case le().CARD:case le().FILE:g=[le().EDITING,le().NEW].includes(a.action)?n.createElement(n.Fragment,null,n.createElement(Yu,{fact:a,factBoards:r,sharers:i,verifiers:o}),Sr.Z.hasCardAttributes()?m.status===le().LOADED?n.createElement(Mp,{fact:a}):null:n.createElement(Mp,{fact:a})):n.createElement(ah,null);break;case le().QUESTION:g=n.createElement(Ag,{auth:c,fact:a,hasCloseButton:l});break;case le().Views.ANSWER:g=n.createElement(Ag,{auth:c,fact:a,hasCloseButton:l,initialView:le().Views.ANSWER});break;case le().Views.ANSWER_WITH_EXISTING_CARD:g=n.createElement(Ag,{auth:c,fact:a,hasCloseButton:l,initialView:le().Views.ANSWER_WITH_EXISTING_CARD});break;case le().Views.DELETE_QUESTION:case le().Views.CHANGE_ANSWERER:case le().Views.CHOOSE_ANSWER_METHOD:case le().Views.ANSWER:case le().Views.DISCUSSION:g=n.createElement(Ag,{auth:c,fact:a,hasCloseButton:l,initialView:le().Views.DISCUSSION})}const E=s()("TabbedCardShell__panel",{"ghq-is-hidden":u,"ghq-is-profile":f===le().PROFILE});return n.createElement("div",{className:E},n.createElement(ye.ZP.Provider,{value:(0,ye.XL)(a,h,p)},g,n.createElement(fr.FN,{filter:"fact-card-".concat(a.id)})))}}pv.propTypes={fact:D().object.isRequired,canClose:D().bool},pv.defaultProps={canClose:!0};var gv=(0,h.Z)(((e,t)=>{const{CollaboratorsStore:a,FactBoardsStore:n,VerifiersStore:r}=e,{fact:s}=t;return{auth:Pe.Z.getState(),teamAttributes:R.getFilter(Pe.Z.getTeamId()),collaborators:a.getBySearchId(s.data.id),factBoards:n.getByFactId(s.data.id||s.id),verifiers:r.getBySearchId(s.id)}}))([Pe.Z,ha.Z,Ai.Z,nd.Z,R],pv),fv=a(27356);var Ev=function(e){let{factTitle:t,id:a,hidden:r}=e;const i=s()("TabbedCardShell403Error",{"ghq-is-hidden":r});return n.createElement("div",{className:i},n.createElement(Xe.Z,{className:"TabbedCardShell403Error__close",size:16,icon:"close",onClick:()=>{d.Z.discardFact(a)}}),n.createElement("img",{draggable:"false",className:"TabbedCardShell403Error__error",src:xt.Z.getURL("common/images/permissions.svg")}),n.createElement("div",{className:"TabbedCardShell403Error__text"},'To view the Card "',t,'" request access from'," ",n.createElement(Sn.Z,{to:fv.ZP.APP_TEAM_ADMIN},"your Guru admins.")))};var vv=function(e){const{message:t,id:a,hidden:r}=e,i=s()("TabbedCardShellError",{"ghq-is-hidden":r});return n.createElement("div",{className:i},n.createElement("img",{draggable:"false",className:"TabbedCardShellError__error",src:xt.Z.getURL("common/images/error-cat@2x.png")}),n.createElement("div",{className:"TabbedCardShellError__text"},t),n.createElement(We.Z,{secondary:!0,destructive:!0,value:"Exit",onClick:()=>{d.Z.discardFact(a)}}))};var Cv=e=>{let{tabs:t}=e;const[a,r]=(0,ls.Z)(),s="true"===a.data.preferences.showTabsCloseWarning,i=t.length;return n.createElement("div",{className:"TabbedShellCloseConfirmation"},n.createElement(lf.ZP,{level:lf.y5.H2,style:lf.Lx.Normal},"Close all tabs?"),n.createElement(St.ZP,null,"You are about to close ".concat(i," ").concat((0,_t.B$)("tab",i)).concat((()=>{const e=t.filter((e=>e.meta.isNew||e.meta.isEditing)).length;return 0===e?"":" - ".concat(e," ").concat((0,_t.bj)(e)," currently being edited")})(),".")," Are you sure you'd like to continue?"),n.createElement(Wa.Z,{alignment:Wa.A.Center},n.createElement(ft.ZP,{label:"Cancel",style:ft.ZJ.Text,theme:ft.bn.Gray,onClick:()=>{d.Z.setFactsTabWindowShowCloseConfirmation(!1)}}),n.createElement(ft.ZP,{label:"Close tabs",style:ft.ZJ.Outline,theme:ft.bn.Destructive,onClick:()=>{d.Z.discardAllFacts(),d.Z.setFactsTabWindowShowCloseConfirmation(!1)}})),n.createElement("section",{className:"TabbedShellCloseConfirmation__preference-option"},n.createElement(Os.Z,{name:"opt-out",isChecked:!s,label:"Don't warn me when attempting to close multiple tabs",onChange:e=>{return t="showTabsCloseWarning",a=!e,r.setPreference(t,a),void r.savePreference(t,a);var t,a}}),n.createElement(St.ZP,{style:St.Jo.Dim,modifier:St.s4.Italicized},"This option can be managed in Preferences")))},yv=a(5257),bv=a(91717);class Sv extends n.Component{constructor(){super(...arguments),this.state={usingResize:!1},this.maximizeWindow=()=>{const{FactsTabWindow:{maximize:e}}=this.props;d.Z.setFactsTabWindowMaximized(!e)},this.discardAllFacts=()=>{const{preferences:e}=this.props;"false"!==o()(e,"data.preferences[showTabsCloseWarning]")?d.Z.setFactsTabWindowShowCloseConfirmation(!0):d.Z.discardAllFacts()},this.renderActiveCard=()=>{const{FactsTabWindow:{activeCard:e,lastActiveCard:t}}=this.props,a=o()(this.props,"openFacts",[]),r=o()(a.filter((e=>e.id===t)),"[0]",null);return a.map((s=>{var i;const l=o()(s,"status",""),c=o()(s,"isNew",!1),d=![s.id,s.data.id].includes(e),m=d?null:n.createElement("div",{className:"TabbedCardShell__loader",key:s.id},n.createElement(Nt.ZP,null));return l===oe.LOADED||c||l===oe.CONFIRM?n.createElement(gv,{fact:s,hidden:d,canClose:1===a.length,key:s.id}):l!==oe.LOADING||null===r||e.includes("new-")&&t.includes("new-")?l===oe.ERROR&&403===(null==s||null===(i=s.errorObject)||void 0===i?void 0:i.status)?n.createElement(Ev,{factTitle:s.extendedText,id:e,hidden:d,key:s.id}):l===oe.ERROR?n.createElement(vv,{message:s.messageText,id:e,hidden:d,key:s.id}):m:m}))},this.getDefaultPosition=()=>{const e=parseInt(this.props.FactsTabWindow.size.width)||672;return"EXTENSION_LEFT"===(0,bv.bS)(this.props.preferences)?{x:350,y:50}:{x:window.innerWidth-e-350,y:50}},this.handleEscape=e=>{const{FactsTabWindow:{activeCard:t}}=this.props,a=e.target.className;!!a.includes("ghq-chip-input-live-input")||a.includes("ghq-Menu__search")||a.includes("FilterOptionsMenu")||(d.Z.discardFact(t),e.stopPropagation())},this.handleShiftEscape=e=>{this.discardAllFacts(),e.stopPropagation()},this.handleDragDisableTextHighlighting=e=>{e.preventDefault&&e.preventDefault()}}render(){const{FactsTabWindow:{activeCard:e,size:t,maximize:a,showCloseConfirmation:r,factOrder:i,position:l=this.getDefaultPosition()}}=this.props,{usingResize:c}=this.state,m=o()(this.props,"openFacts",[]),u=m.length>0,h=m.map((e=>({id:e.id,tabOrderIndex:o()(i,"[".concat(e.id,"]"),{num:1,acc:0}),name:o()(e,"editFact.data.preferredPhrase",e.data.preferredPhrase),data:e.data,meta:{verificationState:e.status===le().LOADED?e.data.verificationState:null,isEditing:e.action===le().EDITING,isNew:e.isNew,isError:e.status===le().ERROR,isQuestion:o()(e,"editFact.data.cardType","")===le().QUESTION,isSynced:o()(e,"data.collection.collectionType")===Lm.Z.EXTERNAL&&!1===o()(e,"data.collection.syncVerificationEnabled",!1),isCreatingNew:e.messageKey===le().CREATING_NEW_CARD}})));h.sort(((e,t)=>e.tabOrderIndex.num-t.tabOrderIndex.num));const p=100,g={height:window.innerHeight-p,width:window.innerWidth-p},f={x:50,y:50},E=s()("ghq-TabbedCardShell__overflow-wrapper",{"is-single":1===h.length}),v=s()("ghq-TabbedCardShell__react-draggable",{"ghq-is-maximized":a}),C=n.createElement(XE.s,{className:v,cancel:".ghq-is-not-draggable",size:a?g:t,position:c?null:a?f:l,disableDragging:a,dragHandleClassName:"ghq-can-drag",enableResizing:a?{top:!1,right:!1,bottom:!1,left:!1,topRight:!1,bottomRight:!1,bottomLeft:!1,topLeft:!1}:{top:!0,right:!1,bottom:!0,left:!0,topRight:!0,bottomRight:!0,bottomLeft:!0,topLeft:!0},minWidth:Ee().size.MIN_WIDTH,minHeight:Sr.Z.hasKCSReports()?Ee().size.KCS_FEATURE_FLAG_MIN_HEIGHT:Ee().size.MIN_HEIGHT,bounds:"window",onDragStart:e=>{window.addEventListener("mousedown",this.handleDragDisableTextHighlighting(e))},onDragStop:(e,a)=>{d.Z.setFactsTabWindowSizeAndLocation({x:a.x,y:a.y,width:t.width,height:t.height}),window.removeEventListener("mousedown",this.handleDragDisableTextHighlighting(e))},onResizeStart:()=>{this.setState({usingResize:!0})},onResizeStop:(e,t,a,n,r)=>{d.Z.setFactsTabWindowSizeAndLocation({width:a.style.width,height:a.style.height,...r}),this.setState({usingResize:!1})}},n.createElement("div",{className:E},r&&n.createElement(Cv,{tabs:h}),!r&&m.length>1&&n.createElement("div",{className:"ghq-TabbedCardShell__nav ghq-can-drag"},n.createElement(hv,{tabItems:h,openCardId:e}),n.createElement("div",{className:"ghq-TabbedCardShell__nav-end-functions","data-testid":"TabbedCardShell__nav-actions"},n.createElement(Xe.Z,{icon:a?"collapse-window":"expand-window",size:16,onClick:this.maximizeWindow}),n.createElement(Xe.Z,{icon:"close",size:16,onClick:this.discardAllFacts}))),!r&&this.renderActiveCard()));return n.createElement(n.Fragment,null,u?a?n.createElement($E.Z,{fullscreen:!0},n.createElement("div",{className:"ghq-TabbedCardShell"},C)):n.createElement("div",{className:"ghq-TabbedCardShell"},C):null)}}var Zv=(0,Ce.Z)((0,h.Z)((()=>({FactsTabWindow:pa.ZP.getFactsTabWindow().data,preferences:yv.Z.getState()})))([pa.ZP,yv.Z],Sv));var Nv=(0,h.Z)((()=>({hasExtensionTabsPreferences:JSON.parse(o()(yv.Z.getState(),"data.preferences['hasExtensionCardTabs']","true")),facts:pa.ZP.getState(),openFacts:pa.ZP.getOpenFacts(),preview:pa.ZP.getPreviewState(),hasMaximizedCard:pa.ZP.isMaximized()})))([pa.ZP,Sr.Z],(e=>{const t=ts.Z.getQueryParam("template_id"),a=null!==t,[{data:r,status:i}]=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{preventOnLoad:!0};const[a,n]=(0,T.Z)({filterId:e,store:b,actions:I,onMustLoad:a=>{t.preventOnLoad||a.get({pathVars:[e]})}});return[a,n]}(t,{preventOnLoad:!a});let o=c()((()=>{const{openFacts:t}=e;t.forEach((e=>{d.Z.handleWindowResize(e.id,window.innerWidth,window.innerHeight)}))}));(0,n.useEffect)((()=>(o=c()(o,100),window.addEventListener("resize",o),()=>{window.removeEventListener("resize",o)})),[]),(0,n.useEffect)((()=>{a&&i===u.S.Loaded&&d.Z.createFact({content:r.content,preferredPhrase:r.preferredPhrase,visible:!0,preventTemplate:!0,createdFromTemplateGallery:!0})}),[i]);const l=t=>{const{allowPins:a,facts:r}=e;return n.createElement(QE,{allowMaximized:!0,key:t.id,routerless:m.ZP.isExtension(),fact:t,isMaximized:t.maximized,allowPin:a,isTopCard:t.id===r.focusedFacts[r.focusedFacts.length-1]})},{facts:h,openFacts:p,preview:g,hasMaximizedCard:f,hasExtensionTabsPreferences:E}=e,{focusedFacts:v}=h,C=v[v.length-1],y=p.filter((e=>e.id===C||e.data.id===C))[0],S=s()("ghq-Cards",{"ghq-is-dragging":h.dragging,"ghq-is-maximized":f,"ghq-is-previewing":g});return m.ZP.isExtension()?E?n.createElement(Zv,{openFacts:p}):n.createElement("div",{className:S},f&&n.createElement("div",{className:"ghq-fact-glass"}),p.map((e=>l(e)))):n.createElement("div",{className:S},f&&n.createElement("div",{className:"ghq-fact-glass"}),y&&l(y))}))},74173:function(e,t,a){"use strict";var n=a(84801),r=a(47421),s=a(42584),i=a(12713),o=a(29857),l=a(27171);n.Z.register(i.FavoriteListsList,{GET:{path:"/favoritelists/:listid"},DELETE:{path:"/favoritelists/:listid"},PUT:{path:"/favoritelists/:listid"}});const c=new l.Z({name:i.FavoriteListsList,syncFilters:!1,dataType:i.OBJECT,boundActions:["".concat(r.LOAD_MORE_FAVORITE_LIST_ITEMS).concat(r._START),function(e){let{filterId:t}=e;this._getFilter(t).syncCapable.status=s.UPDATING,this._onChange()},"".concat(r.LOAD_MORE_FAVORITE_LIST_ITEMS).concat(r._COMPLETE),function(e){let{data:t,context:{filterId:a}}=e;const n=this._getFilter(a);n.syncCapable.status=s.LOADED,Object.keys(t).forEach((e=>{n.syncCapable.data.items.some(((a,n,r)=>a.id===e&&(r[n]=t[e],!0)))})),this._resetEditData(n),this._onChange()}]});c.createStore(),t.Z=o.Z.addStore(c.store)},55173:function(e,t,a){"use strict";var n=a(84801),r=a(12713),s=a(29857),i=a(27171);n.Z.register(r.Favoritelists,{GET:{path:"/favoritelists"},POST:{path:"/favoritelists"}});const o=new i.Z({name:r.Favoritelists});o.createStore(),t.Z=s.Z.addStore(o.store)},17233:function(e,t,a){"use strict";var n=a(84801),r=a(12713),s=a(29857),i=a(27171);n.Z.register(r.KCSCards,{GET:{path:"/kcs"},POST:{path:"/kcs"},DELETE:{path:"/kcs/:cardId"}});const o=new i.Z({name:r.KCSCards,syncFilters:!1});o.createStore(),t.Z=s.Z.addStore(o.store)},38542:function(e,t,a){"use strict";var n=a(67294),r=a(94184),s=a.n(r),i=a(60309),o=a(9248),l=a(76030),c=a(65680);t.Z=e=>{let{color:t,emoji:a,isPreviewing:r=!1,madeByGuru:d=!1,madeByGuruSimplifiedIcon:m=!1}=e;const u=a&&(null==a?void 0:a.length)>0,h={style:d&&t?void 0:{backgroundColor:t},size:r?40:16};return d?n.createElement(c.Z,{icon:l.Z.GuruAllBlack,size:28}):m?n.createElement(c.Z,{icon:l.Z.Guru}):n.createElement("span",{className:s()("CollectionIcon",{CollectionIcon__Preview:r}),style:h.style},u?n.createElement("div",{className:s()("CollectionIcon__Emoji",{CollectionIcon__Preview:r}),"data-testid":"CollectionIcon__Emoji"},n.createElement(i.cJ,{shortcodes:a,size:"".concat(h.size,"px")})):n.createElement("div",{className:s()("CollectionIcon__Icon",{CollectionIcon__Preview:r}),"data-testid":"CollectionIcon__Icon"},n.createElement(c.Z,{color:o.ZP.Spirit,icon:l.Z.Collection,size:h.size})))}},60309:function(e,t,a){"use strict";a.d(t,{Tm:function(){return d},cJ:function(){return c},jO:function(){return l}});a(15306);var n=a(67294),r=a(26638),s=a(73814),i=a(6431),o=a(25108);(0,i.S1)({data:r,maxFrequentRows:4,skin:1});const l=e=>{let{theme:t,onEmojiSelect:a}=e;return n.createElement(s.Z,{data:r,theme:t,skinTonePosition:"none",skin:"1",onEmojiSelect:a})},c=e=>{let{shortcodes:t,ariaLabel:a,size:r="1em"}=e;return t?n.createElement("em-emoji",{"aria-label":a,role:"img",shortcodes:t,size:r}):null},d=e=>{const t=i.WV.get((e=>e.split("::")[0].replace(/:/g,""))(e));if(t)return t;o.info("Emoji ".concat(e," not found."))}},42300:function(e,t,a){"use strict";a.d(t,{S:function(){return l}});var n=a(67294),r=a(94184),s=a.n(r),i=a(9248),o=a(65680);const l=e=>{let{groupLabel:t,children:a}=e;return n.createElement("fieldset",{className:"fieldset-sage"},n.createElement("legend",{className:"legend-sage"},t),a)};t.Z=e=>{let{label:t,disabled:a,name:r,onChange:l,isChecked:c,id:d,icon:m}=e;const u=s()("RadioButton-sage__input",{"FormControl-sage--is-disabled":a});return n.createElement("label",{className:"RadioButton-sage"},n.createElement("input",{className:u,disabled:a,checked:c,id:d,name:r,type:"radio",onChange:()=>{l(!c)}}),n.createElement("span",{className:"RadioButton-sage__label"},m?n.createElement("span",{className:"RadioButton-sage__icon"},n.createElement(o.Z,{icon:m,size:17,color:i.ZP.Twilight})):null,t))}},21136:function(e,t,a){"use strict";a.d(t,{N_:function(){return f.Z},De:function(){return E.Z},$A:function(){return p.$},ZP:function(){return S}});a(33948);var n=a(67294),r=a(94184),s=a.n(r),i=a(87159),o=a(57682),l=a(44214),c=a(76030),d=a(65680);const m=e=>{let{clearAfterSelect:t=!1,disabled:a=!1,isExpanded:r=!1,onClick:s}=e;const{selectedOption:i}=(0,l.n)(),c=Boolean(i.avatar||i.initials),m=Boolean(i.icon||i.customIcon);return r||t||!c&&!m?null:n.createElement("button",{"aria-hidden":"true","aria-label":"combobox prepend trigger",className:"ComboBoxTrigger-sage__prepend",disabled:a,tabIndex:-1,type:"button",onClick:s},c?n.createElement(o.Z,{alt:i.avatarDescription,initials:i.initials,size:o.Z.sizes.XSMALL,src:i.avatar}):n.createElement(d.Z,{color:i.iconColor,customColor:i.customColor,icon:i.icon}))},u=(e,t)=>{let{autofocus:a=!1,clearAfterSelect:r=!1,disabled:s=!1,isExpanded:i=!1,listName:o,onChange:u,onClick:h,onFocus:p,onKeyDown:g,placeholder:f="",value:E}=e;const{focusedOption:v,name:C}=(0,l.n)();return n.createElement("div",{className:"ComboBoxTrigger-sage"},n.createElement(m,{clearAfterSelect:r,disabled:s,isExpanded:i,onClick:h}),n.createElement("input",{autoFocus:a,"aria-activedescendant":v&&v.value,"aria-autocomplete":"none","aria-controls":o,"aria-expanded":i,"aria-haspopup":"listbox",autoComplete:"off",className:"ComboBoxTrigger-sage__input FormControl-sage__input",disabled:s,id:C,placeholder:f,ref:t,role:"combobox",type:"text",value:E,onChange:u,onClick:h,onFocus:p,onKeyDown:g}),n.createElement("button",{"aria-hidden":"true","aria-label":"combobox trigger",className:"ComboBoxTrigger-sage__button",disabled:s,tabIndex:-1,type:"button",onClick:h},n.createElement(d.Z,{icon:i?c.Z.ChevronUp:c.Z.ChevronDown,size:20})))};var h=(0,n.forwardRef)(u),p=a(48277),g=a(26274),f=a(88906),E=a(36913),v=a(72854),C=a(79689),y=a(26965),b=a(48863);var S=(0,n.forwardRef)(((e,t)=>{let{children:a,clearAfterSelect:r=!1,disabled:o=!1,errorMessage:c="",helperText:d=null,label:m,name:u,onBlur:f=(()=>{}),onFocus:E=(()=>{}),onChange:S=(()=>{}),onInputChange:Z,placeholder:N,required:I=!1,requirementLabel:T,value:A="",emptyState:_,autofocus:w=!1}=e;const D=(0,n.useRef)(null),[P,k]=(0,n.useState)(""),[L,M]=(0,n.useState)(0),[O,F]=(0,n.useState)(!1),[R,x]=(0,n.useState)({label:"",value:""}),{optionMap:q,filteredOptions:B,setFilteredOptions:V}=(0,C.Z)({children:a}),U=e=>{V(q),k(r?"":e||R.label),M(0),F(!1)};(0,n.useEffect)((()=>{let e=q.find((e=>e.value===A));if(e){var t;if(x(e),r)return U(),void(null===(t=D.current)||void 0===t||t.focus());O||k(e.label)}else x({label:"",value:""})}),[q,A]);const H=()=>{U(),f()},W=e=>{S(e.value),x(e),U(e.label)},G=s()("ComboBox-sage FormControl-sage",{"FormControl-sage--is-disabled":o,"ComboBox-sage--has-errors":Boolean(c)&&!O}),z="".concat(u,"-list");return n.createElement("div",{className:G},n.createElement(y.Z,{label:m,name:u,requirementLabel:T}),n.createElement(l.Z,{filteredOptions:B,focusedOption:B[L],name:u,selectedOption:R,setFocusedIndex:M,setSelectedOption:W},n.createElement("div",{className:"ComboBox-sage__container FormControl-sage__container",onBlur:e=>{(0,g.r)(e)&&H()}},n.createElement(h,{autofocus:w,clearAfterSelect:r,disabled:o,isExpanded:O,listName:z,placeholder:N,ref:D,value:P,onChange:e=>{const t=e.target.value;if(k(t),Z)Z(t);else{const e=(e=>e.length?q.reduce(((t,a)=>{const{label:n}=a,r=n.toLowerCase(),s=e.toLowerCase();return r.includes(s)&&t.push(a),t}),[]):q)(t);V(e),M(0)}O||F(!0)},onClick:()=>{var e;O||(null===(e=D.current)||void 0===e||e.select());F(!O)},onFocus:E,onKeyDown:e=>{const t=B.length-1;let a=L;switch(e.key){case i.R.ArrowDown:e.preventDefault(),O&&(a=L===t?0:L+1),F(!0),M(a);break;case i.R.ArrowUp:e.preventDefault(),a=0===L?t:L-1,F(!0),M(a);break;case i.R.Enter:e.preventDefault();const n=B[L];O&&n&&W(n);break;case i.R.Home:e.preventDefault(),F(!0),M(0);break;case i.R.End:e.preventDefault(),F(!0),M(t);break;case i.R.Tab:case i.R.Escape:H()}}}),n.createElement(v.Z,{isExpanded:O,listName:z,maxPopoverHeight:p.E.Small,parentRef:D,emptyState:_},a))),n.createElement("input",{readOnly:!0,disabled:o,name:u,required:I,tabIndex:-1,type:"hidden",value:A}),n.createElement(b.Z,{text:c||d,hasErrors:Boolean(c)}))}))},72006:function(){}}]);