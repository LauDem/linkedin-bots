Okta.startBackgroundScript=function(a,i,u,p){var d=1e3,n=Okta.Q.when,g=Okta.fn.storage.wrapVal,c=Okta.fn.base.timestamp,s=Okta.fn.api.getToSettings,l=Okta.fn.api.prependPath,P=Okta.fn.api.setSessionData,e=Okta._okta,k=e.first,y=e.filter,T=e.isUndefined,f=Okta.Q;function b(e){return"_lock_"+e}function h(){return T(a.isInstalledByUser)?f(!0):a.isInstalledByUser()}function r(e,t,o,n){switch(e){case"getSessionState":return i.get(o.key);case"setSessionState":return i.set(o.key,o.val);case"getPersistentState":return u.get(o.key);case"setPersistentState":return u.set(o.key,o.val);case"clearPersistentState":return u.clear&&u.clear(),o.result=!0,o.browserType=a.getType(),o;case"requestPrivacyPermissions":return T(a.requestPrivacyPermissions)?f({errorCode:"requestPrivacyPermissions is not supported on "+a.getType()}):a.requestPrivacyPermissions();case"getTabId":return t;case"getTabInfo":return T(a.getTabInfo)?f({errorCode:"not supported by this version of the plugin"}):a.getTabInfo(t);case"documentLoaded":return T(a.documentLoaded)?f({errorCode:"not supported by this version of the plugin"}):a.documentLoaded(t,n);case"getBrowserType":return a.getType();case"getBackgroundVersion":return a.getBackgroundVersion();case"unlockSessionKey":return function r(e){return i.set(b(e),null),!0}(o.key);case"lockSessionKey":return function s(e){var t=c(),o=b(e),n=i.get(o);return(!n||t>n.lockTime+d)&&(i.set(o,{lockTime:t}),!0)}(o.key);case"request":return p.ajax(o);case"openTab":return a.openTab(o.url);case"hasPrivacyPermissions":return a.hasPrivacyPermissions?a.hasPrivacyPermissions():f(g(!0));case"openPermissionsPage":return a.openPermissionsPage?a.openPermissionsPage():f({errorCode:"openPermissionsPage is not supported on "+a.getType()});case"openSettingsPage":return a.openSettingsPage?a.openSettingsPage():f({errorCode:"openSettingsPage is not supported on "+a.getType()});case"openOktaNewtab":return a.openOktaNewtab?a.openOktaNewtab():f({errorCode:"openOktaNewtab is not supported on "+a.getType()});case"servePopover":return a.servePopover?a.servePopover():f({errorCode:"servePopover is not supported on "+a.getType()});case"suppressSavePassword":return a.suppressSavePassword?a.suppressSavePassword(t,o):f({errorCode:"suppressSavePassword is not supported on "+a.getType()});case"getPasswordSavingDetails":return a.getPasswordSavingDetails?a.getPasswordSavingDetails():f({errorCode:"getPasswordSavingDetails is not supported on "+a.getType()});case"openTabForAccountChooser":return T(a.openTabForAccountChooser)?f({errorCode:"not supported by this version of the plugin",url:o.url}):a.openTabForAccountChooser(o.url);case"closeTab":return a.closeTab(t);case"getCookies":return T(a.getCookies)?f({errorCode:"not supported by this version of the plugin"}):a.getCookies(o.key.hostUrl,o.key.cookieNames,t);case"getLocalStorageUsage":return T(a.getLocalStorageUsage)?f({errorCode:"not supported by this version of the plugin"}):a.getLocalStorageUsage().fail(function(e){return f({errorCode:"failed to get the local storage usage: "+e})});case"updateBadge":return T(a.updateBadge)?f.resolve():a.updateBadge(o.key);case"downloadExtensionLogs":return T(a.downloadExtensionLogs)?f.resolve():a.downloadExtensionLogs(o.key);case"setUninstallURL":return T(a.setUninstallURL)?f.resolve():a.setUninstallURL(o.url||"");case"isInstalledByUser":return h();case"injectContentScript":return a.injectContentScript&&a.injectContentScript(t,n),f();case"getSessionTabState":return i.get(o.key+"_"+t);case"sendMsgToCurrentTab":return T(a.sendMsgToCurrentTab)?f({errorCode:"sendMsgToCurrentTab not supported on "+a.getType()}):a.sendMsgToCurrentTab(o);case"getUserPinned":return T(a.getUserPinned)?f({errorCode:"getUserPinned not supported on "+a.getType()}):a.getUserPinned();case"openPopup":return T(a.openPopup)?f({errorCode:"openPopup not supported on "+a.getType()}):a.openPopup(o.key);default:return f({errorCode:"Unknown msg type: "+e})}}function v(e){u.set("PENDO_ONBOARDING_DATA",{sentTo:e,timestamp:c()})}a.on("injectReady",function(e){a.injectScript(e,null)}),a.on("messageFromContent",function(t){var o=t.msg,e=r(o.type,t.tabId,o.data,t.frameId);n(e,function(e){a.post({msg:{id:o.id,type:o.type,data:e},tabId:t.tabId,portInfo:t.portInfo})}).done()}),a.on("postInstall",function(){return u.set("ONBOARDING_FLOW",!0),h().then(function(e){return Okta.Config.onboardingLaunchNewTab&&e?a.getOrgsWithSessionCookies():f(null)}).then(function(e){if(e)if(e.oktaAccounts&&0!==e.oktaAccounts.length){var t=1===e.oktaAccounts.length;if(!e.sessions||0===e.sessions.length)return a.openTab(t?k(e.oktaAccounts).origin+"/login/login.htm":"https://login.okta.com"),void v(t?"orgLogin":"oktaLogin");var o=y(e.sessions,function(e){return e.tabId!==undefined});if(!t&&0===o.length)return a.openTab("https://login.okta.com"),void v("oktaLogin");var n=k(t?e.sessions:o),r=s(n.domain+l("/settings"),{backgroundVersion:a.getBackgroundVersion(),contentVersion:""});P({sid:n.sid,DT:n.dt,idx:n.idx},r.headers),p.ajax(r).then(function(e){e?(u.set("PLUGIN_SETTINGS",{override:{},orgSettings:e}),e.pluginOnboardingEnabled?n.tabId!==undefined&&n.isDashboardTab?(a.highlightAndRefreshTab(n.tabId),v("refreshDashboard")):(a.openTab(n.domain+"/app/UserHome"),v("openDashboard")):v("none")):v("none")})}else v("zeroOrgs")})})};