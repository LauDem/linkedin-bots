Okta.WebExtension=function(r,e,t){var n=PLUGIN_VERSIONS.currentVersion;var a=Okta._okta;var i=a.compose;var o=a.delay;var s=a.extend;var u=Okta.Q;var d=Okta.Constants.StorageOktaAccountAllowListKey;var c=Okta.fn.action.updateBadge;var g=Okta.fn.action.getUserPinned;var l=Okta.fn.action.openPopup;var v=Okta.Events;var f=s({},v);var p=Okta.fn.base.curry2;var b=Okta.fn.base.always;var h=Okta.fn.url.getMonitoredSitesApiMatchPatterns;var k=i(Okta.fn.url.isOktaPluginHomePagePath,Okta.fn.url.hrefToUrlParts);var m=75;var P=Okta.fn.script;var w=Okta.fn.cookies.getCookies;var O=Okta.fn.browserType;var T=O.isSafari(t);var S=O.isSafariWebExt(t);var C=O.isFirefox(t);var I=O.isChrome(t);var L=new Okta.AuthenticationMonitor(r,e);var M=new Okta.SuppressPwdSave;var y=new Okta.MyPagesMenu(r);var U=new Okta.Onboarding(t);var A=new Okta.Tabs(t);var N=new Okta.API(r,e);var R=new Okta.BasicAuth(r,e);var B=new Okta.RequestHeaders(n,t,r,N);var D=new Okta.RuntimeMessage;var F=p(K);var z=chrome.runtime.onConnect;var E=chrome.runtime.onInstalled;var x=chrome.webRequest.onCompleted;var W=chrome.tabs.onCreated;var q=chrome.tabs.onUpdated;var G=chrome.tabs.onRemoved;var _={};var j=1e3;function V(e){return/^http/.test(e)}function H(e){var t=e.tabId;var n=e.frameId;if(n==0){M.deleteSuppressTab(t,true)}if(!V(e.url)){console.log("Skipped url: "+e.url);return}return A.getTab(t).then(function e(t){if(!t||!V(t.url)){return}P.injectPreloadScript(t.id,n)})}function K(e,t){f.trigger("messageFromContent",{msg:t,tabId:e.sender&&e.sender.tab?e.sender.tab.id:-1,frameId:e.sender?e.sender.frameId:0,portInfo:{port:e}})}function Q(){o(function(){L.initialize()},j)}function J(){if(C){return window&&window.navigator&&window.navigator.userAgent&&parseInt(window.navigator.userAgent.toLowerCase().split("firefox/").pop())>=m}return!T&&!S}f.getType=b(t);f.getBackgroundVersion=b(n);f.post=function e(t){if(!t.portInfo.port.isDisconnected){t.portInfo.port.postMessage(t.msg)}};f.injectContentScript=P.injectContentScript;f.openTab=A.openTab;f.sendMsgToCurrentTab=A.sendMsgToCurrentTab;f.openTabForAccountChooser=A.openTabForAccountChooser;f.openPermissionsPage=A.openPermissionsPage;f.openOktaNewtab=A.openOktaNewtab;f.servePopover=A.servePopover;f.closeTab=A.closeTab;f.highlightAndRefreshTab=A.highlightAndRefreshTab;f.openSettingsPage=A.openSettingsPage;f.getTabInfo=A.getTabInfo;f.getCookies=w;f.isInstalledByUser=U.isInstalledByUser;f.getOrgsWithSessionCookies=U.getOrgsWithSessionCookies;f.setUninstallURL=U.setUninstallURL;f.updateBadge=c;g&&(f.getUserPinned=g);l&&(f.openPopup=l);f.getLocalStorageUsage=r.getStorageUsage;if(S){chrome.webNavigation.onCompleted.addListener(H)}else{chrome.webNavigation.onDOMContentLoaded.addListener(H)}z.addListener(function e(t){t.onMessage.addListener(F(t));t.onDisconnect.addListener(function(){t.isDisconnected=true})});E&&E.addListener(function(e){var t=e&&e.reason;if(t!=="install"){return}f.trigger("postInstall")});x&&x.addListener(Q,{urls:h(),types:["xmlhttprequest"]});W&&W.addListener(function(a){return u.all([r.getDBGPluginSettings(),r.getNewTab()]).spread(function(e,t){var n=e&&e.NTEFlag;var r=t&&t.enableNTE;if(I&&n&&r&&a.pendingUrl==="chrome://newtab/"){chrome.tabs.update({url:chrome.runtime.getURL("shared/newtab/Newtab.html")})}})});q&&q.addListener(function(e,t,n){if(!t||!t.url){return u()}if(n&&n.url&&k(n.url)){_={};_[e]=n.url;return u()}if(_[e]){delete _[e];return r.clearWaitingForTabs()}});G&&G.addListener(function(e){if(!_[e]){return u()}delete _[e];return r.clearWaitingForTabs()});if(!!J()){f.suppressSavePassword=M.turnOffSavePasswordFeature;f.hasPrivacyPermissions=M.hasPrivacyPermissions;f.getPasswordSavingDetails=M.getPasswordSavingDetails;f.requestPrivacyPermissions=M.requestPrivacyPermissions}f.showMyPagesMenu=function(e){e?y.createMenu():y.destroyMenu()};r.readMultiAccount();chrome.storage.onChanged.addListener(function(e,t){if(t!=="local"){return}if(e["DBG_PLUGIN_SETTINGS"]||e[d]){return r.readMultiAccount()}});L.initialize(false);y.initializeMenu();M.initialize();R.initialize(t);B.initialize();D.initialize();return f};